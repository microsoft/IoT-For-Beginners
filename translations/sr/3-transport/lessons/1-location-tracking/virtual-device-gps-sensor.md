<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "64f18a8f8aaa1fef5e7320e0992d8b3a",
  "translation_date": "2025-08-28T13:19:41+00:00",
  "source_file": "3-transport/lessons/1-location-tracking/virtual-device-gps-sensor.md",
  "language_code": "sr"
}
-->
# Читање GPS података - Виртуелни IoT хардвер

У овом делу лекције, додаћете GPS сензор вашем виртуелном IoT уређају и читати вредности са њега.

## Виртуелни хардвер

Виртуелни IoT уређај ће користити симулирани GPS сензор који је доступан преко UART-а путем серијског порта.

Физички GPS сензор имаће антену за пријем радио таласа са GPS сателита и конвертовање GPS сигнала у GPS податке. Виртуелна верзија симулира ово омогућавајући вам да подесите географску ширину и дужину, пошаљете сирове NMEA реченице или отпремите GPX датотеку са више локација које се могу враћати секвенцијално.

> 🎓 NMEA реченице ће бити обрађене касније у овој лекцији

### Додавање сензора у CounterFit

Да бисте користили виртуелни GPS сензор, потребно је да га додате у CounterFit апликацију.

#### Задатак - додавање сензора у CounterFit

Додајте GPS сензор у CounterFit апликацију.

1. Направите нову Python апликацију на вашем рачунару у фасцикли названој `gps-sensor` са једном датотеком названом `app.py` и Python виртуелним окружењем, и додајте CounterFit pip пакете.

    > ⚠️ Можете се позвати на [упутства за креирање и подешавање CounterFit Python пројекта у лекцији 1 ако је потребно](../../../1-getting-started/lessons/1-introduction-to-iot/virtual-device.md).

1. Инсталирајте додатни Pip пакет за инсталацију CounterFit shim-а који може комуницирати са сензорима базираним на UART-у преко серијске везе. Уверите се да ово инсталирате из терминала са активираним виртуелним окружењем.

    ```sh
    pip install counterfit-shims-serial
    ```

1. Уверите се да је CounterFit веб апликација покренута.

1. Направите GPS сензор:

    1. У оквиру *Create sensor* у панелу *Sensors*, из падајућег менија *Sensor type* изаберите *UART GPS*.

    1. Оставите *Port* подешен на */dev/ttyAMA0*.

    1. Изаберите дугме **Add** да бисте креирали GPS сензор на порту `/dev/ttyAMA0`.

    ![Подешавања GPS сензора](../../../../../translated_images/counterfit-create-gps-sensor.6385dc9357d85ad1d47b4abb2525e7651fd498917d25eefc5a72feab09eedc70.sr.png)

    GPS сензор ће бити креиран и појавиће се на листи сензора.

    ![Креирани GPS сензор](../../../../../translated_images/counterfit-gps-sensor.3fbb15af0a5367566f2f11324ef5a6f30861cdf2b497071a5e002b7aa473550e.sr.png)

## Програмирање GPS сензора

Виртуелни IoT уређај сада може бити програмиран да користи виртуелни GPS сензор.

### Задатак - програмирање GPS сензора

Програмирајте апликацију за GPS сензор.

1. Уверите се да је апликација `gps-sensor` отворена у VS Code-у.

1. Отворите датотеку `app.py`.

1. Додајте следећи код на врх `app.py` да бисте повезали апликацију са CounterFit-ом:

    ```python
    from counterfit_connection import CounterFitConnection
    CounterFitConnection.init('127.0.0.1', 5000)
    ```

1. Додајте следећи код испод овог да бисте увезли потребне библиотеке, укључујући библиотеку за CounterFit серијски порт:

    ```python
    import time
    import counterfit_shims_serial
    
    serial = counterfit_shims_serial.Serial('/dev/ttyAMA0')
    ```

    Овај код увози модул `serial` из Pip пакета `counterfit_shims_serial`. Затим се повезује на серијски порт `/dev/ttyAMA0` - ово је адреса серијског порта који виртуелни GPS сензор користи за свој UART порт.

1. Додајте следећи код испод овог да бисте читали са серијског порта и штампали вредности на конзолу:

    ```python
    def print_gps_data(line):
        print(line.rstrip())
    
    while True:
        line = serial.readline().decode('utf-8')
    
        while len(line) > 0:
            print_gps_data(line)
            line = serial.readline().decode('utf-8')
    
        time.sleep(1)
    ```

    Дефинише се функција `print_gps_data` која штампа линију прослеђену њој на конзолу.

    Затим код бесконачно петља, читајући што више линија текста може са серијског порта у свакој итерацији. Позива функцију `print_gps_data` за сваку линију.

    Након што су сви подаци прочитани, петља спава 1 секунду, а затим покушава поново.

1. Покрените овај код, водећи рачуна да користите други терминал од оног на којем је CounterFit апликација покренута, како би CounterFit апликација остала активна.

1. У CounterFit апликацији, промените вредност GPS сензора. Можете то урадити на један од следећих начина:

    * Подесите **Source** на `Lat/Lon` и поставите експлицитну географску ширину, дужину и број сателита који се користе за GPS фиксацију. Ова вредност ће бити послата само једном, па означите **Repeat** кутију да би се подаци понављали сваке секунде.

      ![GPS сензор са изабраним lat lon](../../../../../translated_images/counterfit-gps-sensor-latlon.008c867d75464fbe7f84107cc57040df565ac07cb57d2f21db37d087d470197d.sr.png)

    * Подесите **Source** на `NMEA` и додајте неке NMEA реченице у текстуални оквир. Све ове вредности ће бити послате, са кашњењем од 1 секунде пре сваке нове GGA (позициона фиксација) реченице.

      ![GPS сензор са подешеним NMEA реченицама](../../../../../translated_images/counterfit-gps-sensor-nmea.c62eea442171e17e19528b051b104cfcecdc9cd18db7bc72920f29821ae63f73.sr.png)

      Можете користити алат као што је [nmeagen.org](https://www.nmeagen.org) за генерисање ових реченица цртањем на мапи. Ове вредности ће бити послате само једном, па означите **Repeat** кутију да би се подаци понављали једну секунду након што су сви послати.

    * Подесите **Source** на GPX датотеку и отпремите GPX датотеку са локацијама стазе. Можете преузети GPX датотеке са бројних популарних сајтова за мапирање и планинарење, као што је [AllTrails](https://www.alltrails.com/). Ове датотеке садрже више GPS локација као стазу, а GPS сензор ће враћати сваку нову локацију у интервалима од 1 секунде.

      ![GPS сензор са подешеном GPX датотеком](../../../../../translated_images/counterfit-gps-sensor-gpxfile.8310b063ce8a425ccc8ebeec8306aeac5e8e55207f007d52c6e1194432a70cd9.sr.png)

      Ове вредности ће бити послате само једном, па означите **Repeat** кутију да би се подаци понављали једну секунду након што су сви послати.

    Када конфигуришете GPS подешавања, изаберите дугме **Set** да бисте потврдили ове вредности за сензор.

1. Видећете сирови излаз са GPS сензора, нешто попут следећег:

    ```output
    $GNGGA,020604.001,4738.538654,N,12208.341758,W,1,3,,164.7,M,-17.1,M,,*67
    $GNGGA,020604.001,4738.538654,N,12208.341758,W,1,3,,164.7,M,-17.1,M,,*67
    ```

> 💁 Овај код можете пронаћи у фасцикли [code-gps/virtual-device](../../../../../3-transport/lessons/1-location-tracking/code-gps/virtual-device).

😀 Ваш програм за GPS сензор је успешно завршен!

---

**Одрицање од одговорности**:  
Овај документ је преведен коришћењем услуге за превођење помоћу вештачке интелигенције [Co-op Translator](https://github.com/Azure/co-op-translator). Иако се трудимо да превод буде тачан, молимо вас да имате у виду да аутоматизовани преводи могу садржати грешке или нетачности. Оригинални документ на његовом изворном језику треба сматрати меродавним извором. За критичне информације препоручује се професионални превод од стране људи. Не преузимамо одговорност за било каква погрешна тумачења или неспоразуме који могу настати услед коришћења овог превода.