<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "3f92edf2975175577174910caca4a389",
  "translation_date": "2025-08-27T14:17:33+00:00",
  "source_file": "6-consumer/lessons/1-speech-recognition/wio-terminal-speech-to-text.md",
  "language_code": "ne"
}
-->
# рдЖрд╡рд╛рдЬрд▓рд╛рдИ рдкрд╛рдардорд╛ рд░реВрдкрд╛рдиреНрддрд░рдг - Wio Terminal

рдпрд╕ рдкрд╛рдардХреЛ рдпрд╕ рднрд╛рдЧрдорд╛, рддрдкрд╛рдИрдВрд▓реЗ рдХреНрдпрд╛рдкреНрдЪрд░ рдЧрд░рд┐рдПрдХреЛ рдЕрдбрд┐рдпреЛрдорд╛ рд░рд╣реЗрдХреЛ рдЖрд╡рд╛рдЬрд▓рд╛рдИ рдкрд╛рдардорд╛ рд░реВрдкрд╛рдиреНрддрд░рдг рдЧрд░реНрди рдХреЛрдб рд▓реЗрдЦреНрдиреБрд╣реБрдиреЗрдЫ, рдЬрд╕рдорд╛ рдЖрд╡рд╛рдЬ рд╕реЗрд╡рд╛ рдкреНрд░рдпреЛрдЧ рдЧрд░рд┐рдиреНрдЫред

## рдЕрдбрд┐рдпреЛрд▓рд╛рдИ рдЖрд╡рд╛рдЬ рд╕реЗрд╡рд╛рдорд╛ рдкрдард╛рдЙрдиреБрд╣реЛрд╕реН

рдЕрдбрд┐рдпреЛрд▓рд╛рдИ рдЖрд╡рд╛рдЬ рд╕реЗрд╡рд╛рдорд╛ REST API рдкреНрд░рдпреЛрдЧ рдЧрд░реЗрд░ рдкрдард╛рдЙрди рд╕рдХрд┐рдиреНрдЫред рдЖрд╡рд╛рдЬ рд╕реЗрд╡рд╛ рдкреНрд░рдпреЛрдЧ рдЧрд░реНрдирдХрд╛ рд▓рд╛рдЧрд┐, рдкрд╣рд┐рд▓реЛ рдЪрд░рдгрдорд╛ рддрдкрд╛рдИрдВрд▓реЗ рдкрд╣реБрдБрдЪ рдЯреЛрдХрди рдЕрдиреБрд░реЛрдз рдЧрд░реНрдиреБрдкрд░реНрдЫ, рддреНрдпрд╕рдкрдЫрд┐ рдЙрдХреНрдд рдЯреЛрдХрди рдкреНрд░рдпреЛрдЧ рдЧрд░реЗрд░ REST API рдкрд╣реБрдБрдЪ рдЧрд░реНрди рд╕рдХрд┐рдиреНрдЫред рдпреА рдкрд╣реБрдБрдЪ рдЯреЛрдХрдирд╣рд░реВ резреж рдорд┐рдиреЗрдЯрдкрдЫрд┐ рд╕рдорд╛рдкреНрдд рд╣реБрдиреНрдЫрдиреН, рддреНрдпрд╕реИрд▓реЗ рддрдкрд╛рдИрдВрдХреЛ рдХреЛрдбрд▓реЗ рдирд┐рдпрдорд┐рдд рд░реВрдкрдорд╛ рдЯреЛрдХрди рдЕрдиреБрд░реЛрдз рдЧрд░реНрдиреБрдкрд░реНрдЫ рддрд╛рдХрд┐ рдЯреЛрдХрди рд╕рдзреИрдВ рдЕрджреНрдпрд╛рд╡рдзрд┐рдХ рд░рд╣реЛрд╕реНред

### рдХрд╛рд░реНрдп - рдкрд╣реБрдБрдЪ рдЯреЛрдХрди рдкреНрд░рд╛рдкреНрдд рдЧрд░реНрдиреБрд╣реЛрд╕реН

1. рдпрджрд┐ `smart-timer` рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдЦреБрд▓рд╛ рдЫреИрди рднрдиреЗ рдпрд╕рд▓рд╛рдИ рдЦреЛрд▓реНрдиреБрд╣реЛрд╕реНред

1. WiFi рдкрд╣реБрдБрдЪ рдЧрд░реНрди рд░ JSON рд╣реНрдпрд╛рдиреНрдбрд▓ рдЧрд░реНрди `platformio.ini` рдлрд╛рдЗрд▓рдорд╛ рдирд┐рдореНрди рдкреБрд╕реНрддрдХрд╛рд▓рдп рдирд┐рд░реНрднрд░рддрд╛рд╣рд░реВ рдердкреНрдиреБрд╣реЛрд╕реН:

    ```ini
    seeed-studio/Seeed Arduino rpcWiFi @ 1.0.5
    seeed-studio/Seeed Arduino rpcUnified @ 2.1.3
    seeed-studio/Seeed_Arduino_mbedtls @ 3.0.1
    seeed-studio/Seeed Arduino RTC @ 2.0.0
    bblanchon/ArduinoJson @ 6.17.3
    ```

1. `config.h` рд╣реЗрдбрд░ рдлрд╛рдЗрд▓рдорд╛ рдирд┐рдореНрди рдХреЛрдб рдердкреНрдиреБрд╣реЛрд╕реН:

    ```cpp
    const char *SSID = "<SSID>";
    const char *PASSWORD = "<PASSWORD>";
    
    const char *SPEECH_API_KEY = "<API_KEY>";
    const char *SPEECH_LOCATION = "<LOCATION>";
    const char *LANGUAGE = "<LANGUAGE>";

    const char *TOKEN_URL = "https://%s.api.cognitive.microsoft.com/sts/v1.0/issuetoken";
    ```

    `<SSID>` рд░ `<PASSWORD>` рд▓рд╛рдИ рддрдкрд╛рдИрдВрдХреЛ WiFi рдХрд╛ рд╕рдореНрдмрдиреНрдзрд┐рдд рдорд╛рдирд╣рд░реВрдорд╛ рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрди рдЧрд░реНрдиреБрд╣реЛрд╕реНред

    `<API_KEY>` рд▓рд╛рдИ рддрдкрд╛рдИрдВрдХреЛ рдЖрд╡рд╛рдЬ рд╕реЗрд╡рд╛ рд╕реНрд░реЛрддрдХреЛ API рдХреБрдЮреНрдЬреАрдорд╛ рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрди рдЧрд░реНрдиреБрд╣реЛрд╕реНред `<LOCATION>` рд▓рд╛рдИ рддрдкрд╛рдИрдВрд▓реЗ рдЖрд╡рд╛рдЬ рд╕реЗрд╡рд╛ рд╕реНрд░реЛрдд рд╕рд┐рд░реНрдЬрдирд╛ рдЧрд░реНрджрд╛ рдкреНрд░рдпреЛрдЧ рдЧрд░реЗрдХреЛ рд╕реНрдерд╛рдирдорд╛ рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрди рдЧрд░реНрдиреБрд╣реЛрд╕реНред

    `<LANGUAGE>` рд▓рд╛рдИ рддрдкрд╛рдИрдВ рдмреЛрд▓реНрдиреЗ рднрд╛рд╖рд╛рдХреЛ рд╕реНрдерд╛рдиреАрдп рдирд╛рдордорд╛ рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрди рдЧрд░реНрдиреБрд╣реЛрд╕реН, рдЬрд╕реНрддреИ рдЕрдВрдЧреНрд░реЗрдЬреАрдХрд╛ рд▓рд╛рдЧрд┐ `en-GB`, рд╡рд╛ рдХреНрдпрд╛рдиреНрдЯреЛрдирд┐рдЬрдХрд╛ рд▓рд╛рдЧрд┐ `zn-HK`ред рд╕рдорд░реНрдерд┐рдд рднрд╛рд╖рд╛рд╣рд░реВ рд░ рддрд┐рдирдХрд╛ рд╕реНрдерд╛рдиреАрдп рдирд╛рдорд╣рд░реВрдХреЛ рд╕реВрдЪреА [Microsoft Docs рдорд╛ рднрд╛рд╖рд╛ рд░ рдЖрд╡рд╛рдЬ рд╕рдорд░реНрдерди рджрд╕реНрддрд╛рд╡реЗрдЬ](https://docs.microsoft.com/azure/cognitive-services/speech-service/language-support?WT.mc_id=academic-17441-jabenn#speech-to-text) рдорд╛ рдкрд╛рдЙрди рд╕рдХрд┐рдиреНрдЫред

    `TOKEN_URL` рд╕реНрдерд┐рд░рд╛рдВрдХ рдЯреЛрдХрди рдЬрд╛рд░реАрдХрд░реНрддрд╛ URL рд╣реЛ, рд╕реНрдерд╛рдирдмрд┐рдирд╛ред рдпреЛ рдкрдЫрд┐ рд╕реНрдерд╛рдирд╕рдБрдЧ рдорд┐рд▓рд╛рдПрд░ рдкреВрд░реНрдг URL рдкреНрд░рд╛рдкреНрдд рдЧрд░рд┐рдиреЗрдЫред

1. Custom Vision рдорд╛ рдЬрд╕реНрддреИ, рдЯреЛрдХрди рдЬрд╛рд░реА рдЧрд░реНрдиреЗ рд╕реЗрд╡рд╛рд╕рдБрдЧ рдЬрдбрд╛рди рдЧрд░реНрди HTTPS рдЬрдбрд╛рди рдкреНрд░рдпреЛрдЧ рдЧрд░реНрди рдЖрд╡рд╢реНрдпрдХ рдЫред `config.h` рдХреЛ рдЕрдиреНрддреНрдпрдорд╛ рдирд┐рдореНрди рдХреЛрдб рдердкреНрдиреБрд╣реЛрд╕реН:

    ```cpp
    const char *TOKEN_CERTIFICATE =
        "-----BEGIN CERTIFICATE-----\r\n"
        "MIIF8zCCBNugAwIBAgIQAueRcfuAIek/4tmDg0xQwDANBgkqhkiG9w0BAQwFADBh\r\n"
        "MQswCQYDVQQGEwJVUzEVMBMGA1UEChMMRGlnaUNlcnQgSW5jMRkwFwYDVQQLExB3\r\n"
        "d3cuZGlnaWNlcnQuY29tMSAwHgYDVQQDExdEaWdpQ2VydCBHbG9iYWwgUm9vdCBH\r\n"
        "MjAeFw0yMDA3MjkxMjMwMDBaFw0yNDA2MjcyMzU5NTlaMFkxCzAJBgNVBAYTAlVT\r\n"
        "MR4wHAYDVQQKExVNaWNyb3NvZnQgQ29ycG9yYXRpb24xKjAoBgNVBAMTIU1pY3Jv\r\n"
        "c29mdCBBenVyZSBUTFMgSXNzdWluZyBDQSAwNjCCAiIwDQYJKoZIhvcNAQEBBQAD\r\n"
        "ggIPADCCAgoCggIBALVGARl56bx3KBUSGuPc4H5uoNFkFH4e7pvTCxRi4j/+z+Xb\r\n"
        "wjEz+5CipDOqjx9/jWjskL5dk7PaQkzItidsAAnDCW1leZBOIi68Lff1bjTeZgMY\r\n"
        "iwdRd3Y39b/lcGpiuP2d23W95YHkMMT8IlWosYIX0f4kYb62rphyfnAjYb/4Od99\r\n"
        "ThnhlAxGtfvSbXcBVIKCYfZgqRvV+5lReUnd1aNjRYVzPOoifgSx2fRyy1+pO1Uz\r\n"
        "aMMNnIOE71bVYW0A1hr19w7kOb0KkJXoALTDDj1ukUEDqQuBfBxReL5mXiu1O7WG\r\n"
        "0vltg0VZ/SZzctBsdBlx1BkmWYBW261KZgBivrql5ELTKKd8qgtHcLQA5fl6JB0Q\r\n"
        "gs5XDaWehN86Gps5JW8ArjGtjcWAIP+X8CQaWfaCnuRm6Bk/03PQWhgdi84qwA0s\r\n"
        "sRfFJwHUPTNSnE8EiGVk2frt0u8PG1pwSQsFuNJfcYIHEv1vOzP7uEOuDydsmCjh\r\n"
        "lxuoK2n5/2aVR3BMTu+p4+gl8alXoBycyLmj3J/PUgqD8SL5fTCUegGsdia/Sa60\r\n"
        "N2oV7vQ17wjMN+LXa2rjj/b4ZlZgXVojDmAjDwIRdDUujQu0RVsJqFLMzSIHpp2C\r\n"
        "Zp7mIoLrySay2YYBu7SiNwL95X6He2kS8eefBBHjzwW/9FxGqry57i71c2cDAgMB\r\n"
        "AAGjggGtMIIBqTAdBgNVHQ4EFgQU1cFnOsKjnfR3UltZEjgp5lVou6UwHwYDVR0j\r\n"
        "BBgwFoAUTiJUIBiV5uNu5g/6+rkS7QYXjzkwDgYDVR0PAQH/BAQDAgGGMB0GA1Ud\r\n"
        "JQQWMBQGCCsGAQUFBwMBBggrBgEFBQcDAjASBgNVHRMBAf8ECDAGAQH/AgEAMHYG\r\n"
        "CCsGAQUFBwEBBGowaDAkBggrBgEFBQcwAYYYaHR0cDovL29jc3AuZGlnaWNlcnQu\r\n"
        "Y29tMEAGCCsGAQUFBzAChjRodHRwOi8vY2FjZXJ0cy5kaWdpY2VydC5jb20vRGln\r\n"
        "aUNlcnRHbG9iYWxSb290RzIuY3J0MHsGA1UdHwR0MHIwN6A1oDOGMWh0dHA6Ly9j\r\n"
        "cmwzLmRpZ2ljZXJ0LmNvbS9EaWdpQ2VydEdsb2JhbFJvb3RHMi5jcmwwN6A1oDOG\r\n"
        "MWh0dHA6Ly9jcmw0LmRpZ2ljZXJ0LmNvbS9EaWdpQ2VydEdsb2JhbFJvb3RHMi5j\r\n"
        "cmwwHQYDVR0gBBYwFDAIBgZngQwBAgEwCAYGZ4EMAQICMBAGCSsGAQQBgjcVAQQD\r\n"
        "AgEAMA0GCSqGSIb3DQEBDAUAA4IBAQB2oWc93fB8esci/8esixj++N22meiGDjgF\r\n"
        "+rA2LUK5IOQOgcUSTGKSqF9lYfAxPjrqPjDCUPHCURv+26ad5P/BYtXtbmtxJWu+\r\n"
        "cS5BhMDPPeG3oPZwXRHBJFAkY4O4AF7RIAAUW6EzDflUoDHKv83zOiPfYGcpHc9s\r\n"
        "kxAInCedk7QSgXvMARjjOqdakor21DTmNIUotxo8kHv5hwRlGhBJwps6fEVi1Bt0\r\n"
        "trpM/3wYxlr473WSPUFZPgP1j519kLpWOJ8z09wxay+Br29irPcBYv0GMXlHqThy\r\n"
        "8y4m/HyTQeI2IMvMrQnwqPpY+rLIXyviI2vLoI+4xKE4Rn38ZZ8m\r\n"
        "-----END CERTIFICATE-----\r\n";
    ```

    рдпреЛ рддреНрдпрд╣реА рдкреНрд░рдорд╛рдгрдкрддреНрд░ рд╣реЛ рдЬреБрди рддрдкрд╛рдИрдВрд▓реЗ Custom Vision рдорд╛ рдЬрдбрд╛рди рдЧрд░реНрджрд╛ рдкреНрд░рдпреЛрдЧ рдЧрд░реНрдиреБрднрдПрдХреЛ рдерд┐рдпреЛред

1. `main.cpp` рдлрд╛рдЗрд▓рдХреЛ рд╢реАрд░реНрд╖рдорд╛ WiFi рд╣реЗрдбрд░ рдлрд╛рдЗрд▓ рд░ config рд╣реЗрдбрд░ рдлрд╛рдЗрд▓рдХреЛ рд╕рдорд╛рд╡реЗрд╢ рдердкреНрдиреБрд╣реЛрд╕реН:

    ```cpp
    #include <rpcWiFi.h>

    #include "config.h"
    ```

1. `setup` рдХрд╛рд░реНрдпрднрдиреНрджрд╛ рдорд╛рдерд┐ `main.cpp` рдорд╛ WiFi рдЬрдбрд╛рди рдЧрд░реНрди рдХреЛрдб рдердкреНрдиреБрд╣реЛрд╕реН:

    ```cpp
    void connectWiFi()
    {
        while (WiFi.status() != WL_CONNECTED)
        {
            Serial.println("Connecting to WiFi..");
            WiFi.begin(SSID, PASSWORD);
            delay(500);
        }
    
        Serial.println("Connected!");
    }
    ```

1. рдпреЛ рдХрд╛рд░реНрдпрд▓рд╛рдИ `setup` рдХрд╛рд░реНрдпрдмрд╛рдЯ рдХрд▓ рдЧрд░реНрдиреБрд╣реЛрд╕реН, рд╕реАрд░рд┐рдпрд▓ рдЬрдбрд╛рди рд╕реНрдерд╛рдкрдирд╛ рднрдПрдкрдЫрд┐:

    ```cpp
    connectWiFi();
    ```

1. `src` рдлреЛрд▓реНрдбрд░рдорд╛ рдирдпрд╛рдБ рд╣реЗрдбрд░ рдлрд╛рдЗрд▓ `speech_to_text.h` рд╕рд┐рд░реНрдЬрдирд╛ рдЧрд░реНрдиреБрд╣реЛрд╕реНред рдпрд╕ рд╣реЗрдбрд░ рдлрд╛рдЗрд▓рдорд╛ рдирд┐рдореНрди рдХреЛрдб рдердкреНрдиреБрд╣реЛрд╕реН:

    ```cpp
    #pragma once
    
    #include <Arduino.h>
    #include <ArduinoJson.h>
    #include <HTTPClient.h>
    #include <WiFiClientSecure.h>
    
    #include "config.h"
    #include "mic.h"
    
    class SpeechToText
    {
    public:

    private:

    };

    SpeechToText speechToText;
    ```

    рдпрд╕рд▓реЗ HTTP рдЬрдбрд╛рди, рдХрдиреНрдлрд┐рдЧрд░реЗрд╕рди, рд░ `mic.h` рд╣реЗрдбрд░ рдлрд╛рдЗрд▓рдХрд╛ рд▓рд╛рдЧрд┐ рдЖрд╡рд╢реНрдпрдХ рд╣реЗрдбрд░ рдлрд╛рдЗрд▓рд╣рд░реВ рд╕рдорд╛рд╡реЗрд╢ рдЧрд░реНрджрдЫ, рд░ `SpeechToText` рдирд╛рдордХ рдХрдХреНрд╖рд╛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдЧрд░реНрджрдЫ, рдЬрд╕рдХреЛ рдЙрджрд╛рд╣рд░рдг рдкрдЫрд┐ рдкреНрд░рдпреЛрдЧ рдЧрд░реНрди рд╕рдХрд┐рдиреНрдЫред

1. рдпрд╕ рдХрдХреНрд╖рд╛рдХреЛ `private` рдЦрдгреНрдбрдорд╛ рдирд┐рдореНрди рджреБрдИ рдХреНрд╖реЗрддреНрд░рд╣рд░реВ рдердкреНрдиреБрд╣реЛрд╕реН:

    ```cpp
    WiFiClientSecure _token_client;
    String _access_token;
    ```

    `_token_client` рдПрдХ WiFi Client рд╣реЛ рдЬрд╕рд▓реЗ HTTPS рдкреНрд░рдпреЛрдЧ рдЧрд░реНрджрдЫ рд░ рдкрд╣реБрдБрдЪ рдЯреЛрдХрди рдкреНрд░рд╛рдкреНрдд рдЧрд░реНрди рдкреНрд░рдпреЛрдЧ рдЧрд░рд┐рдиреЗрдЫред рдпреЛ рдЯреЛрдХрди `_access_token` рдорд╛ рднрдгреНрдбрд╛рд░рдг рдЧрд░рд┐рдиреЗрдЫред

1. `private` рдЦрдгреНрдбрдорд╛ рдирд┐рдореНрди рд╡рд┐рдзрд┐ рдердкреНрдиреБрд╣реЛрд╕реН:

    ```cpp
    String getAccessToken()
    {
        char url[128];
        sprintf(url, TOKEN_URL, SPEECH_LOCATION);
    
        HTTPClient httpClient;
        httpClient.begin(_token_client, url);
    
        httpClient.addHeader("Ocp-Apim-Subscription-Key", SPEECH_API_KEY);
        int httpResultCode = httpClient.POST("{}");
    
        if (httpResultCode != 200)
        {
            Serial.println("Error getting access token, trying again...");
            delay(10000);
            return getAccessToken();
        }
    
        Serial.println("Got access token.");
        String result = httpClient.getString();
    
        httpClient.end();
    
        return result;
    }
    ```

    рдпреЛ рдХреЛрдбрд▓реЗ рдЖрд╡рд╛рдЬ рд╕реНрд░реЛрддрдХреЛ рд╕реНрдерд╛рди рдкреНрд░рдпреЛрдЧ рдЧрд░реЗрд░ рдЯреЛрдХрди рдЬрд╛рд░реАрдХрд░реНрддрд╛ API рдХреЛ URL рдирд┐рд░реНрдорд╛рдг рдЧрд░реНрджрдЫред рддреНрдпрд╕рдкрдЫрд┐ рдпреЛ рд╡реЗрдм рдЕрдиреБрд░реЛрдз рдЧрд░реНрди `HTTPClient` рд╕рд┐рд░реНрдЬрдирд╛ рдЧрд░реНрджрдЫ, рдЯреЛрдХрди рдЕрдиреНрддрдмрд┐рдиреНрджреБрдХреЛ рдкреНрд░рдорд╛рдгрдкрддреНрд░рдХреЛ рд╕рд╛рде WiFi рдХреНрд▓рд╛рдЗрдиреНрдЯ рд╕реЗрдЯрдЕрдк рдЧрд░реНрджрдЫред рдпреЛ API рдХреБрдЮреНрдЬреАрд▓рд╛рдИ рдХрд▓рдХреЛ рд╣реЗрдбрд░рдХреЛ рд░реВрдкрдорд╛ рд╕реЗрдЯ рдЧрд░реНрджрдЫред рддреНрдпрд╕рдкрдЫрд┐ рдпреЛ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдкреНрд░рд╛рдкреНрдд рдЧрд░реНрди POST рдЕрдиреБрд░реЛрдз рдЧрд░реНрджрдЫ, рдпрджрд┐ рдХреБрдиреИ рддреНрд░реБрдЯрд┐ рдЖрдПрдорд╛ рдкреБрди: рдкреНрд░рдпрд╛рд╕ рдЧрд░реНрджрдЫред рдЕрдиреНрддрддрдГ рдкрд╣реБрдБрдЪ рдЯреЛрдХрди рдлрд░реНрдХрд╛рдЗрдиреНрдЫред

1. `public` рдЦрдгреНрдбрдорд╛ рдкрд╣реБрдБрдЪ рдЯреЛрдХрди рдкреНрд░рд╛рдкреНрдд рдЧрд░реНрди рд╡рд┐рдзрд┐ рдердкреНрдиреБрд╣реЛрд╕реНред рдпреЛ рд╡рд┐рдзрд┐ рдкрдЫрд┐ рдкрд╛рдард▓рд╛рдИ рдЖрд╡рд╛рдЬрдорд╛ рд░реВрдкрд╛рдиреНрддрд░рдг рдЧрд░реНрди рдЖрд╡рд╢реНрдпрдХ рд╣реБрдиреЗрдЫред

    ```cpp
    String AccessToken()
    {
        return _access_token;
    }
    ```

1. `public` рдЦрдгреНрдбрдорд╛ `init` рд╡рд┐рдзрд┐ рдердкреНрдиреБрд╣реЛрд╕реН рдЬрд╕рд▓реЗ рдЯреЛрдХрди рдХреНрд▓рд╛рдЗрдиреНрдЯ рд╕реЗрдЯрдЕрдк рдЧрд░реНрджрдЫ:

    ```cpp
    void init()
    {
        _token_client.setCACert(TOKEN_CERTIFICATE);
        _access_token = getAccessToken();
    }
    ```

    рдпрд╕рд▓реЗ WiFi рдХреНрд▓рд╛рдЗрдиреНрдЯрдорд╛ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рд╕реЗрдЯ рдЧрд░реНрджрдЫ, рддреНрдпрд╕рдкрдЫрд┐ рдкрд╣реБрдБрдЪ рдЯреЛрдХрди рдкреНрд░рд╛рдкреНрдд рдЧрд░реНрджрдЫред

1. `main.cpp` рдорд╛ рдпрд╕ рдирдпрд╛рдБ рд╣реЗрдбрд░ рдлрд╛рдЗрд▓рд▓рд╛рдИ рд╕рдорд╛рд╡реЗрд╢ рдирд┐рд░реНрджреЗрд╢рдирд╣рд░реВрдорд╛ рдердкреНрдиреБрд╣реЛрд╕реН:

    ```cpp
    #include "speech_to_text.h"
    ```

1. `setup` рдХрд╛рд░реНрдпрдХреЛ рдЕрдиреНрддреНрдпрдорд╛ `SpeechToText` рдХрдХреНрд╖рд╛ рдЖрд░рдореНрдн рдЧрд░реНрдиреБрд╣реЛрд╕реН, `mic.init` рдХрд▓рдкрдЫрд┐ рддрд░ рд╕реАрд░рд┐рдпрд▓ рдореЛрдирд┐рдЯрд░рдорд╛ `Ready` рд▓реЗрдЦреНрдиреБрдЕрдШрд┐:

    ```cpp
    speechToText.init();
    ```

### рдХрд╛рд░реНрдп - рдлреНрд▓реНрдпрд╛рд╕ рдореЗрдореЛрд░реАрдмрд╛рдЯ рдЕрдбрд┐рдпреЛ рдкрдвреНрдиреБрд╣реЛрд╕реН

1. рдкрд╛рдардХреЛ рдЕрдШрд┐рд▓реНрд▓реЛ рднрд╛рдЧрдорд╛, рдЕрдбрд┐рдпреЛ рдлреНрд▓реНрдпрд╛рд╕ рдореЗрдореЛрд░реАрдорд╛ рд░реЗрдХрд░реНрдб рдЧрд░рд┐рдПрдХреЛ рдерд┐рдпреЛред рдпреЛ рдЕрдбрд┐рдпреЛрд▓рд╛рдИ Speech Services REST API рдорд╛ рдкрдард╛рдЙрди рдЖрд╡рд╢реНрдпрдХ рдЫ, рддреНрдпрд╕реИрд▓реЗ рдпрд╕рд▓рд╛рдИ рдлреНрд▓реНрдпрд╛рд╕ рдореЗрдореЛрд░реАрдмрд╛рдЯ рдкрдвреНрдиреБрдкрд░реНрдЫред рдпреЛ рдЗрди-рдореЗрдореЛрд░реА рдмрдлрд░рдорд╛ рд▓реЛрдб рдЧрд░реНрди рд╕рдХрд┐рдБрджреИрди рдХрд┐рдирднрдиреЗ рдпреЛ рдзреЗрд░реИ рдареВрд▓реЛ рд╣реБрдиреЗрдЫред `HTTPClient` рдХрдХреНрд╖рд╛рд▓реЗ REST рдХрд▓рд╣рд░реВрдорд╛ рдбреЗрдЯрд╛ рд╕реНрдЯреНрд░рд┐рдо рдЧрд░реНрди рд╕рдХреНрдЫ, рдЬрд╕рд▓реЗ рд╕рд╛рдиреЛ рдЯреБрдХреНрд░рд╛рд╣рд░реВрдорд╛ рдбреЗрдЯрд╛ рд▓реЛрдб рдЧрд░реНрди рд╕рдХреНрдЫ рд░ рдПрдХ рдкрдЯрдХрдорд╛ рдЯреБрдХреНрд░рд╛ рдкрдард╛рдЙрди рд╕рдХреНрдЫред рдкреНрд░рддреНрдпреЗрдХ рдкрдЯрдХ рддрдкрд╛рдИрдВ рд╕реНрдЯреНрд░рд┐рдордорд╛ `read` рдХрд▓ рдЧрд░реНрдиреБрд╣реБрдиреНрдЫ, рдпрд╕рд▓реЗ рдЕрд░реНрдХреЛ рдбреЗрдЯрд╛ рдмреНрд▓рдХ рдлрд░реНрдХрд╛рдЙрдБрдЫред Arduino рд╕реНрдЯреНрд░рд┐рдо рд╕рд┐рд░реНрдЬрдирд╛ рдЧрд░реНрди рд╕рдХрд┐рдиреНрдЫ рдЬрд╕рд▓реЗ рдлреНрд▓реНрдпрд╛рд╕ рдореЗрдореЛрд░реАрдмрд╛рдЯ рдкрдвреНрди рд╕рдХреНрдЫред `src` рдлреЛрд▓реНрдбрд░рдорд╛ рдирдпрд╛рдБ рдлрд╛рдЗрд▓ `flash_stream.h` рд╕рд┐рд░реНрдЬрдирд╛ рдЧрд░реНрдиреБрд╣реЛрд╕реН, рд░ рдпрд╕рдорд╛ рдирд┐рдореНрди рдХреЛрдб рдердкреНрдиреБрд╣реЛрд╕реН:

    ```cpp
    #pragma once
    
    #include <Arduino.h>
    #include <HTTPClient.h>
    #include <sfud.h>

    #include "config.h"
    
    class FlashStream : public Stream
    {
    public:
        virtual size_t write(uint8_t val)
        {    
        }
    
        virtual int available()
        {
        }
    
        virtual int read()
        {
        }
    
        virtual int peek()
        {
        }
    private:
    
    };
    ```

    рдпрд╕рд▓реЗ `FlashStream` рдХрдХреНрд╖рд╛ рдШреЛрд╖рдгрд╛ рдЧрд░реНрджрдЫ, Arduino `Stream` рдХрдХреНрд╖рдмрд╛рдЯ рд╡реНрдпреБрддреНрдкрдиреНрдиред рдпреЛ рдПрдХ рдЕрдореВрд░реНрдд рдХрдХреНрд╖рд╛ рд╣реЛ - рд╡реНрдпреБрддреНрдкрдиреНрди рдХрдХреНрд╖рд╛рд╣рд░реВрд▓реЗ рдХреЗрд╣реА рд╡рд┐рдзрд┐рд╣рд░реВ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдЧрд░реНрдиреБрдкрд░реНрдЫ рдХрдХреНрд╖рд╛ рдЙрджрд╛рд╣рд░рдгрд┐рдд рд╣реБрдиреБрдЕрдШрд┐, рд░ рдпреА рд╡рд┐рдзрд┐рд╣рд░реВ рдпрд╕ рдХрдХреНрд╖рд╛рдорд╛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдЫрдиреНред

    тЬЕ Arduino Streams рдорд╛ рдердк рдкрдвреНрдиреБрд╣реЛрд╕реН [Arduino Stream рджрд╕реНрддрд╛рд╡реЗрдЬ](https://www.arduino.cc/reference/en/language/functions/communication/stream/) рдорд╛ред

1. `private` рдЦрдгреНрдбрдорд╛ рдирд┐рдореНрди рдХреНрд╖реЗрддреНрд░рд╣рд░реВ рдердкреНрдиреБрд╣реЛрд╕реН:

    ```cpp
    size_t _pos;
    size_t _flash_address;
    const sfud_flash *_flash;

    byte _buffer[HTTP_TCP_BUFFER_SIZE];
    ```

    рдпрд╕рд▓реЗ рдлреНрд▓реНрдпрд╛рд╕ рдореЗрдореЛрд░реАрдмрд╛рдЯ рдкрдврд┐рдПрдХреЛ рдбреЗрдЯрд╛ рднрдгреНрдбрд╛рд░рдг рдЧрд░реНрди рдЕрд╕реНрдерд╛рдпреА рдмрдлрд░ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдЧрд░реНрджрдЫ, рдмрдлрд░рдмрд╛рдЯ рдкрдвреНрджрд╛ рд╣рд╛рд▓рдХреЛ рд╕реНрдерд┐рддрд┐ рднрдгреНрдбрд╛рд░рдг рдЧрд░реНрди рдХреНрд╖реЗрддреНрд░рд╣рд░реВ, рд╣рд╛рд▓рдХреЛ рдареЗрдЧрд╛рдирд╛ рдлреНрд▓реНрдпрд╛рд╕ рдореЗрдореЛрд░реАрдмрд╛рдЯ рдкрдвреНрди, рд░ рдлреНрд▓реНрдпрд╛рд╕ рдореЗрдореЛрд░реА рдЙрдкрдХрд░рдгред

1. `private` рдЦрдгреНрдбрдорд╛ рдирд┐рдореНрди рд╡рд┐рдзрд┐ рдердкреНрдиреБрд╣реЛрд╕реН:

    ```cpp
    void populateBuffer()
    {
        sfud_read(_flash, _flash_address, HTTP_TCP_BUFFER_SIZE, _buffer);
        _flash_address += HTTP_TCP_BUFFER_SIZE;
        _pos = 0;
    }
    ```

    рдпреЛ рдХреЛрдбрд▓реЗ рдлреНрд▓реНрдпрд╛рд╕ рдореЗрдореЛрд░реАрдХреЛ рд╣рд╛рд▓рдХреЛ рдареЗрдЧрд╛рдирд╛рдмрд╛рдЯ рдкрдвреНрдЫ рд░ рдбреЗрдЯрд╛ рдмрдлрд░рдорд╛ рднрдгреНрдбрд╛рд░рдг рдЧрд░реНрджрдЫред рддреНрдпрд╕рдкрдЫрд┐ рдпреЛ рдареЗрдЧрд╛рдирд╛ рдмрдврд╛рдЙрдБрдЫ, рддреНрдпрд╕реИрд▓реЗ рдЕрд░реНрдХреЛ рдХрд▓рд▓реЗ рдореЗрдореЛрд░реАрдХреЛ рдЕрд░реНрдХреЛ рдмреНрд▓рдХ рдкрдвреНрдЫред рдмрдлрд░рдХреЛ рдЖрдХрд╛рд░ REST API рдорд╛ рдПрдХ рдкрдЯрдХрдорд╛ `HTTPClient` рджреНрд╡рд╛рд░рд╛ рдкрдард╛рдЗрдиреЗ рд╕рдмреИрднрдиреНрджрд╛ рдареВрд▓реЛ рдЯреБрдХреНрд░рд╛рдХреЛ рдЖрдзрд╛рд░рдорд╛ рд╕реЗрдЯ рдЧрд░рд┐рдПрдХреЛ рдЫред

    > ЁЯТБ рдлреНрд▓реНрдпрд╛рд╕ рдореЗрдореЛрд░реА рдореЗрдЯреНрди рдЕрдирд╛рдЬ рдЖрдХрд╛рд░ рдкреНрд░рдпреЛрдЧ рдЧрд░реНрдиреБрдкрд░реНрдЫ, рддрд░ рдкрдвреНрди рднрдиреЗ рдЖрд╡рд╢реНрдпрдХ рдЫреИрдиред

1. рдХрдХреНрд╖рд╛рдХреЛ `public` рдЦрдгреНрдбрдорд╛ рдХрдиреНрд╕реНрдЯреНрд░рдХреНрдЯрд░ рдердкреНрдиреБрд╣реЛрд╕реН:

    ```cpp
    FlashStream()
    {
        _pos = 0;
        _flash_address = 0;
        _flash = sfud_get_device_table() + 0;
        
        populateBuffer();
    }
    ```

    рдпреЛ рдХрдиреНрд╕реНрдЯреНрд░рдХреНрдЯрд░рд▓реЗ рдлреНрд▓реНрдпрд╛рд╕ рдореЗрдореЛрд░реА рдмреНрд▓рдХрдХреЛ рд╕реБрд░реБрд╡рд╛рддрдмрд╛рдЯ рдкрдвреНрди рд╕реБрд░реБ рдЧрд░реНрди рд╕рдмреИ рдХреНрд╖реЗрддреНрд░рд╣рд░реВ рд╕реЗрдЯ рдЧрд░реНрджрдЫ, рд░ рдмрдлрд░рдорд╛ рдкрд╣рд┐рд▓реЛ рдбреЗрдЯрд╛ рдЯреБрдХреНрд░рд╛ рд▓реЛрдб рдЧрд░реНрджрдЫред

1. `write` рд╡рд┐рдзрд┐ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдЧрд░реНрдиреБрд╣реЛрд╕реНред рдпреЛ рд╕реНрдЯреНрд░рд┐рдорд▓реЗ рдХреЗрд╡рд▓ рдбреЗрдЯрд╛ рдкрдвреНрдиреЗрдЫ, рддреНрдпрд╕реИрд▓реЗ рдпрд╕рд▓реЗ рдХреЗрд╣реА рдирдЧрд░реНрдиреЗ рд░ 0 рдлрд░реНрдХрд╛рдЙрдиреЗ рдЧрд░реНрди рд╕рдХреНрдЫ:

    ```cpp
    virtual size_t write(uint8_t val)
    {
        return 0;
    }
    ```

1. `peek` рд╡рд┐рдзрд┐ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдЧрд░реНрдиреБрд╣реЛрд╕реНред рдпрд╕рд▓реЗ рд╕реНрдЯреНрд░рд┐рдорд▓рд╛рдИ рдЕрдЧрд╛рдбрд┐ рдмрдврд╛рдЙрдБрджрд╛ рдмрд┐рдирд╛ рд╣рд╛рд▓рдХреЛ рд╕реНрдерд┐рддрд┐рдорд╛ рдбреЗрдЯрд╛ рдлрд░реНрдХрд╛рдЙрдБрдЫред `peek` рдмрд╛рд░рдореНрдмрд╛рд░ рдХрд▓ рдЧрд░реНрджрд╛, рд╕реНрдЯреНрд░рд┐рдордмрд╛рдЯ рдХреБрдиреИ рдбреЗрдЯрд╛ рдирдкрдврд┐рдПрд╕рдореНрдо рд╕рдзреИрдВ рдЙрд╣реА рдбреЗрдЯрд╛ рдлрд░реНрдХрд╛рдЙрдБрдЫред

    ```cpp
    virtual int peek()
    {
        return _buffer[_pos];
    }
    ```

1. `available` рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдЧрд░реНрдиреБрд╣реЛрд╕реНред рдпрд╕рд▓реЗ рд╕реНрдЯреНрд░рд┐рдордмрд╛рдЯ рдХрддрд┐ рдмрд╛рдЗрдЯрд╣рд░реВ рдкрдвреНрди рд╕рдХрд┐рдиреНрдЫ рднрдиреНрдиреЗ рдлрд░реНрдХрд╛рдЙрдБрдЫ, рд╡рд╛ рдпрджрд┐ рд╕реНрдЯреНрд░рд┐рдо рдкреВрд░рд╛ рднрдпреЛ рднрдиреЗ -1 рдлрд░реНрдХрд╛рдЙрдБрдЫред рдпрд╕ рдХрдХреНрд╖рд╛рдХреЛ рд▓рд╛рдЧрд┐, рдЕрдзрд┐рдХрддрдо рдЙрдкрд▓рдмреНрдзрддрд╛ `HTTPClient` рдХреЛ рдЯреБрдХреНрд░рд╛ рдЖрдХрд╛рд░рднрдиреНрджрд╛ рдмрдвреА рд╣реБрдиреЗрдЫреИрдиред рдЬрдм рдпреЛ рд╕реНрдЯреНрд░рд┐рдо `HTTPClient` рдорд╛ рдкреНрд░рдпреЛрдЧ рдЧрд░рд┐рдиреНрдЫ, рдпрд╕рд▓реЗ рдпреЛ рдХрд╛рд░реНрдпрд▓рд╛рдИ рдХрддрд┐ рдбреЗрдЯрд╛ рдЙрдкрд▓рдмреНрдз рдЫ рд╣реЗрд░реНрди рдХрд▓ рдЧрд░реНрджрдЫ, рддреНрдпрд╕рдкрдЫрд┐ REST API рдорд╛ рдкрдард╛рдЙрди рддреНрдпрддрд┐ рдбреЗрдЯрд╛ рдЕрдиреБрд░реЛрдз рдЧрд░реНрджрдЫред рд╣рд╛рдореА рдЪрд╛рд╣рдиреНрди рдХрд┐ рдкреНрд░рддреНрдпреЗрдХ рдЯреБрдХреНрд░рд╛ `HTTPClient` рдХреЛ рдЯреБрдХреНрд░рд╛ рдЖрдХрд╛рд░рднрдиреНрджрд╛ рдмрдвреА рд╣реЛрд╕реН, рддреНрдпрд╕реИрд▓реЗ рдпрджрд┐ рдЙрдкрд▓рдмреНрдзрддрд╛ рдмрдвреА рдЫ рднрдиреЗ, рдЯреБрдХреНрд░рд╛ рдЖрдХрд╛рд░ рдлрд░реНрдХрд╛рдЗрдиреНрдЫред рдпрджрд┐ рдХрдо рдЫ рднрдиреЗ, рдЙрдкрд▓рдмреНрдзрддрд╛ рдлрд░реНрдХрд╛рдЗрдиреНрдЫред рд╕рдмреИ рдбреЗрдЯрд╛ рд╕реНрдЯреНрд░рд┐рдо рдЧрд░рд┐рд╕рдХреЗрдкрдЫрд┐, -1 рдлрд░реНрдХрд╛рдЗрдиреНрдЫред

    ```cpp
    virtual int available()
    {
        int remaining = BUFFER_SIZE - ((_flash_address - HTTP_TCP_BUFFER_SIZE) + _pos);
        int bytes_available = min(HTTP_TCP_BUFFER_SIZE, remaining);

        if (bytes_available == 0)
        {
            bytes_available = -1;
        }

        return bytes_available;
    }
    ```

1. `read` рд╡рд┐рдзрд┐ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдЧрд░реНрдиреБрд╣реЛрд╕реН рддрд╛рдХрд┐ рдмрдлрд░рдмрд╛рдЯ рдЕрд░реНрдХреЛ рдмрд╛рдЗрдЯ рдлрд░реНрдХрд╛рдЙрдБрдЫ, рд╕реНрдерд┐рддрд┐ рдмрдврд╛рдЙрдБрджреИред рдпрджрд┐ рд╕реНрдерд┐рддрд┐ рдмрдлрд░рдХреЛ рдЖрдХрд╛рд░рднрдиреНрджрд╛ рдмрдвреА рдЫ рднрдиреЗ, рдпреЛ рдлреНрд▓реНрдпрд╛рд╕ рдореЗрдореЛрд░реАрдмрд╛рдЯ рдЕрд░реНрдХреЛ рдмреНрд▓рдХрд▓реЗ рдмрдлрд░ рднрд░реНрдЫ рд░ рд╕реНрдерд┐рддрд┐ рд░рд┐рд╕реЗрдЯ рдЧрд░реНрджрдЫред

    ```cpp
    virtual int read()
    {
        int retVal = _buffer[_pos++];

        if (_pos == HTTP_TCP_BUFFER_SIZE)
        {
            populateBuffer();
        }

        return retVal;
    }
    ```

1. `speech_to_text.h` рд╣реЗрдбрд░ рдлрд╛рдЗрд▓рдорд╛ рдпрд╕ рдирдпрд╛рдБ рд╣реЗрдбрд░ рдлрд╛рдЗрд▓рдХреЛ рд╕рдорд╛рд╡реЗрд╢ рдирд┐рд░реНрджреЗрд╢рди рдердкреНрдиреБрд╣реЛрд╕реН:

    ```cpp
    #include "flash_stream.h"
    ```

### рдХрд╛рд░реНрдп - рдЖрд╡рд╛рдЬрд▓рд╛рдИ рдкрд╛рдардорд╛ рд░реВрдкрд╛рдиреНрддрд░рдг рдЧрд░реНрдиреБрд╣реЛрд╕реН

1. рдЖрд╡рд╛рдЬрд▓рд╛рдИ рдкрд╛рдардорд╛ рд░реВрдкрд╛рдиреНрддрд░рдг рдЧрд░реНрди рдЕрдбрд┐рдпреЛрд▓рд╛рдИ REST API рдорд╛рд░реНрдлрдд Speech Service рдорд╛ рдкрдард╛рдЙрди рд╕рдХрд┐рдиреНрдЫред рдпрд╕ REST API рдХреЛ рдЯреЛрдХрди рдЬрд╛рд░реАрдХрд░реНрддрд╛рд╕рдБрдЧ рдлрд░рдХ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдЫ, рддреНрдпрд╕реИрд▓реЗ `config.h` рд╣реЗрдбрд░ рдлрд╛рдЗрд▓рдорд╛ рдирд┐рдореНрди рдХреЛрдб рдердкреНрдиреБрд╣реЛрд╕реН рддрд╛рдХрд┐ рдпреЛ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдкрд░рд┐рднрд╛рд╖рд┐рдд рд╣реЛрд╕реН:

    ```cpp
    const char *SPEECH_CERTIFICATE =
        "-----BEGIN CERTIFICATE-----\r\n"
        "MIIF8zCCBNugAwIBAgIQCq+mxcpjxFFB6jvh98dTFzANBgkqhkiG9w0BAQwFADBh\r\n"
        "MQswCQYDVQQGEwJVUzEVMBMGA1UEChMMRGlnaUNlcnQgSW5jMRkwFwYDVQQLExB3\r\n"
        "d3cuZGlnaWNlcnQuY29tMSAwHgYDVQQDExdEaWdpQ2VydCBHbG9iYWwgUm9vdCBH\r\n"
        "MjAeFw0yMDA3MjkxMjMwMDBaFw0yNDA2MjcyMzU5NTlaMFkxCzAJBgNVBAYTAlVT\r\n"
        "MR4wHAYDVQQKExVNaWNyb3NvZnQgQ29ycG9yYXRpb24xKjAoBgNVBAMTIU1pY3Jv\r\n"
        "c29mdCBBenVyZSBUTFMgSXNzdWluZyBDQSAwMTCCAiIwDQYJKoZIhvcNAQEBBQAD\r\n"
        "ggIPADCCAgoCggIBAMedcDrkXufP7pxVm1FHLDNA9IjwHaMoaY8arqqZ4Gff4xyr\r\n"
        "RygnavXL7g12MPAx8Q6Dd9hfBzrfWxkF0Br2wIvlvkzW01naNVSkHp+OS3hL3W6n\r\n"
        "l/jYvZnVeJXjtsKYcXIf/6WtspcF5awlQ9LZJcjwaH7KoZuK+THpXCMtzD8XNVdm\r\n"
        "GW/JI0C/7U/E7evXn9XDio8SYkGSM63aLO5BtLCv092+1d4GGBSQYolRq+7Pd1kR\r\n"
        "EkWBPm0ywZ2Vb8GIS5DLrjelEkBnKCyy3B0yQud9dpVsiUeE7F5sY8Me96WVxQcb\r\n"
        "OyYdEY/j/9UpDlOG+vA+YgOvBhkKEjiqygVpP8EZoMMijephzg43b5Qi9r5UrvYo\r\n"
        "o19oR/8pf4HJNDPF0/FJwFVMW8PmCBLGstin3NE1+NeWTkGt0TzpHjgKyfaDP2tO\r\n"
        "4bCk1G7pP2kDFT7SYfc8xbgCkFQ2UCEXsaH/f5YmpLn4YPiNFCeeIida7xnfTvc4\r\n"
        "7IxyVccHHq1FzGygOqemrxEETKh8hvDR6eBdrBwmCHVgZrnAqnn93JtGyPLi6+cj\r\n"
        "WGVGtMZHwzVvX1HvSFG771sskcEjJxiQNQDQRWHEh3NxvNb7kFlAXnVdRkkvhjpR\r\n"
        "GchFhTAzqmwltdWhWDEyCMKC2x/mSZvZtlZGY+g37Y72qHzidwtyW7rBetZJAgMB\r\n"
        "AAGjggGtMIIBqTAdBgNVHQ4EFgQUDyBd16FXlduSzyvQx8J3BM5ygHYwHwYDVR0j\r\n"
        "BBgwFoAUTiJUIBiV5uNu5g/6+rkS7QYXjzkwDgYDVR0PAQH/BAQDAgGGMB0GA1Ud\r\n"
        "JQQWMBQGCCsGAQUFBwMBBggrBgEFBQcDAjASBgNVHRMBAf8ECDAGAQH/AgEAMHYG\r\n"
        "CCsGAQUFBwEBBGowaDAkBggrBgEFBQcwAYYYaHR0cDovL29jc3AuZGlnaWNlcnQu\r\n"
        "Y29tMEAGCCsGAQUFBzAChjRodHRwOi8vY2FjZXJ0cy5kaWdpY2VydC5jb20vRGln\r\n"
        "aUNlcnRHbG9iYWxSb290RzIuY3J0MHsGA1UdHwR0MHIwN6A1oDOGMWh0dHA6Ly9j\r\n"
        "cmwzLmRpZ2ljZXJ0LmNvbS9EaWdpQ2VydEdsb2JhbFJvb3RHMi5jcmwwN6A1oDOG\r\n"
        "MWh0dHA6Ly9jcmw0LmRpZ2ljZXJ0LmNvbS9EaWdpQ2VydEdsb2JhbFJvb3RHMi5j\r\n"
        "cmwwHQYDVR0gBBYwFDAIBgZngQwBAgEwCAYGZ4EMAQICMBAGCSsGAQQBgjcVAQQD\r\n"
        "AgEAMA0GCSqGSIb3DQEBDAUAA4IBAQAlFvNh7QgXVLAZSsNR2XRmIn9iS8OHFCBA\r\n"
        "WxKJoi8YYQafpMTkMqeuzoL3HWb1pYEipsDkhiMnrpfeYZEA7Lz7yqEEtfgHcEBs\r\n"
        "K9KcStQGGZRfmWU07hPXHnFz+5gTXqzCE2PBMlRgVUYJiA25mJPXfB00gDvGhtYa\r\n"
        "+mENwM9Bq1B9YYLyLjRtUz8cyGsdyTIG/bBM/Q9jcV8JGqMU/UjAdh1pFyTnnHEl\r\n"
        "Y59Npi7F87ZqYYJEHJM2LGD+le8VsHjgeWX2CJQko7klXvcizuZvUEDTjHaQcs2J\r\n"
        "+kPgfyMIOY1DMJ21NxOJ2xPRC/wAh/hzSBRVtoAnyuxtkZ4VjIOh\r\n"
        "-----END CERTIFICATE-----\r\n";
    ```

1. рдпрд╕ рдлрд╛рдЗрд▓рдорд╛ рд╕реНрдерд╛рдирдмрд┐рдирд╛ рдЖрд╡рд╛рдЬ URL рдХреЛ рд▓рд╛рдЧрд┐ рд╕реНрдерд┐рд░рд╛рдВрдХ рдердкреНрдиреБрд╣реЛрд╕реНред рдпреЛ рдкрдЫрд┐ рд╕реНрдерд╛рди рд░ рднрд╛рд╖рд╛рд╕рдБрдЧ рдорд┐рд▓рд╛рдПрд░ рдкреВрд░реНрдг URL рдкреНрд░рд╛рдкреНрдд рдЧрд░рд┐рдиреЗрдЫред

    ```cpp
    const char *SPEECH_URL = "https://%s.stt.speech.microsoft.com/speech/recognition/conversation/cognitiveservices/v1?language=%s";
    ```

1. `speech_to_text.h` рд╣реЗрдбрд░ рдлрд╛рдЗрд▓рдорд╛, `SpeechToText` рдХрдХреНрд╖рд╛рдХреЛ `private` рдЦрдгреНрдбрдорд╛, рдЖрд╡рд╛рдЬ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдкреНрд░рдпреЛрдЧ рдЧрд░реНрдиреЗ WiFi Client рдХреЛ рд▓рд╛рдЧрд┐ рдХреНрд╖реЗрддреНрд░ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдЧрд░реНрдиреБрд╣реЛрд╕реН:

    ```cpp
    WiFiClientSecure _speech_client;
    ```

1. `init` рд╡рд┐рдзрд┐рдорд╛, рдпрд╕ WiFi Client рдорд╛ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рд╕реЗрдЯ рдЧрд░реНрдиреБрд╣реЛрд╕реН:

    ```cpp
    _speech_client.setCACert(SPEECH_CERTIFICATE);
    ```

1. `SpeechToText` рдХрдХреНрд╖рд╛рдХреЛ `public` рдЦрдгреНрдбрдорд╛ рдЖрд╡рд╛рдЬрд▓рд╛рдИ рдкрд╛рдардорд╛ рд░реВрдкрд╛рдиреНрддрд░рдг рдЧрд░реНрди рд╡рд┐рдзрд┐ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдЧрд░реНрди рдирд┐рдореНрди рдХреЛрдб рдердкреНрдиреБрд╣реЛрд╕реН:

    ```cpp
    String convertSpeechToText()
    {
        
    }
    ```

1. рдпрд╕ рд╡рд┐рдзрд┐рдорд╛ рдирд┐рдореНрди рдХреЛрдб рдердкреНрдиреБрд╣реЛрд╕реН рддрд╛рдХрд┐ рдЖрд╡рд╛рдЬ рдкреНрд░рдорд╛рдгрдкрддреНрд░рдХреЛ рд╕рд╛рде рдХрдиреНрдлрд┐рдЧрд░ рдЧрд░рд┐рдПрдХреЛ WiFi Client рдкреНрд░рдпреЛрдЧ рдЧрд░реЗрд░ HTTP рдХреНрд▓рд╛рдЗрдиреНрдЯ рд╕рд┐рд░реНрдЬрдирд╛ рдЧрд░рд┐рдпреЛрд╕реН, рд░ рд╕реНрдерд╛рди рд░ рднрд╛рд╖рд╛рд╕рдБрдЧ рд╕реЗрдЯ рдЧрд░рд┐рдПрдХреЛ рдЖрд╡рд╛рдЬ URL рдкреНрд░рдпреЛрдЧ рдЧрд░рд┐рдпреЛрд╕реН:

    ```cpp
    char url[128];
    sprintf(url, SPEECH_URL, SPEECH_LOCATION, LANGUAGE);

    HTTPClient httpClient;
    httpClient.begin(_speech_client, url);
    ```

1. рдЬрдбрд╛рдирдорд╛ рдХреЗрд╣реА рд╣реЗрдбрд░рд╣рд░реВ рд╕реЗрдЯ рдЧрд░реНрди рдЖрд╡рд╢реНрдпрдХ рдЫ:

    ```cpp
    httpClient.addHeader("Authorization", String("Bearer ") + _access_token);
    httpClient.addHeader("Content-Type", String("audio/wav; codecs=audio/pcm; samplerate=") + String(RATE));
    httpClient.addHeader("Accept", "application/json;text/xml");
    ```

    рдпрд╕рд▓реЗ рдкрд╣реБрдБрдЪ рдЯреЛрдХрди рдкреНрд░рдпреЛрдЧ рдЧрд░реЗрд░ рдкреНрд░рд╛рдзрд┐рдХрд░рдгрдХрд╛ рд▓рд╛рдЧрд┐ рд╣реЗрдбрд░ рд╕реЗрдЯ рдЧрд░реНрджрдЫ, рдЕрдбрд┐рдпреЛ рдврд╛рдБрдЪрд╛ рдирдореВрдирд╛ рджрд░ рдкреНрд░рдпреЛрдЧ рдЧрд░реЗрд░ рд╕реЗрдЯ рдЧрд░реНрджрдЫ, рд░ рдХреНрд▓рд╛рдЗрдиреНрдЯрд▓реЗ JSON рдХреЛ рд░реВрдкрдорд╛ рдкрд░рд┐рдгрд╛рдо рдЕрдкреЗрдХреНрд╖рд╛ рдЧрд░реНрджрдЫред

1. рдпрд╕рдкрдЫрд┐, REST API рдХрд▓ рдЧрд░реНрди рдирд┐рдореНрди рдХреЛрдб рдердкреНрдиреБрд╣реЛрд╕реН:

    ```cpp
    Serial.println("Sending speech...");

    FlashStream stream;
    int httpResponseCode = httpClient.sendRequest("POST", &stream, BUFFER_SIZE);

    Serial.println("Speech sent!");
    ```

    рдпрд╕рд▓реЗ `FlashStream` рд╕рд┐рд░реНрдЬрдирд╛ рдЧрд░реНрджрдЫ рд░ рдпрд╕рд▓рд╛рдИ REST API рдорд╛ рдбреЗрдЯрд╛ рд╕реНрдЯреНрд░рд┐рдо рдЧрд░реНрди рдкреНрд░рдпреЛрдЧ рдЧрд░реНрджрдЫред

1. рдпрд╕рдХреЛ рддрд▓ рдирд┐рдореНрди рдХреЛрдб рдердкреНрдиреБрд╣реЛрд╕реН:

    ```cpp
    String text = "";

    if (httpResponseCode == 200)
    {
        String result = httpClient.getString();
        Serial.println(result);

        DynamicJsonDocument doc(1024);
        deserializeJson(doc, result.c_str());

        JsonObject obj = doc.as<JsonObject>();
        text = obj["DisplayText"].as<String>();
    }
    else if (httpResponseCode == 401)
    {
        Serial.println("Access token expired, trying again with a new token");
        _access_token = getAccessToken();
        return convertSpeechToText();
    }
    else
    {
        Serial.print("Failed to convert text to speech - error ");
        Serial.println(httpResponseCode);
    }
    ```

    рдпреЛ рдХреЛрдбрд▓реЗ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЛрдб рдЬрд╛рдБрдЪ рдЧрд░реНрджрдЫред

    рдпрджрд┐ рдпреЛ 200 рд╣реЛ, рд╕рдлрд▓рддрд╛рдХреЛ рдХреЛрдб, рддреНрдпрд╕рдкрдЫрд┐ рдкрд░рд┐рдгрд╛рдо рдкреНрд░рд╛рдкреНрдд рдЧрд░рд┐рдиреНрдЫ, JSON рдмрд╛рдЯ рдбрд┐рдХреЛрдб рдЧрд░рд┐рдиреНрдЫ, рд░ `DisplayText` рдЧреБрдгрд▓рд╛рдИ `text` рдЪрд░рдорд╛ рд╕реЗрдЯ рдЧрд░рд┐рдиреНрдЫред рдпреЛ рдЧреБрдгрдорд╛ рдЖрд╡рд╛рдЬрдХреЛ рдкрд╛рда рд╕рдВрд╕реНрдХрд░рдг рдлрд░реНрдХрд╛рдЗрдиреНрдЫред

    рдпрджрд┐ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЛрдб 401 рд╣реЛ рднрдиреЗ, рдкрд╣реБрдБрдЪ рдЯреЛрдХрди рд╕рдорд╛рдкреНрдд рднрдПрдХреЛ рдЫ (рдпреА рдЯреЛрдХрдирд╣рд░реВ рдХреЗрд╡рд▓ резреж рдорд┐рдиреЗрдЯрд╕рдореНрдо рдЯрд┐рдХреНрдЫрдиреН)ред рдирдпрд╛рдБ рдкрд╣реБрдБрдЪ рдЯреЛрдХрди рдЕрдиреБрд░реЛрдз рдЧрд░рд┐рдиреНрдЫ, рд░ рдХрд▓ рдлреЗрд░рд┐ рдЧрд░рд┐рдиреНрдЫред

    рдЕрдиреНрдпрдерд╛, рд╕реАрд░рд┐рдпрд▓ рдореЛрдирд┐рдЯрд░рдорд╛ рддреНрд░реБрдЯрд┐ рдкрдард╛рдЗрдиреНрдЫ, рд░ `text` рдЦрд╛рд▓реА рдЫреЛрдбрд┐рдиреНрдЫред

1. рдпрд╕ рд╡рд┐рдзрд┐рдХреЛ рдЕрдиреНрддреНрдпрдорд╛ рдирд┐рдореНрди рдХреЛрдб рдердкреНрдиреБрд╣реЛрд╕реН рддрд╛рдХрд┐ HTTP рдХреНрд▓рд╛рдЗрдиреНрдЯ рдмрдиреНрдж рдЧрд░рд┐рдпреЛрд╕реН рд░ рдкрд╛рда рдлрд░реНрдХрд╛рдЗрдпреЛрд╕реН:

    ```cpp
    httpClient.end();

    return text;
    ```

1. `main.cpp` рдорд╛ рдирдпрд╛рдБ `convertSpeechToText` рд╡рд┐рдзрд┐ `processAudio` рдХрд╛рд░реНрдпрдорд╛ рдХрд▓ рдЧрд░реНрдиреБрд╣реЛрд╕реН, рддреНрдпрд╕рдкрдЫрд┐ рд╕реАрд░рд┐рдпрд▓ рдореЛрдирд┐рдЯрд░рдорд╛ рдЖрд╡рд╛рдЬрд▓рд╛рдИ рд▓рдЧ рдЧрд░реНрдиреБрд╣реЛрд╕реН:

    ```cpp
    String text = speechToText.convertSpeechToText();
    Serial.println(text);
    ```

1. рдпреЛ рдХреЛрдб рдирд┐рд░реНрдорд╛рдг рдЧрд░реНрдиреБрд╣реЛрд╕реН, рдпрд╕рд▓рд╛рдИ рддрдкрд╛рдИрдВрдХреЛ Wio Terminal рдорд╛ рдЕрдкрд▓реЛрдб рдЧрд░реНрдиреБрд╣реЛрд╕реН, рд░ рд╕реАрд░рд┐рдпрд▓ рдореЛрдирд┐рдЯрд░ рдорд╛рд░реНрдлрдд рдкрд░реАрдХреНрд╖рдг рдЧрд░реНрдиреБрд╣реЛрд╕реНред рдЬрдм рддрдкрд╛рдИрдВ рд╕реАрд░рд┐рдпрд▓ рдореЛрдирд┐рдЯрд░рдорд╛ `Ready` рджреЗрдЦреНрдиреБрд╣реБрдиреНрдЫ, C рдмрдЯрди (рдмрд╛рдпрд╛рдБрддрд░реНрдлрдХреЛ, рдкрд╛рд╡рд░ рд╕реНрд╡рд┐рдЪрдХреЛ рдирдЬрд┐рдХ) рдерд┐рдЪреНрдиреБрд╣реЛрд╕реН, рд░ рдмреЛрд▓реНрдиреБрд╣реЛрд╕реНред рек рд╕реЗрдХреЗрдиреНрдбрдХреЛ рдЕрдбрд┐рдпреЛ рдХреНрдпрд╛рдкреНрдЪрд░ рдЧрд░рд┐рдиреЗрдЫ, рддреНрдпрд╕рдкрдЫрд┐ рдкрд╛рдардорд╛ рд░реВрдкрд╛рдиреНрддрд░рдг рдЧрд░рд┐рдиреЗрдЫред

    ```output
    --- Available filters and text transformations: colorize, debug, default, direct, hexlify, log2file, nocontrol, printable, send_on_enter, time
    --- More details at http://bit.ly/pio-monitor-filters
    --- Miniterm on /dev/cu.usbmodem1101  9600,8,N,1 ---
    --- Quit: Ctrl+C | Menu: Ctrl+T | Help: Ctrl+T followed by Ctrl+H ---
    Connecting to WiFi..
    Connected!
    Got access token.
    Ready.
    Starting recording...
    Finished recording
    Sending speech...
    Speech sent!
    {"RecognitionStatus":"Success","DisplayText":"Set a 2 minute and 27 second timer.","Offset":4700000,"Duration":35300000}
    Set a 2 minute and 27 second timer.
    ```

> ЁЯТБ рддрдкрд╛рдИрдВ рдпреЛ рдХреЛрдб [code-speech-to-text/wio-terminal](../../../../../6-consumer/lessons/1-speech-recognition/code-speech-to-text/wio-terminal) рдлреЛрд▓реНрдбрд░рдорд╛ рдкрд╛рдЙрди рд╕рдХреНрдиреБрд╣реБрдиреНрдЫред

ЁЯША рддрдкрд╛рдИрдВрдХреЛ рдЖрд╡рд╛рдЬрд▓рд╛рдИ рдкрд╛рдардорд╛ рд░реВрдкрд╛рдиреНрддрд░рдг рдЧрд░реНрдиреЗ рдХрд╛рд░реНрдпрдХреНрд░рдо рд╕рдлрд▓ рднрдпреЛ!

---

**рдЕрд╕реНрд╡реАрдХрд░рдг**:  
рдпреЛ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ AI рдЕрдиреБрд╡рд╛рдж рд╕реЗрд╡рд╛ [Co-op Translator](https://github.com/Azure/co-op-translator) рдкреНрд░рдпреЛрдЧ рдЧрд░реЗрд░ рдЕрдиреБрд╡рд╛рдж рдЧрд░рд┐рдПрдХреЛ рдЫред рд╣рд╛рдореА рд╢реБрджреНрдзрддрд╛рдХреЛ рд▓рд╛рдЧрд┐ рдкреНрд░рдпрд╛рд╕ рдЧрд░реНрдЫреМрдВ, рддрд░ рдХреГрдкрдпрд╛ рдзреНрдпрд╛рди рджрд┐рдиреБрд╣реЛрд╕реН рдХрд┐ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдЕрдиреБрд╡рд╛рджрдорд╛ рддреНрд░реБрдЯрд┐рд╣рд░реВ рд╡рд╛ рдЕрд╢реБрджреНрдзрддрд╛рд╣рд░реВ рд╣реБрди рд╕рдХреНрдЫред рдпрд╕рдХреЛ рдореВрд▓ рднрд╛рд╖рд╛ рдорд╛ рд░рд╣реЗрдХреЛ рдореВрд▓ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝рд▓рд╛рдИ рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рд╕реНрд░реЛрдд рдорд╛рдирд┐рдиреБрдкрд░реНрдЫред рдорд╣рддреНрд╡рдкреВрд░реНрдг рдЬрд╛рдирдХрд╛рд░реАрдХреЛ рд▓рд╛рдЧрд┐, рд╡реНрдпрд╛рд╡рд╕рд╛рдпрд┐рдХ рдорд╛рдирд╡ рдЕрдиреБрд╡рд╛рдж рд╕рд┐рдлрд╛рд░рд┐рд╕ рдЧрд░рд┐рдиреНрдЫред рдпрд╕ рдЕрдиреБрд╡рд╛рджрдХреЛ рдкреНрд░рдпреЛрдЧрдмрд╛рдЯ рдЙрддреНрдкрдиреНрди рд╣реБрдиреЗ рдХреБрдиреИ рдкрдирд┐ рдЧрд▓рддрдлрд╣рдореА рд╡рд╛ рдЧрд▓рдд рд╡реНрдпрд╛рдЦреНрдпрд╛рдХреЛ рд▓рд╛рдЧрд┐ рд╣рд╛рдореА рдЬрд┐рдореНрдореЗрд╡рд╛рд░ рд╣реБрдиреЗ рдЫреИрдиреМрдВред