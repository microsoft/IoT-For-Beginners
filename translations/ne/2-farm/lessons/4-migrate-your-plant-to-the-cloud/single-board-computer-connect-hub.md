<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "3ac42e284a7222c0e83d2d43231a364f",
  "translation_date": "2025-08-27T12:03:00+00:00",
  "source_file": "2-farm/lessons/4-migrate-your-plant-to-the-cloud/single-board-computer-connect-hub.md",
  "language_code": "ne"
}
-->
# рдЖрдлреНрдиреЛ IoT рдЙрдкрдХрд░рдгрд▓рд╛рдИ рдХреНрд▓рд╛рдЙрдбрд╕рдБрдЧ рдЬрдбрд╛рди рдЧрд░реНрдиреБрд╣реЛрд╕реН - рднрд░реНрдЪреБрдЕрд▓ IoT рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ рд░ Raspberry Pi

рдпрд╕ рдкрд╛рдардХреЛ рдпрд╕ рднрд╛рдЧрдорд╛, рддрдкрд╛рдИрдВ рдЖрдлреНрдиреЛ рднрд░реНрдЪреБрдЕрд▓ IoT рдЙрдкрдХрд░рдг рд╡рд╛ Raspberry Pi рд▓рд╛рдИ IoT Hubрд╕рдБрдЧ рдЬрдбрд╛рди рдЧрд░реНрдиреБрд╣реБрдиреЗрдЫ, рдЯреЗрд▓рд┐рдореЗрдЯреНрд░реА рдкрдард╛рдЙрди рд░ рдЖрджреЗрд╢рд╣рд░реВ рдкреНрд░рд╛рдкреНрдд рдЧрд░реНрдиред

## рдЖрдлреНрдиреЛ рдЙрдкрдХрд░рдгрд▓рд╛рдИ IoT Hubрд╕рдБрдЧ рдЬрдбрд╛рди рдЧрд░реНрдиреБрд╣реЛрд╕реН

рдЕрд░реНрдХреЛ рдЪрд░рдг рднрдиреЗрдХреЛ рдЖрдлреНрдиреЛ рдЙрдкрдХрд░рдгрд▓рд╛рдИ IoT Hubрд╕рдБрдЧ рдЬрдбрд╛рди рдЧрд░реНрдиреБ рд╣реЛред

### рдХрд╛рд░реНрдп - IoT Hubрд╕рдБрдЧ рдЬрдбрд╛рди рдЧрд░реНрдиреБрд╣реЛрд╕реН

1. VS Code рдорд╛ `soil-moisture-sensor` рдлреЛрд▓реНрдбрд░ рдЦреЛрд▓реНрдиреБрд╣реЛрд╕реНред рдпрджрд┐ рддрдкрд╛рдИрдВ рднрд░реНрдЪреБрдЕрд▓ IoT рдЙрдкрдХрд░рдг рдкреНрд░рдпреЛрдЧ рдЧрд░реНрджреИ рд╣реБрдиреБрд╣реБрдиреНрдЫ рднрдиреЗ рдЯрд░реНрдорд┐рдирд▓рдорд╛ рднрд░реНрдЪреБрдЕрд▓ рд╡рд╛рддрд╛рд╡рд░рдг рдЪрд▓рд┐рд░рд╣реЗрдХреЛ рдЫ рднрдиреЗрд░ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдЧрд░реНрдиреБрд╣реЛрд╕реНред

1. рдХреЗрд╣реА рдЕрддрд┐рд░рд┐рдХреНрдд Pip рдкреНрдпрд╛рдХреЗрдЬрд╣рд░реВ рд╕реНрдерд╛рдкрдирд╛ рдЧрд░реНрдиреБрд╣реЛрд╕реН:

    ```sh
    pip3 install azure-iot-device
    ```

    `azure-iot-device` рддрдкрд╛рдИрдВрдХреЛ IoT Hubрд╕рдБрдЧ рд╕рдВрд╡рд╛рдж рдЧрд░реНрдирдХреЛ рд▓рд╛рдЧрд┐ рдкреБрд╕реНрддрдХрд╛рд▓рдп рд╣реЛред

1. `app.py` рдлрд╛рдЗрд▓рдХреЛ рдорд╛рдерд┐, рдкрд╣рд┐рд▓реЗ рдиреИ рднрдПрдХрд╛ рдЖрдпрд╛рддрд╣рд░реВ рддрд▓ рдирд┐рдореНрди рдЖрдпрд╛рддрд╣рд░реВ рдердкреНрдиреБрд╣реЛрд╕реН:

    ```python
    from azure.iot.device import IoTHubDeviceClient, Message, MethodResponse
    ```

    рдпреЛ рдХреЛрдбрд▓реЗ рддрдкрд╛рдИрдВрдХреЛ IoT Hubрд╕рдБрдЧ рд╕рдВрд╡рд╛рдж рдЧрд░реНрдирдХреЛ рд▓рд╛рдЧрд┐ SDK рдЖрдпрд╛рдд рдЧрд░реНрджрдЫред

1. `import paho.mqtt.client as mqtt` рд▓рд╛рдЗрди рд╣рдЯрд╛рдЙрдиреБрд╣реЛрд╕реН рдХрд┐рдирдХрд┐ рдпреЛ рдкреБрд╕реНрддрдХрд╛рд▓рдп рдЕрдм рдЖрд╡рд╢реНрдпрдХ рдЫреИрдиред MQTT рдХреЛрдб, рдЯрдкрд┐рдХ рдирд╛рдорд╣рд░реВ, `mqtt_client` рдкреНрд░рдпреЛрдЧ рдЧрд░реНрдиреЗ рд╕рдмреИ рдХреЛрдб рд░ `handle_command` рд╣рдЯрд╛рдЙрдиреБрд╣реЛрд╕реНред `while True:` рд▓реВрдк рд░рд╛рдЦреНрдиреБрд╣реЛрд╕реН, рддрд░ рдпрд╕ рд▓реВрдкрдмрд╛рдЯ `mqtt_client.publish` рд▓рд╛рдЗрди рд╣рдЯрд╛рдЙрдиреБрд╣реЛрд╕реНред

1. рдЖрдпрд╛рдд рдХрдердирд╣рд░реВ рддрд▓ рдирд┐рдореНрди рдХреЛрдб рдердкреНрдиреБрд╣реЛрд╕реН:

    ```python
    connection_string = "<connection string>"
    ```

    `<connection string>` рд▓рд╛рдИ рдпрд╕ рдкрд╛рдардХреЛ рдкрд╣рд┐рд▓реЗ рддрдкрд╛рдИрдВрд▓реЗ рдЙрдкрдХрд░рдгрдХреЛ рд▓рд╛рдЧрд┐ рдкреНрд░рд╛рдкреНрдд рдЧрд░реЗрдХреЛ рдЬрдбрд╛рди рд╕реНрдЯреНрд░рд┐рдЩрд▓реЗ рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрди рдЧрд░реНрдиреБрд╣реЛрд╕реНред

    > ЁЯТБ рдпреЛ рдЙрддреНрддрдо рдЕрднреНрдпрд╛рд╕ рд╣реЛрдЗрдиред рдЬрдбрд╛рди рд╕реНрдЯреНрд░рд┐рдЩрд╣рд░реВ рдХрд╣рд┐рд▓реНрдпреИ рд╕реНрд░реЛрдд рдХреЛрдбрдорд╛ рднрдгреНрдбрд╛рд░рдг рдЧрд░реНрдиреБ рд╣реБрдБрджреИрди, рдХрд┐рдирдХрд┐ рдпрд╕рд▓рд╛рдИ рд╕реНрд░реЛрдд рдХреЛрдб рдирд┐рдпрдиреНрддреНрд░рдгрдорд╛ рдЬрд╛рдБрдЪ рдЧрд░реНрди рд╕рдХрд┐рдиреНрдЫ рд░ рдЬреЛ рдХреЛрд╣реАрд▓реЗ рдлреЗрд▓рд╛ рдкрд╛рд░реНрди рд╕рдХреНрдЫред рд╣рд╛рдореА рдпрд╣рд╛рдБ рд╕рд░рд▓рддрд╛рдХреЛ рд▓рд╛рдЧрд┐ рдпреЛ рдЧрд░реНрджреИрдЫреМрдВред рдЖрджрд░реНрд╢ рд░реВрдкрдорд╛ рддрдкрд╛рдИрдВрд▓реЗ рд╡рд╛рддрд╛рд╡рд░рдг рдЪрд░ рд░ [`python-dotenv`](https://pypi.org/project/python-dotenv/) рдЬрд╕реНрддрд╛ рдЙрдкрдХрд░рдг рдкреНрд░рдпреЛрдЧ рдЧрд░реНрдиреБрдкрд░реНрдЫред рддрдкрд╛рдИрдВ рдпрд╕рдмрд╛рд░реЗ рдЖрдЧрд╛рдореА рдкрд╛рдардорд╛ рдердк рдЬрд╛рдиреНрдиреБрд╣реБрдиреЗрдЫред

1. рдпрд╕ рдХреЛрдбрдХреЛ рддрд▓, IoT Hubрд╕рдБрдЧ рд╕рдВрд╡рд╛рдж рдЧрд░реНрди рд╕рдХреНрдиреЗ рдЙрдкрдХрд░рдг рдХреНрд▓рд╛рдЗрдиреНрдЯ рд╡рд╕реНрддреБ рд╕рд┐рд░реНрдЬрдирд╛ рдЧрд░реНрди рд░ рдпрд╕рд▓рд╛рдИ рдЬрдбрд╛рди рдЧрд░реНрди рдирд┐рдореНрди рдХреЛрдб рдердкреНрдиреБрд╣реЛрд╕реН:

    ```python
    device_client = IoTHubDeviceClient.create_from_connection_string(connection_string)

    print('Connecting')
    device_client.connect()
    print('Connected')
    ```

1. рдпреЛ рдХреЛрдб рдЪрд▓рд╛рдЙрдиреБрд╣реЛрд╕реНред рддрдкрд╛рдИрдВрдХреЛ рдЙрдкрдХрд░рдг рдЬрдбрд╛рди рднрдПрдХреЛ рджреЗрдЦреНрдиреБрд╣реБрдиреЗрдЫред

    ```output
    pi@raspberrypi:~/soil-moisture-sensor $ python3 app.py 
    Connecting
    Connected
    Soil moisture: 379
    ```

## рдЯреЗрд▓рд┐рдореЗрдЯреНрд░реА рдкрдард╛рдЙрдиреБрд╣реЛрд╕реН

рдЕрдм рддрдкрд╛рдИрдВрдХреЛ рдЙрдкрдХрд░рдг рдЬрдбрд╛рди рднрдЗрд╕рдХреЗрдХреЛ рдЫ, рддрдкрд╛рдИрдВ MQTT рдмреНрд░реЛрдХрд░рдХреЛ рд╕рдЯреНрдЯрд╛ IoT Hubрдорд╛ рдЯреЗрд▓рд┐рдореЗрдЯреНрд░реА рдкрдард╛рдЙрди рд╕рдХреНрдиреБрд╣реБрдиреНрдЫред

### рдХрд╛рд░реНрдп - рдЯреЗрд▓рд┐рдореЗрдЯреНрд░реА рдкрдард╛рдЙрдиреБрд╣реЛрд╕реН

1. `while True` рд▓реВрдк рднрд┐рддреНрд░, рд╕реБрддреНрдиреБрдЕрдШрд┐ рдирд┐рдореНрди рдХреЛрдб рдердкреНрдиреБрд╣реЛрд╕реН:

    ```python
    message = Message(json.dumps({ 'soil_moisture': soil_moisture }))
    device_client.send_message(message)
    ```

    рдпреЛ рдХреЛрдбрд▓реЗ рдорд╛рдЯреЛрдХреЛ рдЪрд┐рд╕реНрдпрд╛рдирдХреЛ рд░рд┐рдбрд┐рдЩрд▓рд╛рдИ JSON рд╕реНрдЯреНрд░рд┐рдЩрдХреЛ рд░реВрдкрдорд╛ рд╕рдорд╛рд╡реЗрд╢ рдЧрд░реНрдиреЗ IoT Hub `Message` рд╕рд┐рд░реНрдЬрдирд╛ рдЧрд░реНрджрдЫ, рддреНрдпрд╕рдкрдЫрд┐ рдпрд╕рд▓рд╛рдИ рдЙрдкрдХрд░рдгрдмрд╛рдЯ рдХреНрд▓рд╛рдЙрдб рд╕рдиреНрджреЗрд╢рдХреЛ рд░реВрдкрдорд╛ IoT Hubрдорд╛ рдкрдард╛рдЙрдБрдЫред

## рдЖрджреЗрд╢рд╣рд░реВ рд╣реНрдпрд╛рдиреНрдбрд▓ рдЧрд░реНрдиреБрд╣реЛрд╕реН

рддрдкрд╛рдИрдВрдХреЛ рдЙрдкрдХрд░рдгрд▓реЗ рд░рд┐рд▓реЗ рдирд┐рдпрдиреНрддреНрд░рдг рдЧрд░реНрди рд╕рд░реНрд╡рд░ рдХреЛрдбрдмрд╛рдЯ рдЖрджреЗрд╢ рд╣реНрдпрд╛рдиреНрдбрд▓ рдЧрд░реНрди рдЖрд╡рд╢реНрдпрдХ рдЫред рдпреЛ рдкреНрд░рддреНрдпрдХреНрд╖ рд╡рд┐рдзрд┐ рдЕрдиреБрд░реЛрдзрдХреЛ рд░реВрдкрдорд╛ рдкрдард╛рдЗрдиреНрдЫред

## рдХрд╛рд░реНрдп - рдкреНрд░рддреНрдпрдХреНрд╖ рд╡рд┐рдзрд┐ рдЕрдиреБрд░реЛрдз рд╣реНрдпрд╛рдиреНрдбрд▓ рдЧрд░реНрдиреБрд╣реЛрд╕реН

1. `while True` рд▓реВрдк рдЕрдШрд┐ рдирд┐рдореНрди рдХреЛрдб рдердкреНрдиреБрд╣реЛрд╕реН:

    ```python
    def handle_method_request(request):
        print("Direct method received - ", request.name)
    
        if request.name == "relay_on":
            relay.on()
        elif request.name == "relay_off":
            relay.off()    
    ```

    рдпреЛ `handle_method_request` рдирд╛рдордХреЛ рд╡рд┐рдзрд┐ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдЧрд░реНрджрдЫ, рдЬреБрди IoT HubрджреНрд╡рд╛рд░рд╛ рдкреНрд░рддреНрдпрдХреНрд╖ рд╡рд┐рдзрд┐ рдмреЛрд▓рд╛рдЙрдБрджрд╛ рдХрд▓ рдЧрд░рд┐рдиреЗрдЫред рдкреНрд░рддреНрдпреЗрдХ рдкреНрд░рддреНрдпрдХреНрд╖ рд╡рд┐рдзрд┐рдХреЛ рдирд╛рдо рд╣реБрдиреНрдЫ, рд░ рдпреЛ рдХреЛрдбрд▓реЗ рд░рд┐рд▓реЗ рдЕрди рдЧрд░реНрди `relay_on` рд░ рд░рд┐рд▓реЗ рдЕрдл рдЧрд░реНрди `relay_off` рдирд╛рдордХреЛ рд╡рд┐рдзрд┐ рдЕрдкреЗрдХреНрд╖рд╛ рдЧрд░реНрджрдЫред

    > ЁЯТБ рдпреЛ рдПрдХрд▓ рдкреНрд░рддреНрдпрдХреНрд╖ рд╡рд┐рдзрд┐ рдЕрдиреБрд░реЛрдзрдорд╛ рдкрдирд┐ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдЧрд░реНрди рд╕рдХрд┐рдиреНрдЫ, рд░рд┐рд▓реЗрдХреЛ рдЗрдЪреНрдЫрд┐рдд рдЕрд╡рд╕реНрдерд╛ рдЕрдиреБрд░реЛрдзрдХреЛ рд╕рд╛рде рдкрдард╛рдЙрди рд╕рдХрд┐рдиреЗ рдкреЗрд▓реЛрдбрдорд╛ рдкрд╛рд╕ рдЧрд░реЗрд░, рдЬреБрди `request` рд╡рд╕реНрддреБрдмрд╛рдЯ рдЙрдкрд▓рдмреНрдз рд╣реБрдиреНрдЫред

1. рдкреНрд░рддреНрдпрдХреНрд╖ рд╡рд┐рдзрд┐рд▓реЗ рдХрд▓ рдЧрд░реНрдиреЗ рдХреЛрдбрд▓рд╛рдИ рдпреЛ рд╣реНрдпрд╛рдиреНрдбрд▓ рдЧрд░рд┐рдПрдХреЛ рдЫ рднрдиреЗрд░ рдмрддрд╛рдЙрди рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдЖрд╡рд╢реНрдпрдХ рдЫред `handle_method_request` рдХрд╛рд░реНрдпрдХреЛ рдЕрдиреНрддреНрдпрдорд╛ рдирд┐рдореНрди рдХреЛрдб рдердкреНрдиреБрд╣реЛрд╕реН:

    ```python
    method_response = MethodResponse.create_from_method_request(request, 200)
    device_client.send_method_response(method_response)
    ```

    рдпреЛ рдХреЛрдбрд▓реЗ рдкреНрд░рддреНрдпрдХреНрд╖ рд╡рд┐рдзрд┐ рдЕрдиреБрд░реЛрдзрд▓рд╛рдИ HTTP рд╕реНрдерд┐рддрд┐ рдХреЛрдб 200 рд╕рд╣рд┐рдд рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдкрдард╛рдЙрдБрдЫ, рд░ рдпрд╕рд▓рд╛рдИ IoT Hubрдорд╛ рдлрд░реНрдХрд╛рдЙрдБрдЫред

1. рдпреЛ рдХрд╛рд░реНрдп рдкрд░рд┐рднрд╛рд╖рд╛рдХреЛ рддрд▓ рдирд┐рдореНрди рдХреЛрдб рдердкреНрдиреБрд╣реЛрд╕реН:

    ```python
    device_client.on_method_request_received = handle_method_request
    ```

    рдпреЛ рдХреЛрдбрд▓реЗ IoT Hub рдХреНрд▓рд╛рдЗрдиреНрдЯрд▓рд╛рдИ рдкреНрд░рддреНрдпрдХреНрд╖ рд╡рд┐рдзрд┐ рдмреЛрд▓рд╛рдЙрдБрджрд╛ `handle_method_request` рдХрд╛рд░реНрдп рдХрд▓ рдЧрд░реНрди рднрдиреНрдЫред

> ЁЯТБ рддрдкрд╛рдИрдВ рдпреЛ рдХреЛрдб [code/pi](../../../../../2-farm/lessons/4-migrate-your-plant-to-the-cloud/code/pi) рд╡рд╛ [code/virtual-device](../../../../../2-farm/lessons/4-migrate-your-plant-to-the-cloud/code/virtual-device) рдлреЛрд▓реНрдбрд░рдорд╛ рдлреЗрд▓рд╛ рдкрд╛рд░реНрди рд╕рдХреНрдиреБрд╣реБрдиреНрдЫред

ЁЯША рддрдкрд╛рдИрдВрдХреЛ рдорд╛рдЯреЛрдХреЛ рдЪрд┐рд╕реНрдпрд╛рди рд╕реЗрдиреНрд╕рд░ рдХрд╛рд░реНрдпрдХреНрд░рдо IoT Hubрд╕рдБрдЧ рдЬрдбрд╛рди рднрдПрдХреЛ рдЫ!

---

**рдЕрд╕реНрд╡реАрдХрд░рдг**:  
рдпреЛ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ AI рдЕрдиреБрд╡рд╛рдж рд╕реЗрд╡рд╛ [Co-op Translator](https://github.com/Azure/co-op-translator) рдкреНрд░рдпреЛрдЧ рдЧрд░реЗрд░ рдЕрдиреБрд╡рд╛рдж рдЧрд░рд┐рдПрдХреЛ рдЫред рд╣рд╛рдореА рд╢реБрджреНрдзрддрд╛рдХреЛ рд▓рд╛рдЧрд┐ рдкреНрд░рдпрд╛рд╕ рдЧрд░реНрдЫреМрдВ, рддрд░ рдХреГрдкрдпрд╛ рдзреНрдпрд╛рди рджрд┐рдиреБрд╣реЛрд╕реН рдХрд┐ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдЕрдиреБрд╡рд╛рджрдорд╛ рддреНрд░реБрдЯрд┐рд╣рд░реВ рд╡рд╛ рдЕрд╢реБрджреНрдзрддрд╛рд╣рд░реВ рд╣реБрди рд╕рдХреНрдЫред рдпрд╕рдХреЛ рдореВрд▓ рднрд╛рд╖рд╛ рдорд╛ рд░рд╣реЗрдХреЛ рдореВрд▓ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝рд▓рд╛рдИ рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рд╕реНрд░реЛрдд рдорд╛рдирд┐рдиреБрдкрд░реНрдЫред рдорд╣рддреНрд╡рдкреВрд░реНрдг рдЬрд╛рдирдХрд╛рд░реАрдХреЛ рд▓рд╛рдЧрд┐, рд╡реНрдпрд╛рд╡рд╕рд╛рдпрд┐рдХ рдорд╛рдирд╡ рдЕрдиреБрд╡рд╛рдж рд╕рд┐рдлрд╛рд░рд┐рд╕ рдЧрд░рд┐рдиреНрдЫред рдпрд╕ рдЕрдиреБрд╡рд╛рджрдХреЛ рдкреНрд░рдпреЛрдЧрдмрд╛рдЯ рдЙрддреНрдкрдиреНрди рд╣реБрдиреЗ рдХреБрдиреИ рдкрдирд┐ рдЧрд▓рддрдлрд╣рдореА рд╡рд╛ рдЧрд▓рдд рд╡реНрдпрд╛рдЦреНрдпрд╛рдХреЛ рд▓рд╛рдЧрд┐ рд╣рд╛рдореА рдЬрд┐рдореНрдореЗрд╡рд╛рд░ рд╣реБрдиреЗ рдЫреИрдиреМрдВред