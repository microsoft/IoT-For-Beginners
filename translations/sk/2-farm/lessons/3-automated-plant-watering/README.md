<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "f7bb24ba53fb627ddb38a8b24a05e594",
  "translation_date": "2025-08-28T11:36:20+00:00",
  "source_file": "2-farm/lessons/3-automated-plant-watering/README.md",
  "language_code": "sk"
}
-->
# Automatick√© zavla≈æovanie rastl√≠n

![Prehƒæad tejto lekcie vo forme sketchnote](../../../../../translated_images/lesson-7.30b5f577d3cb8e031238751475cb519c7d6dbaea261b5df4643d086ffb2a03bb.sk.jpg)

> Sketchnote od [Nitya Narasimhan](https://github.com/nitya). Kliknite na obr√°zok pre jeho zv√§ƒç≈°en√∫ verziu.

T√°to lekcia bola s√∫ƒças≈•ou [IoT pre zaƒçiatoƒçn√≠kov Projekt 2 - Digit√°lne poƒænohospod√°rstvo](https://youtube.com/playlist?list=PLmsFUfdnGr3yCutmcVg6eAUEfsGiFXgcx) zo s√©rie [Microsoft Reactor](https://developer.microsoft.com/reactor/?WT.mc_id=academic-17441-jabenn).

[![Automatick√© zavla≈æovanie rastl√≠n pomocou IoT](https://img.youtube.com/vi/g9FfZwv9R58/0.jpg)](https://youtu.be/g9FfZwv9R58)

## Kv√≠z pred lekciou

[Kv√≠z pred lekciou](https://black-meadow-040d15503.1.azurestaticapps.net/quiz/13)

## √övod

V predch√°dzaj√∫cej lekcii ste sa nauƒçili, ako monitorova≈• vlhkos≈• p√¥dy. V tejto lekcii sa nauƒç√≠te, ako zostavi≈• z√°kladn√© komponenty automatick√©ho zavla≈æovacieho syst√©mu, ktor√Ω reaguje na vlhkos≈• p√¥dy. Tie≈æ sa dozviete o naƒçasovan√≠ ‚Äì ako senzory m√¥≈æu potrebova≈• urƒçit√Ω ƒças na reakciu na zmeny a ako aktu√°tory m√¥≈æu potrebova≈• ƒças na zmenu vlastnost√≠, ktor√© senzory meraj√∫.

V tejto lekcii sa budeme venova≈•:

* [Ovl√°danie zariaden√≠ s vysok√Ωm v√Ωkonom pomocou IoT zariadenia s n√≠zkym v√Ωkonom](../../../../../2-farm/lessons/3-automated-plant-watering)
* [Ovl√°danie rel√©](../../../../../2-farm/lessons/3-automated-plant-watering)
* [Ovl√°danie va≈°ej rastliny cez MQTT](../../../../../2-farm/lessons/3-automated-plant-watering)
* [Naƒçasovanie senzorov a aktu√°torov](../../../../../2-farm/lessons/3-automated-plant-watering)
* [Pridanie naƒçasovania do v√°≈°ho servera na ovl√°danie rastl√≠n](../../../../../2-farm/lessons/3-automated-plant-watering)

## Ovl√°danie zariaden√≠ s vysok√Ωm v√Ωkonom pomocou IoT zariadenia s n√≠zkym v√Ωkonom

IoT zariadenia pou≈æ√≠vaj√∫ n√≠zke nap√§tie. Hoci to staƒç√≠ pre senzory a n√≠zkov√Ωkonn√© aktu√°tory, ako s√∫ LED di√≥dy, je to pr√≠li≈° m√°lo na ovl√°danie v√§ƒç≈°ieho hardv√©ru, ako je vodn√© ƒçerpadlo pou≈æ√≠van√© na zavla≈æovanie. Dokonca aj mal√© ƒçerpadl√°, ktor√© by ste mohli pou≈æi≈• pre izbov√© rastliny, odoberaj√∫ pr√≠li≈° veƒæa pr√∫du pre IoT v√Ωvojov√∫ dosku a mohli by ju po≈°kodi≈•.

> üéì Pr√∫d, meran√Ω v amp√©roch (A), je mno≈æstvo elektriny pretekaj√∫ce obvodom. Nap√§tie poskytuje tlak, pr√∫d je to, koƒæko sa tlaƒç√≠. Viac o pr√∫de si m√¥≈æete preƒç√≠ta≈• na [str√°nke o elektrickom pr√∫de na Wikip√©dii](https://wikipedia.org/wiki/Electric_current).

Rie≈°en√≠m je pripoji≈• ƒçerpadlo k extern√©mu zdroju nap√°jania a pou≈æi≈• aktu√°tor na zapnutie ƒçerpadla, podobne ako by ste zapli svetlo. Na preklopenie vyp√≠naƒça prstom staƒç√≠ mal√© mno≈æstvo energie (vo forme energie v√°≈°ho tela), a to spoj√≠ svetlo s elektrickou sie≈•ou be≈æiacou na 110V/240V.

![Vyp√≠naƒç zap√≠na svetlo](../../../../../translated_images/light-switch.760317ad6ab8bd6d611da5352dfe9c73a94a0822ccec7df3c8bae35da18e1658.sk.png)

> üéì [Elektrick√° sie≈•](https://wikipedia.org/wiki/Mains_electricity) oznaƒçuje elektrinu dod√°van√∫ do dom√°cnost√≠ a podnikov prostredn√≠ctvom n√°rodnej infra≈°trukt√∫ry v mnoh√Ωch ƒçastiach sveta.

‚úÖ IoT zariadenia zvyƒçajne poskytuj√∫ 3,3V alebo 5V, pri pr√∫de menej ako 1 amp√©r (1A). Porovnajte to s elektrickou sie≈•ou, ktor√° je najƒçastej≈°ie na √∫rovni 230V (120V v Severnej Amerike a 100V v Japonsku) a dok√°≈æe nap√°ja≈• zariadenia, ktor√© odoberaj√∫ 30A.

Existuje mno≈æstvo aktu√°torov, ktor√© to dok√°≈æu, vr√°tane mechanick√Ωch zariaden√≠, ktor√© m√¥≈æete pripoji≈• k existuj√∫cim vyp√≠naƒçom a ktor√© napodob≈àuj√∫ prst zap√≠naj√∫ci ich. Najpopul√°rnej≈°√≠m je rel√©.

### Rel√©

Rel√© je elektromechanick√Ω sp√≠naƒç, ktor√Ω premie≈àa elektrick√Ω sign√°l na mechanick√Ω pohyb, ktor√Ω zap√≠na sp√≠naƒç. Jadro rel√© tvor√≠ elektromagnet.

> üéì [Elektromagnety](https://wikipedia.org/wiki/Electromagnet) s√∫ magnety, ktor√© vznikaj√∫ prechodom elektriny cez cievku dr√¥tu. Keƒè je elektrina zapnut√°, cievka sa zmagnetizuje. Keƒè je elektrina vypnut√°, cievka strat√≠ svoju magnetick√∫ schopnos≈•.

![Keƒè je zapnut√©, elektromagnet vytv√°ra magnetick√© pole, ktor√© zap√≠na sp√≠naƒç pre v√Ωstupn√Ω obvod](../../../../../translated_images/relay-on.4db16a0fd6b669262fd6699aff3fbcd31b6057c06d90411b6bddc06326d1cf75.sk.png)

V rel√© nap√°ja ovl√°dac√≠ obvod elektromagnet. Keƒè je elektromagnet zapnut√Ω, pritiahne p√°ku, ktor√° pohne sp√≠naƒçom, uzavrie p√°r kontaktov a dokonƒç√≠ v√Ωstupn√Ω obvod.

![Keƒè je vypnut√©, elektromagnet nevytv√°ra magnetick√© pole, ktor√© by zap√≠nalo sp√≠naƒç pre v√Ωstupn√Ω obvod](../../../../../translated_images/relay-off.c34a178a2960fecdc3c6400d43e633ed11c6746cd653cfb4a768fa097c40394c.sk.png)

Keƒè je ovl√°dac√≠ obvod vypnut√Ω, elektromagnet sa vypne, uvoƒæn√≠ p√°ku a otvor√≠ kontakty, ƒç√≠m vypne v√Ωstupn√Ω obvod. Rel√© s√∫ digit√°lne aktu√°tory ‚Äì vysok√Ω sign√°l do rel√© ho zapne, n√≠zky sign√°l ho vypne.

V√Ωstupn√Ω obvod m√¥≈æe by≈• pou≈æit√Ω na nap√°janie ƒèal≈°ieho hardv√©ru, ako je zavla≈æovac√≠ syst√©m. IoT zariadenie m√¥≈æe zapn√∫≈• rel√©, ƒç√≠m dokonƒç√≠ v√Ωstupn√Ω obvod, ktor√Ω nap√°ja zavla≈æovac√≠ syst√©m, a rastliny sa zavla≈æia. IoT zariadenie potom m√¥≈æe rel√© vypn√∫≈•, ƒç√≠m preru≈°√≠ nap√°janie zavla≈æovacieho syst√©mu a zastav√≠ vodu.

![Rel√© zap√≠na ƒçerpadlo, ktor√© posiela vodu do rastliny](../../../../../images/strawberry-pump.gif)

Vo videu vy≈°≈°ie sa zapne rel√©. LED di√≥da na rel√© sa rozsvieti, aby signalizovala, ≈æe je zapnut√© (niektor√© rel√© maj√∫ LED di√≥dy na indik√°ciu zapnutia alebo vypnutia), a nap√°janie sa odo≈°le do ƒçerpadla, ktor√© sa zapne a pumpuje vodu do rastliny.

> üíÅ Rel√© m√¥≈æu by≈• tie≈æ pou≈æit√© na prep√≠nanie medzi dvoma v√Ωstupn√Ωmi obvodmi namiesto zap√≠nania a vyp√≠nania jedn√©ho. Keƒè sa p√°ka pohybuje, pres√∫va sp√≠naƒç z dokonƒçenia jedn√©ho v√Ωstupn√©ho obvodu na dokonƒçenie in√©ho v√Ωstupn√©ho obvodu, zvyƒçajne zdieƒæaj√∫ceho spoloƒçn√© nap√°janie alebo spoloƒçn√© uzemnenie.

‚úÖ Urobte si v√Ωskum: Existuje viacero typov rel√© s rozdielmi, ako napr√≠klad ƒçi ovl√°dac√≠ obvod zap√≠na alebo vyp√≠na rel√©, keƒè je nap√°janie pripojen√©, alebo s viacer√Ωmi v√Ωstupn√Ωmi obvodmi. Zistite viac o t√Ωchto r√¥znych typoch.

Keƒè sa p√°ka pohybuje, zvyƒçajne poƒçujete, ako sa dotkne elektromagnetu s dobre definovan√Ωm kliknut√≠m.

> üíÅ Rel√© m√¥≈æe by≈• zapojen√© tak, ≈æe vytvorenie spojenia vlastne preru≈°√≠ nap√°janie rel√©, ƒç√≠m sa rel√© vypne, ƒço potom po≈°le nap√°janie sp√§≈• do rel√©, ƒç√≠m sa op√§≈• zapne, a tak ƒèalej. To znamen√°, ≈æe rel√© bude klika≈• neuveriteƒæne r√Ωchlo a vytv√°ra≈• bzuƒçiv√Ω zvuk. Takto fungovali niektor√© z prv√Ωch bzuƒçiakov pou≈æ√≠van√Ωch v elektrick√Ωch zvonƒçekoch.

### Nap√°janie rel√©

Elektromagnet nepotrebuje veƒæa energie na aktiv√°ciu a pritiahne p√°ku, m√¥≈æe by≈• ovl√°dan√Ω pomocou 3,3V alebo 5V v√Ωstupu z IoT v√Ωvojovej dosky. V√Ωstupn√Ω obvod m√¥≈æe nies≈• oveƒæa viac energie, v z√°vislosti od rel√©, vr√°tane nap√§tia zo siete alebo dokonca vy≈°≈°√≠ch √∫rovn√≠ v√Ωkonu pre priemyseln√© pou≈æitie. T√Ωmto sp√¥sobom m√¥≈æe IoT v√Ωvojov√° doska ovl√°da≈• zavla≈æovac√≠ syst√©m, od mal√©ho ƒçerpadla pre jednu rastlinu a≈æ po mas√≠vny priemyseln√Ω syst√©m pre cel√∫ komerƒçn√∫ farmu.

![Rel√© Grove s oznaƒçen√Ωmi ovl√°dac√≠m obvodom, v√Ωstupn√Ωm obvodom a rel√©](../../../../../translated_images/grove-relay-labelled.293e068f5c3c2a199bd7892f2661fdc9e10c920b535cfed317fbd6d1d4ae1168.sk.png)

Na obr√°zku vy≈°≈°ie je rel√© Grove. Ovl√°dac√≠ obvod sa prip√°ja k IoT zariadeniu a zap√≠na alebo vyp√≠na rel√© pomocou 3,3V alebo 5V. V√Ωstupn√Ω obvod m√° dva termin√°ly, buƒè jeden m√¥≈æe by≈• nap√°janie alebo uzemnenie. V√Ωstupn√Ω obvod zvl√°dne a≈æ 250V pri 10A, ƒço je dos≈• pre rad zariaden√≠ nap√°jan√Ωch zo siete. M√¥≈æete z√≠ska≈• rel√©, ktor√© zvl√°dnu e≈°te vy≈°≈°ie √∫rovne v√Ωkonu.

![ƒåerpadlo zapojen√© cez rel√©](../../../../../translated_images/pump-wired-to-relay.66c5cfc0d89189900cd601777f5caeb39ee35c6250f6c86bf38feaceedb21fe9.sk.png)

Na obr√°zku vy≈°≈°ie je ƒçerpadlo nap√°jan√© cez rel√©. ƒåerven√Ω vodiƒç sp√°ja +5V termin√°l USB nap√°jacieho zdroja s jedn√Ωm termin√°lom v√Ωstupn√©ho obvodu rel√© a ƒèal≈°√≠ ƒçerven√Ω vodiƒç sp√°ja druh√Ω termin√°l v√Ωstupn√©ho obvodu s ƒçerpadlom. ƒåierny vodiƒç sp√°ja ƒçerpadlo s uzemnen√≠m USB nap√°jacieho zdroja. Keƒè sa rel√© zapne, dokonƒç√≠ obvod, po≈°le 5V do ƒçerpadla a zapne ho.

## Ovl√°danie rel√©

Rel√© m√¥≈æete ovl√°da≈• zo svojej IoT v√Ωvojovej dosky.

### √öloha - ovl√°danie rel√©

Prejdite si pr√≠slu≈°n√Ω n√°vod na ovl√°danie rel√© pomocou v√°≈°ho IoT zariadenia:

* [Arduino - Wio Terminal](wio-terminal-relay.md)
* [Jednodoskov√Ω poƒç√≠taƒç - Raspberry Pi](pi-relay.md)
* [Jednodoskov√Ω poƒç√≠taƒç - Virtu√°lne zariadenie](virtual-device-relay.md)

## Ovl√°danie va≈°ej rastliny cez MQTT

Doteraz bolo va≈°e rel√© ovl√°dan√© IoT zariaden√≠m priamo na z√°klade jedn√©ho merania vlhkosti p√¥dy. V komerƒçnom zavla≈æovacom syst√©me bude riadiaca logika centralizovan√°, ƒço umo≈æn√≠ rozhodovanie o zavla≈æovan√≠ na z√°klade √∫dajov z viacer√Ωch senzorov a umo≈æn√≠ zmenu konfigur√°cie na jednom mieste. Na simul√°ciu tohto procesu m√¥≈æete ovl√°da≈• rel√© cez MQTT.

### √öloha - ovl√°danie rel√© cez MQTT

1. Pridajte pr√≠slu≈°n√© kni≈ænice/pip bal√≠ƒçky MQTT a k√≥d do v√°≈°ho projektu `soil-moisture-sensor`, aby ste sa pripojili k MQTT. Pomenujte ID klienta ako `soilmoisturesensor_client` s predponou v√°≈°ho ID.

    > ‚ö†Ô∏è M√¥≈æete sa odvola≈• na [pokyny na pripojenie k MQTT v projekte 1, lekcia 4, ak je to potrebn√©](../../../1-getting-started/lessons/4-connect-internet/README.md#connect-your-iot-device-to-mqtt).

1. Pridajte pr√≠slu≈°n√Ω k√≥d zariadenia na odosielanie telemetrie s nastaveniami vlhkosti p√¥dy. Pre spr√°vu telemetrie pomenujte vlastnos≈• `soil_moisture`.

    > ‚ö†Ô∏è M√¥≈æete sa odvola≈• na [pokyny na odosielanie telemetrie do MQTT v projekte 1, lekcia 4, ak je to potrebn√©](../../../1-getting-started/lessons/4-connect-internet/README.md#send-telemetry-from-your-iot-device).

1. Vytvorte lok√°lny serverov√Ω k√≥d na odber telemetrie a odoslanie pr√≠kazu na ovl√°danie rel√© v prieƒçinku `soil-moisture-sensor-server`. Pomenujte vlastnos≈• v spr√°ve pr√≠kazu `relay_on` a nastavte ID klienta ako `soilmoisturesensor_server` s predponou v√°≈°ho ID. Zachovajte rovnak√∫ ≈°trukt√∫ru ako serverov√Ω k√≥d, ktor√Ω ste nap√≠sali pre projekt 1, lekcia 4, preto≈æe tento k√≥d budete nesk√¥r v tejto lekcii roz≈°irova≈•.

    > ‚ö†Ô∏è M√¥≈æete sa odvola≈• na [pokyny na odosielanie telemetrie do MQTT](../../../1-getting-started/lessons/4-connect-internet/README.md#write-the-server-code) a [odosielanie pr√≠kazov cez MQTT](../../../1-getting-started/lessons/4-connect-internet/README.md#send-commands-to-the-mqtt-broker) v projekte 1, lekcia 4, ak je to potrebn√©.

1. Pridajte pr√≠slu≈°n√Ω k√≥d zariadenia na ovl√°danie rel√© z prijat√Ωch pr√≠kazov, pomocou vlastnosti `relay_on` zo spr√°vy. Po≈°lite hodnotu true pre `relay_on`, ak je `soil_moisture` v√§ƒç≈°ia ako 450, inak po≈°lite hodnotu false, rovnako ako logiku, ktor√∫ ste pridali pre IoT zariadenie sk√¥r.

    > ‚ö†Ô∏è M√¥≈æete sa odvola≈• na [pokyny na reagovanie na pr√≠kazy z MQTT v projekte 1, lekcia 4, ak je to potrebn√©](../../../1-getting-started/lessons/4-connect-internet/README.md#handle-commands-on-the-iot-device).

> üíÅ Tento k√≥d n√°jdete v prieƒçinku [code-mqtt](../../../../../2-farm/lessons/3-automated-plant-watering/code-mqtt).

Uistite sa, ≈æe k√≥d be≈æ√≠ na va≈°om zariaden√≠ a lok√°lnom serveri, a otestujte ho zmenou √∫rovn√≠ vlhkosti p√¥dy, buƒè zmenou hodn√¥t odosielan√Ωch virtu√°lnym senzorom, alebo zmenou √∫rovn√≠ vlhkosti p√¥dy pridan√≠m vody alebo odstr√°nen√≠m senzora z p√¥dy.

## Naƒçasovanie senzorov a aktu√°torov

V lekcii 3 ste vytvorili noƒçn√© svetlo ‚Äì LED di√≥du, ktor√° sa zapne hneƒè, ako sveteln√Ω senzor zist√≠ n√≠zku √∫rove≈à svetla. Sveteln√Ω senzor zistil zmenu √∫rovne svetla okam≈æite a zariadenie mohlo reagova≈• r√Ωchlo, obmedzen√© iba dƒ∫≈ækou oneskorenia v sluƒçke `loop` alebo `while True:`. Ako v√Ωvoj√°r IoT sa v≈°ak nem√¥≈æete v≈ædy spolieha≈• na tak√∫to r√Ωchlu sp√§tn√∫ v√§zbu.

### Naƒçasovanie pre vlhkos≈• p√¥dy

Ak ste robili predch√°dzaj√∫cu lekciu o vlhkosti p√¥dy pomocou fyzick√©ho senzora, mohli ste si v≈°imn√∫≈•, ≈æe trvalo niekoƒæko sek√∫nd, k√Ωm hodnota vlhkosti p√¥dy klesla po tom, ƒço ste zaliali rastlinu. To nie je preto, ≈æe by bol senzor pomal√Ω, ale preto, ≈æe vode trv√° urƒçit√Ω ƒças, k√Ωm sa vsiakne do p√¥dy.
üíÅ Ak ste polievali pr√≠li≈° bl√≠zko senzora, mohli ste si v≈°imn√∫≈•, ≈æe hodnota r√Ωchlo klesla a potom sa op√§≈• zv√Ω≈°ila ‚Äì je to sp√¥soben√© t√Ωm, ≈æe voda v bl√≠zkosti senzora sa roz≈°√≠rila do zvy≈°ku p√¥dy, ƒç√≠m sa zn√≠≈æila vlhkos≈• p√¥dy v okol√≠ senzora.
![Meranie vlhkosti p√¥dy na √∫rovni 658 sa nemen√≠ poƒças zalievania, klesne na 320 a≈æ po tom, ako voda presiakne p√¥dou](../../../../../translated_images/soil-moisture-travel.a0e31af222cf14385de5380dfc32c7b8213960965228b8e4f7b7ab7f73b310a3.sk.png)

Na diagrame vy≈°≈°ie je zobrazen√© meranie vlhkosti p√¥dy na √∫rovni 658. Rastlina je zaliata, ale t√°to hodnota sa okam≈æite nezmen√≠, preto≈æe voda e≈°te nedosiahla senzor. Zalievanie m√¥≈æe dokonca skonƒçi≈• sk√¥r, ne≈æ voda dosiahne senzor, a hodnota klesne, aby odr√°≈æala nov√∫ √∫rove≈à vlhkosti.

Ak by ste p√≠sali k√≥d na ovl√°danie zavla≈æovacieho syst√©mu pomocou rel√© na z√°klade √∫rovn√≠ vlhkosti p√¥dy, museli by ste zohƒæadni≈• toto oneskorenie a implementova≈• inteligentnej≈°ie naƒçasovanie do v√°≈°ho IoT zariadenia.

‚úÖ Zamyslite sa nad t√Ωm, ako by ste to mohli urobi≈•.

### Ovl√°danie naƒçasovania senzora a aktu√°tora

Predstavte si, ≈æe m√°te za √∫lohu vybudova≈• zavla≈æovac√≠ syst√©m pre farmu. Na z√°klade typu p√¥dy sa zistilo, ≈æe ide√°lna √∫rove≈à vlhkosti p√¥dy pre pestovan√© rastliny zodpoved√° anal√≥gov√©mu nap√§tiu v rozmedz√≠ 400-450.

Mohli by ste naprogramova≈• zariadenie podobne ako noƒçn√© svetlo ‚Äì v≈ædy, keƒè senzor nameria hodnotu nad 450, zapne rel√© na spustenie ƒçerpadla. Probl√©m je, ≈æe voda potrebuje urƒçit√Ω ƒças, aby sa dostala z ƒçerpadla cez p√¥du k senzoru. Senzor zastav√≠ pr√≠vod vody, keƒè zist√≠ √∫rove≈à 450, ale √∫rove≈à vlhkosti bude naƒèalej klesa≈•, preto≈æe ƒçerpan√° voda st√°le presakuje p√¥dou. V√Ωsledkom je plytvanie vodou a riziko po≈°kodenia kore≈àov.

‚úÖ Pam√§tajte ‚Äì pr√≠li≈° veƒæa vody m√¥≈æe by≈• pre rastliny rovnako ≈°kodliv√© ako jej nedostatok a z√°rove≈à plytv√° vz√°cnym zdrojom.

Lep≈°√≠m rie≈°en√≠m je pochopi≈•, ≈æe medzi zapnut√≠m aktu√°tora a zmenou vlastnosti, ktor√∫ senzor meria, existuje oneskorenie. To znamen√°, ≈æe senzor by mal nielen chv√≠ƒæu poƒçka≈• pred op√§tovn√Ωm meran√≠m hodnoty, ale aktu√°tor by sa mal vypn√∫≈• na urƒçit√Ω ƒças pred ƒèal≈°√≠m meran√≠m senzora.

Ako dlho by malo by≈• rel√© zapnut√© pri ka≈ædom cykle? Je lep≈°ie by≈• opatrn√Ω a zapn√∫≈• rel√© len na kr√°tky ƒças, potom poƒçka≈•, k√Ωm voda presiakne, a n√°sledne znovu skontrolova≈• √∫rove≈à vlhkosti. Nakoniec, v≈ædy m√¥≈æete rel√© znovu zapn√∫≈•, aby ste pridali viac vody, ale nem√¥≈æete vodu z p√¥dy odstr√°ni≈•.

> üíÅ Tento typ naƒçasovania je veƒæmi ≈°pecifick√Ω pre IoT zariadenie, ktor√© budujete, vlastnos≈•, ktor√∫ meriate, a pou≈æit√© senzory a aktu√°tory.

![Rastlina jahody pripojen√° k ƒçerpadlu cez rel√©. Rel√© a senzor vlhkosti p√¥dy s√∫ pripojen√© k Raspberry Pi](../../../../../translated_images/strawberry-with-pump.b410fc72ac6aabad3e28de9775bf2393ead73dcfec6fd8c9bc01cf107ecd171a.sk.png)

Napr√≠klad m√°m rastlinu jahody so senzorom vlhkosti p√¥dy a ƒçerpadlom ovl√°dan√Ωm rel√©. Zistil som, ≈æe keƒè prid√°m vodu, trv√° pribli≈æne 20 sek√∫nd, k√Ωm sa hodnota vlhkosti p√¥dy stabilizuje. To znamen√°, ≈æe mus√≠m rel√© vypn√∫≈• a poƒçka≈• 20 sek√∫nd pred kontrolou √∫rovne vlhkosti. Rad≈°ej prid√°m menej vody ne≈æ pr√≠li≈° veƒæa ‚Äì ƒçerpadlo m√¥≈æem v≈ædy znovu zapn√∫≈•, ale nem√¥≈æem vodu z rastliny odstr√°ni≈•.

![Krok 1: vykonajte meranie. Krok 2: pridajte vodu. Krok 3: poƒçkajte, k√Ωm voda presiakne p√¥dou. Krok 4: vykonajte op√§tovn√© meranie](../../../../../translated_images/soil-moisture-delay.865f3fae206db01d5f8f100f4f44040215d44a0412dd3450aef7ff7b93b6d273.sk.png)

To znamen√°, ≈æe najlep≈°√≠ proces zavla≈æovania by mohol vyzera≈• takto:

* Zapnite ƒçerpadlo na 5 sek√∫nd
* Poƒçkajte 20 sek√∫nd
* Skontrolujte vlhkos≈• p√¥dy
* Ak je √∫rove≈à st√°le nad po≈æadovanou hodnotou, zopakujte vy≈°≈°ie uveden√© kroky

5 sek√∫nd m√¥≈æe by≈• pre ƒçerpadlo pr√≠li≈° dlh√Ω ƒças, najm√§ ak s√∫ √∫rovne vlhkosti len mierne nad po≈æadovanou hodnotou. Najlep≈°√≠ sp√¥sob, ako zisti≈• spr√°vne naƒçasovanie, je vysk√∫≈°a≈• to, potom upravi≈• na z√°klade √∫dajov zo senzora, s neust√°lym sp√§tn√Ωm cyklom. To m√¥≈æe vies≈• k jemnej≈°iemu naƒçasovaniu, napr√≠klad zapnutiu ƒçerpadla na 1 sekundu za ka≈æd√Ωch 100 nad po≈æadovanou √∫rov≈àou vlhkosti, namiesto pevne stanoven√Ωch 5 sek√∫nd.

‚úÖ Urobte si prieskum: Existuj√∫ ƒèal≈°ie faktory naƒçasovania? M√¥≈æe by≈• rastlina zalievan√° kedykoƒævek, keƒè je vlhkos≈• p√¥dy pr√≠li≈° n√≠zka, alebo existuj√∫ konkr√©tne ƒçasy d≈àa, ktor√© s√∫ vhodn√© alebo nevhodn√© na zalievanie rastl√≠n?

> üíÅ Predpovede poƒçasia m√¥≈æu by≈• tie≈æ zohƒæadnen√© pri ovl√°dan√≠ automatizovan√Ωch zavla≈æovac√≠ch syst√©mov pre vonkaj≈°ie pestovanie. Ak sa oƒçak√°va d√°≈æƒè, zavla≈æovanie m√¥≈æe by≈• odlo≈æen√© a≈æ po skonƒçen√≠ da≈æƒèa. V tom momente m√¥≈æe by≈• p√¥da dostatoƒçne vlhk√°, tak≈æe u≈æ nebude potrebn√© zalieva≈•, ƒço je oveƒæa efekt√≠vnej≈°ie ne≈æ plytvanie vodou tesne pred da≈æƒèom.

## Pridajte naƒçasovanie do v√°≈°ho servera na ovl√°danie rastl√≠n

K√≥d servera m√¥≈æe by≈• upraven√Ω tak, aby prid√°val kontrolu nad naƒçasovan√≠m zavla≈æovacieho cyklu a ƒçakan√≠m na zmenu √∫rovne vlhkosti p√¥dy. Logika servera na ovl√°danie naƒçasovania rel√© je:

1. Prijatie telemetrickej spr√°vy
1. Kontrola √∫rovne vlhkosti p√¥dy
1. Ak je √∫rove≈à v poriadku, nerobte niƒç. Ak je hodnota pr√≠li≈° vysok√° (ƒço znamen√°, ≈æe vlhkos≈• p√¥dy je pr√≠li≈° n√≠zka), potom:
    1. Po≈°lite pr√≠kaz na zapnutie rel√©
    1. Poƒçkajte 5 sek√∫nd
    1. Po≈°lite pr√≠kaz na vypnutie rel√©
    1. Poƒçkajte 20 sek√∫nd, k√Ωm sa √∫rovne vlhkosti p√¥dy stabilizuj√∫

Zavla≈æovac√≠ cyklus, proces od prijatia telemetrickej spr√°vy po pripravenos≈• na spracovanie √∫rovn√≠ vlhkosti p√¥dy, trv√° pribli≈æne 25 sek√∫nd. Posielame √∫rovne vlhkosti p√¥dy ka≈æd√Ωch 10 sek√∫nd, tak≈æe existuje prekrytie, kde je spr√°va prijat√°, zatiaƒæ ƒço server ƒçak√° na stabiliz√°ciu √∫rovn√≠ vlhkosti p√¥dy, ƒço by mohlo spusti≈• ƒèal≈°√≠ zavla≈æovac√≠ cyklus.

Existuj√∫ dve mo≈ænosti, ako tento probl√©m vyrie≈°i≈•:

* Zmeni≈• k√≥d IoT zariadenia tak, aby posielalo telemetriu ka≈æd√∫ min√∫tu, ƒç√≠m sa zabezpeƒç√≠, ≈æe zavla≈æovac√≠ cyklus bude dokonƒçen√Ω pred odoslan√≠m ƒèal≈°ej spr√°vy
* Odhl√°si≈• sa z telemetrie poƒças zavla≈æovacieho cyklu

Prv√° mo≈ænos≈• nie je v≈ædy dobr√Ωm rie≈°en√≠m pre veƒæk√© farmy. Farm√°r m√¥≈æe chcie≈• zachyti≈• √∫rovne vlhkosti p√¥dy poƒças zavla≈æovania na neskor≈°iu anal√Ωzu, napr√≠klad aby si uvedomil tok vody v r√¥znych oblastiach farmy na lep≈°ie cielen√© zavla≈æovanie. Druh√° mo≈ænos≈• je lep≈°ia ‚Äì k√≥d jednoducho ignoruje telemetriu, keƒè ju nem√¥≈æe pou≈æi≈•, ale telemetria je st√°le dostupn√° pre in√© slu≈æby, ktor√© by ju mohli odobera≈•.

> üíÅ IoT √∫daje nie s√∫ posielan√© len z jedn√©ho zariadenia do jednej slu≈æby, ale mnoho zariaden√≠ m√¥≈æe posiela≈• √∫daje do brokeru a mnoho slu≈æieb m√¥≈æe poƒç√∫va≈• √∫daje z brokeru. Napr√≠klad jedna slu≈æba m√¥≈æe poƒç√∫va≈• √∫daje o vlhkosti p√¥dy a uklada≈• ich do datab√°zy na neskor≈°iu anal√Ωzu. In√° slu≈æba m√¥≈æe poƒç√∫va≈• t√∫ ist√∫ telemetriu na ovl√°danie zavla≈æovacieho syst√©mu.

### √öloha ‚Äì pridajte naƒçasovanie do v√°≈°ho servera na ovl√°danie rastl√≠n

Aktualizujte k√≥d servera tak, aby rel√© be≈æalo 5 sek√∫nd, potom ƒçakalo 20 sek√∫nd.

1. Otvorte prieƒçinok `soil-moisture-sensor-server` vo VS Code, ak u≈æ nie je otvoren√Ω. Uistite sa, ≈æe virtu√°lne prostredie je aktivovan√©.

1. Otvorte s√∫bor `app.py`

1. Pridajte nasleduj√∫ci k√≥d do s√∫boru `app.py` pod existuj√∫ce importy:

    ```python
    import threading
    ```

    Tento pr√≠kaz importuje `threading` z kni≈æn√≠c Pythonu, ƒço umo≈æ≈àuje Pythonu vykon√°va≈• in√Ω k√≥d poƒças ƒçakania.

1. Pridajte nasleduj√∫ci k√≥d pred funkciu `handle_telemetry`, ktor√° spracov√°va telemetrick√© spr√°vy prijat√© k√≥dom servera:

    ```python
    water_time = 5
    wait_time = 20
    ```

    Toto definuje, ako dlho m√° rel√© be≈æa≈• (`water_time`) a ako dlho m√° ƒçaka≈• pred kontrolou vlhkosti p√¥dy (`wait_time`).

1. Pod tento k√≥d pridajte nasleduj√∫ci:

    ```python
    def send_relay_command(client, state):
        command = { 'relay_on' : state }
        print("Sending message:", command)
        client.publish(server_command_topic, json.dumps(command))
    ```

    Tento k√≥d definuje funkciu nazvan√∫ `send_relay_command`, ktor√° posiela pr√≠kaz cez MQTT na ovl√°danie rel√©. Telemetria je vytvoren√° ako slovn√≠k, potom konvertovan√° na JSON re≈•azec. Hodnota odovzdan√° do `state` urƒçuje, ƒçi m√° by≈• rel√© zapnut√© alebo vypnut√©.

1. Po funkcii `send_relay_code` pridajte nasleduj√∫ci k√≥d:

    ```python
    def control_relay(client):
        print("Unsubscribing from telemetry")
        mqtt_client.unsubscribe(client_telemetry_topic)
    
        send_relay_command(client, True)
        time.sleep(water_time)
        send_relay_command(client, False)
    
        time.sleep(wait_time)
    
        print("Subscribing to telemetry")
        mqtt_client.subscribe(client_telemetry_topic)
    ```

    Toto definuje funkciu na ovl√°danie rel√© na z√°klade po≈æadovan√©ho naƒçasovania. Zaƒç√≠na odhl√°sen√≠m z telemetrie, aby sa spr√°vy o vlhkosti p√¥dy nespracov√°vali poƒças zavla≈æovania. Potom po≈°le pr√≠kaz na zapnutie rel√©. N√°sledne ƒçak√° `water_time`, ne≈æ po≈°le pr√≠kaz na vypnutie rel√©. Nakoniec ƒçak√° na stabiliz√°ciu √∫rovn√≠ vlhkosti p√¥dy po dobu `wait_time`. Potom sa znovu prihl√°si na telemetriu.

1. Zme≈àte funkciu `handle_telemetry` na nasleduj√∫cu:

    ```python
    def handle_telemetry(client, userdata, message):
        payload = json.loads(message.payload.decode())
        print("Message received:", payload)
    
        if payload['soil_moisture'] > 450:
            threading.Thread(target=control_relay, args=(client,)).start()
    ```

    Tento k√≥d kontroluje √∫rove≈à vlhkosti p√¥dy. Ak je vy≈°≈°ia ako 450, p√¥da potrebuje zavla≈æovanie, tak≈æe zavol√° funkciu `control_relay`. T√°to funkcia be≈æ√≠ na samostatnom vl√°kne, ktor√© be≈æ√≠ na pozad√≠.

1. Uistite sa, ≈æe va≈°e IoT zariadenie be≈æ√≠, potom spustite tento k√≥d. Zme≈àte √∫rovne vlhkosti p√¥dy a pozorujte, ƒço sa stane s rel√© ‚Äì malo by by≈• zapnut√© na 5 sek√∫nd a potom zosta≈• vypnut√© aspo≈à 20 sek√∫nd, priƒçom sa zapne iba v pr√≠pade, ≈æe √∫rovne vlhkosti nie s√∫ dostatoƒçn√©.

    ```output
    (.venv) ‚ûú  soil-moisture-sensor-server ‚úó python app.py
    Message received: {'soil_moisture': 457}
    Unsubscribing from telemetry
    Sending message: {'relay_on': True}
    Sending message: {'relay_on': False}
    Subscribing to telemetry
    Message received: {'soil_moisture': 302}
    ```

    Dobr√Ωm sp√¥sobom, ako to otestova≈• v simulovanom zavla≈æovacom syst√©me, je pou≈æi≈• such√∫ p√¥du, potom manu√°lne nalieva≈• vodu, zatiaƒæ ƒço rel√© je zapnut√©, a zastavi≈• nalievanie, keƒè sa rel√© vypne.

> üíÅ Tento k√≥d n√°jdete v prieƒçinku [code-timing](../../../../../2-farm/lessons/3-automated-plant-watering/code-timing).

> üíÅ Ak chcete pou≈æi≈• ƒçerpadlo na vybudovanie skutoƒçn√©ho zavla≈æovacieho syst√©mu, m√¥≈æete pou≈æi≈• [6V vodn√© ƒçerpadlo](https://www.seeedstudio.com/6V-Mini-Water-Pump-p-1945.html) s [USB nap√°jac√≠m termin√°lom](https://www.adafruit.com/product/3628). Uistite sa, ≈æe nap√°janie do alebo z ƒçerpadla je pripojen√© cez rel√©.

---

## üöÄ V√Ωzva

Dok√°≈æete si predstavi≈• in√© IoT alebo elektrick√© zariadenia, ktor√© maj√∫ podobn√Ω probl√©m, kde trv√° urƒçit√Ω ƒças, k√Ωm v√Ωsledky aktu√°tora dosiahnu senzor? Pravdepodobne m√°te niekoƒæko tak√Ωchto zariaden√≠ vo va≈°om dome alebo ≈°kole.

* Ak√© vlastnosti meraj√∫?
* Ako dlho trv√°, k√Ωm sa vlastnos≈• zmen√≠ po pou≈æit√≠ aktu√°tora?
* Je v poriadku, ak sa vlastnos≈• zmen√≠ nad po≈æadovan√∫ hodnotu?
* Ako ju mo≈æno vr√°ti≈• sp√§≈• na po≈æadovan√∫ hodnotu, ak je to potrebn√©?

## Kv√≠z po predn√°≈°ke

[Kv√≠z po predn√°≈°ke](https://black-meadow-040d15503.1.azurestaticapps.net/quiz/14)

## Prehƒæad a samostatn√© ≈°t√∫dium

* Preƒç√≠tajte si viac o rel√© vr√°tane ich historick√©ho pou≈æitia v telef√≥nnych √∫stredniach na [str√°nke Wikipedia o rel√©](https://wikipedia.org/wiki/Relay).

## Zadanie

[Vybudujte efekt√≠vnej≈°√≠ zavla≈æovac√≠ cyklus](assignment.md)

---

**Upozornenie**:  
Tento dokument bol prelo≈æen√Ω pomocou slu≈æby AI prekladu [Co-op Translator](https://github.com/Azure/co-op-translator). Hoci sa sna≈æ√≠me o presnos≈•, pros√≠m, berte na vedomie, ≈æe automatizovan√© preklady m√¥≈æu obsahova≈• chyby alebo nepresnosti. P√¥vodn√Ω dokument v jeho rodnom jazyku by mal by≈• pova≈æovan√Ω za autoritat√≠vny zdroj. Pre kritick√© inform√°cie sa odpor√∫ƒça profesion√°lny ƒæudsk√Ω preklad. Nie sme zodpovedn√≠ za ak√©koƒævek nedorozumenia alebo nespr√°vne interpret√°cie vypl√Ωvaj√∫ce z pou≈æitia tohto prekladu.