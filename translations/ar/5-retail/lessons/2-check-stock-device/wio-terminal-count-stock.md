<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "0b2ae20b0fc8e73c9598dea937cac038",
  "translation_date": "2025-08-26T21:33:27+00:00",
  "source_file": "5-retail/lessons/2-check-stock-device/wio-terminal-count-stock.md",
  "language_code": "ar"
}
-->
# ุนุฏ ุงููุฎุฒูู ุจุงุณุชุฎุฏุงู ุฌูุงุฒ ุฅูุชุฑูุช ุงูุฃุดูุงุก - Wio Terminal

ูููู ุงุณุชุฎุฏุงู ูุฒูุฌ ูู ุงูุชููุนุงุช ูุฅุทุงุฑุงุช ุงูุชุญุฏูุฏ ุงูุฎุงุตุฉ ุจูุง ูุนุฏ ุงููุฎุฒูู ูู ุตูุฑุฉ.

## ุนุฏ ุงููุฎุฒูู

![4 ุนูุจ ูู ูุนุฌูู ุงูุทูุงุทู ูุน ุฅุทุงุฑุงุช ุชุญุฏูุฏ ุญูู ูู ุนูุจุฉ](../../../../../translated_images/rpi-stock-with-bounding-boxes.b5540e2ecb7cd49f1271828d3be412671d950e87625c5597ea97c90f11e01097.ar.jpg)

ูู ุงูุตูุฑุฉ ุงูููุถุญุฉ ุฃุนูุงูุ ููุงู ุชุฏุงุฎู ุจุณูุท ุจูู ุฅุทุงุฑุงุช ุงูุชุญุฏูุฏ. ุฅุฐุง ูุงู ูุฐุง ุงูุชุฏุงุฎู ุฃูุจุฑ ุจูุซูุฑุ ููุฏ ุชุดูุฑ ุฅุทุงุฑุงุช ุงูุชุญุฏูุฏ ุฅูู ููุณ ุงููุงุฆู. ูุนุฏ ุงููุงุฆูุงุช ุจุดูู ุตุญูุญุ ุชุญุชุงุฌ ุฅูู ุชุฌุงูู ุงูุฅุทุงุฑุงุช ุฐุงุช ุงูุชุฏุงุฎู ุงููุจูุฑ.

### ุงููููุฉ - ุนุฏ ุงููุฎุฒูู ูุน ุชุฌุงูู ุงูุชุฏุงุฎู

1. ุงูุชุญ ูุดุฑูุนู `stock-counter` ุฅุฐุง ูู ููู ููุชูุญูุง ุจุงููุนู.

1. ููู ุฏุงูุฉ `processPredictions`ุ ุฃุถู ุงูููุฏ ุงูุชุงูู:

    ```cpp
    const float overlap_threshold = 0.20f;
    ```

    ูุฐุง ูุญุฏุฏ ุงููุณุจุฉ ุงููุฆููุฉ ููุชุฏุงุฎู ุงููุณููุญ ุจูุง ูุจู ุงุนุชุจุงุฑ ุฅุทุงุฑุงุช ุงูุชุญุฏูุฏ ูููุณ ุงููุงุฆู. ุงููููุฉ 0.20 ุชุนูู ุชุฏุงุฎู ุจูุณุจุฉ 20%.

1. ุฃุณูู ูุฐุงุ ูููู ุฏุงูุฉ `processPredictions`ุ ุฃุถู ุงูููุฏ ุงูุชุงูู ูุญุณุงุจ ุงูุชุฏุงุฎู ุจูู ูุณุชุทูููู:

    ```cpp
    struct Point {
        float x, y;
    };

    struct Rect {
        Point topLeft, bottomRight;
    };

    float area(Rect rect)
    {
        return abs(rect.bottomRight.x - rect.topLeft.x) * abs(rect.bottomRight.y - rect.topLeft.y);
    }
     
    float overlappingArea(Rect rect1, Rect rect2)
    {
        float left = max(rect1.topLeft.x, rect2.topLeft.x);
        float right = min(rect1.bottomRight.x, rect2.bottomRight.x);
        float top = max(rect1.topLeft.y, rect2.topLeft.y);
        float bottom = min(rect1.bottomRight.y, rect2.bottomRight.y);
    
    
        if ( right > left && bottom > top )
        {
            return (right-left)*(bottom-top);
        }
        
        return 0.0f;
    }
    ```

    ูุฐุง ุงูููุฏ ูุนุฑูู ุจููุฉ `Point` ูุชุฎุฒูู ุงูููุงุท ุนูู ุงูุตูุฑุฉุ ูุจููุฉ `Rect` ูุชุนุฑูู ูุณุชุทูู ุจุงุณุชุฎุฏุงู ุฅุญุฏุงุซูุงุช ุงูุฒุงููุฉ ุงูุนูููุฉ ุงููุณุฑู ูุงูุณูููุฉ ุงููููู. ุซู ูุนุฑูู ุฏุงูุฉ `area` ุงูุชู ุชุญุณุจ ูุณุงุญุฉ ุงููุณุชุทูู ูู ุฅุญุฏุงุซูุงุช ุงูุฒุงููุฉ ุงูุนูููุฉ ุงููุณุฑู ูุงูุณูููุฉ ุงููููู.

    ุจุนุฏ ุฐููุ ูุนุฑูู ุฏุงูุฉ `overlappingArea` ุงูุชู ุชุญุณุจ ูุณุงุญุฉ ุงูุชุฏุงุฎู ุจูู ูุณุชุทูููู. ุฅุฐุง ูู ููู ููุงู ุชุฏุงุฎูุ ุชุนูุฏ ุงููููุฉ 0.

1. ุฃุณูู ุฏุงูุฉ `overlappingArea`ุ ูู ุจุชุนุฑูู ุฏุงูุฉ ูุชุญููู ุฅุทุงุฑ ุงูุชุญุฏูุฏ ุฅูู `Rect`:

    ```cpp
    Rect rectFromBoundingBox(JsonVariant prediction)
    {
        JsonObject bounding_box = prediction["boundingBox"].as<JsonObject>();
    
        float left = bounding_box["left"].as<float>();
        float top = bounding_box["top"].as<float>();
        float width = bounding_box["width"].as<float>();
        float height = bounding_box["height"].as<float>();
    
        Point topLeft = {left, top};
        Point bottomRight = {left + width, top + height};
    
        return {topLeft, bottomRight};
    }
    ```

    ูุฐู ุงูุฏุงูุฉ ุชุฃุฎุฐ ุชููุนูุง ูู ูุงุดู ุงููุงุฆูุงุชุ ูุชุณุชุฎุฑุฌ ุฅุทุงุฑ ุงูุชุญุฏูุฏ ูุชุณุชุฎุฏู ุงูููู ุงูููุฌูุฏุฉ ูู ุฅุทุงุฑ ุงูุชุญุฏูุฏ ูุชุนุฑูู ูุณุชุทูู. ูุชู ุญุณุงุจ ุงูุฌุงูุจ ุงูุฃููู ูู ุฎูุงู ุฌูุน ุงููุณุงุฑ ูุน ุงูุนุฑุถ. ููุชู ุญุณุงุจ ุงูุฃุณูู ูู ุฎูุงู ุฌูุน ุงูุฃุนูู ูุน ุงูุงุฑุชูุงุน.

1. ูุฌุจ ููุงุฑูุฉ ุงูุชููุนุงุช ูุน ุจุนุถูุง ุงูุจุนุถุ ูุฅุฐุง ูุงู ููุงู ุชุฏุงุฎู ุจูู ุชููุนูู ูุชุฌุงูุฒ ุงูุนุชุจุฉ ุงููุญุฏุฏุฉุ ูุฌุจ ุญุฐู ุฃุญุฏููุง. ุนุชุจุฉ ุงูุชุฏุงุฎู ูู ูุณุจุฉ ูุฆููุฉุ ูุฐุง ูุฌุจ ุถุฑุจูุง ูู ุญุฌู ุฃุตุบุฑ ุฅุทุงุฑ ุชุญุฏูุฏ ููุชุญูู ููุง ุฅุฐุง ูุงู ุงูุชุฏุงุฎู ูุชุฌุงูุฒ ุงููุณุจุฉ ุงููุญุฏุฏุฉ ูู ุฅุทุงุฑ ุงูุชุญุฏูุฏุ ูููุณ ุงููุณุจุฉ ุงููุญุฏุฏุฉ ูู ุงูุตูุฑุฉ ุจุฃููููุง. ุงุจุฏุฃ ุจุญุฐู ูุญุชูู ุฏุงูุฉ `processPredictions`.

1. ุฃุถู ุงูุชุงูู ุฅูู ุฏุงูุฉ `processPredictions` ุงููุงุฑุบุฉ:

    ```cpp
    std::vector<JsonVariant> passed_predictions;

    for (int i = 0; i < predictions.size(); ++i)
    {
        Rect prediction_1_rect = rectFromBoundingBox(predictions[i]);
        float prediction_1_area = area(prediction_1_rect);
        bool passed = true;

        for (int j = i + 1; j < predictions.size(); ++j)
        {
            Rect prediction_2_rect = rectFromBoundingBox(predictions[j]);
            float prediction_2_area = area(prediction_2_rect);

            float overlap = overlappingArea(prediction_1_rect, prediction_2_rect);
            float smallest_area = min(prediction_1_area, prediction_2_area);

            if (overlap > (overlap_threshold * smallest_area))
            {
                passed = false;
                break;
            }
        }

        if (passed)
        {
            passed_predictions.push_back(predictions[i]);
        }
    }
    ```

    ูุฐุง ุงูููุฏ ูุนุฑูู ูุชุฌููุง ูุชุฎุฒูู ุงูุชููุนุงุช ุงูุชู ูุง ุชุชุฏุงุฎู. ุซู ูููู ุจุงูุชูุฑุงุฑ ุนุจุฑ ุฌููุน ุงูุชููุนุงุชุ ููููู ุจุฅูุดุงุก `Rect` ูู ุฅุทุงุฑ ุงูุชุญุฏูุฏ.

    ุจุนุฏ ุฐููุ ูููู ูุฐุง ุงูููุฏ ุจุงูุชูุฑุงุฑ ุนุจุฑ ุงูุชููุนุงุช ุงููุชุจููุฉุ ุจุฏุกูุง ูู ุงูุชููุน ุงูุฐู ููู ุงูุชููุน ุงูุญุงูู. ูุฐุง ูููุน ููุงุฑูุฉ ุงูุชููุนุงุช ุฃูุซุฑ ูู ูุฑุฉ - ุจูุฌุฑุฏ ููุงุฑูุฉ 1 ู2ุ ูุง ุญุงุฌุฉ ูููุงุฑูุฉ 2 ูุน 1ุ ููุท ูุน 3ุ 4ุ ูููุฐุง.

    ููู ุฒูุฌ ูู ุงูุชููุนุงุชุ ูุชู ุญุณุงุจ ูุณุงุญุฉ ุงูุชุฏุงุฎู. ุซู ูุชู ููุงุฑูุฉ ูุฐู ุงููุณุงุญุฉ ุจูุณุงุญุฉ ุฃุตุบุฑ ุฅุทุงุฑ ุชุญุฏูุฏ - ุฅุฐุง ุชุฌุงูุฒ ุงูุชุฏุงุฎู ุงููุณุจุฉ ุงููุฆููุฉ ุงููุญุฏุฏุฉ ูู ุฃุตุบุฑ ุฅุทุงุฑ ุชุญุฏูุฏุ ูุชู ูุถุน ุนูุงูุฉ ุนูู ุงูุชููุน ุจุฃูู ูู ููุฌุญ. ุฅุฐุง ุงุฌุชุงุฒ ุงูุชููุน ุงููุญูุตุงุช ุจุนุฏ ููุงุฑูุฉ ุฌููุน ุงูุชุฏุงุฎูุงุชุ ูุชู ุฅุถุงูุชู ุฅูู ูุฌููุนุฉ `passed_predictions`.

    > ๐ ูุฐู ุทุฑููุฉ ุจุณูุทุฉ ุฌุฏูุง ูุฅุฒุงูุฉ ุงูุชุฏุงุฎูุงุชุ ุญูุซ ูุชู ููุท ุฅุฒุงูุฉ ุงูุฃูู ูู ุฒูุฌ ุงูุชุฏุงุฎู. ุจุงููุณุจุฉ ููููุฏ ุงูุฅูุชุงุฌูุ ูุฏ ุชุฑุบุจ ูู ุฅุถุงูุฉ ุงููุฒูุฏ ูู ุงูููุทู ููุงุ ูุซู ุงููุธุฑ ูู ุงูุชุฏุงุฎูุงุช ุจูู ูุงุฆูุงุช ูุชุนุฏุฏุฉุ ุฃู ุฅุฐุง ูุงู ุฃุญุฏ ุฅุทุงุฑุงุช ุงูุชุญุฏูุฏ ูุญุชูู ุนูู ุงูุขุฎุฑ.

1. ุจุนุฏ ุฐููุ ุฃุถู ุงูููุฏ ุงูุชุงูู ูุฅุฑุณุงู ุชูุงุตูู ุงูุชููุนุงุช ุงูุชู ุงุฌุชุงุฒุช ุงููุญูุตุงุช ุฅูู ุดุงุดุฉ ุงููุฑุงูุจุฉ ุงูุชุณูุณููุฉ:

    ```cpp
    for(JsonVariant prediction : passed_predictions)
    {
        String boundingBox = prediction["boundingBox"].as<String>();
        String tag = prediction["tagName"].as<String>();
        float probability = prediction["probability"].as<float>();

        char buff[32];
        sprintf(buff, "%s:\t%.2f%%\t%s", tag.c_str(), probability * 100.0, boundingBox.c_str());
        Serial.println(buff);
    }
    ```

    ูุฐุง ุงูููุฏ ูููู ุจุงูุชูุฑุงุฑ ุนุจุฑ ุงูุชููุนุงุช ุงูุชู ุงุฌุชุงุฒุช ุงููุญูุตุงุช ููุทุจุน ุชูุงุตูููุง ุฅูู ุดุงุดุฉ ุงููุฑุงูุจุฉ ุงูุชุณูุณููุฉ.

1. ุฃุณูู ูุฐุงุ ุฃุถู ููุฏูุง ูุทุจุงุนุฉ ุนุฏุฏ ุงูุนูุงุตุฑ ุงูุชู ุชู ุนุฏูุง ุฅูู ุดุงุดุฉ ุงููุฑุงูุจุฉ ุงูุชุณูุณููุฉ:

    ```cpp
    Serial.print("Counted ");
    Serial.print(passed_predictions.size());
    Serial.println(" stock items.");
    ```

    ูููู ุจุนุฏ ุฐูู ุฅุฑุณุงู ูุฐุง ุฅูู ุฎุฏูุฉ ุฅูุชุฑูุช ุงูุฃุดูุงุก ูุชูุจููู ุฅุฐุง ูุงูุช ูุณุชููุงุช ุงููุฎุฒูู ููุฎูุถุฉ.

1. ูู ุจุชุญููู ูุชุดุบูู ุงูููุฏ ุงูุฎุงุต ุจู. ูุฌู ุงููุงููุฑุง ูุญู ุงููุงุฆูุงุช ุนูู ุฑู ูุงุถุบุท ุนูู ุงูุฒุฑ C. ุญุงูู ุชุนุฏูู ูููุฉ `overlap_threshold` ูุฑุคูุฉ ุงูุชููุนุงุช ุงูุชู ูุชู ุชุฌุงูููุง.

    ```output
    Connecting to WiFi..
    Connected!
    Image captured
    Image read to buffer with length 17416
    tomato paste:   35.84%  {"left":0.395631,"top":0.215897,"width":0.180768,"height":0.359364}
    tomato paste:   35.87%  {"left":0.378554,"top":0.583012,"width":0.14824,"height":0.359382}
    tomato paste:   34.11%  {"left":0.699024,"top":0.592617,"width":0.124411,"height":0.350456}
    tomato paste:   35.16%  {"left":0.513006,"top":0.647853,"width":0.187472,"height":0.325817}
    Counted 4 stock items.
    ```

> ๐ ููููู ุงูุนุซูุฑ ุนูู ูุฐุง ุงูููุฏ ูู ุงููุฌูุฏ [code-count/wio-terminal](../../../../../5-retail/lessons/2-check-stock-device/code-count/wio-terminal).

๐ ููุฏ ูุงู ุจุฑูุงูุฌ ุนุฏ ุงููุฎุฒูู ุงูุฎุงุต ุจู ูุงุฌุญูุง!

---

**ุฅุฎูุงุก ุงููุณุคูููุฉ**:  
ุชู ุชุฑุฌูุฉ ูุฐุง ุงููุณุชูุฏ ุจุงุณุชุฎุฏุงู ุฎุฏูุฉ ุงูุชุฑุฌูุฉ ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู [Co-op Translator](https://github.com/Azure/co-op-translator). ุจูููุง ูุณุนู ูุชุญููู ุงูุฏูุฉุ ูุฑุฌู ุงูุนูู ุฃู ุงูุชุฑุฌูุงุช ุงูุขููุฉ ูุฏ ุชุญุชูู ุนูู ุฃุฎุทุงุก ุฃู ูุนูููุงุช ุบูุฑ ุฏูููุฉ. ูุฌุจ ุงุนุชุจุงุฑ ุงููุณุชูุฏ ุงูุฃุตูู ุจูุบุชู ุงูุฃุตููุฉ ุงููุตุฏุฑ ุงูููุซูู. ููุญุตูู ุนูู ูุนูููุงุช ุญุงุณูุฉุ ูููุตู ุจุงูุงุณุชุนุงูุฉ ุจุชุฑุฌูุฉ ุจุดุฑูุฉ ุงุญุชุฑุงููุฉ. ูุญู ุบูุฑ ูุณุคูููู ุนู ุฃู ุณูุก ููู ุฃู ุชูุณูุฑุงุช ุฎุงุทุฆุฉ ุชูุดุฃ ุนู ุงุณุชุฎุฏุงู ูุฐู ุงูุชุฑุฌูุฉ.