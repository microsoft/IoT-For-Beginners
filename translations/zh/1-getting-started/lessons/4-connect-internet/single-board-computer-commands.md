<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "c527ce85d69b1a3875366ec61cbed8aa",
  "translation_date": "2025-08-24T22:59:55+00:00",
  "source_file": "1-getting-started/lessons/4-connect-internet/single-board-computer-commands.md",
  "language_code": "zh"
}
-->
# é€šè¿‡äº’è”ç½‘æ§åˆ¶ä½ çš„å¤œç¯ - è™šæ‹Ÿç‰©è”ç½‘ç¡¬ä»¶å’Œæ ‘è“æ´¾

åœ¨æœ¬è¯¾çš„è¿™ä¸€éƒ¨åˆ†ï¼Œä½ å°†è®¢é˜…ä» MQTT broker å‘é€åˆ°ä½ çš„æ ‘è“æ´¾æˆ–è™šæ‹Ÿç‰©è”ç½‘è®¾å¤‡çš„å‘½ä»¤ã€‚

## è®¢é˜…å‘½ä»¤

ä¸‹ä¸€æ­¥æ˜¯è®¢é˜…ä» MQTT broker å‘é€çš„å‘½ä»¤å¹¶å¯¹å…¶ä½œå‡ºå“åº”ã€‚

### ä»»åŠ¡

è®¢é˜…å‘½ä»¤ã€‚

1. åœ¨ VS Code ä¸­æ‰“å¼€å¤œç¯é¡¹ç›®ã€‚

1. å¦‚æœä½ ä½¿ç”¨çš„æ˜¯è™šæ‹Ÿç‰©è”ç½‘è®¾å¤‡ï¼Œè¯·ç¡®ä¿ç»ˆç«¯æ­£åœ¨è¿è¡Œè™šæ‹Ÿç¯å¢ƒã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯æ ‘è“æ´¾ï¼Œåˆ™æ— éœ€ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒã€‚

1. åœ¨ `client_telemetry_topic` å®šä¹‰ä¹‹åæ·»åŠ ä»¥ä¸‹ä»£ç ï¼š

    ```python
    server_command_topic = id + '/commands'
    ```

    `server_command_topic` æ˜¯è®¾å¤‡è®¢é˜…ä»¥æ¥æ”¶ LED å‘½ä»¤çš„ MQTT ä¸»é¢˜ã€‚

1. åœ¨ä¸»å¾ªç¯çš„ä¸Šæ–¹ã€`mqtt_client.loop_start()` è¡Œä¹‹åæ·»åŠ ä»¥ä¸‹ä»£ç ï¼š

    ```python
    def handle_command(client, userdata, message):
        payload = json.loads(message.payload.decode())
        print("Message received:", payload)
    
        if payload['led_on']:
            led.on()
        else:
            led.off()
    
    mqtt_client.subscribe(server_command_topic)
    mqtt_client.on_message = handle_command
    ```

    è¿™æ®µä»£ç å®šä¹‰äº†ä¸€ä¸ªå‡½æ•° `handle_command`ï¼Œå®ƒå°†æ¶ˆæ¯è¯»å–ä¸º JSON æ–‡æ¡£ï¼Œå¹¶æŸ¥æ‰¾ `led_on` å±æ€§çš„å€¼ã€‚å¦‚æœè¯¥å€¼ä¸º `True`ï¼Œåˆ™æ‰“å¼€ LEDï¼Œå¦åˆ™å…³é—­ LEDã€‚

    MQTT å®¢æˆ·ç«¯ä¼šè®¢é˜…æœåŠ¡å™¨å‘é€æ¶ˆæ¯çš„ä¸»é¢˜ï¼Œå¹¶è®¾ç½®åœ¨æ¥æ”¶åˆ°æ¶ˆæ¯æ—¶è°ƒç”¨ `handle_command` å‡½æ•°ã€‚

    > ğŸ’ `on_message` å¤„ç†å™¨ä¼šè¢«æ‰€æœ‰è®¢é˜…çš„ä¸»é¢˜è°ƒç”¨ã€‚å¦‚æœä½ ä¹‹åç¼–å†™ä»£ç ç›‘å¬å¤šä¸ªä¸»é¢˜ï¼Œå¯ä»¥ä»ä¼ é€’ç»™å¤„ç†å™¨å‡½æ•°çš„ `message` å¯¹è±¡ä¸­è·å–æ¶ˆæ¯å‘é€çš„ä¸»é¢˜ã€‚

1. æŒ‰ç…§ä¸Šä¸€éƒ¨åˆ†ä½œä¸šè¿è¡Œä»£ç çš„æ–¹å¼è¿è¡Œä»£ç ã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯è™šæ‹Ÿç‰©è”ç½‘è®¾å¤‡ï¼Œè¯·ç¡®ä¿ CounterFit åº”ç”¨æ­£åœ¨è¿è¡Œï¼Œå¹¶ä¸”å…‰ä¼ æ„Ÿå™¨å’Œ LED å·²åœ¨æ­£ç¡®çš„å¼•è„šä¸Šåˆ›å»ºã€‚

1. è°ƒæ•´ä½ çš„ç‰©ç†æˆ–è™šæ‹Ÿè®¾å¤‡æ£€æµ‹åˆ°çš„å…‰çº¿æ°´å¹³ã€‚æ¥æ”¶åˆ°çš„æ¶ˆæ¯å’Œå‘é€çš„å‘½ä»¤ä¼šå†™å…¥ç»ˆç«¯ã€‚LED ä¹Ÿä¼šæ ¹æ®å…‰çº¿æ°´å¹³æ‰“å¼€æˆ–å…³é—­ã€‚

> ğŸ’ ä½ å¯ä»¥åœ¨ [code-commands/virtual-device](../../../../../1-getting-started/lessons/4-connect-internet/code-commands/virtual-device) æ–‡ä»¶å¤¹æˆ– [code-commands/pi](../../../../../1-getting-started/lessons/4-connect-internet/code-commands/pi) æ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°è¿™æ®µä»£ç ã€‚

ğŸ˜€ æ­å–œï¼ä½ å·²ç»æˆåŠŸç¼–å†™äº†è®¾å¤‡ä»£ç ï¼Œä½¿å…¶èƒ½å¤Ÿå“åº”æ¥è‡ª MQTT broker çš„å‘½ä»¤ã€‚

**å…è´£å£°æ˜**ï¼š  
æœ¬æ–‡æ¡£ä½¿ç”¨AIç¿»è¯‘æœåŠ¡[Co-op Translator](https://github.com/Azure/co-op-translator)è¿›è¡Œç¿»è¯‘ã€‚å°½ç®¡æˆ‘ä»¬åŠªåŠ›ç¡®ä¿å‡†ç¡®æ€§ï¼Œä½†è¯·æ³¨æ„ï¼Œè‡ªåŠ¨ç¿»è¯‘å¯èƒ½åŒ…å«é”™è¯¯æˆ–ä¸å‡†ç¡®ä¹‹å¤„ã€‚åº”ä»¥åŸå§‹è¯­è¨€çš„æ–‡æ¡£ä½œä¸ºæƒå¨æ¥æºã€‚å¯¹äºå…³é”®ä¿¡æ¯ï¼Œå»ºè®®ä½¿ç”¨ä¸“ä¸šäººå·¥ç¿»è¯‘ã€‚å› ä½¿ç”¨æœ¬ç¿»è¯‘è€Œå¯¼è‡´çš„ä»»ä½•è¯¯è§£æˆ–è¯¯è¯»ï¼Œæˆ‘ä»¬æ¦‚ä¸è´Ÿè´£ã€‚