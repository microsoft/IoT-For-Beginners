<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "28320305a35ea3bc59c41fe146a2e6ed",
  "translation_date": "2025-08-27T12:05:42+00:00",
  "source_file": "2-farm/lessons/4-migrate-your-plant-to-the-cloud/wio-terminal-connect-hub.md",
  "language_code": "pa"
}
-->
# ‡®Ü‡®™‡®£‡®æ IoT ‡®°‡®ø‡®µ‡®æ‡®à‡®∏ ‡®ï‡®≤‡®æ‡®â‡®° ‡®®‡®æ‡®≤ ‡®ú‡©Å‡©ú‡©ã - Wio Terminal

‡®á‡®∏ ‡®™‡®æ‡®† ‡®¶‡©á ‡®á‡®∏ ‡®π‡®ø‡©±‡®∏‡©á ‡®µ‡®ø‡©±‡®ö, ‡®§‡©Å‡®∏‡©Ä‡®Ç ‡®Ü‡®™‡®£‡©á Wio Terminal ‡®®‡©Ç‡©∞ ‡®Ü‡®™‡®£‡©á IoT Hub ‡®®‡®æ‡®≤ ‡®ú‡©ã‡©ú‡©ã‡®ó‡©á, ‡®§‡®æ‡®Ç ‡®ú‡©ã ‡®ü‡©à‡®≤‡©Ä‡®Æ‡©á‡®ü‡®∞‡©Ä ‡®≠‡©á‡®ú ‡®∏‡®ï‡©ã ‡®Ö‡®§‡©á ‡®ï‡®Æ‡®æ‡®Ç‡®° ‡®™‡©ç‡®∞‡®æ‡®™‡®§ ‡®ï‡®∞ ‡®∏‡®ï‡©ã‡•§

## ‡®Ü‡®™‡®£‡©á ‡®°‡®ø‡®µ‡®æ‡®à‡®∏ ‡®®‡©Ç‡©∞ IoT Hub ‡®®‡®æ‡®≤ ‡®ú‡©ã‡©ú‡©ã

‡®Ö‡®ó‡®≤‡®æ ‡®ï‡®¶‡®Æ ‡®Ü‡®™‡®£‡©á ‡®°‡®ø‡®µ‡®æ‡®à‡®∏ ‡®®‡©Ç‡©∞ IoT Hub ‡®®‡®æ‡®≤ ‡®ú‡©ã‡©ú‡®®‡®æ ‡®π‡©à‡•§

### ‡®ü‡®æ‡®∏‡®ï - IoT Hub ‡®®‡®æ‡®≤ ‡®ú‡©Å‡©ú‡©ã

1. VS Code ‡®µ‡®ø‡©±‡®ö `soil-moisture-sensor` ‡®™‡©ç‡®∞‡©ã‡®ú‡©à‡®ï‡®ü ‡®ñ‡©ã‡®≤‡©ç‡®π‡©ã‡•§

1. `platformio.ini` ‡®´‡®æ‡®à‡®≤ ‡®ñ‡©ã‡®≤‡©ç‡®π‡©ã‡•§ `knolleary/PubSubClient` ‡®≤‡®æ‡®á‡®¨‡©ç‡®∞‡©á‡®∞‡©Ä ‡®°‡®ø‡®™‡©à‡®Ç‡®°‡©à‡®Ç‡®∏‡©Ä ‡®π‡®ü‡®æ‡®ì‡•§ ‡®á‡®π ‡®™‡®¨‡®≤‡®ø‡®ï MQTT ‡®¨‡©ç‡®∞‡©ã‡®ï‡®∞ ‡®®‡®æ‡®≤ ‡®ú‡©Å‡©ú‡®® ‡®≤‡®à ‡®µ‡®∞‡®§‡©Ä ‡®ó‡®à ‡®∏‡©Ä, ‡®Ö‡®§‡©á IoT Hub ‡®®‡®æ‡®≤ ‡®ú‡©Å‡©ú‡®® ‡®≤‡®à ‡®≤‡©ã‡©ú‡©Ä‡®Ç‡®¶‡©Ä ‡®®‡®π‡©Ä‡®Ç ‡®π‡©à‡•§

1. ‡®π‡©á‡®†‡®æ‡®Ç ‡®¶‡®ø‡©±‡®§‡©Ä ‡®≤‡®æ‡®á‡®¨‡©ç‡®∞‡©á‡®∞‡©Ä ‡®°‡®ø‡®™‡©à‡®Ç‡®°‡©à‡®Ç‡®∏‡©Ä‡®ú‡®º ‡®∏‡®º‡®æ‡®Æ‡®≤ ‡®ï‡®∞‡©ã:

    ```ini
    seeed-studio/Seeed Arduino RTC @ 2.0.0
    arduino-libraries/AzureIoTHub @ 1.6.0
    azure/AzureIoTUtility @ 1.6.1
    azure/AzureIoTProtocol_MQTT @ 1.6.0
    azure/AzureIoTProtocol_HTTP @ 1.6.0
    azure/AzureIoTSocket_WiFi @ 1.0.2
    ```

    `Seeed Arduino RTC` ‡®≤‡®æ‡®á‡®¨‡©ç‡®∞‡©á‡®∞‡©Ä Wio Terminal ‡®µ‡®ø‡©±‡®ö ‡®∞‡©Ä‡®Ö‡®≤-‡®ü‡®æ‡®à‡®Æ ‡®ò‡©ú‡©Ä ‡®®‡®æ‡®≤ ‡®á‡©∞‡®ü‡®∞‡©à‡®ï‡®ü ‡®ï‡®∞‡®® ‡®≤‡®à ‡®ï‡©ã‡®° ‡®™‡©ç‡®∞‡®¶‡®æ‡®® ‡®ï‡®∞‡®¶‡©Ä ‡®π‡©à, ‡®ú‡©ã ‡®∏‡®Æ‡®æ‡®Ç ‡®ü‡©ç‡®∞‡©à‡®ï ‡®ï‡®∞‡®® ‡®≤‡®à ‡®µ‡®∞‡®§‡©Ä ‡®ú‡®æ‡®Ç‡®¶‡©Ä ‡®π‡©à‡•§ ‡®¨‡®æ‡®ï‡©Ä ‡®≤‡®æ‡®á‡®¨‡©ç‡®∞‡©á‡®∞‡©Ä‡®Ü‡®Ç ‡®§‡©Å‡®π‡®æ‡®°‡©á IoT ‡®°‡®ø‡®µ‡®æ‡®à‡®∏ ‡®®‡©Ç‡©∞ IoT Hub ‡®®‡®æ‡®≤ ‡®ú‡©Å‡©ú‡®® ‡®¶‡©Ä ‡®Ü‡®ó‡®ø‡®Ü ‡®¶‡®ø‡©∞‡®¶‡©Ä ‡®π‡®®‡•§

1. `platformio.ini` ‡®´‡®æ‡®à‡®≤ ‡®¶‡©á ‡®§‡®≤ ‡®µ‡®ø‡©±‡®ö ‡®π‡©á‡®†‡®æ‡®Ç ‡®¶‡®ø‡©±‡®§‡®æ ‡®∏‡®º‡®æ‡®Æ‡®≤ ‡®ï‡®∞‡©ã:

    ```ini
    build_flags =
        -DDONT_USE_UPLOADTOBLOB
    ```

    ‡®á‡®π ‡®á‡©±‡®ï ‡®ï‡©∞‡®™‡®æ‡®á‡®≤‡®∞ ‡®´‡®≤‡©à‡®ó ‡®∏‡©à‡®ü ‡®ï‡®∞‡®¶‡®æ ‡®π‡©à ‡®ú‡©ã Arduino IoT Hub ‡®ï‡©ã‡®° ‡®®‡©Ç‡©∞ ‡®ï‡©∞‡®™‡®æ‡®á‡®≤ ‡®ï‡®∞‡®® ‡®∏‡®Æ‡©á‡®Ç ‡®≤‡©ã‡©ú‡©Ä‡®Ç‡®¶‡®æ ‡®π‡©à‡•§

1. `config.h` ‡®π‡©à‡®°‡®∞ ‡®´‡®æ‡®à‡®≤ ‡®ñ‡©ã‡®≤‡©ç‡®π‡©ã‡•§ ‡®∏‡®æ‡®∞‡©á MQTT ‡®∏‡©à‡®ü‡®ø‡©∞‡®ó‡®æ‡®Ç ‡®π‡®ü‡®æ‡®ì ‡®Ö‡®§‡©á ‡®°‡®ø‡®µ‡®æ‡®à‡®∏ ‡®ï‡®®‡©à‡®ï‡®∏‡®º‡®® ‡®∏‡®ü‡©ç‡®∞‡®ø‡©∞‡®ó ‡®≤‡®à ‡®π‡©á‡®†‡®æ‡®Ç ‡®¶‡®ø‡©±‡®§‡®æ ‡®ï‡®æ‡®Ç‡®∏‡®ü‡©à‡®Ç‡®ü ‡®∏‡®º‡®æ‡®Æ‡®≤ ‡®ï‡®∞‡©ã:

    ```cpp
    // IoT Hub settings
    const char *CONNECTION_STRING = "<connection string>";
    ```

    `<connection string>` ‡®®‡©Ç‡©∞ ‡®Ü‡®™‡®£‡©á ‡®°‡®ø‡®µ‡®æ‡®à‡®∏ ‡®≤‡®à ‡®ï‡®æ‡®™‡©Ä ‡®ï‡©Ä‡®§‡©Ä ‡®ï‡®®‡©à‡®ï‡®∏‡®º‡®® ‡®∏‡®ü‡©ç‡®∞‡®ø‡©∞‡®ó ‡®®‡®æ‡®≤ ‡®¨‡®¶‡®≤‡©ã‡•§

1. IoT Hub ‡®®‡®æ‡®≤ ‡®ï‡®®‡©à‡®ï‡®∏‡®º‡®® ‡®ü‡®æ‡®à‡®Æ-‡®¨‡©á‡®∏‡®° ‡®ü‡©ã‡®ï‡®® ‡®µ‡®∞‡®§‡®¶‡®æ ‡®π‡©à‡•§ ‡®á‡®∏‡®¶‡®æ ‡®Æ‡®§‡®≤‡®¨ ‡®π‡©à ‡®ï‡®ø IoT ‡®°‡®ø‡®µ‡®æ‡®à‡®∏ ‡®®‡©Ç‡©∞ ‡®Æ‡©å‡®ú‡©Ç‡®¶‡®æ ‡®∏‡®Æ‡®æ‡®Ç ‡®™‡®§‡®æ ‡®π‡©ã‡®£‡®æ ‡®ö‡®æ‡®π‡©Ä‡®¶‡®æ ‡®π‡©à‡•§ Windows, macOS ‡®ú‡®æ‡®Ç Linux ‡®µ‡®∞‡®ó‡©á ‡®ì‡®™‡®∞‡©á‡®ü‡®ø‡©∞‡®ó ‡®∏‡®ø‡®∏‡®ü‡®Æ‡®æ‡®Ç ‡®¶‡©á ‡®µ‡®ø‡®∞‡©Å‡©±‡®ß, ‡®Æ‡®æ‡®à‡®ï‡®∞‡©ã‡®ï‡©∞‡®ü‡®∞‡©ã‡®≤‡®∞ ‡®á‡©∞‡®ü‡®∞‡®®‡©à‡®ü ‡®∞‡®æ‡®π‡©Ä‡®Ç ‡®Æ‡©å‡®ú‡©Ç‡®¶‡®æ ‡®∏‡®Æ‡®æ‡®Ç ‡®Ü‡®™‡®£‡©á ‡®Ü‡®™ ‡®∏‡®ø‡©∞‡®ï‡®∞‡©ã‡®®‡®æ‡®à‡®ú‡®º ‡®®‡®π‡©Ä‡®Ç ‡®ï‡®∞‡®¶‡©á‡•§ ‡®á‡®∏‡®¶‡®æ ‡®Æ‡®§‡®≤‡®¨ ‡®π‡©à ‡®ï‡®ø ‡®§‡©Å‡®π‡®æ‡®®‡©Ç‡©∞ [NTP](https://wikipedia.org/wiki/Network_Time_Protocol) ‡®∏‡®∞‡®µ‡®∞ ‡®§‡©ã‡®Ç ‡®Æ‡©å‡®ú‡©Ç‡®¶‡®æ ‡®∏‡®Æ‡®æ‡®Ç ‡®™‡©ç‡®∞‡®æ‡®™‡®§ ‡®ï‡®∞‡®® ‡®≤‡®à ‡®ï‡©ã‡®° ‡®∏‡®º‡®æ‡®Æ‡®≤ ‡®ï‡®∞‡®® ‡®¶‡©Ä ‡®≤‡©ã‡©ú ‡®π‡©ã‡®µ‡©á‡®ó‡©Ä‡•§ ‡®ú‡®¶‡©ã‡®Ç ‡®∏‡®Æ‡®æ‡®Ç ‡®™‡©ç‡®∞‡®æ‡®™‡®§ ‡®ï‡©Ä‡®§‡®æ ‡®ú‡®æ‡®Ç‡®¶‡®æ ‡®π‡©à, ‡®á‡®∏‡®®‡©Ç‡©∞ Wio Terminal ‡®µ‡®ø‡©±‡®ö ‡®∞‡©Ä‡®Ö‡®≤-‡®ü‡®æ‡®à‡®Æ ‡®ò‡©ú‡©Ä ‡®µ‡®ø‡©±‡®ö ‡®∏‡®ü‡©ã‡®∞ ‡®ï‡©Ä‡®§‡®æ ‡®ú‡®æ ‡®∏‡®ï‡®¶‡®æ ‡®π‡©à, ‡®ú‡®ø‡®∏ ‡®®‡®æ‡®≤ ‡®∏‡®π‡©Ä ‡®∏‡®Æ‡®æ‡®Ç ‡®¨‡®æ‡®Ö‡®¶ ‡®µ‡®ø‡©±‡®ö ‡®Æ‡©∞‡®ó‡®ø‡®Ü ‡®ú‡®æ ‡®∏‡®ï‡®¶‡®æ ‡®π‡©à, ‡®ú‡©á‡®ï‡®∞ ‡®°‡®ø‡®µ‡®æ‡®à‡®∏ ‡®¶‡©Ä ‡®™‡®æ‡®µ‡®∞ ‡®®‡®æ ‡®ú‡®æ‡®µ‡©á‡•§ `ntp.h` ‡®®‡®æ‡®Æ ‡®¶‡©Ä ‡®®‡®µ‡©Ä‡®Ç ‡®´‡®æ‡®à‡®≤ ‡®¨‡®£‡®æ‡®ì ‡®Ö‡®§‡©á ‡®π‡©á‡®†‡®æ‡®Ç ‡®¶‡®ø‡©±‡®§‡®æ ‡®ï‡©ã‡®° ‡®∏‡®º‡®æ‡®Æ‡®≤ ‡®ï‡®∞‡©ã:

    ```cpp
    #pragma once
    
    #include "DateTime.h"
    #include <time.h>
    #include "samd/NTPClientAz.h"
    #include <sys/time.h>

    static void initTime()
    {
        WiFiUDP _udp;
        time_t epochTime = (time_t)-1;
        NTPClientAz ntpClient;

        ntpClient.begin();

        while (true)
        {
            epochTime = ntpClient.getEpochTime("0.pool.ntp.org");

            if (epochTime == (time_t)-1)
            {
                Serial.println("Fetching NTP epoch time failed! Waiting 2 seconds to retry.");
                delay(2000);
            }
            else
            {
                Serial.print("Fetched NTP epoch time is: ");

                char buff[32];
                sprintf(buff, "%.f", difftime(epochTime, (time_t)0));
                Serial.println(buff);
                break;
            }
        }

        ntpClient.end();

        struct timeval tv;
        tv.tv_sec = epochTime;
        tv.tv_usec = 0;

        settimeofday(&tv, NULL);
    }
    ```

    ‡®á‡®∏ ‡®ï‡©ã‡®° ‡®¶‡©á ‡®µ‡©á‡®∞‡®µ‡©á ‡®á‡®∏ ‡®™‡®æ‡®† ‡®¶‡©á ‡®¶‡®æ‡®á‡®∞‡©á ‡®§‡©ã‡®Ç ‡®¨‡®æ‡®π‡®∞ ‡®π‡®®‡•§ ‡®á‡®π ‡®á‡©±‡®ï ‡®´‡©∞‡®ï‡®∏‡®º‡®® `initTime` ‡®®‡©Ç‡©∞ ‡®™‡®∞‡®ø‡®≠‡®æ‡®∏‡®º‡®ø‡®§ ‡®ï‡®∞‡®¶‡®æ ‡®π‡©à ‡®ú‡©ã NTP ‡®∏‡®∞‡®µ‡®∞ ‡®§‡©ã‡®Ç ‡®Æ‡©å‡®ú‡©Ç‡®¶‡®æ ‡®∏‡®Æ‡®æ‡®Ç ‡®™‡©ç‡®∞‡®æ‡®™‡®§ ‡®ï‡®∞‡®¶‡®æ ‡®π‡©à ‡®Ö‡®§‡©á ‡®á‡®∏‡®®‡©Ç‡©∞ Wio Terminal ‡®¶‡©Ä ‡®ò‡©ú‡©Ä '‡®§‡©á ‡®∏‡©à‡®ü ‡®ï‡®∞‡®® ‡®≤‡®à ‡®µ‡®∞‡®§‡®¶‡®æ ‡®π‡©à‡•§

1. `main.cpp` ‡®´‡®æ‡®à‡®≤ ‡®ñ‡©ã‡®≤‡©ç‡®π‡©ã ‡®Ö‡®§‡©á ‡®∏‡®æ‡®∞‡©á MQTT ‡®ï‡©ã‡®° ‡®π‡®ü‡®æ‡®ì, ‡®ú‡®ø‡®∏ ‡®µ‡®ø‡©±‡®ö `PubSubClient.h` ‡®π‡©à‡®°‡®∞ ‡®´‡®æ‡®à‡®≤, `PubSubClient` ‡®µ‡©à‡®∞‡©Ä‡®è‡®¨‡®≤ ‡®¶‡©Ä ‡®ò‡©ã‡®∏‡®º‡®£‡®æ, `reconnectMQTTClient` ‡®Ö‡®§‡©á `createMQTTClient` ‡®Æ‡©à‡®•‡®°, ‡®Ö‡®§‡©á ‡®á‡®®‡©ç‡®π‡®æ‡®Ç ‡®µ‡©à‡®∞‡©Ä‡®è‡®¨‡®≤‡®æ‡®Ç ‡®Ö‡®§‡©á ‡®Æ‡©à‡®•‡®°‡®æ‡®Ç ‡®®‡©Ç‡©∞ ‡®ï‡®æ‡®≤ ‡®ï‡®∞‡®® ‡®µ‡®æ‡®≤‡©á ‡®ï‡©ã‡®à ‡®µ‡©Ä ‡®ï‡©ã‡®° ‡®∏‡®º‡®æ‡®Æ‡®≤ ‡®π‡®®‡•§ ‡®á‡®∏ ‡®´‡®æ‡®à‡®≤ ‡®µ‡®ø‡©±‡®ö ‡®∏‡®ø‡®∞‡®´ WiFi ‡®®‡®æ‡®≤ ‡®ú‡©Å‡©ú‡®®, ‡®Æ‡®ø‡©±‡®ü‡©Ä ‡®¶‡©Ä ‡®®‡®Æ‡©Ä ‡®™‡©ç‡®∞‡®æ‡®™‡®§ ‡®ï‡®∞‡®® ‡®Ö‡®§‡©á ‡®á‡®∏ ‡®®‡®æ‡®≤ JSON ‡®°‡©å‡®ï‡©Ç‡®Æ‡©à‡®Ç‡®ü ‡®¨‡®£‡®æ‡®â‡®£ ‡®≤‡®à ‡®ï‡©ã‡®° ‡®π‡©ã‡®£‡®æ ‡®ö‡®æ‡®π‡©Ä‡®¶‡®æ ‡®π‡©à‡•§

1. `main.cpp` ‡®´‡®æ‡®à‡®≤ ‡®¶‡©á ‡®â‡©±‡®™‡®∞ ‡®π‡©á‡®†‡®æ‡®Ç ‡®¶‡®ø‡©±‡®§‡©á `#include` ‡®°‡®æ‡®á‡®∞‡©à‡®ï‡®ü‡®ø‡®µ‡®ú‡®º ‡®∏‡®º‡®æ‡®Æ‡®≤ ‡®ï‡®∞‡©ã, ‡®§‡®æ‡®Ç ‡®ú‡©ã IoT Hub ‡®≤‡®æ‡®á‡®¨‡©ç‡®∞‡©á‡®∞‡©Ä‡®Ü‡®Ç ‡®Ö‡®§‡©á ‡®∏‡®Æ‡®æ‡®Ç ‡®∏‡©à‡®ü ‡®ï‡®∞‡®® ‡®≤‡®à ‡®π‡©à‡®°‡®∞ ‡®´‡®æ‡®à‡®≤‡®æ‡®Ç ‡®∏‡®º‡®æ‡®Æ‡®≤ ‡®ï‡©Ä‡®§‡©Ä‡®Ü‡®Ç ‡®ú‡®æ ‡®∏‡®ï‡®£:

    ```cpp
    #include <AzureIoTHub.h>
    #include <AzureIoTProtocol_MQTT.h>
    #include <iothubtransportmqtt.h>
    #include "ntp.h"
    ```

1. `setup` ‡®´‡©∞‡®ï‡®∏‡®º‡®® ‡®¶‡©á ‡®Ö‡©∞‡®§ ‡®µ‡®ø‡©±‡®ö ‡®π‡©á‡®†‡®æ‡®Ç ‡®¶‡®ø‡©±‡®§‡®æ ‡®ï‡®æ‡®≤ ‡®∏‡®º‡®æ‡®Æ‡®≤ ‡®ï‡®∞‡©ã, ‡®§‡®æ‡®Ç ‡®ú‡©ã ‡®Æ‡©å‡®ú‡©Ç‡®¶‡®æ ‡®∏‡®Æ‡®æ‡®Ç ‡®∏‡©à‡®ü ‡®ï‡©Ä‡®§‡®æ ‡®ú‡®æ ‡®∏‡®ï‡©á:

    ```cpp
    initTime();
    ```

1. ‡®´‡®æ‡®à‡®≤ ‡®¶‡©á ‡®â‡©±‡®™‡®∞, `include` ‡®°‡®æ‡®á‡®∞‡©à‡®ï‡®ü‡®ø‡®µ‡®ú‡®º ‡®¶‡©á ‡®•‡©±‡®≤‡©á ‡®π‡©á‡®†‡®æ‡®Ç ‡®¶‡®ø‡©±‡®§‡©Ä ‡®µ‡©à‡®∞‡©Ä‡®è‡®¨‡®≤ ‡®ò‡©ã‡®∏‡®º‡®£‡®æ ‡®∏‡®º‡®æ‡®Æ‡®≤ ‡®ï‡®∞‡©ã:

    ```cpp
    IOTHUB_DEVICE_CLIENT_LL_HANDLE _device_ll_handle;
    ```

    ‡®á‡®π ‡®á‡©±‡®ï `IOTHUB_DEVICE_CLIENT_LL_HANDLE` ‡®ò‡©ã‡®∏‡®º‡®ø‡®§ ‡®ï‡®∞‡®¶‡®æ ‡®π‡©à, ‡®ú‡©ã IoT Hub ‡®®‡®æ‡®≤ ‡®ï‡®®‡©à‡®ï‡®∏‡®º‡®® ‡®≤‡®à ‡®á‡©±‡®ï ‡®π‡©à‡®Ç‡®°‡®≤ ‡®π‡©à‡•§

1. ‡®á‡®∏ ‡®¶‡©á ‡®•‡©±‡®≤‡©á ‡®π‡©á‡®†‡®æ‡®Ç ‡®¶‡®ø‡©±‡®§‡®æ ‡®ï‡©ã‡®° ‡®∏‡®º‡®æ‡®Æ‡®≤ ‡®ï‡®∞‡©ã:

    ```cpp
    static void connectionStatusCallback(IOTHUB_CLIENT_CONNECTION_STATUS result, IOTHUB_CLIENT_CONNECTION_STATUS_REASON reason, void *user_context)
    {
        if (result == IOTHUB_CLIENT_CONNECTION_AUTHENTICATED)
        {
            Serial.println("The device client is connected to iothub");
        }
        else
        {
            Serial.println("The device client has been disconnected");
        }
    }
    ```

    ‡®á‡®π ‡®á‡©±‡®ï ‡®ï‡®æ‡®≤‡®¨‡©à‡®ï ‡®´‡©∞‡®ï‡®∏‡®º‡®® ‡®ò‡©ã‡®∏‡®º‡®ø‡®§ ‡®ï‡®∞‡®¶‡®æ ‡®π‡©à ‡®ú‡©ã IoT Hub ‡®®‡®æ‡®≤ ‡®ï‡®®‡©à‡®ï‡®∏‡®º‡®® ‡®¶‡©Ä ‡®∏‡®•‡®ø‡®§‡©Ä ‡®¨‡®¶‡®≤‡®£ '‡®§‡©á ‡®ï‡®æ‡®≤ ‡®ï‡©Ä‡®§‡®æ ‡®ú‡®æ‡®Ç‡®¶‡®æ ‡®π‡©à, ‡®ú‡®ø‡®µ‡©á‡®Ç ‡®ï‡®ø ‡®ï‡®®‡©à‡®ï‡®ü ‡®π‡©ã‡®£‡®æ ‡®ú‡®æ‡®Ç ‡®°‡®ø‡®∏‡®ï‡®®‡©à‡®ï‡®ü ‡®π‡©ã‡®£‡®æ‡•§ ‡®∏‡®•‡®ø‡®§‡©Ä ‡®∏‡©Ä‡®∞‡©Ä‡®Ö‡®≤ ‡®™‡©ã‡®∞‡®ü '‡®§‡©á ‡®≠‡©á‡®ú‡©Ä ‡®ú‡®æ‡®Ç‡®¶‡©Ä ‡®π‡©à‡•§

1. ‡®á‡®∏ ‡®¶‡©á ‡®•‡©±‡®≤‡©á IoT Hub ‡®®‡®æ‡®≤ ‡®ï‡®®‡©à‡®ï‡®∏‡®º‡®® ‡®ï‡®∞‡®® ‡®≤‡®à ‡®á‡©±‡®ï ‡®´‡©∞‡®ï‡®∏‡®º‡®® ‡®∏‡®º‡®æ‡®Æ‡®≤ ‡®ï‡®∞‡©ã:

    ```cpp
    void connectIoTHub()
    {
        IoTHub_Init();
    
        _device_ll_handle = IoTHubDeviceClient_LL_CreateFromConnectionString(CONNECTION_STRING, MQTT_Protocol);
        
        if (_device_ll_handle == NULL)
        {
            Serial.println("Failure creating Iothub device. Hint: Check your connection string.");
            return;
        }
    
        IoTHubDeviceClient_LL_SetConnectionStatusCallback(_device_ll_handle, connectionStatusCallback, NULL);
    }
    ```

    ‡®á‡®π IoT Hub ‡®≤‡®æ‡®á‡®¨‡©ç‡®∞‡©á‡®∞‡©Ä ‡®ï‡©ã‡®° ‡®®‡©Ç‡©∞ ‡®∏‡®º‡©Å‡®∞‡©Ç ‡®ï‡®∞‡®¶‡®æ ‡®π‡©à, ‡®´‡®ø‡®∞ `config.h` ‡®π‡©à‡®°‡®∞ ‡®´‡®æ‡®à‡®≤ ‡®µ‡®ø‡©±‡®ö ‡®ï‡®®‡©à‡®ï‡®∏‡®º‡®® ‡®∏‡®ü‡©ç‡®∞‡®ø‡©∞‡®ó ‡®¶‡©Ä ‡®µ‡®∞‡®§‡©ã‡®Ç ‡®ï‡®∞‡®ï‡©á ‡®á‡©±‡®ï ‡®ï‡®®‡©à‡®ï‡®∏‡®º‡®® ‡®¨‡®£‡®æ‡®â‡®Ç‡®¶‡®æ ‡®π‡©à‡•§ ‡®á‡®π ‡®ï‡®®‡©à‡®ï‡®∏‡®º‡®® MQTT '‡®§‡©á ‡®Ö‡®ß‡®æ‡®∞‡®ø‡®§ ‡®π‡©à‡•§ ‡®ú‡©á‡®ï‡®∞ ‡®ï‡®®‡©à‡®ï‡®∏‡®º‡®® ‡®´‡©á‡®≤ ‡®π‡©ã ‡®ú‡®æ‡®Ç‡®¶‡®æ ‡®π‡©à, ‡®§‡®æ‡®Ç ‡®á‡®π ‡®∏‡©Ä‡®∞‡©Ä‡®Ö‡®≤ ‡®™‡©ã‡®∞‡®ü '‡®§‡©á ‡®≠‡©á‡®ú‡®ø‡®Ü ‡®ú‡®æ‡®Ç‡®¶‡®æ ‡®π‡©à - ‡®ú‡©á‡®ï‡®∞ ‡®§‡©Å‡®∏‡©Ä‡®Ç ‡®á‡®π ‡®Ü‡®â‡®ü‡®™‡©Å‡©±‡®ü ‡®µ‡®ø‡©±‡®ö ‡®µ‡©á‡®ñ‡®¶‡©á ‡®π‡©ã, ‡®§‡®æ‡®Ç ‡®ï‡®®‡©à‡®ï‡®∏‡®º‡®® ‡®∏‡®ü‡©ç‡®∞‡®ø‡©∞‡®ó ‡®¶‡©Ä ‡®ú‡®æ‡®Ç‡®ö ‡®ï‡®∞‡©ã‡•§ ‡®Ö‡©∞‡®§ ‡®µ‡®ø‡©±‡®ö, ‡®ï‡®®‡©à‡®ï‡®∏‡®º‡®® ‡®∏‡®•‡®ø‡®§‡©Ä ‡®ï‡®æ‡®≤‡®¨‡©à‡®ï ‡®∏‡©à‡®ü ‡®ï‡©Ä‡®§‡®æ ‡®ú‡®æ‡®Ç‡®¶‡®æ ‡®π‡©à‡•§

1. ‡®á‡®∏ ‡®´‡©∞‡®ï‡®∏‡®º‡®® ‡®®‡©Ç‡©∞ `setup` ‡®´‡©∞‡®ï‡®∏‡®º‡®® ‡®µ‡®ø‡©±‡®ö `initTime` ‡®ï‡®æ‡®≤ ‡®¶‡©á ‡®•‡©±‡®≤‡©á ‡®ï‡®æ‡®≤ ‡®ï‡®∞‡©ã:

    ```cpp
    connectIoTHub();
    ```

1. MQTT ‡®ï‡®≤‡®æ‡®á‡©∞‡®ü ‡®¶‡©Ä ‡®§‡®∞‡©ç‡®π‡®æ‡®Ç, ‡®á‡®π ‡®ï‡©ã‡®° ‡®á‡©±‡®ï ‡®∏‡®ø‡©∞‡®ó‡®≤ ‡®•‡©ç‡®∞‡©à‡®° '‡®§‡©á ‡®ö‡®≤‡®¶‡®æ ‡®π‡©à, ‡®á‡®∏ ‡®≤‡®à ‡®π‡©±‡®¨ ‡®¶‡©Å‡®Ü‡®∞‡®æ ‡®≠‡©á‡®ú‡©á ‡®ó‡®è ‡®∏‡©Å‡®®‡©á‡®π‡®ø‡®Ü‡®Ç ‡®®‡©Ç‡©∞ ‡®™‡©ç‡®∞‡®ï‡®ø‡®∞‡®ø‡®Ü ‡®ï‡®∞‡®® ‡®≤‡®à ‡®∏‡®Æ‡®æ‡®Ç ‡®¶‡©Ä ‡®≤‡©ã‡©ú ‡®π‡©Å‡©∞‡®¶‡©Ä ‡®π‡©à, ‡®Ö‡®§‡©á ‡®π‡©±‡®¨ ‡®®‡©Ç‡©∞ ‡®≠‡©á‡®ú‡©á ‡®ó‡®è ‡®∏‡©Å‡®®‡©á‡®π‡®ø‡®Ü‡®Ç ‡®®‡©Ç‡©∞ ‡®µ‡©Ä‡•§ `loop` ‡®´‡©∞‡®ï‡®∏‡®º‡®® ‡®¶‡©á ‡®â‡©±‡®™‡®∞ ‡®π‡©á‡®†‡®æ‡®Ç ‡®¶‡®ø‡©±‡®§‡®æ ‡®∏‡®º‡®æ‡®Æ‡®≤ ‡®ï‡®∞‡©ã:

    ```cpp
    IoTHubDeviceClient_LL_DoWork(_device_ll_handle);
    ```

1. ‡®á‡®∏ ‡®ï‡©ã‡®° ‡®®‡©Ç‡©∞ ‡®¨‡®£‡®æ‡®ì ‡®Ö‡®§‡©á ‡®Ö‡®™‡®≤‡©ã‡®° ‡®ï‡®∞‡©ã‡•§ ‡®§‡©Å‡®∏‡©Ä‡®Ç ‡®∏‡©Ä‡®∞‡©Ä‡®Ö‡®≤ ‡®Æ‡®æ‡®®‡©Ä‡®ü‡®∞ ‡®µ‡®ø‡©±‡®ö ‡®ï‡®®‡©à‡®ï‡®∏‡®º‡®® ‡®µ‡©á‡®ñ‡©ã‡®ó‡©á:

    ```output
    Connecting to WiFi..
    Connected!
    Fetched NTP epoch time is: 1619983687
    Sending telemetry {"soil_moisture":391}
    The device client is connected to iothub
    ```

    ‡®Ü‡®â‡®ü‡®™‡©Å‡©±‡®ü ‡®µ‡®ø‡©±‡®ö ‡®§‡©Å‡®∏‡©Ä‡®Ç NTP ‡®∏‡®Æ‡®æ‡®Ç ‡®™‡©ç‡®∞‡®æ‡®™‡®§ ‡®π‡©ã‡®£ ‡®¶‡©á ‡®¨‡®æ‡®Ö‡®¶ ‡®°‡®ø‡®µ‡®æ‡®à‡®∏ ‡®ï‡®≤‡®æ‡®á‡©∞‡®ü ‡®®‡©Ç‡©∞ ‡®ï‡®®‡©à‡®ï‡®ü ‡®π‡©Å‡©∞‡®¶‡©á ‡®µ‡©á‡®ñ ‡®∏‡®ï‡®¶‡©á ‡®π‡©ã‡•§ ‡®ï‡®®‡©à‡®ï‡®ü ‡®ï‡®∞‡®® ‡®µ‡®ø‡©±‡®ö ‡®ï‡©Å‡®ù ‡®∏‡®ï‡®ø‡©∞‡®ü ‡®≤‡©±‡®ó ‡®∏‡®ï‡®¶‡©á ‡®π‡®®, ‡®á‡®∏ ‡®≤‡®à ‡®§‡©Å‡®∏‡©Ä‡®Ç ‡®°‡®ø‡®µ‡®æ‡®à‡®∏ ‡®ï‡®®‡©à‡®ï‡®ü ‡®π‡©ã‡®£ ‡®¶‡©å‡®∞‡®æ‡®® ‡®Ü‡®â‡®ü‡®™‡©Å‡©±‡®ü ‡®µ‡®ø‡©±‡®ö ‡®Æ‡®ø‡©±‡®ü‡©Ä ‡®¶‡©Ä ‡®®‡®Æ‡©Ä ‡®µ‡©á‡®ñ ‡®∏‡®ï‡®¶‡©á ‡®π‡©ã‡•§

    > üíÅ ‡®§‡©Å‡®∏‡©Ä‡®Ç NTP ‡®≤‡®à UNIX ‡®∏‡®Æ‡®æ‡®Ç ‡®®‡©Ç‡©∞ ‡®á‡©±‡®ï ‡®µ‡©±‡®ß ‡®™‡©ú‡©ç‡®π‡®®‡®Ø‡©ã‡®ó ‡®µ‡®∞‡®ú‡®® ‡®µ‡®ø‡©±‡®ö [unixtimestamp.com](https://www.unixtimestamp.com) ‡®µ‡®∞‡®ó‡©á ‡®µ‡©à‡®¨‡®∏‡®æ‡®à‡®ü ‡®¶‡©Ä ‡®µ‡®∞‡®§‡©ã‡®Ç ‡®ï‡®∞‡®ï‡©á ‡®¨‡®¶‡®≤ ‡®∏‡®ï‡®¶‡©á ‡®π‡©ã‡•§

## ‡®ü‡©à‡®≤‡©Ä‡®Æ‡©á‡®ü‡®∞‡©Ä ‡®≠‡©á‡®ú‡©ã

‡®π‡©Å‡®£ ‡®§‡©Å‡®π‡®æ‡®°‡®æ ‡®°‡®ø‡®µ‡®æ‡®à‡®∏ ‡®ú‡©Å‡©ú‡®ø‡®Ü ‡®π‡©ã‡®á‡®Ü ‡®π‡©à, ‡®§‡©Å‡®∏‡©Ä‡®Ç MQTT ‡®¨‡©ç‡®∞‡©ã‡®ï‡®∞ ‡®¶‡©Ä ‡®¨‡®ú‡®æ‡®è IoT Hub ‡®®‡©Ç‡©∞ ‡®ü‡©à‡®≤‡©Ä‡®Æ‡©á‡®ü‡®∞‡©Ä ‡®≠‡©á‡®ú ‡®∏‡®ï‡®¶‡©á ‡®π‡©ã‡•§

### ‡®ü‡®æ‡®∏‡®ï - ‡®ü‡©à‡®≤‡©Ä‡®Æ‡©á‡®ü‡®∞‡©Ä ‡®≠‡©á‡®ú‡©ã

1. `setup` ‡®´‡©∞‡®ï‡®∏‡®º‡®® ‡®¶‡©á ‡®â‡©±‡®™‡®∞ ‡®π‡©á‡®†‡®æ‡®Ç ‡®¶‡®ø‡©±‡®§‡®æ ‡®´‡©∞‡®ï‡®∏‡®º‡®® ‡®∏‡®º‡®æ‡®Æ‡®≤ ‡®ï‡®∞‡©ã:

    ```cpp
    void sendTelemetry(const char *telemetry)
    {
        IOTHUB_MESSAGE_HANDLE message_handle = IoTHubMessage_CreateFromString(telemetry);
        IoTHubDeviceClient_LL_SendEventAsync(_device_ll_handle, message_handle, NULL, NULL);
        IoTHubMessage_Destroy(message_handle);
    }
    ```

    ‡®á‡®π ‡®ï‡©ã‡®° ‡®á‡©±‡®ï ‡®∏‡®ü‡©ç‡®∞‡®ø‡©∞‡®ó ‡®§‡©ã‡®Ç IoT Hub ‡®∏‡©Å‡®®‡©á‡®π‡®æ ‡®¨‡®£‡®æ‡®â‡®Ç‡®¶‡®æ ‡®π‡©à ‡®ú‡©ã ‡®™‡©à‡®∞‡®æ‡®Æ‡©Ä‡®ü‡®∞ ‡®µ‡®ú‡©ã‡®Ç ‡®™‡®æ‡®∏ ‡®ï‡©Ä‡®§‡®æ ‡®ú‡®æ‡®Ç‡®¶‡®æ ‡®π‡©à, ‡®á‡®∏‡®®‡©Ç‡©∞ ‡®π‡©±‡®¨ ‡®®‡©Ç‡©∞ ‡®≠‡©á‡®ú‡®¶‡®æ ‡®π‡©à, ‡®´‡®ø‡®∞ ‡®∏‡©Å‡®®‡©á‡®π‡®æ ‡®Ü‡®¨‡®ú‡©à‡®ï‡®ü ‡®®‡©Ç‡©∞ ‡®∏‡®æ‡®´ ‡®ï‡®∞‡®¶‡®æ ‡®π‡©à‡•§

1. ‡®á‡®∏ ‡®ï‡©ã‡®° ‡®®‡©Ç‡©∞ `loop` ‡®´‡©∞‡®ï‡®∏‡®º‡®® ‡®µ‡®ø‡©±‡®ö ‡®ï‡®æ‡®≤ ‡®ï‡®∞‡©ã, ‡®â‡®∏ ‡®≤‡®æ‡®à‡®® ‡®¶‡©á ‡®•‡©±‡®≤‡©á ‡®ú‡®ø‡©±‡®•‡©á ‡®ü‡©à‡®≤‡©Ä‡®Æ‡©á‡®ü‡®∞‡©Ä ‡®∏‡©Ä‡®∞‡©Ä‡®Ö‡®≤ ‡®™‡©ã‡®∞‡®ü '‡®§‡©á ‡®≠‡©á‡®ú‡©Ä ‡®ú‡®æ‡®Ç‡®¶‡©Ä ‡®π‡©à:

    ```cpp
    sendTelemetry(telemetry.c_str());
    ```

## ‡®ï‡®Æ‡®æ‡®Ç‡®° ‡®∏‡©∞‡®≠‡®æ‡®≤‡©ã

‡®§‡©Å‡®π‡®æ‡®°‡©á ‡®°‡®ø‡®µ‡®æ‡®à‡®∏ ‡®®‡©Ç‡©∞ ‡®∏‡®∞‡®µ‡®∞ ‡®ï‡©ã‡®° ‡®§‡©ã‡®Ç ‡®∞‡©Ä‡®≤‡©á ‡®®‡©Ç‡©∞ ‡®ï‡©∞‡®ü‡®∞‡©ã‡®≤ ‡®ï‡®∞‡®® ‡®≤‡®à ‡®á‡©±‡®ï ‡®ï‡®Æ‡®æ‡®Ç‡®° ‡®∏‡©∞‡®≠‡®æ‡®≤‡®£ ‡®¶‡©Ä ‡®≤‡©ã‡©ú ‡®π‡©à‡•§ ‡®á‡®π ‡®á‡©±‡®ï ‡®°‡®æ‡®á‡®∞‡©à‡®ï‡®ü ‡®Æ‡©à‡®•‡®° ‡®∞‡®ø‡®ï‡®µ‡©à‡®∏‡®ü ‡®µ‡®ú‡©ã‡®Ç ‡®≠‡©á‡®ú‡®ø‡®Ü ‡®ú‡®æ‡®Ç‡®¶‡®æ ‡®π‡©à‡•§

## ‡®ü‡®æ‡®∏‡®ï - ‡®°‡®æ‡®á‡®∞‡©à‡®ï‡®ü ‡®Æ‡©à‡®•‡®° ‡®∞‡®ø‡®ï‡®µ‡©à‡®∏‡®ü ‡®∏‡©∞‡®≠‡®æ‡®≤‡©ã

1. `connectIoTHub` ‡®´‡©∞‡®ï‡®∏‡®º‡®® ‡®§‡©ã‡®Ç ‡®™‡®π‡®ø‡®≤‡®æ‡®Ç ‡®π‡©á‡®†‡®æ‡®Ç ‡®¶‡®ø‡©±‡®§‡®æ ‡®ï‡©ã‡®° ‡®∏‡®º‡®æ‡®Æ‡®≤ ‡®ï‡®∞‡©ã:

    ```cpp
    int directMethodCallback(const char *method_name, const unsigned char *payload, size_t size, unsigned char **response, size_t *response_size, void *userContextCallback)
    {
        Serial.printf("Direct method received %s\r\n", method_name);
    
        if (strcmp(method_name, "relay_on") == 0)
        {
            digitalWrite(PIN_WIRE_SCL, HIGH);
        }
        else if (strcmp(method_name, "relay_off") == 0)
        {
            digitalWrite(PIN_WIRE_SCL, LOW);
        }
    }
    ```

    ‡®á‡®π ‡®ï‡©ã‡®° ‡®á‡©±‡®ï ‡®ï‡®æ‡®≤‡®¨‡©à‡®ï ‡®Æ‡©à‡®•‡®° ‡®™‡®∞‡®ø‡®≠‡®æ‡®∏‡®º‡®ø‡®§ ‡®ï‡®∞‡®¶‡®æ ‡®π‡©à ‡®ú‡©ã IoT Hub ‡®≤‡®æ‡®á‡®¨‡©ç‡®∞‡©á‡®∞‡©Ä ‡®®‡©Ç‡©∞ ‡®ï‡®æ‡®≤ ‡®ï‡®∞ ‡®∏‡®ï‡®¶‡®æ ‡®π‡©à ‡®ú‡®¶‡©ã‡®Ç ‡®á‡®π ‡®á‡©±‡®ï ‡®°‡®æ‡®á‡®∞‡©à‡®ï‡®ü ‡®Æ‡©à‡®•‡®° ‡®∞‡®ø‡®ï‡®µ‡©à‡®∏‡®ü ‡®™‡©ç‡®∞‡®æ‡®™‡®§ ‡®ï‡®∞‡®¶‡®æ ‡®π‡©à‡•§ ‡®Æ‡©à‡®•‡®° ‡®ú‡©ã ‡®∞‡®ø‡®ï‡®µ‡©à‡®∏‡®ü ‡®ï‡©Ä‡®§‡®æ ‡®ú‡®æ‡®Ç‡®¶‡®æ ‡®π‡©à `method_name` ‡®™‡©à‡®∞‡®æ‡®Æ‡©Ä‡®ü‡®∞ ‡®µ‡®ø‡©±‡®ö ‡®≠‡©á‡®ú‡®ø‡®Ü ‡®ú‡®æ‡®Ç‡®¶‡®æ ‡®π‡©à‡•§ ‡®á‡®π ‡®´‡©∞‡®ï‡®∏‡®º‡®® ‡®∏‡©Ä‡®∞‡©Ä‡®Ö‡®≤ ‡®™‡©ã‡®∞‡®ü '‡®§‡©á ‡®ï‡®æ‡®≤ ‡®ï‡©Ä‡®§‡©á ‡®ó‡®è ‡®Æ‡©à‡®•‡®° ‡®®‡©Ç‡©∞ ‡®™‡©ç‡®∞‡®ø‡©∞‡®ü ‡®ï‡®∞‡®¶‡®æ ‡®π‡©à, ‡®´‡®ø‡®∞ ‡®Æ‡©à‡®•‡®° ‡®®‡®æ‡®Æ ‡®¶‡©á ‡®Ö‡®®‡©Å‡®∏‡®æ‡®∞ ‡®∞‡©Ä‡®≤‡©á ‡®®‡©Ç‡©∞ ‡®ö‡®æ‡®≤‡©Ç ‡®ú‡®æ‡®Ç ‡®¨‡©∞‡®¶ ‡®ï‡®∞‡®¶‡®æ ‡®π‡©à‡•§

    > üíÅ ‡®á‡®π ‡®á‡©±‡®ï ‡®∏‡®ø‡©∞‡®ó‡®≤ ‡®°‡®æ‡®á‡®∞‡©à‡®ï‡®ü ‡®Æ‡©à‡®•‡®° ‡®∞‡®ø‡®ï‡®µ‡©à‡®∏‡®ü ‡®µ‡®ø‡©±‡®ö ‡®µ‡©Ä ‡®≤‡®æ‡®ó‡©Ç ‡®ï‡©Ä‡®§‡®æ ‡®ú‡®æ ‡®∏‡®ï‡®¶‡®æ ‡®π‡©à, ‡®ú‡®ø‡®∏ ‡®µ‡®ø‡©±‡®ö ‡®∞‡©Ä‡®≤‡©á ‡®¶‡©Ä ‡®ö‡®æ‡®π‡©Ä‡®¶‡©Ä ‡®∏‡®•‡®ø‡®§‡©Ä ‡®®‡©Ç‡©∞ ‡®™‡©á‡®≤‡©ã‡®° ‡®µ‡®ø‡©±‡®ö ‡®™‡®æ‡®∏ ‡®ï‡©Ä‡®§‡®æ ‡®ú‡®æ ‡®∏‡®ï‡®¶‡®æ ‡®π‡©à ‡®ú‡©ã ‡®Æ‡©à‡®•‡®° ‡®∞‡®ø‡®ï‡®µ‡©à‡®∏‡®ü ‡®®‡®æ‡®≤ ‡®™‡®æ‡®∏ ‡®ï‡©Ä‡®§‡®æ ‡®ú‡®æ ‡®∏‡®ï‡®¶‡®æ ‡®π‡©à ‡®Ö‡®§‡©á `payload` ‡®™‡©à‡®∞‡®æ‡®Æ‡©Ä‡®ü‡®∞ ‡®§‡©ã‡®Ç ‡®â‡®™‡®≤‡®¨‡®ß ‡®π‡©ã ‡®∏‡®ï‡®¶‡®æ ‡®π‡©à‡•§

1. `directMethodCallback` ‡®´‡©∞‡®ï‡®∏‡®º‡®® ‡®¶‡©á ‡®Ö‡©∞‡®§ ‡®µ‡®ø‡©±‡®ö ‡®π‡©á‡®†‡®æ‡®Ç ‡®¶‡®ø‡©±‡®§‡®æ ‡®ï‡©ã‡®° ‡®∏‡®º‡®æ‡®Æ‡®≤ ‡®ï‡®∞‡©ã:

    ```cpp
    char resultBuff[16];
    sprintf(resultBuff, "{\"Result\":\"\"}");
    *response_size = strlen(resultBuff);
    *response = (unsigned char *)malloc(*response_size);
    memcpy(*response, resultBuff, *response_size);

    return IOTHUB_CLIENT_OK;
    ```

    ‡®°‡®æ‡®á‡®∞‡©à‡®ï‡®ü ‡®Æ‡©à‡®•‡®° ‡®∞‡®ø‡®ï‡®µ‡©à‡®∏‡®ü‡®æ‡®Ç ‡®®‡©Ç‡©∞ ‡®á‡©±‡®ï ‡®ú‡®µ‡®æ‡®¨ ‡®¶‡©Ä ‡®≤‡©ã‡©ú ‡®π‡©Å‡©∞‡®¶‡©Ä ‡®π‡©à, ‡®Ö‡®§‡©á ‡®ú‡®µ‡®æ‡®¨ ‡®¶‡©ã ‡®π‡®ø‡©±‡®∏‡®ø‡®Ü‡®Ç ‡®µ‡®ø‡©±‡®ö ‡®π‡©Å‡©∞‡®¶‡®æ ‡®π‡©à - ‡®á‡©±‡®ï ‡®ü‡©à‡®ï‡®∏‡®ü ‡®µ‡®ú‡©ã‡®Ç ‡®ú‡®µ‡®æ‡®¨, ‡®Ö‡®§‡©á ‡®á‡©±‡®ï ‡®∞‡®ø‡®ü‡®∞‡®® ‡®ï‡©ã‡®°‡•§ ‡®á‡®π ‡®ï‡©ã‡®° ‡®π‡©á‡®†‡®æ‡®Ç ‡®¶‡®ø‡©±‡®§‡©á JSON ‡®°‡©å‡®ï‡©Ç‡®Æ‡©à‡®Ç‡®ü ‡®µ‡®ú‡©ã‡®Ç ‡®á‡©±‡®ï ‡®®‡®§‡©Ä‡®ú‡®æ ‡®¨‡®£‡®æ‡®è‡®ó‡®æ:

    ```JSON
    {
        "Result": ""
    }
    ```

    ‡®á‡®π ‡®´‡®ø‡®∞ `response` ‡®™‡©à‡®∞‡®æ‡®Æ‡©Ä‡®ü‡®∞ ‡®µ‡®ø‡©±‡®ö ‡®ï‡®æ‡®™‡©Ä ‡®ï‡©Ä‡®§‡®æ ‡®ú‡®æ‡®Ç‡®¶‡®æ ‡®π‡©à, ‡®Ö‡®§‡©á ‡®á‡®∏ ‡®ú‡®µ‡®æ‡®¨ ‡®¶‡®æ ‡®Ü‡®ï‡®æ‡®∞ `response_size` ‡®™‡©à‡®∞‡®æ‡®Æ‡©Ä‡®ü‡®∞ ‡®µ‡®ø‡©±‡®ö ‡®∏‡©à‡®ü ‡®ï‡©Ä‡®§‡®æ ‡®ú‡®æ‡®Ç‡®¶‡®æ ‡®π‡©à‡•§ ‡®á‡®π ‡®ï‡©ã‡®° ‡®´‡®ø‡®∞ `IOTHUB_CLIENT_OK` ‡®∞‡®ø‡®ü‡®∞‡®® ‡®ï‡®∞‡®¶‡®æ ‡®π‡©à, ‡®á‡®π ‡®¶‡®ø‡®ñ‡®æ‡®â‡®£ ‡®≤‡®à ‡®ï‡®ø ‡®Æ‡©à‡®•‡®° ‡®∏‡®π‡©Ä ‡®§‡®∞‡©Ä‡®ï‡©á ‡®®‡®æ‡®≤ ‡®∏‡©∞‡®≠‡®æ‡®≤‡®ø‡®Ü ‡®ó‡®ø‡®Ü ‡®∏‡©Ä‡•§

1. ‡®ï‡®æ‡®≤‡®¨‡©à‡®ï ‡®®‡©Ç‡©∞ ‡®µ‡®æ‡®á‡®∞ ‡®ï‡®∞‡®® ‡®≤‡®à `connectIoTHub` ‡®´‡©∞‡®ï‡®∏‡®º‡®® ‡®¶‡©á ‡®Ö‡©∞‡®§ ‡®µ‡®ø‡©±‡®ö ‡®π‡©á‡®†‡®æ‡®Ç ‡®¶‡®ø‡©±‡®§‡®æ ‡®∏‡®º‡®æ‡®Æ‡®≤ ‡®ï‡®∞‡©ã:

    ```cpp
    IoTHubClient_LL_SetDeviceMethodCallback(_device_ll_handle, directMethodCallback, NULL);
    ```

1. `loop` ‡®´‡©∞‡®ï‡®∏‡®º‡®® `IoTHubDeviceClient_LL_DoWork` ‡®´‡©∞‡®ï‡®∏‡®º‡®® ‡®®‡©Ç‡©∞ IoT Hub ‡®¶‡©Å‡®Ü‡®∞‡®æ ‡®≠‡©á‡®ú‡©á ‡®ó‡®è ‡®á‡®µ‡©à‡®Ç‡®ü‡®∏ ‡®®‡©Ç‡©∞ ‡®™‡©ç‡®∞‡®ï‡®ø‡®∞‡®ø‡®Ü ‡®ï‡®∞‡®® ‡®≤‡®à ‡®ï‡®æ‡®≤ ‡®ï‡®∞‡©á‡®ó‡®æ‡•§ ‡®á‡®π ‡®∏‡®ø‡®∞‡®´ 10 ‡®∏‡®ï‡®ø‡©∞‡®ü ‡®¶‡©á `delay` ‡®ï‡®æ‡®∞‡®® ‡®ï‡®æ‡®≤ ‡®ï‡©Ä‡®§‡®æ ‡®ú‡®æ‡®Ç‡®¶‡®æ ‡®π‡©à, ‡®ú‡®ø‡®∏‡®¶‡®æ ‡®Æ‡®§‡®≤‡®¨ ‡®π‡©à ‡®ï‡®ø ‡®°‡®æ‡®á‡®∞‡©à‡®ï‡®ü ‡®Æ‡©à‡®•‡®° ‡®∏‡®ø‡®∞‡®´ ‡®π‡®∞ 10 ‡®∏‡®ï‡®ø‡©∞‡®ü ‡®µ‡®ø‡©±‡®ö ‡®™‡©ç‡®∞‡®ï‡®ø‡®∞‡®ø‡®Ü ‡®ï‡©Ä‡®§‡©á ‡®ú‡®æ‡®Ç‡®¶‡©á ‡®π‡®®‡•§ ‡®á‡®∏‡®®‡©Ç‡©∞ ‡®µ‡®ß‡©á‡®∞‡©á ‡®ï‡©Å‡®∏‡®º‡®≤ ‡®¨‡®£‡®æ‡®â‡®£ ‡®≤‡®à, 10 ‡®∏‡®ï‡®ø‡©∞‡®ü ‡®¶‡©á `delay` ‡®®‡©Ç‡©∞ ‡®ï‡®à ‡®õ‡©ã‡®ü‡©á `delay` ‡®µ‡®ú‡©ã‡®Ç ‡®≤‡®æ‡®ó‡©Ç ‡®ï‡©Ä‡®§‡®æ ‡®ú‡®æ ‡®∏‡®ï‡®¶‡®æ ‡®π‡©à, ‡®π‡®∞ ‡®µ‡®æ‡®∞ `IoTHubDeviceClient_LL_DoWork` ‡®®‡©Ç‡©∞ ‡®ï‡®æ‡®≤ ‡®ï‡®∞‡®¶‡©á ‡®π‡©ã‡®è‡•§ ‡®á‡®∏‡®®‡©Ç‡©∞ ‡®ï‡®∞‡®® ‡®≤‡®à, `loop` ‡®´‡©∞‡®ï‡®∏‡®º‡®® ‡®¶‡©á ‡®â‡©±‡®™‡®∞ ‡®π‡©á‡®†‡®æ‡®Ç ‡®¶‡®ø‡©±‡®§‡®æ ‡®ï‡©ã‡®° ‡®∏‡®º‡®æ‡®Æ‡®≤ ‡®ï‡®∞‡©ã:

    ```cpp
    void work_delay(int delay_time)
    {
        int current = 0;
        do
        {
            IoTHubDeviceClient_LL_DoWork(_device_ll_handle);
            delay(100);
            current += 100;
        } while (current < delay_time);
    }
    ```

    ‡®á‡®π ‡®ï‡©ã‡®° ‡®µ‡®æ‡®∞-‡®µ‡®æ‡®∞ ‡®≤‡©Ç‡®™ ‡®ï‡®∞‡©á‡®ó‡®æ, `IoTHubDeviceClient_LL_DoWork` ‡®®‡©Ç‡©∞ ‡®ï‡®æ‡®≤ ‡®ï‡®∞‡©á‡®ó‡®æ ‡®Ö‡®§‡©á ‡®π‡®∞ ‡®µ‡®æ‡®∞ 100ms ‡®≤‡®à `delay` ‡®ï‡®∞‡©á‡®ó‡®æ‡•§ ‡®á‡®π ‡®á‡®∏‡®®‡©Ç‡©∞ ‡®ú‡®ø‡©∞‡®®‡®æ ‡®∏‡®Æ‡®æ‡®Ç ‡®≤‡©±‡®ó‡©á‡®ó‡®æ `delay_time` ‡®™‡©à‡®∞‡®æ‡®Æ‡©Ä‡®ü‡®∞ ‡®µ‡®ø‡©±‡®ö ‡®¶‡®ø‡©±‡®§‡©á ‡®∏‡®Æ‡©á‡®Ç ‡®≤‡®à `delay` ‡®ï‡®∞‡®® ‡®≤‡®à‡•§ ‡®á‡®∏‡®¶‡®æ ‡®Æ‡®§‡®≤‡®¨ ‡®π‡©à ‡®ï‡®ø ‡®°‡®ø‡®µ‡®æ‡®à‡®∏ ‡®°‡®æ‡®á‡®∞‡©à‡®ï‡®ü ‡®Æ‡©à‡®•‡®° ‡®∞‡®ø‡®ï‡®µ‡©à‡®∏‡®ü‡®æ‡®Ç ‡®®‡©Ç‡©∞ ‡®™‡©ç‡®∞‡®ï‡®ø‡®∞‡®ø‡®Ü ‡®ï‡®∞‡®® ‡®≤‡®à ‡®µ‡©±‡®ß ‡®§‡©ã‡®Ç ‡®µ‡©±‡®ß 100ms ‡®¶‡©Ä ‡®â‡®°‡©Ä‡®ï ‡®ï‡®∞ ‡®∞‡®ø‡®π‡®æ ‡®π‡©à‡•§

1. `loop` ‡®´‡©∞‡®ï‡®∏‡®º‡®® ‡®µ‡®ø‡©±‡®ö, `IoTHubDeviceClient_LL_DoWork` ‡®®‡©Ç‡©∞ ‡®ï‡®æ‡®≤ ‡®ï‡®∞‡®® ‡®µ‡®æ‡®≤‡©Ä ‡®≤‡®æ‡®à‡®® ‡®π‡®ü‡®æ‡®ì, ‡®Ö‡®§‡©á `delay(10000)` ‡®ï‡®æ‡®≤ ‡®®‡©Ç‡©∞ ‡®π‡©á‡®†‡®æ‡®Ç ‡®¶‡®ø‡©±‡®§‡©á ‡®®‡®æ‡®≤ ‡®¨‡®¶‡®≤‡©ã, ‡®§‡®æ‡®Ç ‡®ú‡©ã ‡®á‡®π ‡®®‡®µ‡®æ‡®Ç ‡®´‡©∞‡®ï‡®∏‡®º‡®® ‡®ï‡®æ‡®≤ ‡®ï‡©Ä‡®§‡®æ ‡®ú‡®æ ‡®∏‡®ï‡©á:

    ```cpp
    work_delay(10000);
    ```

> üíÅ ‡®§‡©Å‡®∏‡©Ä‡®Ç ‡®á‡®π ‡®ï‡©ã‡®° [code/wio-terminal](../../../../../2-farm/lessons/4-migrate-your-plant-to-the-cloud/code/wio-terminal) ‡®´‡©ã‡®≤‡®°‡®∞ ‡®µ‡®ø‡©±‡®ö ‡®™‡®æ ‡®∏‡®ï‡®¶‡©á ‡®π‡©ã‡•§

üòÄ ‡®§‡©Å‡®π‡®æ‡®°‡®æ ‡®Æ‡®ø‡©±‡®ü‡©Ä ‡®¶‡©Ä ‡®®‡®Æ‡©Ä ‡®∏‡©à‡®Ç‡®∏‡®∞ ‡®™‡©ç‡®∞‡©ã‡®ó‡®∞‡®æ‡®Æ ‡®§‡©Å‡®π‡®æ‡®°‡©á IoT Hub ‡®®‡®æ‡®≤ ‡®ú‡©Å‡©ú‡®ø‡®Ü ‡®π‡©ã‡®á‡®Ü ‡®π‡©à!

---

**‡®Ö‡®∏‡®µ‡©Ä‡®ï‡®∞‡®§‡®æ**:  
‡®á‡®π ‡®¶‡®∏‡®§‡®æ‡®µ‡©á‡®ú‡®º AI ‡®Ö‡®®‡©Å‡®µ‡®æ‡®¶ ‡®∏‡©á‡®µ‡®æ [Co-op Translator](https://github.com/Azure/co-op-translator) ‡®¶‡©Ä ‡®µ‡®∞‡®§‡©ã‡®Ç ‡®ï‡®∞‡®ï‡©á ‡®Ö‡®®‡©Å‡®µ‡®æ‡®¶ ‡®ï‡©Ä‡®§‡®æ ‡®ó‡®ø‡®Ü ‡®π‡©à‡•§ ‡®ú‡®¶‡©ã‡®Ç ‡®ï‡®ø ‡®Ö‡®∏‡©Ä‡®Ç ‡®∏‡®π‡©Ä ‡®π‡©ã‡®£ ‡®¶‡©Ä ‡®ï‡©ã‡®∏‡®º‡®ø‡®∏‡®º ‡®ï‡®∞‡®¶‡©á ‡®π‡®æ‡®Ç, ‡®ï‡®ø‡®∞‡®™‡®æ ‡®ï‡®∞‡®ï‡©á ‡®ß‡®ø‡®Ü‡®® ‡®¶‡®ø‡®ì ‡®ï‡®ø ‡®∏‡®µ‡©à‡®ö‡®æ‡®≤‡®ø‡®§ ‡®Ö‡®®‡©Å‡®µ‡®æ‡®¶‡®æ‡®Ç ‡®µ‡®ø‡©±‡®ö ‡®ó‡®≤‡®§‡©Ä‡®Ü‡®Ç ‡®ú‡®æ‡®Ç ‡®Ö‡®∏‡©Å‡®ö‡©±‡®ú‡©á‡®™‡®£ ‡®π‡©ã ‡®∏‡®ï‡®¶‡©á ‡®π‡®®‡•§ ‡®Æ‡©Ç‡®≤ ‡®¶‡®∏‡®§‡®æ‡®µ‡©á‡®ú‡®º, ‡®ú‡©ã ‡®á‡®∏‡®¶‡©Ä ‡®Æ‡©Ç‡®≤ ‡®≠‡®æ‡®∏‡®º‡®æ ‡®µ‡®ø‡©±‡®ö ‡®π‡©à, ‡®®‡©Ç‡©∞ ‡®Ö‡®ß‡®ø‡®ï‡®æ‡®∞‡®§ ‡®∏‡®∞‡©ã‡®§ ‡®Æ‡©∞‡®®‡®ø‡®Ü ‡®ú‡®æ‡®£‡®æ ‡®ö‡®æ‡®π‡©Ä‡®¶‡®æ ‡®π‡©à‡•§ ‡®Æ‡®π‡©±‡®§‡®µ‡®™‡©Ç‡®∞‡®® ‡®ú‡®æ‡®£‡®ï‡®æ‡®∞‡©Ä ‡®≤‡®à, ‡®™‡©á‡®∏‡®º‡©á‡®µ‡®∞ ‡®Æ‡®®‡©Å‡©±‡®ñ‡©Ä ‡®Ö‡®®‡©Å‡®µ‡®æ‡®¶ ‡®¶‡©Ä ‡®∏‡®ø‡®´‡®æ‡®∞‡®∏‡®º ‡®ï‡©Ä‡®§‡©Ä ‡®ú‡®æ‡®Ç‡®¶‡©Ä ‡®π‡©à‡•§ ‡®á‡®∏ ‡®Ö‡®®‡©Å‡®µ‡®æ‡®¶ ‡®¶‡©Ä ‡®µ‡®∞‡®§‡©ã‡®Ç ‡®§‡©ã‡®Ç ‡®™‡©à‡®¶‡®æ ‡®π‡©ã‡®£ ‡®µ‡®æ‡®≤‡©á ‡®ï‡®ø‡®∏‡©á ‡®µ‡©Ä ‡®ó‡®≤‡®§‡®´‡®π‡®ø‡®Æ‡©Ä ‡®ú‡®æ‡®Ç ‡®ó‡®≤‡®§ ‡®µ‡®ø‡®Ü‡®ñ‡®ø‡®Ü ‡®≤‡®à ‡®Ö‡®∏‡©Ä‡®Ç ‡®ú‡®º‡®ø‡©∞‡®Æ‡©á‡®µ‡®æ‡®∞ ‡®®‡®π‡©Ä‡®Ç ‡®π‡®æ‡®Ç‡•§