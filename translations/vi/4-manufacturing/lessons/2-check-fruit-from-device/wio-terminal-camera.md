<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "160be8c0f558687f6686dca64f10f739",
  "translation_date": "2025-08-27T21:04:06+00:00",
  "source_file": "4-manufacturing/lessons/2-check-fruit-from-device/wio-terminal-camera.md",
  "language_code": "vi"
}
-->
# Ch·ª•p ·∫£nh - Wio Terminal

Trong ph·∫ßn n√†y c·ªßa b√†i h·ªçc, b·∫°n s·∫Ω th√™m m·ªôt camera v√†o Wio Terminal c·ªßa m√¨nh v√† ch·ª•p ·∫£nh t·ª´ n√≥.

## Ph·∫ßn c·ª©ng

Wio Terminal c·∫ßn m·ªôt camera.

Camera b·∫°n s·∫Ω s·ª≠ d·ª•ng l√† [ArduCam Mini 2MP Plus](https://www.arducam.com/product/arducam-2mp-spi-camera-b0067-arduino/). ƒê√¢y l√† m·ªôt camera 2 megapixel d·ª±a tr√™n c·∫£m bi·∫øn h√¨nh ·∫£nh OV2640. N√≥ giao ti·∫øp qua giao di·ªán SPI ƒë·ªÉ ch·ª•p ·∫£nh v√† s·ª≠ d·ª•ng I2C ƒë·ªÉ c·∫•u h√¨nh c·∫£m bi·∫øn.

## K·∫øt n·ªëi camera

ArduCam kh√¥ng c√≥ c·ªïng Grove, thay v√†o ƒë√≥ n√≥ k·∫øt n·ªëi v·ªõi c·∫£ bus SPI v√† I2C th√¥ng qua c√°c ch√¢n GPIO tr√™n Wio Terminal.

### Nhi·ªám v·ª• - k·∫øt n·ªëi camera

K·∫øt n·ªëi camera.

![M·ªôt c·∫£m bi·∫øn ArduCam](../../../../../translated_images/arducam.20e4e4cbb268296570b5914e20d6c349fc42ddac9ed4e1b9deba2188204eebae.vi.png)

1. C√°c ch√¢n ·ªü ƒë√°y c·ªßa ArduCam c·∫ßn ƒë∆∞·ª£c k·∫øt n·ªëi v·ªõi c√°c ch√¢n GPIO tr√™n Wio Terminal. ƒê·ªÉ d·ªÖ d√†ng t√¨m ƒë√∫ng ch√¢n, h√£y g·∫Øn nh√£n d√°n ch√¢n GPIO ƒëi k√®m v·ªõi Wio Terminal xung quanh c√°c ch√¢n:

    ![Wio Terminal v·ªõi nh√£n d√°n ch√¢n GPIO](../../../../../translated_images/wio-terminal-pin-sticker.b90b1535937b84bd00d853f0004aea74fac2aec04b43f14b887796b2633f855e.vi.png)

1. S·ª≠ d·ª•ng d√¢y nh·∫£y, th·ª±c hi·ªán c√°c k·∫øt n·ªëi sau:

    | Ch√¢n ArduCAM | Ch√¢n Wio Terminal | M√¥ t·∫£                                   |
    | ------------ | ----------------- | --------------------------------------- |
    | CS           | 24 (SPI_CS)       | SPI Chip Select                         |
    | MOSI         | 19 (SPI_MOSI)     | SPI Controller Output, Peripheral Input |
    | MISO         | 21 (SPI_MISO)     | SPI Controller Input, Peripheral Output |
    | SCK          | 23 (SPI_SCLK)     | SPI Serial Clock                        |
    | GND          | 6 (GND)           | Ground - 0V                             |
    | VCC          | 4 (5V)            | Ngu·ªìn ƒëi·ªán 5V                           |
    | SDA          | 3 (I2C1_SDA)      | I2C Serial Data                         |
    | SCL          | 5 (I2C1_SCL)      | I2C Serial Clock                        |

    ![Wio Terminal ƒë∆∞·ª£c k·∫øt n·ªëi v·ªõi ArduCam b·∫±ng d√¢y nh·∫£y](../../../../../translated_images/arducam-wio-terminal-connections.a4d5a4049bdb5ab800a2877389fc6ecf5e4ff307e6451ff56c517e6786467d0a.vi.png)

    K·∫øt n·ªëi GND v√† VCC cung c·∫•p ngu·ªìn ƒëi·ªán 5V cho ArduCam. N√≥ ho·∫°t ƒë·ªông ·ªü 5V, kh√¥ng gi·ªëng nh∆∞ c√°c c·∫£m bi·∫øn Grove ho·∫°t ƒë·ªông ·ªü 3V. Ngu·ªìn ƒëi·ªán n√†y ƒë∆∞·ª£c cung c·∫•p tr·ª±c ti·∫øp t·ª´ k·∫øt n·ªëi USB-C c·∫•p ngu·ªìn cho thi·∫øt b·ªã.

    > üíÅ ƒê·ªëi v·ªõi k·∫øt n·ªëi SPI, c√°c nh√£n ch√¢n tr√™n ArduCam v√† t√™n ch√¢n Wio Terminal ƒë∆∞·ª£c s·ª≠ d·ª•ng trong m√£ v·∫´n s·ª≠ d·ª•ng quy ∆∞·ªõc ƒë·∫∑t t√™n c≈©. C√°c h∆∞·ªõng d·∫´n trong b√†i h·ªçc n√†y s·∫Ω s·ª≠ d·ª•ng quy ∆∞·ªõc ƒë·∫∑t t√™n m·ªõi, ngo·∫°i tr·ª´ khi t√™n ch√¢n ƒë∆∞·ª£c s·ª≠ d·ª•ng trong m√£.

1. B√¢y gi·ªù b·∫°n c√≥ th·ªÉ k·∫øt n·ªëi Wio Terminal v·ªõi m√°y t√≠nh c·ªßa m√¨nh.

## L·∫≠p tr√¨nh thi·∫øt b·ªã ƒë·ªÉ k·∫øt n·ªëi v·ªõi camera

Wio Terminal b√¢y gi·ªù c√≥ th·ªÉ ƒë∆∞·ª£c l·∫≠p tr√¨nh ƒë·ªÉ s·ª≠ d·ª•ng camera ArduCAM ƒë√£ ƒë∆∞·ª£c g·∫Øn.

### Nhi·ªám v·ª• - l·∫≠p tr√¨nh thi·∫øt b·ªã ƒë·ªÉ k·∫øt n·ªëi v·ªõi camera

1. T·∫°o m·ªôt d·ª± √°n Wio Terminal m·ªõi b·∫±ng PlatformIO. ƒê·∫∑t t√™n d·ª± √°n n√†y l√† `fruit-quality-detector`. Th√™m m√£ v√†o h√†m `setup` ƒë·ªÉ c·∫•u h√¨nh c·ªïng n·ªëi ti·∫øp.

1. Th√™m m√£ ƒë·ªÉ k·∫øt n·ªëi WiFi, v·ªõi th√¥ng tin ƒëƒÉng nh·∫≠p WiFi c·ªßa b·∫°n trong m·ªôt t·ªáp c√≥ t√™n `config.h`. ƒê·ª´ng qu√™n th√™m c√°c th∆∞ vi·ªán c·∫ßn thi·∫øt v√†o t·ªáp `platformio.ini`.

1. Th∆∞ vi·ªán ArduCam kh√¥ng c√≥ s·∫µn d∆∞·ªõi d·∫°ng th∆∞ vi·ªán Arduino c√≥ th·ªÉ ƒë∆∞·ª£c c√†i ƒë·∫∑t t·ª´ t·ªáp `platformio.ini`. Thay v√†o ƒë√≥, n√≥ c·∫ßn ƒë∆∞·ª£c c√†i ƒë·∫∑t t·ª´ m√£ ngu·ªìn tr√™n trang GitHub c·ªßa h·ªç. B·∫°n c√≥ th·ªÉ l·∫•y n√≥ b·∫±ng c√°ch:

    * Clone repo t·ª´ [https://github.com/ArduCAM/Arduino.git](https://github.com/ArduCAM/Arduino.git)
    * Truy c·∫≠p repo tr√™n GitHub t·∫°i [github.com/ArduCAM/Arduino](https://github.com/ArduCAM/Arduino) v√† t·∫£i m√£ d∆∞·ªõi d·∫°ng t·ªáp zip t·ª´ n√∫t **Code**

1. B·∫°n ch·ªâ c·∫ßn th∆∞ m·ª•c `ArduCAM` t·ª´ m√£ n√†y. Sao ch√©p to√†n b·ªô th∆∞ m·ª•c v√†o th∆∞ m·ª•c `lib` trong d·ª± √°n c·ªßa b·∫°n.

    > ‚ö†Ô∏è To√†n b·ªô th∆∞ m·ª•c ph·∫£i ƒë∆∞·ª£c sao ch√©p, v√¨ v·∫≠y m√£ n·∫±m trong `lib/ArduCam`. ƒê·ª´ng ch·ªâ sao ch√©p n·ªôi dung c·ªßa th∆∞ m·ª•c `ArduCam` v√†o th∆∞ m·ª•c `lib`, h√£y sao ch√©p to√†n b·ªô th∆∞ m·ª•c.

1. M√£ th∆∞ vi·ªán ArduCam ho·∫°t ƒë·ªông cho nhi·ªÅu lo·∫°i camera. Lo·∫°i camera b·∫°n mu·ªën s·ª≠ d·ª•ng ƒë∆∞·ª£c c·∫•u h√¨nh b·∫±ng c√°c c·ªù tr√¨nh bi√™n d·ªãch - ƒëi·ªÅu n√†y gi√∫p th∆∞ vi·ªán ƒë∆∞·ª£c x√¢y d·ª±ng nh·ªè nh·∫•t c√≥ th·ªÉ b·∫±ng c√°ch lo·∫°i b·ªè m√£ cho c√°c camera b·∫°n kh√¥ng s·ª≠ d·ª•ng. ƒê·ªÉ c·∫•u h√¨nh th∆∞ vi·ªán cho camera OV2640, th√™m ƒëo·∫°n sau v√†o cu·ªëi t·ªáp `platformio.ini`:

    ```ini
    build_flags =
        -DARDUCAM_SHIELD_V2
        -DOV2640_CAM
    ```

    ƒêi·ªÅu n√†y thi·∫øt l·∫≠p 2 c·ªù tr√¨nh bi√™n d·ªãch:

      * `ARDUCAM_SHIELD_V2` ƒë·ªÉ th√¥ng b√°o cho th∆∞ vi·ªán r·∫±ng camera n·∫±m tr√™n m·ªôt bo m·∫°ch Arduino, ƒë∆∞·ª£c g·ªçi l√† shield.
      * `OV2640_CAM` ƒë·ªÉ th√¥ng b√°o cho th∆∞ vi·ªán ch·ªâ bao g·ªìm m√£ cho camera OV2640.

1. Th√™m m·ªôt t·ªáp ti√™u ƒë·ªÅ v√†o th∆∞ m·ª•c `src` c√≥ t√™n `camera.h`. T·ªáp n√†y s·∫Ω ch·ª©a m√£ ƒë·ªÉ giao ti·∫øp v·ªõi camera. Th√™m ƒëo·∫°n m√£ sau v√†o t·ªáp n√†y:

    ```cpp
    #pragma once
    
    #include <ArduCAM.h>
    #include <Wire.h>
    
    class Camera
    {
    public:
        Camera(int format, int image_size) : _arducam(OV2640, PIN_SPI_SS)
        {
            _format = format;
            _image_size = image_size;
        }
    
        bool init()
        {
            // Reset the CPLD
            _arducam.write_reg(0x07, 0x80);
            delay(100);
    
            _arducam.write_reg(0x07, 0x00);
            delay(100);
    
            // Check if the ArduCAM SPI bus is OK
            _arducam.write_reg(ARDUCHIP_TEST1, 0x55);
            if (_arducam.read_reg(ARDUCHIP_TEST1) != 0x55)
            {
                return false;
            }
                
            // Change MCU mode
            _arducam.set_mode(MCU2LCD_MODE);
    
            uint8_t vid, pid;
    
            // Check if the camera module type is OV2640
            _arducam.wrSensorReg8_8(0xff, 0x01);
            _arducam.rdSensorReg8_8(OV2640_CHIPID_HIGH, &vid);
            _arducam.rdSensorReg8_8(OV2640_CHIPID_LOW, &pid);
            if ((vid != 0x26) && ((pid != 0x41) || (pid != 0x42)))
            {
                return false;
            }
            
            _arducam.set_format(_format);
            _arducam.InitCAM();
            _arducam.OV2640_set_JPEG_size(_image_size);
            _arducam.OV2640_set_Light_Mode(Auto);
            _arducam.OV2640_set_Special_effects(Normal);
            delay(1000);
    
            return true;
        }
    
        void startCapture()
        {
            _arducam.flush_fifo();
            _arducam.clear_fifo_flag();
            _arducam.start_capture();
        }
    
        bool captureReady()
        {
            return _arducam.get_bit(ARDUCHIP_TRIG, CAP_DONE_MASK);
        }
    
        bool readImageToBuffer(byte **buffer, uint32_t &buffer_length)
        {
            if (!captureReady()) return false;
    
            // Get the image file length
            uint32_t length = _arducam.read_fifo_length();
            buffer_length = length;
    
            if (length >= MAX_FIFO_SIZE)
            {
                return false;
            }
            if (length == 0)
            {
                return false;
            }
    
            // create the buffer
            byte *buf = new byte[length];
    
            uint8_t temp = 0, temp_last = 0;
            int i = 0;
            uint32_t buffer_pos = 0;
            bool is_header = false;
    
            _arducam.CS_LOW();
            _arducam.set_fifo_burst();
            
            while (length--)
            {
                temp_last = temp;
                temp = SPI.transfer(0x00);
                //Read JPEG data from FIFO
                if ((temp == 0xD9) && (temp_last == 0xFF)) //If find the end ,break while,
                {
                    buf[buffer_pos] = temp;
    
                    buffer_pos++;
                    i++;
                    
                    _arducam.CS_HIGH();
                }
                if (is_header == true)
                {
                    //Write image data to buffer if not full
                    if (i < 256)
                    {
                        buf[buffer_pos] = temp;
                        buffer_pos++;
                        i++;
                    }
                    else
                    {
                        _arducam.CS_HIGH();
    
                        i = 0;
                        buf[buffer_pos] = temp;
    
                        buffer_pos++;
                        i++;
    
                        _arducam.CS_LOW();
                        _arducam.set_fifo_burst();
                    }
                }
                else if ((temp == 0xD8) & (temp_last == 0xFF))
                {
                    is_header = true;
    
                    buf[buffer_pos] = temp_last;
                    buffer_pos++;
                    i++;
    
                    buf[buffer_pos] = temp;
                    buffer_pos++;
                    i++;
                }
            }
            
            _arducam.clear_fifo_flag();
    
            _arducam.set_format(_format);
            _arducam.InitCAM();
            _arducam.OV2640_set_JPEG_size(_image_size);
    
            // return the buffer
            *buffer = buf;
        }
    
    private:
        ArduCAM _arducam;
        int _format;
        int _image_size;
    };
    ```

    ƒê√¢y l√† m√£ c·∫•p th·∫•p c·∫•u h√¨nh camera b·∫±ng c√°ch s·ª≠ d·ª•ng c√°c th∆∞ vi·ªán ArduCam v√† tr√≠ch xu·∫•t h√¨nh ·∫£nh khi c·∫ßn thi·∫øt b·∫±ng bus SPI. M√£ n√†y r·∫•t c·ª• th·ªÉ cho ArduCam, v√¨ v·∫≠y b·∫°n kh√¥ng c·∫ßn lo l·∫Øng v·ªÅ c√°ch n√≥ ho·∫°t ƒë·ªông ·ªü th·ªùi ƒëi·ªÉm n√†y.

1. Trong `main.cpp`, th√™m ƒëo·∫°n m√£ sau b√™n d∆∞·ªõi c√°c c√¢u l·ªánh `include` kh√°c ƒë·ªÉ bao g·ªìm t·ªáp m·ªõi n√†y v√† t·∫°o m·ªôt th·ªÉ hi·ªán c·ªßa l·ªõp camera:

    ```cpp
    #include "camera.h"

    Camera camera = Camera(JPEG, OV2640_640x480);
    ```

    ƒêi·ªÅu n√†y t·∫°o m·ªôt `Camera` l∆∞u h√¨nh ·∫£nh d∆∞·ªõi d·∫°ng JPEG v·ªõi ƒë·ªô ph√¢n gi·∫£i 640 x 480. M·∫∑c d√π c√°c ƒë·ªô ph√¢n gi·∫£i cao h∆°n ƒë∆∞·ª£c h·ªó tr·ª£ (l√™n ƒë·∫øn 3280x2464), b·ªô ph√¢n lo·∫°i h√¨nh ·∫£nh ho·∫°t ƒë·ªông tr√™n c√°c h√¨nh ·∫£nh nh·ªè h∆°n nhi·ªÅu (227x227) n√™n kh√¥ng c·∫ßn ch·ª•p v√† g·ª≠i c√°c h√¨nh ·∫£nh l·ªõn h∆°n.

1. Th√™m ƒëo·∫°n m√£ sau b√™n d∆∞·ªõi ƒë·ªÉ ƒë·ªãnh nghƒ©a m·ªôt h√†m thi·∫øt l·∫≠p camera:

    ```cpp
    void setupCamera()
    {
        pinMode(PIN_SPI_SS, OUTPUT);
        digitalWrite(PIN_SPI_SS, HIGH);
    
        Wire.begin();
        SPI.begin();
    
        if (!camera.init())
        {
            Serial.println("Error setting up the camera!");
        }
    }
    ```

    H√†m `setupCamera` n√†y b·∫Øt ƒë·∫ßu b·∫±ng c√°ch c·∫•u h√¨nh ch√¢n SPI chip select (`PIN_SPI_SS`) ·ªü m·ª©c cao, l√†m cho Wio Terminal tr·ªü th√†nh b·ªô ƒëi·ªÅu khi·ªÉn SPI. Sau ƒë√≥, n√≥ kh·ªüi ƒë·ªông c√°c bus I2C v√† SPI. Cu·ªëi c√πng, n√≥ kh·ªüi t·∫°o l·ªõp camera, c·∫•u h√¨nh c√°c c√†i ƒë·∫∑t c·∫£m bi·∫øn camera v√† ƒë·∫£m b·∫£o m·ªçi th·ª© ƒë∆∞·ª£c k·∫øt n·ªëi ƒë√∫ng c√°ch.

1. G·ªçi h√†m n√†y ·ªü cu·ªëi h√†m `setup`:

    ```cpp
    setupCamera();
    ```

1. X√¢y d·ª±ng v√† t·∫£i m√£ n√†y l√™n, sau ƒë√≥ ki·ªÉm tra ƒë·∫ßu ra t·ª´ m√†n h√¨nh n·ªëi ti·∫øp. N·∫øu b·∫°n th·∫•y `Error setting up the camera!`, h√£y ki·ªÉm tra l·∫°i d√¢y n·ªëi ƒë·ªÉ ƒë·∫£m b·∫£o t·∫•t c·∫£ c√°c d√¢y c√°p ƒëang k·∫øt n·ªëi ƒë√∫ng ch√¢n tr√™n ArduCam v·ªõi ƒë√∫ng ch√¢n GPIO tr√™n Wio Terminal, v√† t·∫•t c·∫£ c√°c d√¢y nh·∫£y ƒë∆∞·ª£c c·∫Øm ch·∫Øc ch·∫Øn.

## Ch·ª•p ·∫£nh

Wio Terminal b√¢y gi·ªù c√≥ th·ªÉ ƒë∆∞·ª£c l·∫≠p tr√¨nh ƒë·ªÉ ch·ª•p ·∫£nh khi m·ªôt n√∫t ƒë∆∞·ª£c nh·∫•n.

### Nhi·ªám v·ª• - ch·ª•p ·∫£nh

1. C√°c vi ƒëi·ªÅu khi·ªÉn ch·∫°y m√£ c·ªßa b·∫°n li√™n t·ª•c, v√¨ v·∫≠y kh√¥ng d·ªÖ d√†ng ƒë·ªÉ k√≠ch ho·∫°t m·ªôt h√†nh ƒë·ªông nh∆∞ ch·ª•p ·∫£nh m√† kh√¥ng ph·∫£n ·ª©ng v·ªõi m·ªôt c·∫£m bi·∫øn. Wio Terminal c√≥ c√°c n√∫t, v√¨ v·∫≠y camera c√≥ th·ªÉ ƒë∆∞·ª£c thi·∫øt l·∫≠p ƒë·ªÉ k√≠ch ho·∫°t b·ªüi m·ªôt trong c√°c n√∫t. Th√™m ƒëo·∫°n m√£ sau v√†o cu·ªëi h√†m `setup` ƒë·ªÉ c·∫•u h√¨nh n√∫t C (m·ªôt trong ba n√∫t ·ªü tr√™n c√πng, n√∫t g·∫ßn c√¥ng t·∫Øc ngu·ªìn nh·∫•t).

    ![N√∫t C ·ªü tr√™n c√πng g·∫ßn c√¥ng t·∫Øc ngu·ªìn](../../../../../translated_images/wio-terminal-c-button.73df3cb1c1445ea07ee98316af0e7925fcb43135df0abed58d3d4822b2589c3b.vi.png)

    ```cpp
    pinMode(WIO_KEY_C, INPUT_PULLUP);
    ```

    Ch·∫ø ƒë·ªô `INPUT_PULLUP` th·ª±c ch·∫•t ƒë·∫£o ng∆∞·ª£c m·ªôt ƒë·∫ßu v√†o. V√≠ d·ª•, th√¥ng th∆∞·ªùng m·ªôt n√∫t s·∫Ω g·ª≠i t√≠n hi·ªáu th·∫•p khi kh√¥ng ƒë∆∞·ª£c nh·∫•n v√† t√≠n hi·ªáu cao khi ƒë∆∞·ª£c nh·∫•n. Khi ƒë∆∞·ª£c ƒë·∫∑t th√†nh `INPUT_PULLUP`, ch√∫ng g·ª≠i t√≠n hi·ªáu cao khi kh√¥ng ƒë∆∞·ª£c nh·∫•n v√† t√≠n hi·ªáu th·∫•p khi ƒë∆∞·ª£c nh·∫•n.

1. Th√™m m·ªôt h√†m tr·ªëng ƒë·ªÉ ph·∫£n h·ªìi khi n√∫t ƒë∆∞·ª£c nh·∫•n tr∆∞·ªõc h√†m `loop`:

    ```cpp
    void buttonPressed()
    {
        
    }
    ```

1. G·ªçi h√†m n√†y trong ph∆∞∆°ng th·ª©c `loop` khi n√∫t ƒë∆∞·ª£c nh·∫•n:

    ```cpp
    void loop()
    {
        if (digitalRead(WIO_KEY_C) == LOW)
        {
            buttonPressed();
            delay(2000);
        }
    
        delay(200);
    }
    ```

    ƒêo·∫°n m√£ n√†y ki·ªÉm tra xem n√∫t c√≥ ƒë∆∞·ª£c nh·∫•n hay kh√¥ng. N·∫øu ƒë∆∞·ª£c nh·∫•n, h√†m `buttonPressed` s·∫Ω ƒë∆∞·ª£c g·ªçi v√† v√≤ng l·∫∑p s·∫Ω t·∫°m d·ª´ng trong 2 gi√¢y. ƒêi·ªÅu n√†y ƒë·ªÉ cho ph√©p th·ªùi gian ƒë·ªÉ n√∫t ƒë∆∞·ª£c nh·∫£ ra ƒë·ªÉ m·ªôt l·∫ßn nh·∫•n d√†i kh√¥ng ƒë∆∞·ª£c ƒëƒÉng k√Ω hai l·∫ßn.

    > üíÅ N√∫t tr√™n Wio Terminal ƒë∆∞·ª£c ƒë·∫∑t th√†nh `INPUT_PULLUP`, v√¨ v·∫≠y g·ª≠i t√≠n hi·ªáu cao khi kh√¥ng ƒë∆∞·ª£c nh·∫•n v√† t√≠n hi·ªáu th·∫•p khi ƒë∆∞·ª£c nh·∫•n.

1. Th√™m ƒëo·∫°n m√£ sau v√†o h√†m `buttonPressed`:

    ```cpp
    camera.startCapture();
 
    while (!camera.captureReady())
        delay(100);

    Serial.println("Image captured");

    byte *buffer;
    uint32_t length;

    if (camera.readImageToBuffer(&buffer, length))
    {
        Serial.print("Image read to buffer with length ");
        Serial.println(length);

        delete(buffer);
    }
    ```

    ƒêo·∫°n m√£ n√†y b·∫Øt ƒë·∫ßu ch·ª•p ·∫£nh b·∫±ng c√°ch g·ªçi `startCapture`. Ph·∫ßn c·ª©ng camera kh√¥ng ho·∫°t ƒë·ªông b·∫±ng c√°ch tr·∫£ v·ªÅ d·ªØ li·ªáu khi b·∫°n y√™u c·∫ßu, thay v√†o ƒë√≥ b·∫°n g·ª≠i m·ªôt l·ªánh ƒë·ªÉ b·∫Øt ƒë·∫ßu ch·ª•p, v√† camera s·∫Ω ho·∫°t ƒë·ªông trong n·ªÅn ƒë·ªÉ ch·ª•p ·∫£nh, chuy·ªÉn ƒë·ªïi n√≥ th√†nh JPEG v√† l∆∞u tr·ªØ trong m·ªôt b·ªô ƒë·ªám c·ª•c b·ªô tr√™n ch√≠nh camera. L·ªánh `captureReady` sau ƒë√≥ ki·ªÉm tra xem vi·ªác ch·ª•p ·∫£nh ƒë√£ ho√†n th√†nh hay ch∆∞a.

    Khi vi·ªác ch·ª•p ƒë√£ ho√†n th√†nh, d·ªØ li·ªáu h√¨nh ·∫£nh ƒë∆∞·ª£c sao ch√©p t·ª´ b·ªô ƒë·ªám tr√™n camera v√†o m·ªôt b·ªô ƒë·ªám c·ª•c b·ªô (m·∫£ng byte) v·ªõi l·ªánh `readImageToBuffer`. ƒê·ªô d√†i c·ªßa b·ªô ƒë·ªám sau ƒë√≥ ƒë∆∞·ª£c g·ª≠i ƒë·∫øn m√†n h√¨nh n·ªëi ti·∫øp.

1. X√¢y d·ª±ng v√† t·∫£i m√£ n√†y l√™n, sau ƒë√≥ ki·ªÉm tra ƒë·∫ßu ra tr√™n m√†n h√¨nh n·ªëi ti·∫øp. M·ªói l·∫ßn b·∫°n nh·∫•n n√∫t C, m·ªôt h√¨nh ·∫£nh s·∫Ω ƒë∆∞·ª£c ch·ª•p v√† b·∫°n s·∫Ω th·∫•y k√≠ch th∆∞·ªõc h√¨nh ·∫£nh ƒë∆∞·ª£c g·ª≠i ƒë·∫øn m√†n h√¨nh n·ªëi ti·∫øp.

    ```output
    Connecting to WiFi..
    Connected!
    Image captured
    Image read to buffer with length 9224
    Image captured
    Image read to buffer with length 11272
    ```

    C√°c h√¨nh ·∫£nh kh√°c nhau s·∫Ω c√≥ k√≠ch th∆∞·ªõc kh√°c nhau. Ch√∫ng ƒë∆∞·ª£c n√©n d∆∞·ªõi d·∫°ng JPEG v√† k√≠ch th∆∞·ªõc c·ªßa t·ªáp JPEG cho m·ªôt ƒë·ªô ph√¢n gi·∫£i nh·∫•t ƒë·ªãnh ph·ª• thu·ªôc v√†o n·ªôi dung trong h√¨nh ·∫£nh.

> üíÅ B·∫°n c√≥ th·ªÉ t√¨m th·∫•y m√£ n√†y trong th∆∞ m·ª•c [code-camera/wio-terminal](../../../../../4-manufacturing/lessons/2-check-fruit-from-device/code-camera/wio-terminal).

üòÄ B·∫°n ƒë√£ ch·ª•p ·∫£nh th√†nh c√¥ng v·ªõi Wio Terminal c·ªßa m√¨nh.

## T√πy ch·ªçn - x√°c minh h√¨nh ·∫£nh camera b·∫±ng th·∫ª SD

C√°ch d·ªÖ nh·∫•t ƒë·ªÉ xem c√°c h√¨nh ·∫£nh ƒë∆∞·ª£c ch·ª•p b·ªüi camera l√† ghi ch√∫ng v√†o th·∫ª SD trong Wio Terminal v√† sau ƒë√≥ xem ch√∫ng tr√™n m√°y t√≠nh c·ªßa b·∫°n. Th·ª±c hi·ªán b∆∞·ªõc n√†y n·∫øu b·∫°n c√≥ m·ªôt th·∫ª microSD d·ª± ph√≤ng v√† m·ªôt khe c·∫Øm th·∫ª microSD tr√™n m√°y t√≠nh c·ªßa b·∫°n ho·∫∑c m·ªôt b·ªô chuy·ªÉn ƒë·ªïi.

Wio Terminal ch·ªâ h·ªó tr·ª£ th·∫ª microSD c√≥ dung l∆∞·ª£ng t·ªëi ƒëa 16GB. N·∫øu b·∫°n c√≥ th·∫ª SD l·ªõn h∆°n, n√≥ s·∫Ω kh√¥ng ho·∫°t ƒë·ªông.

### Nhi·ªám v·ª• - x√°c minh h√¨nh ·∫£nh camera b·∫±ng th·∫ª SD

1. ƒê·ªãnh d·∫°ng m·ªôt th·∫ª microSD d∆∞·ªõi d·∫°ng FAT32 ho·∫∑c exFAT b·∫±ng c√°c ·ª©ng d·ª•ng li√™n quan tr√™n m√°y t√≠nh c·ªßa b·∫°n (Disk Utility tr√™n macOS, File Explorer tr√™n Windows, ho·∫∑c s·ª≠ d·ª•ng c√°c c√¥ng c·ª• d√≤ng l·ªánh tr√™n Linux).

1. Ch√®n th·∫ª microSD v√†o khe c·∫Øm ngay b√™n d∆∞·ªõi c√¥ng t·∫Øc ngu·ªìn. ƒê·∫£m b·∫£o n√≥ ƒë∆∞·ª£c ƒë·∫©y v√†o ho√†n to√†n cho ƒë·∫øn khi n√≥ k√™u "click" v√† gi·ªØ nguy√™n v·ªã tr√≠, b·∫°n c√≥ th·ªÉ c·∫ßn ƒë·∫©y n√≥ b·∫±ng m√≥ng tay ho·∫∑c m·ªôt c√¥ng c·ª• m·ªèng.

1. Th√™m c√°c c√¢u l·ªánh `include` sau v√†o ƒë·∫ßu t·ªáp `main.cpp`:

    ```cpp
    #include "SD/Seeed_SD.h"
    #include <Seeed_FS.h>
    ```

1. Th√™m h√†m sau tr∆∞·ªõc h√†m `setup`:

    ```cpp
    void setupSDCard()
    {
        while (!SD.begin(SDCARD_SS_PIN, SDCARD_SPI))
        {
            Serial.println("SD Card Error");
        }
    }
    ```

    H√†m n√†y c·∫•u h√¨nh th·∫ª SD b·∫±ng bus SPI.

1. G·ªçi h√†m n√†y t·ª´ h√†m `setup`:

    ```cpp
    setupSDCard();
    ```

1. Th√™m ƒëo·∫°n m√£ sau ph√≠a tr√™n h√†m `buttonPressed`:

    ```cpp
    int fileNum = 1;

    void saveToSDCard(byte *buffer, uint32_t length)
    {
        char buff[16];
        sprintf(buff, "%d.jpg", fileNum);
        fileNum++;
    
        File outFile = SD.open(buff, FILE_WRITE );
        outFile.write(buffer, length);
        outFile.close();

        Serial.print("Image written to file ");
        Serial.println(buff);
    }
    ```

    ƒêo·∫°n m√£ n√†y ƒë·ªãnh nghƒ©a m·ªôt bi·∫øn to√†n c·ª•c cho s·ªë l∆∞·ª£ng t·ªáp. Bi·∫øn n√†y ƒë∆∞·ª£c s·ª≠ d·ª•ng cho t√™n t·ªáp h√¨nh ·∫£nh ƒë·ªÉ nhi·ªÅu h√¨nh ·∫£nh c√≥ th·ªÉ ƒë∆∞·ª£c ch·ª•p v·ªõi c√°c t√™n t·ªáp tƒÉng d·∫ßn - `1.jpg`, `2.jpg` v√† c·ª© th·∫ø.

    Sau ƒë√≥, n√≥ ƒë·ªãnh nghƒ©a h√†m `saveToSDCard` nh·∫≠n m·ªôt b·ªô ƒë·ªám d·ªØ li·ªáu byte v√† ƒë·ªô d√†i c·ªßa b·ªô ƒë·ªám. M·ªôt t√™n t·ªáp ƒë∆∞·ª£c t·∫°o b·∫±ng s·ªë l∆∞·ª£ng t·ªáp, v√† s·ªë l∆∞·ª£ng t·ªáp ƒë∆∞·ª£c tƒÉng l√™n s·∫µn s√†ng cho t·ªáp ti·∫øp theo. D·ªØ li·ªáu nh·ªã ph√¢n t·ª´ b·ªô ƒë·ªám sau ƒë√≥ ƒë∆∞·ª£c ghi v√†o t·ªáp.

1. G·ªçi h√†m `saveToSDCard` t·ª´ h√†m `buttonPressed`. L·ªánh g·ªçi n√†y n√™n **tr∆∞·ªõc** khi b·ªô ƒë·ªám b·ªã x√≥a:

    ```cpp
    Serial.print("Image read to buffer with length ");
    Serial.println(length);

    saveToSDCard(buffer, length);
    
    delete(buffer);
    ```

1. X√¢y d·ª±ng v√† t·∫£i m√£ n√†y l√™n, sau ƒë√≥ ki·ªÉm tra ƒë·∫ßu ra tr√™n m√†n h√¨nh n·ªëi ti·∫øp. M·ªói l·∫ßn b·∫°n nh·∫•n n√∫t C, m·ªôt h√¨nh ·∫£nh s·∫Ω ƒë∆∞·ª£c ch·ª•p v√† l∆∞u v√†o th·∫ª SD.

    ```output
    Connecting to WiFi..
    Connected!
    Image captured
    Image read to buffer with length 16392
    Image written to file 1.jpg
    Image captured
    Image read to buffer with length 14344
    Image written to file 2.jpg
    ```

1. T·∫Øt ngu·ªìn Wio Terminal v√† th√°o th·∫ª microSD b·∫±ng c√°ch ƒë·∫©y nh·∫π v√†o v√† th·∫£ ra, th·∫ª s·∫Ω b·∫≠t ra. B·∫°n c√≥ th·ªÉ c·∫ßn s·ª≠ d·ª•ng m·ªôt c√¥ng c·ª• m·ªèng ƒë·ªÉ l√†m ƒëi·ªÅu n√†y. C·∫Øm th·∫ª microSD v√†o m√°y t√≠nh c·ªßa b·∫°n ƒë·ªÉ xem c√°c h√¨nh ·∫£nh.

    ![H√¨nh ·∫£nh m·ªôt qu·∫£ chu·ªëi ƒë∆∞·ª£c ch·ª•p b·∫±ng ArduCam](../../../../../translated_images/banana-arducam.be1b32d4267a8194b0fd042362e56faa431da9cd4af172051b37243ea9be0256.vi.jpg)
> üíÅ C√≥ th·ªÉ m·∫•t v√†i h√¨nh ·∫£nh ƒë·ªÉ c√¢n b·∫±ng tr·∫Øng c·ªßa m√°y ·∫£nh t·ª± ƒëi·ªÅu ch·ªânh. B·∫°n s·∫Ω nh·∫≠n th·∫•y ƒëi·ªÅu n√†y d·ª±a tr√™n m√†u s·∫Øc c·ªßa c√°c h√¨nh ·∫£nh ƒë∆∞·ª£c ch·ª•p, v√†i h√¨nh ƒë·∫ßu ti√™n c√≥ th·ªÉ tr√¥ng kh√¥ng ƒë√∫ng m√†u. B·∫°n lu√¥n c√≥ th·ªÉ kh·∫Øc ph·ª•c ƒëi·ªÅu n√†y b·∫±ng c√°ch thay ƒë·ªïi m√£ ƒë·ªÉ ch·ª•p v√†i h√¨nh ·∫£nh b·ªã b·ªè qua trong h√†m `setup`.


---

**Tuy√™n b·ªë mi·ªÖn tr·ª´ tr√°ch nhi·ªám**:  
T√†i li·ªáu n√†y ƒë√£ ƒë∆∞·ª£c d·ªãch b·∫±ng d·ªãch v·ª• d·ªãch thu·∫≠t AI [Co-op Translator](https://github.com/Azure/co-op-translator). M·∫∑c d√π ch√∫ng t√¥i c·ªë g·∫Øng ƒë·∫£m b·∫£o ƒë·ªô ch√≠nh x√°c, xin l∆∞u √Ω r·∫±ng c√°c b·∫£n d·ªãch t·ª± ƒë·ªông c√≥ th·ªÉ ch·ª©a l·ªói ho·∫∑c kh√¥ng ch√≠nh x√°c. T√†i li·ªáu g·ªëc b·∫±ng ng√¥n ng·ªØ b·∫£n ƒë·ªãa n√™n ƒë∆∞·ª£c coi l√† ngu·ªìn th√¥ng tin ch√≠nh th·ª©c. ƒê·ªëi v·ªõi c√°c th√¥ng tin quan tr·ªçng, n√™n s·ª≠ d·ª•ng d·ªãch v·ª• d·ªãch thu·∫≠t chuy√™n nghi·ªáp b·ªüi con ng∆∞·ªùi. Ch√∫ng t√¥i kh√¥ng ch·ªãu tr√°ch nhi·ªám cho b·∫•t k·ª≥ s·ª± hi·ªÉu l·∫ßm ho·∫∑c di·ªÖn gi·∫£i sai n√†o ph√°t sinh t·ª´ vi·ªác s·ª≠ d·ª•ng b·∫£n d·ªãch n√†y.