<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "5f6c164e349f8989959e02a90f37908d",
  "translation_date": "2025-08-27T22:55:28+00:00",
  "source_file": "6-consumer/lessons/4-multiple-language-support/wio-terminal-translate-speech.md",
  "language_code": "vi"
}
-->
# D·ªãch gi·ªçng n√≥i - Wio Terminal

Trong ph·∫ßn n√†y c·ªßa b√†i h·ªçc, b·∫°n s·∫Ω vi·∫øt m√£ ƒë·ªÉ d·ªãch vƒÉn b·∫£n b·∫±ng d·ªãch v·ª• d·ªãch thu·∫≠t.

## Chuy·ªÉn ƒë·ªïi vƒÉn b·∫£n th√†nh gi·ªçng n√≥i b·∫±ng d·ªãch v·ª• d·ªãch thu·∫≠t

API REST c·ªßa d·ªãch v·ª• gi·ªçng n√≥i kh√¥ng h·ªó tr·ª£ d·ªãch tr·ª±c ti·∫øp, thay v√†o ƒë√≥ b·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng d·ªãch v·ª• Translator ƒë·ªÉ d·ªãch vƒÉn b·∫£n ƒë∆∞·ª£c t·∫°o b·ªüi d·ªãch v·ª• chuy·ªÉn gi·ªçng n√≥i th√†nh vƒÉn b·∫£n, v√† vƒÉn b·∫£n c·ªßa ph·∫£n h·ªìi ƒë∆∞·ª£c n√≥i. D·ªãch v·ª• n√†y c√≥ m·ªôt API REST m√† b·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng ƒë·ªÉ d·ªãch vƒÉn b·∫£n, nh∆∞ng ƒë·ªÉ d·ªÖ s·ª≠ d·ª•ng h∆°n, n√≥ s·∫Ω ƒë∆∞·ª£c bao b·ªçc trong m·ªôt HTTP trigger kh√°c trong ·ª©ng d·ª•ng functions c·ªßa b·∫°n.

### Nhi·ªám v·ª• - t·∫°o m·ªôt function serverless ƒë·ªÉ d·ªãch vƒÉn b·∫£n

1. M·ªü d·ª± √°n `smart-timer-trigger` c·ªßa b·∫°n trong VS Code, v√† m·ªü terminal ƒë·∫£m b·∫£o r·∫±ng m√¥i tr∆∞·ªùng ·∫£o ƒë√£ ƒë∆∞·ª£c k√≠ch ho·∫°t. N·∫øu kh√¥ng, h√£y t·∫Øt v√† t·∫°o l·∫°i terminal.

1. M·ªü t·ªáp `local.settings.json` v√† th√™m c√°c thi·∫øt l·∫≠p cho kh√≥a API v√† v·ªã tr√≠ c·ªßa d·ªãch v·ª• d·ªãch thu·∫≠t:

    ```json
    "TRANSLATOR_KEY": "<key>",
    "TRANSLATOR_LOCATION": "<location>"
    ```

    Thay th·∫ø `<key>` b·∫±ng kh√≥a API cho t√†i nguy√™n d·ªãch v·ª• d·ªãch thu·∫≠t c·ªßa b·∫°n. Thay th·∫ø `<location>` b·∫±ng v·ªã tr√≠ b·∫°n ƒë√£ s·ª≠ d·ª•ng khi t·∫°o t√†i nguy√™n d·ªãch v·ª• d·ªãch thu·∫≠t.

1. Th√™m m·ªôt HTTP trigger m·ªõi v√†o ·ª©ng d·ª•ng n√†y c√≥ t√™n l√† `translate-text` b·∫±ng l·ªánh sau t·ª´ b√™n trong terminal c·ªßa VS Code trong th∆∞ m·ª•c g·ªëc c·ªßa d·ª± √°n ·ª©ng d·ª•ng functions:

    ```sh
    func new --name translate-text --template "HTTP trigger"
    ```

    L·ªánh n√†y s·∫Ω t·∫°o m·ªôt HTTP trigger c√≥ t√™n l√† `translate-text`.

1. Thay th·∫ø n·ªôi dung c·ªßa t·ªáp `__init__.py` trong th∆∞ m·ª•c `translate-text` b·∫±ng n·ªôi dung sau:

    ```python
    import logging
    import os
    import requests
    
    import azure.functions as func
    
    location = os.environ['TRANSLATOR_LOCATION']
    translator_key = os.environ['TRANSLATOR_KEY']
    
    def main(req: func.HttpRequest) -> func.HttpResponse:
        req_body = req.get_json()
        from_language = req_body['from_language']
        to_language = req_body['to_language']
        text = req_body['text']
        
        logging.info(f'Translating {text} from {from_language} to {to_language}')
    
        url = f'https://api.cognitive.microsofttranslator.com/translate?api-version=3.0'
    
        headers = {
            'Ocp-Apim-Subscription-Key': translator_key,
            'Ocp-Apim-Subscription-Region': location,
            'Content-type': 'application/json'
        }
    
        params = {
            'from': from_language,
            'to': to_language
        }
    
        body = [{
            'text' : text
        }]
        
        response = requests.post(url, headers=headers, params=params, json=body)
        return func.HttpResponse(response.json()[0]['translations'][0]['text'])
    ```

    M√£ n√†y tr√≠ch xu·∫•t vƒÉn b·∫£n v√† ng√¥n ng·ªØ t·ª´ y√™u c·∫ßu HTTP. Sau ƒë√≥, n√≥ g·ª≠i m·ªôt y√™u c·∫ßu ƒë·∫øn API REST c·ªßa d·ªãch v·ª• d·ªãch thu·∫≠t, truy·ªÅn c√°c ng√¥n ng·ªØ l√†m tham s·ªë cho URL v√† vƒÉn b·∫£n c·∫ßn d·ªãch l√†m n·ªôi dung. Cu·ªëi c√πng, b·∫£n d·ªãch s·∫Ω ƒë∆∞·ª£c tr·∫£ v·ªÅ.

1. Ch·∫°y ·ª©ng d·ª•ng functions c·ªßa b·∫°n c·ª•c b·ªô. Sau ƒë√≥, b·∫°n c√≥ th·ªÉ g·ªçi n√≥ b·∫±ng m·ªôt c√¥ng c·ª• nh∆∞ curl theo c√°ch t∆∞∆°ng t·ª± nh∆∞ khi b·∫°n ki·ªÉm tra HTTP trigger `text-to-timer`. ƒê·∫£m b·∫£o truy·ªÅn vƒÉn b·∫£n c·∫ßn d·ªãch v√† ng√¥n ng·ªØ d∆∞·ªõi d·∫°ng JSON body:

    ```json
    {
        "text": "D√©finir une minuterie de 30 secondes",
        "from_language": "fr-FR",
        "to_language": "en-US"
    }
    ```

    V√≠ d·ª• n√†y d·ªãch *D√©finir une minuterie de 30 secondes* t·ª´ ti·∫øng Ph√°p sang ti·∫øng Anh M·ªπ. N√≥ s·∫Ω tr·∫£ v·ªÅ *Set a 30-second timer*.

> üíÅ B·∫°n c√≥ th·ªÉ t√¨m th·∫•y m√£ n√†y trong th∆∞ m·ª•c [code/functions](../../../../../6-consumer/lessons/4-multiple-language-support/code/functions).

### Nhi·ªám v·ª• - s·ª≠ d·ª•ng function d·ªãch thu·∫≠t ƒë·ªÉ d·ªãch vƒÉn b·∫£n

1. M·ªü d·ª± √°n `smart-timer` trong VS Code n·∫øu n√≥ ch∆∞a ƒë∆∞·ª£c m·ªü.

1. B·ªô ƒë·∫øm th·ªùi gian th√¥ng minh c·ªßa b·∫°n s·∫Ω c√≥ 2 ng√¥n ng·ªØ ƒë∆∞·ª£c thi·∫øt l·∫≠p - ng√¥n ng·ªØ c·ªßa m√°y ch·ªß ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ hu·∫•n luy·ªán LUIS (ng√¥n ng·ªØ n√†y c≈©ng ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ t·∫°o c√°c th√¥ng b√°o n√≥i v·ªõi ng∆∞·ªùi d√πng), v√† ng√¥n ng·ªØ ƒë∆∞·ª£c ng∆∞·ªùi d√πng n√≥i. C·∫≠p nh·∫≠t h·∫±ng s·ªë `LANGUAGE` trong t·ªáp ti√™u ƒë·ªÅ `config.h` th√†nh ng√¥n ng·ªØ m√† ng∆∞·ªùi d√πng s·∫Ω n√≥i, v√† th√™m m·ªôt h·∫±ng s·ªë m·ªõi c√≥ t√™n l√† `SERVER_LANGUAGE` cho ng√¥n ng·ªØ ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ hu·∫•n luy·ªán LUIS:

    ```cpp
    const char *LANGUAGE = "<user language>";
    const char *SERVER_LANGUAGE = "<server language>";
    ```

    Thay th·∫ø `<user language>` b·∫±ng t√™n locale c·ªßa ng√¥n ng·ªØ b·∫°n s·∫Ω n√≥i, v√≠ d·ª• `fr-FR` cho ti·∫øng Ph√°p, ho·∫∑c `zn-HK` cho ti·∫øng Qu·∫£ng ƒê√¥ng.

    Thay th·∫ø `<server language>` b·∫±ng t√™n locale c·ªßa ng√¥n ng·ªØ ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ hu·∫•n luy·ªán LUIS.

    B·∫°n c√≥ th·ªÉ t√¨m th·∫•y danh s√°ch c√°c ng√¥n ng·ªØ ƒë∆∞·ª£c h·ªó tr·ª£ v√† t√™n locale c·ªßa ch√∫ng trong [t√†i li·ªáu h·ªó tr·ª£ ng√¥n ng·ªØ v√† gi·ªçng n√≥i tr√™n Microsoft docs](https://docs.microsoft.com/azure/cognitive-services/speech-service/language-support?WT.mc_id=academic-17441-jabenn#speech-to-text).

    > üíÅ N·∫øu b·∫°n kh√¥ng n√≥i ƒë∆∞·ª£c nhi·ªÅu ng√¥n ng·ªØ, b·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng m·ªôt d·ªãch v·ª• nh∆∞ [Bing Translate](https://www.bing.com/translator) ho·∫∑c [Google Translate](https://translate.google.com) ƒë·ªÉ d·ªãch t·ª´ ng√¥n ng·ªØ ∆∞a th√≠ch c·ªßa b·∫°n sang m·ªôt ng√¥n ng·ªØ kh√°c. C√°c d·ªãch v·ª• n√†y sau ƒë√≥ c√≥ th·ªÉ ph√°t √¢m thanh c·ªßa vƒÉn b·∫£n ƒë√£ d·ªãch.
    >
    > V√≠ d·ª•, n·∫øu b·∫°n hu·∫•n luy·ªán LUIS b·∫±ng ti·∫øng Anh, nh∆∞ng mu·ªën s·ª≠ d·ª•ng ti·∫øng Ph√°p l√†m ng√¥n ng·ªØ ng∆∞·ªùi d√πng, b·∫°n c√≥ th·ªÉ d·ªãch c√°c c√¢u nh∆∞ "set a 2 minute and 27 second timer" t·ª´ ti·∫øng Anh sang ti·∫øng Ph√°p b·∫±ng Bing Translate, sau ƒë√≥ s·ª≠ d·ª•ng n√∫t **Nghe b·∫£n d·ªãch** ƒë·ªÉ n√≥i b·∫£n d·ªãch v√†o micro c·ªßa b·∫°n.
    >
    > ![N√∫t nghe b·∫£n d·ªãch tr√™n Bing Translate](../../../../../translated_images/bing-translate.348aa796d6efe2a92f41ea74a5cf42bb4c63d6faaa08e7f46924e072a35daa48.vi.png)

1. Th√™m kh√≥a API v√† v·ªã tr√≠ c·ªßa d·ªãch v·ª• d·ªãch thu·∫≠t b√™n d∆∞·ªõi `SPEECH_LOCATION`:

    ```cpp
    const char *TRANSLATOR_API_KEY = "<KEY>";
    const char *TRANSLATOR_LOCATION = "<LOCATION>";
    ```

    Thay th·∫ø `<KEY>` b·∫±ng kh√≥a API cho t√†i nguy√™n d·ªãch v·ª• d·ªãch thu·∫≠t c·ªßa b·∫°n. Thay th·∫ø `<LOCATION>` b·∫±ng v·ªã tr√≠ b·∫°n ƒë√£ s·ª≠ d·ª•ng khi t·∫°o t√†i nguy√™n d·ªãch v·ª• d·ªãch thu·∫≠t.

1. Th√™m URL trigger c·ªßa d·ªãch v·ª• d·ªãch thu·∫≠t b√™n d∆∞·ªõi `VOICE_URL`:

    ```cpp
    const char *TRANSLATE_FUNCTION_URL = "<URL>";
    ```

    Thay th·∫ø `<URL>` b·∫±ng URL cho HTTP trigger `translate-text` tr√™n ·ª©ng d·ª•ng functions c·ªßa b·∫°n. URL n√†y s·∫Ω gi·ªëng v·ªõi gi√° tr·ªã c·ªßa `TEXT_TO_TIMER_FUNCTION_URL`, ngo·∫°i tr·ª´ t√™n function l√† `translate-text` thay v√¨ `text-to-timer`.

1. Th√™m m·ªôt t·ªáp m·ªõi v√†o th∆∞ m·ª•c `src` c√≥ t√™n l√† `text_translator.h`.

1. T·ªáp ti√™u ƒë·ªÅ `text_translator.h` m·ªõi n√†y s·∫Ω ch·ª©a m·ªôt l·ªõp ƒë·ªÉ d·ªãch vƒÉn b·∫£n. Th√™m n·ªôi dung sau v√†o t·ªáp n√†y ƒë·ªÉ khai b√°o l·ªõp:

    ```cpp
    #pragma once
    
    #include <Arduino.h>
    #include <ArduinoJson.h>
    #include <HTTPClient.h>
    #include <WiFiClient.h>
    
    #include "config.h"
    
    class TextTranslator
    {
    public:   
    private:
        WiFiClient _client;
    };
    
    TextTranslator textTranslator;
    ```

    ƒêi·ªÅu n√†y khai b√°o l·ªõp `TextTranslator`, c√πng v·ªõi m·ªôt instance c·ªßa l·ªõp n√†y. L·ªõp c√≥ m·ªôt tr∆∞·ªùng duy nh·∫•t cho WiFi client.

1. Trong ph·∫ßn `public` c·ªßa l·ªõp n√†y, th√™m m·ªôt ph∆∞∆°ng th·ª©c ƒë·ªÉ d·ªãch vƒÉn b·∫£n:

    ```cpp
    String translateText(String text, String from_language, String to_language)
    {
    }
    ```

    Ph∆∞∆°ng th·ª©c n√†y nh·∫≠n ng√¥n ng·ªØ c·∫ßn d·ªãch t·ª´, v√† ng√¥n ng·ªØ c·∫ßn d·ªãch sang. Khi x·ª≠ l√Ω gi·ªçng n√≥i, gi·ªçng n√≥i s·∫Ω ƒë∆∞·ª£c d·ªãch t·ª´ ng√¥n ng·ªØ ng∆∞·ªùi d√πng sang ng√¥n ng·ªØ m√°y ch·ªß LUIS, v√† khi ƒë∆∞a ra ph·∫£n h·ªìi, n√≥ s·∫Ω d·ªãch t·ª´ ng√¥n ng·ªØ m√°y ch·ªß LUIS sang ng√¥n ng·ªØ ng∆∞·ªùi d√πng.

1. Trong ph∆∞∆°ng th·ª©c n√†y, th√™m m√£ ƒë·ªÉ t·∫°o m·ªôt JSON body ch·ª©a vƒÉn b·∫£n c·∫ßn d·ªãch v√† c√°c ng√¥n ng·ªØ:

    ```cpp
    DynamicJsonDocument doc(1024);
    doc["text"] = text;
    doc["from_language"] = from_language;
    doc["to_language"] = to_language;

    String body;
    serializeJson(doc, body);

    Serial.print("Translating ");
    Serial.print(text);
    Serial.print(" from ");
    Serial.print(from_language);
    Serial.print(" to ");
    Serial.print(to_language);
    ```

1. B√™n d∆∞·ªõi ƒëo·∫°n m√£ n√†y, th√™m m√£ sau ƒë·ªÉ g·ª≠i body ƒë·∫øn ·ª©ng d·ª•ng functions serverless:

    ```cpp
    HTTPClient httpClient;
    httpClient.begin(_client, TRANSLATE_FUNCTION_URL);

    int httpResponseCode = httpClient.POST(body);
    ```

1. Ti·∫øp theo, th√™m m√£ ƒë·ªÉ nh·∫≠n ph·∫£n h·ªìi:

    ```cpp
    String translated_text = "";

    if (httpResponseCode == 200)
    {
        translated_text = httpClient.getString();
        Serial.print("Translated: ");
        Serial.println(translated_text);
    }
    else
    {
        Serial.print("Failed to translate text - error ");
        Serial.println(httpResponseCode);
    }
    ```

1. Cu·ªëi c√πng, th√™m m√£ ƒë·ªÉ ƒë√≥ng k·∫øt n·ªëi v√† tr·∫£ v·ªÅ vƒÉn b·∫£n ƒë√£ d·ªãch:

    ```cpp
    httpClient.end();

    return translated_text;
    ```

### Nhi·ªám v·ª• - d·ªãch gi·ªçng n√≥i nh·∫≠n di·ªán v√† c√°c ph·∫£n h·ªìi

1. M·ªü t·ªáp `main.cpp`.

1. Th√™m m·ªôt ch·ªâ th·ªã include ·ªü ƒë·∫ßu t·ªáp cho t·ªáp ti√™u ƒë·ªÅ c·ªßa l·ªõp `TextTranslator`:

    ```cpp
    #include "text_translator.h"
    ```

1. VƒÉn b·∫£n ƒë∆∞·ª£c n√≥i khi m·ªôt b·ªô ƒë·∫øm th·ªùi gian ƒë∆∞·ª£c thi·∫øt l·∫≠p ho·∫∑c h·∫øt h·∫°n c·∫ßn ƒë∆∞·ª£c d·ªãch. ƒê·ªÉ l√†m ƒëi·ªÅu n√†y, th√™m d√≤ng sau l√†m d√≤ng ƒë·∫ßu ti√™n c·ªßa h√†m `say`:

    ```cpp
    text = textTranslator.translateText(text, LANGUAGE, SERVER_LANGUAGE);
    ```

    ƒêi·ªÅu n√†y s·∫Ω d·ªãch vƒÉn b·∫£n sang ng√¥n ng·ªØ c·ªßa ng∆∞·ªùi d√πng.

1. Trong h√†m `processAudio`, vƒÉn b·∫£n ƒë∆∞·ª£c l·∫•y t·ª´ √¢m thanh ƒë√£ ghi l·∫°i b·∫±ng l·ªánh `String text = speechToText.convertSpeechToText();`. Sau l·ªánh n√†y, d·ªãch vƒÉn b·∫£n:

    ```cpp
    String text = speechToText.convertSpeechToText();
    text = textTranslator.translateText(text, LANGUAGE, SERVER_LANGUAGE);
    ```

    ƒêi·ªÅu n√†y s·∫Ω d·ªãch vƒÉn b·∫£n t·ª´ ng√¥n ng·ªØ c·ªßa ng∆∞·ªùi d√πng sang ng√¥n ng·ªØ ƒë∆∞·ª£c s·ª≠ d·ª•ng tr√™n m√°y ch·ªß.

1. Bi√™n d·ªãch m√£ n√†y, t·∫£i n√≥ l√™n Wio Terminal c·ªßa b·∫°n v√† ki·ªÉm tra qua serial monitor. Khi b·∫°n th·∫•y `Ready` trong serial monitor, nh·∫•n n√∫t C (n√∫t ·ªü b√™n tr√°i, g·∫ßn c√¥ng t·∫Øc ngu·ªìn nh·∫•t), v√† n√≥i. ƒê·∫£m b·∫£o ·ª©ng d·ª•ng functions c·ªßa b·∫°n ƒëang ch·∫°y, v√† y√™u c·∫ßu m·ªôt b·ªô ƒë·∫øm th·ªùi gian b·∫±ng ng√¥n ng·ªØ ng∆∞·ªùi d√πng, b·∫±ng c√°ch t·ª± n√≥i ng√¥n ng·ªØ ƒë√≥ ho·∫∑c s·ª≠ d·ª•ng m·ªôt ·ª©ng d·ª•ng d·ªãch thu·∫≠t.

    ```output
    Connecting to WiFi..
    Connected!
    Got access token.
    Ready.
    Starting recording...
    Finished recording
    Sending speech...
    Speech sent!
    {"RecognitionStatus":"Success","DisplayText":"D√©finir une minuterie de 2 minutes 27 secondes.","Offset":9600000,"Duration":40400000}
    Translating D√©finir une minuterie de 2 minutes 27 secondes. from fr-FR to en-US
    Translated: Set a timer of 2 minutes 27 seconds.
    Set a timer of 2 minutes 27 seconds.
    {"seconds": 147}
    Translating 2 minute 27 second timer started. from en-US to fr-FR
    Translated: 2 minute 27 seconde minute a commenc√©.
    2 minute 27 seconde minute a commenc√©.
    Translating Times up on your 2 minute 27 second timer. from en-US to fr-FR
    Translated: Chronom√©trant votre minuterie de 2 minutes 27 secondes.
    Chronom√©trant votre minuterie de 2 minutes 27 secondes.
    ```

> üíÅ B·∫°n c√≥ th·ªÉ t√¨m th·∫•y m√£ n√†y trong th∆∞ m·ª•c [code/wio-terminal](../../../../../6-consumer/lessons/4-multiple-language-support/code/wio-terminal).

üòÄ Ch∆∞∆°ng tr√¨nh b·ªô ƒë·∫øm th·ªùi gian ƒëa ng√¥n ng·ªØ c·ªßa b·∫°n ƒë√£ th√†nh c√¥ng!

---

**Tuy√™n b·ªë mi·ªÖn tr·ª´ tr√°ch nhi·ªám**:  
T√†i li·ªáu n√†y ƒë√£ ƒë∆∞·ª£c d·ªãch b·∫±ng d·ªãch v·ª• d·ªãch thu·∫≠t AI [Co-op Translator](https://github.com/Azure/co-op-translator). M·∫∑c d√π ch√∫ng t√¥i c·ªë g·∫Øng ƒë·∫£m b·∫£o ƒë·ªô ch√≠nh x√°c, xin l∆∞u √Ω r·∫±ng c√°c b·∫£n d·ªãch t·ª± ƒë·ªông c√≥ th·ªÉ ch·ª©a l·ªói ho·∫∑c kh√¥ng ch√≠nh x√°c. T√†i li·ªáu g·ªëc b·∫±ng ng√¥n ng·ªØ b·∫£n ƒë·ªãa n√™n ƒë∆∞·ª£c coi l√† ngu·ªìn th√¥ng tin ch√≠nh th·ª©c. ƒê·ªëi v·ªõi c√°c th√¥ng tin quan tr·ªçng, n√™n s·ª≠ d·ª•ng d·ªãch v·ª• d·ªãch thu·∫≠t chuy√™n nghi·ªáp t·ª´ con ng∆∞·ªùi. Ch√∫ng t√¥i kh√¥ng ch·ªãu tr√°ch nhi·ªám cho b·∫•t k·ª≥ s·ª± hi·ªÉu l·∫ßm ho·∫∑c di·ªÖn gi·∫£i sai n√†o ph√°t sinh t·ª´ vi·ªác s·ª≠ d·ª•ng b·∫£n d·ªãch n√†y.