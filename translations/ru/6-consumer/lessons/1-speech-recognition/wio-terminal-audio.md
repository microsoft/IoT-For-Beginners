<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "2f336726b9410e97c3aaed76cc89b0d8",
  "translation_date": "2025-08-27T00:24:26+00:00",
  "source_file": "6-consumer/lessons/1-speech-recognition/wio-terminal-audio.md",
  "language_code": "ru"
}
-->
# –ó–∞—Ö–≤–∞—Ç –∞—É–¥–∏–æ - Wio Terminal

–í —ç—Ç–æ–π —á–∞—Å—Ç–∏ —É—Ä–æ–∫–∞ –≤—ã –Ω–∞–ø–∏—à–µ—Ç–µ –∫–æ–¥ –¥–ª—è –∑–∞—Ö–≤–∞—Ç–∞ –∞—É–¥–∏–æ –Ω–∞ –≤–∞—à–µ–º Wio Terminal. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞—Ö–≤–∞—Ç–æ–º –∞—É–¥–∏–æ –±—É–¥–µ—Ç –æ—Å—É—â–µ—Å—Ç–≤–ª—è—Ç—å—Å—è –æ–¥–Ω–æ–π –∏–∑ –∫–Ω–æ–ø–æ–∫ –Ω–∞ –≤–µ—Ä—Ö–Ω–µ–π —á–∞—Å—Ç–∏ Wio Terminal.

## –ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –¥–ª—è –∑–∞—Ö–≤–∞—Ç–∞ –∞—É–¥–∏–æ

–í—ã –º–æ–∂–µ—Ç–µ –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –∞—É–¥–∏–æ —Å –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É—è –∫–æ–¥ –Ω–∞ C++. Wio Terminal –∏–º–µ–µ—Ç –≤—Å–µ–≥–æ 192 –ö–ë –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏, —á–µ–≥–æ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –∑–∞—Ö–≤–∞—Ç–∞ –±–æ–ª–µ–µ —á–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–µ–∫—É–Ω–¥ –∞—É–¥–∏–æ. –û–¥–Ω–∞–∫–æ –æ–Ω —Ç–∞–∫–∂–µ –æ—Å–Ω–∞—â–µ–Ω 4 –ú–ë —Ñ–ª—ç—à-–ø–∞–º—è—Ç–∏, –∫–æ—Ç–æ—Ä—É—é –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞—Ö–≤–∞—á–µ–Ω–Ω–æ–≥–æ –∞—É–¥–∏–æ.

–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–∏–∫—Ä–æ—Ñ–æ–Ω –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –∞–Ω–∞–ª–æ–≥–æ–≤—ã–π —Å–∏–≥–Ω–∞–ª, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è –≤ —Ü–∏—Ñ—Ä–æ–≤–æ–π —Å–∏–≥–Ω–∞–ª, –ø—Ä–∏–≥–æ–¥–Ω—ã–π –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Wio Terminal. –ü—Ä–∏ –∑–∞—Ö–≤–∞—Ç–µ –∞—É–¥–∏–æ –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞—Ö–≤–∞—á–µ–Ω—ã –≤ –Ω—É–∂–Ω—ã–π –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏ ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –∑–∞—Ö–≤–∞—Ç–∞ –∞—É–¥–∏–æ —Å —á–∞—Å—Ç–æ—Ç–æ–π 16 –∫–ì—Ü –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—Ç—å—Å—è —Ä–æ–≤–Ω–æ 16 000 —Ä–∞–∑ –≤ —Å–µ–∫—É–Ω–¥—É —Å —Ä–∞–≤–Ω—ã–º–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞–º–∏ –º–µ–∂–¥—É –∫–∞–∂–¥—ã–º –æ–±—Ä–∞–∑—Ü–æ–º. –í–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–∞—à –∫–æ–¥ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–æ–π –∑–∞–¥–∞—á–∏, –≤—ã –º–æ–∂–µ—Ç–µ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–º –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–∞–º—è—Ç–∏ (DMAC). –≠—Ç–æ –∞–ø–ø–∞—Ä–∞—Ç–Ω–∞—è —Å—Ö–µ–º–∞, –∫–æ—Ç–æ—Ä–∞—è –º–æ–∂–µ—Ç –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—Ç—å —Å–∏–≥–Ω–∞–ª –∏ –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –µ–≥–æ –≤ –ø–∞–º—è—Ç—å, –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤–∞—à–µ–≥–æ –∫–æ–¥–∞ –Ω–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–µ.

‚úÖ –ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ DMA –º–æ–∂–Ω–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å –Ω–∞ [—Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–∞–º—è—Ç–∏ –≤ –í–∏–∫–∏–ø–µ–¥–∏–∏](https://wikipedia.org/wiki/Direct_memory_access).

![–ê—É–¥–∏–æ —Å –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ –ø–æ—Å—Ç—É–ø–∞–µ—Ç –Ω–∞ –ê–¶–ü, –∑–∞—Ç–µ–º –Ω–∞ DMAC. DMAC –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –æ–¥–∏–Ω –±—É—Ñ–µ—Ä. –ö–æ–≥–¥–∞ —ç—Ç–æ—Ç –±—É—Ñ–µ—Ä –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è, –æ–Ω –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è, –∞ DMAC –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤–æ –≤—Ç–æ—Ä–æ–π –±—É—Ñ–µ—Ä](../../../../../translated_images/dmac-adc-buffers.4509aee49145c90bc2e1be472b8ed2ddfcb2b6a81ad3e559114aca55f5fff759.ru.png)

DMAC –º–æ–∂–µ—Ç –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –∞—É–¥–∏–æ —Å –ê–¶–ü —á–µ—Ä–µ–∑ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä, 16 000 —Ä–∞–∑ –≤ —Å–µ–∫—É–Ω–¥—É –¥–ª—è –∞—É–¥–∏–æ —Å —á–∞—Å—Ç–æ—Ç–æ–π 16 –∫–ì—Ü. –û–Ω –º–æ–∂–µ—Ç –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –≤ –∑–∞—Ä–∞–Ω–µ–µ –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–π –±—É—Ñ–µ—Ä –ø–∞–º—è—Ç–∏, –∞ –∫–æ–≥–¥–∞ –±—É—Ñ–µ—Ä –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è, –¥–∞–Ω–Ω—ã–µ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–∞—à–∏–º –∫–æ–¥–æ–º. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —ç—Ç–æ–π –ø–∞–º—è—Ç–∏ –º–æ–∂–µ—Ç –∑–∞–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∑–∞—Ö–≤–∞—Ç –∞—É–¥–∏–æ, –Ω–æ –≤—ã –º–æ–∂–µ—Ç–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –±—É—Ñ–µ—Ä–æ–≤. DMAC –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –±—É—Ñ–µ—Ä 1, –∑–∞—Ç–µ–º, –∫–æ–≥–¥–∞ –æ–Ω –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è, —É–≤–µ–¥–æ–º–ª—è–µ—Ç –≤–∞—à –∫–æ–¥ –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±—É—Ñ–µ—Ä–∞ 1, –≤ —Ç–æ –≤—Ä–µ–º—è –∫–∞–∫ DMAC –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –±—É—Ñ–µ—Ä 2. –ö–æ–≥–¥–∞ –±—É—Ñ–µ—Ä 2 –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è, –æ–Ω —É–≤–µ–¥–æ–º–ª—è–µ—Ç –≤–∞—à –∫–æ–¥ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫ –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö –≤ –±—É—Ñ–µ—Ä 1. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –µ—Å–ª–∏ –≤—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç–µ –∫–∞–∂–¥—ã–π –±—É—Ñ–µ—Ä –±—ã—Å—Ç—Ä–µ–µ, —á–µ–º —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è –µ–≥–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è, –≤—ã –Ω–µ –ø–æ—Ç–µ—Ä—è–µ—Ç–µ –¥–∞–Ω–Ω—ã–µ.

–ü–æ—Å–ª–µ –∑–∞—Ö–≤–∞—Ç–∞ –∫–∞–∂–¥–æ–≥–æ –±—É—Ñ–µ—Ä–∞ –µ–≥–æ –º–æ–∂–Ω–æ –∑–∞–ø–∏—Å–∞—Ç—å –≤–æ —Ñ–ª—ç—à-–ø–∞–º—è—Ç—å. –ó–∞–ø–∏—Å—å –≤–æ —Ñ–ª—ç—à-–ø–∞–º—è—Ç—å —Ç—Ä–µ–±—É–µ—Ç —É–∫–∞–∑–∞–Ω–∏—è –∞–¥—Ä–µ—Å–æ–≤, –≥–¥–µ –Ω—É–∂–Ω–æ –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏ –∫–∞–∫–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –±—É–¥–µ—Ç –∑–∞–ø–∏—Å—å, –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é –º–∞—Å—Å–∏–≤–∞ –±–∞–π—Ç–æ–≤ –≤ –ø–∞–º—è—Ç–∏. –§–ª—ç—à-–ø–∞–º—è—Ç—å –∏–º–µ–µ—Ç –≥—Ä–∞–Ω—É–ª—è—Ä–Ω–æ—Å—Ç—å, —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å—Ç–∏—Ä–∞–Ω–∏—è –∏ –∑–∞–ø–∏—Å–∏ –∑–∞–≤–∏—Å—è—Ç –Ω–µ —Ç–æ–ª—å–∫–æ –æ—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞, –Ω–æ –∏ –æ—Ç –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è –ø–æ —ç—Ç–æ–º—É —Ä–∞–∑–º–µ—Ä—É. –ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –≥—Ä–∞–Ω—É–ª—è—Ä–Ω–æ—Å—Ç—å —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç 4096 –±–∞–π—Ç, –∞ –≤—ã –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç–µ —Å—Ç–∏—Ä–∞–Ω–∏–µ –ø–æ –∞–¥—Ä–µ—Å—É 4200, —ç—Ç–æ –º–æ–∂–µ—Ç —Å—Ç–µ—Ä–µ—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Å –∞–¥—Ä–µ—Å–∞ 4096 –¥–æ 8192. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –∞—É–¥–∏–æ –¥–∞–Ω–Ω—ã—Ö –≤–æ —Ñ–ª—ç—à-–ø–∞–º—è—Ç—å –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–∞–∑–±–∏—Ç—ã –Ω–∞ –±–ª–æ–∫–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞.

### –ó–∞–¥–∞—á–∞ - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–ª—ç—à-–ø–∞–º—è—Ç–∏

1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç –¥–ª—è Wio Terminal —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º PlatformIO. –ù–∞–∑–æ–≤–∏—Ç–µ —ç—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç `smart-timer`. –î–æ–±–∞–≤—å—Ç–µ –∫–æ–¥ –≤ —Ñ—É–Ω–∫—Ü–∏—é `setup` –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –ø–æ—Ä—Ç–∞.

1. –î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫ –≤ —Ñ–∞–π–ª `platformio.ini`, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Ñ–ª—ç—à-–ø–∞–º—è—Ç–∏:

    ```ini
    lib_deps =
        seeed-studio/Seeed Arduino FS @ 2.1.1
        seeed-studio/Seeed Arduino SFUD @ 2.0.2
    ```

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `main.cpp` –∏ –¥–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â—É—é –¥–∏—Ä–µ–∫—Ç–∏–≤—É –≤–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ —Ñ–ª—ç—à-–ø–∞–º—è—Ç–∏ –≤ –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞:

    ```cpp
    #include <sfud.h>
    #include <SPI.h>
    ```

    > üéì SFUD –æ–∑–Ω–∞—á–∞–µ—Ç Serial Flash Universal Driver, –±–∏–±–ª–∏–æ—Ç–µ–∫—É, —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω—É—é –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ –≤—Å–µ–º–∏ —á–∏–ø–∞–º–∏ —Ñ–ª—ç—à-–ø–∞–º—è—Ç–∏.

1. –í —Ñ—É–Ω–∫—Ü–∏–∏ `setup` –¥–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π –∫–æ–¥ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ —Ñ–ª—ç—à-—Ö—Ä–∞–Ω–∏–ª–∏—â–∞:

    ```cpp
    while (!(sfud_init() == SFUD_SUCCESS))
        ;

    sfud_qspi_fast_read_enable(sfud_get_device(SFUD_W25Q32_DEVICE_INDEX), 2);
    ```

    –≠—Ç–æ—Ç –∫–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ü–∏–∫–ª –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ SFUD –Ω–µ –±—É–¥–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞, –∑–∞—Ç–µ–º –≤–∫–ª—é—á–∞–µ—Ç –±—ã—Å—Ç—Ä—ã–µ —á—Ç–µ–Ω–∏—è. –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Ñ–ª—ç—à-–ø–∞–º—è—Ç—å –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω–∞ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Queued Serial Peripheral Interface (QSPI), —Ç–∏–ø SPI-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥—å —Å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–æ–π –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞. –≠—Ç–æ –¥–µ–ª–∞–µ—Ç —á—Ç–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—å –≤–æ —Ñ–ª—ç—à-–ø–∞–º—è—Ç—å –±—ã—Å—Ç—Ä–µ–µ.

1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ñ–∞–π–ª –≤ –ø–∞–ø–∫–µ `src` —Å –∏–º–µ–Ω–µ–º `flash_writer.h`.

1. –î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–µ–µ –≤ –Ω–∞—á–∞–ª–æ —ç—Ç–æ–≥–æ —Ñ–∞–π–ª–∞:

    ```cpp
    #pragma once

    #include <Arduino.h>
    #include <sfud.h>
    ```

    –≠—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã–µ —Ñ–∞–π–ª—ã, –≤–∫–ª—é—á–∞—è –∑–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã–π —Ñ–∞–π–ª –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ SFUD –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å —Ñ–ª—ç—à-–ø–∞–º—è—Ç—å—é.

1. –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –∫–ª–∞—Å—Å –≤ —ç—Ç–æ–º –Ω–æ–≤–æ–º –∑–∞–≥–æ–ª–æ–≤–æ—á–Ω–æ–º —Ñ–∞–π–ª–µ —Å –∏–º–µ–Ω–µ–º `FlashWriter`:

    ```cpp
    class FlashWriter
    {
    public:
    
    private:
    };
    ```

1. –í —Å–µ–∫—Ü–∏–∏ `private` –¥–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π –∫–æ–¥:

    ```cpp
    byte *_sfudBuffer;
    size_t _sfudBufferSize;
    size_t _sfudBufferPos;
    size_t _sfudBufferWritePos;

    const sfud_flash *_flash;
    ```

    –≠—Ç–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ª–µ–π –¥–ª—è –±—É—Ñ–µ—Ä–∞, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é –∏—Ö –≤–æ —Ñ–ª—ç—à-–ø–∞–º—è—Ç—å. –°—É—â–µ—Å—Ç–≤—É–µ—Ç –º–∞—Å—Å–∏–≤ –±–∞–π—Ç–æ–≤ `_sfudBuffer` –¥–ª—è –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö, –∏ –∫–æ–≥–¥–∞ –æ–Ω –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è, –¥–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤–æ —Ñ–ª—ç—à-–ø–∞–º—è—Ç—å. –ü–æ–ª–µ `_sfudBufferPos` —Ö—Ä–∞–Ω–∏—Ç —Ç–µ–∫—É—â—É—é –ø–æ–∑–∏—Ü–∏—é –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤ —ç—Ç–æ—Ç –±—É—Ñ–µ—Ä, –∞ `_sfudBufferWritePos` —Ö—Ä–∞–Ω–∏—Ç –ø–æ–∑–∏—Ü–∏—é –≤–æ —Ñ–ª—ç—à-–ø–∞–º—è—Ç–∏ –¥–ª—è –∑–∞–ø–∏—Å–∏. `_flash` ‚Äî —ç—Ç–æ —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ —Ñ–ª—ç—à-–ø–∞–º—è—Ç—å –¥–ª—è –∑–∞–ø–∏—Å–∏ ‚Äî –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –∏–º–µ—é—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–∏–ø–æ–≤ —Ñ–ª—ç—à-–ø–∞–º—è—Ç–∏.

1. –î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π –º–µ—Ç–æ–¥ –≤ —Å–µ–∫—Ü–∏—é `public` –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —ç—Ç–æ–≥–æ –∫–ª–∞—Å—Å–∞:

    ```cpp
    void init()
    {
        _flash = sfud_get_device_table() + 0;
        _sfudBufferSize = _flash->chip.erase_gran;
        _sfudBuffer = new byte[_sfudBufferSize];
        _sfudBufferPos = 0;
        _sfudBufferWritePos = 0;
    }
    ```

    –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç —Ñ–ª—ç—à-–ø–∞–º—è—Ç—å –Ω–∞ Wio Terminal –¥–ª—è –∑–∞–ø–∏—Å–∏ –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –±—É—Ñ–µ—Ä—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–∞–∑–º–µ—Ä–∞ –∑–µ—Ä–Ω–∞ —Ñ–ª—ç—à-–ø–∞–º—è—Ç–∏. –≠—Ç–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –º–µ—Ç–æ–¥–µ `init`, –∞ –Ω–µ –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ, —Ç–∞–∫ –∫–∞–∫ –º–µ—Ç–æ–¥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤—ã–∑–≤–∞–Ω –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–ª—ç—à-–ø–∞–º—è—Ç–∏ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `setup`.

1. –î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π –∫–æ–¥ –≤ —Å–µ–∫—Ü–∏—é `public`:

    ```cpp
    void writeSfudBuffer(byte b)
    {
        _sfudBuffer[_sfudBufferPos++] = b;
        if (_sfudBufferPos == _sfudBufferSize)
        {
            sfud_erase_write(_flash, _sfudBufferWritePos, _sfudBufferSize, _sfudBuffer);
            _sfudBufferWritePos += _sfudBufferSize;
            _sfudBufferPos = 0;
        }
    }

    void writeSfudBuffer(byte *b, size_t len)
    {
        for (size_t i = 0; i < len; ++i)
        {
            writeSfudBuffer(b[i]);
        }
    }

    void flushSfudBuffer()
    {
        if (_sfudBufferPos > 0)
        {
            sfud_erase_write(_flash, _sfudBufferWritePos, _sfudBufferSize, _sfudBuffer);
            _sfudBufferWritePos += _sfudBufferSize;
            _sfudBufferPos = 0;
        }
    }
    ```

    –≠—Ç–æ—Ç –∫–æ–¥ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –º–µ—Ç–æ–¥—ã –¥–ª—è –∑–∞–ø–∏—Å–∏ –±–∞–π—Ç–æ–≤ –≤ —Å–∏—Å—Ç–µ–º—É —Ñ–ª—ç—à-—Ö—Ä–∞–Ω–∏–ª–∏—â–∞. –û–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç, –∑–∞–ø–∏—Å—ã–≤–∞—è –¥–∞–Ω–Ω—ã–µ –≤ –±—É—Ñ–µ—Ä –≤ –ø–∞–º—è—Ç–∏, –∫–æ—Ç–æ—Ä—ã–π –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –¥–ª—è —Ñ–ª—ç—à-–ø–∞–º—è—Ç–∏, –∏ –∫–æ–≥–¥–∞ –æ–Ω –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è, –¥–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤–æ —Ñ–ª—ç—à-–ø–∞–º—è—Ç—å, —Å—Ç–∏—Ä–∞—è –ª—é–±—ã–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –≤ —ç—Ç–æ–º –º–µ—Å—Ç–µ. –¢–∞–∫–∂–µ –µ—Å—Ç—å –º–µ—Ç–æ–¥ `flushSfudBuffer` –¥–ª—è –∑–∞–ø–∏—Å–∏ –Ω–µ–ø–æ–ª–Ω–æ–≥–æ –±—É—Ñ–µ—Ä–∞, —Ç–∞–∫ –∫–∞–∫ –∑–∞—Ö–≤–∞—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ –±—É–¥—É—Ç —Ç–æ—á–Ω—ã–º–∏ –∫—Ä–∞—Ç–Ω—ã–º–∏ —Ä–∞–∑–º–µ—Ä—É –∑–µ—Ä–Ω–∞, –ø–æ—ç—Ç–æ–º—É –∫–æ–Ω–µ—á–Ω–∞—è —á–∞—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∑–∞–ø–∏—Å–∞–Ω–∞.

    > üíÅ –ö–æ–Ω–µ—á–Ω–∞—è —á–∞—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–µ–Ω—É–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –Ω–æ —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, —Ç–∞–∫ –∫–∞–∫ –±—É–¥–µ—Ç –ø—Ä–æ—á–∏—Ç–∞–Ω–∞ —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è.

### –ó–∞–¥–∞—á–∞ - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞—Ö–≤–∞—Ç–∞ –∞—É–¥–∏–æ

1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ñ–∞–π–ª –≤ –ø–∞–ø–∫–µ `src` —Å –∏–º–µ–Ω–µ–º `config.h`.

1. –î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–µ–µ –≤ –Ω–∞—á–∞–ª–æ —ç—Ç–æ–≥–æ —Ñ–∞–π–ª–∞:

    ```cpp
    #pragma once

    #define RATE 16000
    #define SAMPLE_LENGTH_SECONDS 4
    #define SAMPLES RATE * SAMPLE_LENGTH_SECONDS
    #define BUFFER_SIZE (SAMPLES * 2) + 44
    #define ADC_BUF_LEN 1600
    ```

    –≠—Ç–æ—Ç –∫–æ–¥ –∑–∞–¥–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–Ω—Å—Ç–∞–Ω—Ç –¥–ª—è –∑–∞—Ö–≤–∞—Ç–∞ –∞—É–¥–∏–æ.

    | –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞             | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
    | --------------------- | -------: | - |
    | RATE                  | 16000    | –ß–∞—Å—Ç–æ—Ç–∞ –≤—ã–±–æ—Ä–∫–∏ –¥–ª—è –∞—É–¥–∏–æ. 16 000 ‚Äî —ç—Ç–æ 16 –∫–ì—Ü |
    | SAMPLE_LENGTH_SECONDS | 4        | –î–ª–∏–Ω–∞ –∞—É–¥–∏–æ –¥–ª—è –∑–∞—Ö–≤–∞—Ç–∞. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞ 4 —Å–µ–∫—É–Ω–¥—ã. –ß—Ç–æ–±—ã –∑–∞–ø–∏—Å–∞—Ç—å –±–æ–ª–µ–µ –¥–ª–∏–Ω–Ω–æ–µ –∞—É–¥–∏–æ, —É–≤–µ–ª–∏—á—å—Ç–µ —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ. |
    | SAMPLES               | 64000    | –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞—É–¥–∏–æ–≤—ã–±–æ—Ä–æ–∫, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –∑–∞—Ö–≤–∞—á–µ–Ω—ã. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –∫–∞–∫ —á–∞—Å—Ç–æ—Ç–∞ –≤—ã–±–æ—Ä–∫–∏ * –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ–∫—É–Ω–¥ |
    | BUFFER_SIZE           | 128044   | –†–∞–∑–º–µ—Ä –±—É—Ñ–µ—Ä–∞ –¥–ª—è –∑–∞—Ö–≤–∞—Ç–∞ –∞—É–¥–∏–æ. –ê—É–¥–∏–æ –±—É–¥–µ—Ç –∑–∞—Ö–≤–∞—á–µ–Ω–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ WAV, –∫–æ—Ç–æ—Ä—ã–π —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ 44 –±–∞–π—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∏ 128 000 –±–∞–π—Ç –∞—É–¥–∏–æ–¥–∞–Ω–Ω—ã—Ö (–∫–∞–∂–¥–∞—è –≤—ã–±–æ—Ä–∫–∞ –∑–∞–Ω–∏–º–∞–µ—Ç 2 –±–∞–π—Ç–∞) |
    | ADC_BUF_LEN           | 1600     | –†–∞–∑–º–µ—Ä –±—É—Ñ–µ—Ä–æ–≤ –¥–ª—è –∑–∞—Ö–≤–∞—Ç–∞ –∞—É–¥–∏–æ —Å DMAC |

    > üíÅ –ï—Å–ª–∏ –≤—ã —Å—á–∏—Ç–∞–µ—Ç–µ, —á—Ç–æ 4 —Å–µ–∫—É–Ω–¥—ã —Å–ª–∏—à–∫–æ–º –º–∞–ª–æ –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ —Ç–∞–π–º–µ—Ä–∞, –≤—ã –º–æ–∂–µ—Ç–µ —É–≤–µ–ª–∏—á–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ `SAMPLE_LENGTH_SECONDS`, –∏ –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –±—É–¥—É—Ç –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω—ã.

1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ñ–∞–π–ª –≤ –ø–∞–ø–∫–µ `src` —Å –∏–º–µ–Ω–µ–º `mic.h`.

1. –î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–µ–µ –≤ –Ω–∞—á–∞–ª–æ —ç—Ç–æ–≥–æ —Ñ–∞–π–ª–∞:

    ```cpp
    #pragma once

    #include <Arduino.h>

    #include "config.h"
    #include "flash_writer.h"
    ```

    –≠—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã–µ —Ñ–∞–π–ª—ã, –≤–∫–ª—é—á–∞—è –∑–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã–µ —Ñ–∞–π–ª—ã `config.h` –∏ `FlashWriter`.

1. –î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–µ–µ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–ª–∞—Å—Å–∞ `Mic`, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —Å –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞:

    ```cpp
    class Mic
    {
    public:
        Mic()
        {
            _isRecording = false;
            _isRecordingReady = false;
        }
    
        void startRecording()
        {
            _isRecording = true;
            _isRecordingReady = false;
        }
    
        bool isRecording()
        {
            return _isRecording;
        }
    
        bool isRecordingReady()
        {
            return _isRecordingReady;
        }
    
    private:
        volatile bool _isRecording;
        volatile bool _isRecordingReady;
        FlashWriter _writer;
    };
    
    Mic mic;
    ```

    –≠—Ç–æ—Ç –∫–ª–∞—Å—Å –ø–æ–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ª–µ–π –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è, –Ω–∞—á–∞–ª–∞—Å—å –ª–∏ –∑–∞–ø–∏—Å—å, –∏ –≥–æ—Ç–æ–≤–∞ –ª–∏ –∑–∞–ø–∏—Å—å –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é. –ö–æ–≥–¥–∞ DMAC –Ω–∞—Å—Ç—Ä–æ–µ–Ω, –æ–Ω –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –±—É—Ñ–µ—Ä—ã –ø–∞–º—è—Ç–∏, –ø–æ—ç—Ç–æ–º—É —Ñ–ª–∞–≥ `_isRecording` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –¥–æ–ª–∂–Ω—ã –ª–∏ –æ–Ω–∏ –±—ã—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã –∏–ª–∏ –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω—ã. –§–ª–∞–≥ `_isRecordingReady` –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –∫–æ–≥–¥–∞ –±—É–¥–µ—Ç –∑–∞—Ö–≤–∞—á–µ–Ω–æ —Ç—Ä–µ–±—É–µ–º–æ–µ 4 —Å–µ–∫—É–Ω–¥—ã –∞—É–¥–∏–æ. –ü–æ–ª–µ `_writer` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∞—É–¥–∏–æ–¥–∞–Ω–Ω—ã—Ö –≤–æ —Ñ–ª—ç—à-–ø–∞–º—è—Ç—å.

    –ó–∞—Ç–µ–º –æ–±—ä—è–≤–ª—è–µ—Ç—Å—è –≥–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –∫–ª–∞—Å—Å–∞ `Mic`.

1. –î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π –∫–æ–¥ –≤ —Å–µ–∫—Ü–∏—é `private` –∫–ª–∞—Å—Å–∞ `Mic`:

    ```cpp
    typedef struct
    {
        uint16_t btctrl;
        uint16_t btcnt;
        uint32_t srcaddr;
        uint32_t dstaddr;
        uint32_t descaddr;
    } dmacdescriptor;

    // Globals - DMA and ADC
    volatile dmacdescriptor _wrb[DMAC_CH_NUM] __attribute__((aligned(16)));
    dmacdescriptor _descriptor_section[DMAC_CH_NUM] __attribute__((aligned(16)));
    dmacdescriptor _descriptor __attribute__((aligned(16)));

    void configureDmaAdc()
    {
        // Configure DMA to sample from ADC at a regular interval (triggered by timer/counter)
        DMAC->BASEADDR.reg = (uint32_t)_descriptor_section;                    // Specify the location of the descriptors
        DMAC->WRBADDR.reg = (uint32_t)_wrb;                                    // Specify the location of the write back descriptors
        DMAC->CTRL.reg = DMAC_CTRL_DMAENABLE | DMAC_CTRL_LVLEN(0xf);           // Enable the DMAC peripheral
        DMAC->Channel[1].CHCTRLA.reg = DMAC_CHCTRLA_TRIGSRC(TC5_DMAC_ID_OVF) | // Set DMAC to trigger on TC5 timer overflow
                                        DMAC_CHCTRLA_TRIGACT_BURST;             // DMAC burst transfer

        _descriptor.descaddr = (uint32_t)&_descriptor_section[1];                    // Set up a circular descriptor
        _descriptor.srcaddr = (uint32_t)&ADC1->RESULT.reg;                           // Take the result from the ADC0 RESULT register
        _descriptor.dstaddr = (uint32_t)_adc_buf_0 + sizeof(uint16_t) * ADC_BUF_LEN; // Place it in the adc_buf_0 array
        _descriptor.btcnt = ADC_BUF_LEN;                                             // Beat count
        _descriptor.btctrl = DMAC_BTCTRL_BEATSIZE_HWORD |                            // Beat size is HWORD (16-bits)
                                DMAC_BTCTRL_DSTINC |                                    // Increment the destination address
                                DMAC_BTCTRL_VALID |                                     // Descriptor is valid
                                DMAC_BTCTRL_BLOCKACT_SUSPEND;                           // Suspend DMAC channel 0 after block transfer
        memcpy(&_descriptor_section[0], &_descriptor, sizeof(_descriptor));          // Copy the descriptor to the descriptor section

        _descriptor.descaddr = (uint32_t)&_descriptor_section[0];                    // Set up a circular descriptor
        _descriptor.srcaddr = (uint32_t)&ADC1->RESULT.reg;                           // Take the result from the ADC0 RESULT register
        _descriptor.dstaddr = (uint32_t)_adc_buf_1 + sizeof(uint16_t) * ADC_BUF_LEN; // Place it in the adc_buf_1 array
        _descriptor.btcnt = ADC_BUF_LEN;                                             // Beat count
        _descriptor.btctrl = DMAC_BTCTRL_BEATSIZE_HWORD |                            // Beat size is HWORD (16-bits)
                                DMAC_BTCTRL_DSTINC |                                    // Increment the destination address
                                DMAC_BTCTRL_VALID |                                     // Descriptor is valid
                                DMAC_BTCTRL_BLOCKACT_SUSPEND;                           // Suspend DMAC channel 0 after block transfer
        memcpy(&_descriptor_section[1], &_descriptor, sizeof(_descriptor));          // Copy the descriptor to the descriptor section

        // Configure NVIC
        NVIC_SetPriority(DMAC_1_IRQn, 0); // Set the Nested Vector Interrupt Controller (NVIC) priority for DMAC1 to 0 (highest)
        NVIC_EnableIRQ(DMAC_1_IRQn);      // Connect DMAC1 to Nested Vector Interrupt Controller (NVIC)

        // Activate the suspend (SUSP) interrupt on DMAC channel 1
        DMAC->Channel[1].CHINTENSET.reg = DMAC_CHINTENSET_SUSP;

        // Configure ADC
        ADC1->INPUTCTRL.bit.MUXPOS = ADC_INPUTCTRL_MUXPOS_AIN12_Val; // Set the analog input to ADC0/AIN2 (PB08 - A4 on Metro M4)
        while (ADC1->SYNCBUSY.bit.INPUTCTRL)
            ;                              // Wait for synchronization
        ADC1->SAMPCTRL.bit.SAMPLEN = 0x00; // Set max Sampling Time Length to half divided ADC clock pulse (2.66us)
        while (ADC1->SYNCBUSY.bit.SAMPCTRL)
            ;                                         // Wait for synchronization
        ADC1->CTRLA.reg = ADC_CTRLA_PRESCALER_DIV128; // Divide Clock ADC GCLK by 128 (48MHz/128 = 375kHz)
        ADC1->CTRLB.reg = ADC_CTRLB_RESSEL_12BIT |    // Set ADC resolution to 12 bits
                            ADC_CTRLB_FREERUN;          // Set ADC to free run mode
        while (ADC1->SYNCBUSY.bit.CTRLB)
            ;                       // Wait for synchronization
        ADC1->CTRLA.bit.ENABLE = 1; // Enable the ADC
        while (ADC1->SYNCBUSY.bit.ENABLE)
            ;                       // Wait for synchronization
        ADC1->SWTRIG.bit.START = 1; // Initiate a software trigger to start an ADC conversion
        while (ADC1->SYNCBUSY.bit.SWTRIG)
            ; // Wait for synchronization

        // Enable DMA channel 1
        DMAC->Channel[1].CHCTRLA.bit.ENABLE = 1;

        // Configure Timer/Counter 5
        GCLK->PCHCTRL[TC5_GCLK_ID].reg = GCLK_PCHCTRL_CHEN |     // Enable peripheral channel for TC5
                                            GCLK_PCHCTRL_GEN_GCLK1; // Connect generic clock 0 at 48MHz

        TC5->COUNT16.WAVE.reg = TC_WAVE_WAVEGEN_MFRQ; // Set TC5 to Match Frequency (MFRQ) mode
        TC5->COUNT16.CC[0].reg = 3000 - 1;            // Set the trigger to 16 kHz: (4Mhz / 16000) - 1
        while (TC5->COUNT16.SYNCBUSY.bit.CC0)
            ; // Wait for synchronization

        // Start Timer/Counter 5
        TC5->COUNT16.CTRLA.bit.ENABLE = 1; // Enable the TC5 timer
        while (TC5->COUNT16.SYNCBUSY.bit.ENABLE)
            ; // Wait for synchronization
    }

    uint16_t _adc_buf_0[ADC_BUF_LEN];
    uint16_t _adc_buf_1[ADC_BUF_LEN];
    ```

    –≠—Ç–æ—Ç –∫–æ–¥ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –º–µ—Ç–æ–¥ `configureDmaAdc`, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç DMAC, –ø–æ–¥–∫–ª—é—á–∞—è –µ–≥–æ –∫ –ê–¶–ü –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—è –µ–≥–æ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –¥–≤—É—Ö —á–µ—Ä–µ–¥—É—é—â–∏—Ö—Å—è –±—É—Ñ–µ—Ä–æ–≤, `_adc_buf_0` –∏ `_adc_buf_1`.

    > üíÅ –û–¥–Ω–∏–º –∏–∑ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–æ–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –¥–ª—è –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ —è–≤–ª—è–µ—Ç—Å—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å –∫–æ–¥–∞, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–≥–æ –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ–º, —Ç–∞–∫ –∫–∞–∫ –≤–∞—à –∫–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –æ—á–µ–Ω—å –Ω–∏–∑–∫–æ–º —É—Ä–æ–≤–Ω–µ, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—è –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ —Å –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ–º. –≠—Ç–æ—Ç –∫–æ–¥ —Å–ª–æ–∂–Ω–µ–µ, —á–µ–º —Ç–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤—ã –±—ã –Ω–∞–ø–∏—Å–∞–ª–∏ –¥–ª—è –æ–¥–Ω–æ–ø–ª–∞—Ç–Ω–æ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ –∏–ª–∏ –Ω–∞—Å—Ç–æ–ª—å–Ω–æ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞, —Ç–∞–∫ –∫–∞–∫ –∑–¥–µ—Å—å –Ω–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã, –∫–æ—Ç–æ—Ä–∞—è –º–æ–≥–ª–∞ –±—ã –ø–æ–º–æ—á—å. –°—É—â–µ—Å—Ç–≤—É—é—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç —É–ø—Ä–æ—Å—Ç–∏—Ç—å —ç—Ç—É –∑–∞–¥–∞—á—É, –Ω–æ —Å–ª–æ–∂–Ω–æ—Å—Ç—å –≤—Å–µ —Ä–∞–≤–Ω–æ –æ—Å—Ç–∞–µ—Ç—Å—è.

1. –ù–∏–∂–µ –¥–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π –∫–æ–¥:

    ```cpp
    // WAV files have a header. This struct defines that header
    struct wavFileHeader
    {
        char riff[4];         /* "RIFF"                                  */
        long flength;         /* file length in bytes                    */
        char wave[4];         /* "WAVE"                                  */
        char fmt[4];          /* "fmt "                                  */
        long chunk_size;      /* size of FMT chunk in bytes (usually 16) */
        short format_tag;     /* 1=PCM, 257=Mu-Law, 258=A-Law, 259=ADPCM */
        short num_chans;      /* 1=mono, 2=stereo                        */
        long srate;           /* Sampling rate in samples per second     */
        long bytes_per_sec;   /* bytes per second = srate*bytes_per_samp */
        short bytes_per_samp; /* 2=16-bit mono, 4=16-bit stereo          */
        short bits_per_samp;  /* Number of bits per sample               */
        char data[4];         /* "data"                                  */
        long dlength;         /* data length in bytes (filelength - 44)  */
    };

    void initBufferHeader()
    {
        wavFileHeader wavh;

        strncpy(wavh.riff, "RIFF", 4);
        strncpy(wavh.wave, "WAVE", 4);
        strncpy(wavh.fmt, "fmt ", 4);
        strncpy(wavh.data, "data", 4);

        wavh.chunk_size = 16;
        wavh.format_tag = 1; // PCM
        wavh.num_chans = 1;  // mono
        wavh.srate = RATE;
        wavh.bytes_per_sec = (RATE * 1 * 16 * 1) / 8;
        wavh.bytes_per_samp = 2;
        wavh.bits_per_samp = 16;
        wavh.dlength = RATE * 2 * 1 * 16 / 2;
        wavh.flength = wavh.dlength + 44;

        _writer.writeSfudBuffer((byte *)&wavh, 44);
    }
    ```

    –≠—Ç–æ—Ç –∫–æ–¥ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ WAV –∫–∞–∫ —Å—Ç—Ä—É–∫—Ç—É—Ä—É, –∑–∞–Ω–∏–º–∞—é—â—É—é 44 –±–∞–π—Ç–∞ –ø–∞–º—è—Ç–∏. –í –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –¥–µ—Ç–∞–ª–∏ –æ —á–∞—Å—Ç–æ—Ç–µ –∞—É–¥–∏–æ—Ñ–∞–π–ª–∞, —Ä–∞–∑–º–µ—Ä–µ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –∫–∞–Ω–∞–ª–æ–≤. –≠—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∑–∞—Ç–µ–º –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤–æ —Ñ–ª—ç—à-–ø–∞–º—è—Ç—å.

1. –ù–∏–∂–µ —ç—Ç–æ–≥–æ –∫–æ–¥–∞ –¥–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–µ–µ –¥–ª—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è –º–µ—Ç–æ–¥–∞, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å—Å—è, –∫–æ–≥–¥–∞ –∞—É–¥–∏–æ–±—É—Ñ–µ—Ä—ã –≥–æ—Ç–æ–≤—ã –∫ –æ–±—Ä–∞–±–æ—Ç–∫–µ:

    ```cpp
    void audioCallback(uint16_t *buf, uint32_t buf_len)
    {
        static uint32_t idx = 44;

        if (_isRecording)
        {
            for (uint32_t i = 0; i < buf_len; i++)
            {
                int16_t audio_value = ((int16_t)buf[i] - 2048) * 16;

                _writer.writeSfudBuffer(audio_value & 0xFF);
                _writer.writeSfudBuffer((audio_value >> 8) & 0xFF);
            }

            idx += buf_len;
                
            if (idx >= BUFFER_SIZE)
            {
                _writer.flushSfudBuffer();
                idx = 44;
                _isRecording = false;
                _isRecordingReady = true;
            }
        }
    }
    ```

    –ê—É–¥–∏–æ–±—É—Ñ–µ—Ä—ã –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç —Å–æ–±–æ–π –º–∞—Å—Å–∏–≤—ã 16-–±–∏—Ç–Ω—ã—Ö —Ü–µ–ª—ã—Ö —á–∏—Å–µ–ª, —Å–æ–¥–µ—Ä–∂–∞—â–∏—Ö –∞—É–¥–∏–æ —Å –ê–¶–ü. –ê–¶–ü –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 12-–±–∏—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –±–µ–∑ –∑–Ω–∞–∫–∞ (0-1023), –ø–æ—ç—Ç–æ–º—É –∏—Ö –Ω—É–∂–Ω–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤ 16-–±–∏—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å–æ –∑–Ω–∞–∫–æ–º, –∞ –∑–∞—Ç–µ–º –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤ 2 –±–∞–π—Ç–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –≤–∏–¥–µ –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –±–∏–Ω–∞—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

    –≠—Ç–∏ –±–∞–π—Ç—ã –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ –±—É—Ñ–µ—Ä—ã —Ñ–ª—ç—à-–ø–∞–º—è—Ç–∏. –ó–∞–ø–∏—Å—å –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –∏–Ω–¥–µ–∫—Å–∞ 44 ‚Äî —ç—Ç–æ —Å–º–µ—â–µ–Ω–∏–µ –æ—Ç 44 –±–∞–π—Ç, –∑–∞–ø–∏—Å–∞–Ω–Ω—ã—Ö –∫–∞–∫ –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Ñ–∞–π–ª–∞ WAV. –ö–∞–∫ —Ç–æ–ª—å–∫–æ –≤—Å–µ –±–∞–π—Ç—ã, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–ª—è —Ç—Ä–µ–±—É–µ–º–æ–π –¥–ª–∏–Ω—ã –∞—É–¥–∏–æ, –∑–∞—Ö–≤–∞—á–µ–Ω—ã, –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –¥–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤–æ —Ñ–ª—ç—à-–ø–∞–º—è—Ç—å.

1. –í —Å–µ–∫—Ü–∏–∏ `public` –∫–ª–∞—Å—Å–∞ `Mic` –¥–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π –∫–æ–¥:

    ```cpp
    void dmaHandler()
    {
        static uint8_t count = 0;

        if (DMAC->Channel[1].CHINTFLAG.bit.SUSP)
        {
            DMAC->Channel[1].CHCTRLB.reg = DMAC_CHCTRLB_CMD_RESUME;
            DMAC->Channel[1].CHINTFLAG.bit.SUSP = 1;

            if (count)
            {
                audioCallback(_adc_buf_0, ADC_BUF_LEN);
            }
            else
            {
                audioCallback(_adc_buf_1, ADC_BUF_LEN);
            }

            count = (count + 1) % 2;
        }
    }
    ```

    –≠—Ç–æ—Ç –∫–æ–¥ –±—É–¥–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å—Å—è DMAC, —á—Ç–æ–±—ã —É–≤–µ–¥–æ–º–∏—Ç—å –≤–∞—à –∫–æ–¥ –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±—É—Ñ–µ—Ä–æ–≤. –û–Ω –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏, –∏ –≤—ã–∑—ã–≤–∞–µ—Ç –º–µ—Ç–æ–¥ `audioCallback` —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º –±—É—Ñ–µ—Ä–æ–º.

1. –í–Ω–µ –∫–ª–∞—Å—Å–∞, –ø–æ—Å–ª–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è `Mic mic;`, –¥–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π –∫–æ–¥:

    ```cpp
    void DMAC_1_Handler()
    {
        mic.dmaHandler();
    }
    ```

    –§—É–Ω–∫—Ü–∏—è `DMAC_1_Handler` –±—É–¥–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å—Å—è DMAC, –∫–æ–≥–¥–∞ –±—É—Ñ–µ—Ä—ã –≥–æ—Ç–æ–≤—ã –∫ –æ–±—Ä–∞–±–æ—Ç–∫–µ. –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ –∏–º–µ–Ω–∏, –ø–æ—ç—Ç–æ–º—É –æ–Ω–∞ –ø—Ä–æ—Å—Ç–æ –¥–æ–ª–∂–Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å, —á—Ç–æ–±—ã –±—ã—Ç—å –≤—ã–∑–≤–∞–Ω–Ω–æ–π.

1. –î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –¥–≤–∞ –º–µ—Ç–æ–¥–∞ –≤ —Å–µ–∫—Ü–∏—é `public` –∫–ª–∞—Å—Å–∞ `Mic`:

    ```cpp
    void init()
    {
        analogReference(AR_INTERNAL2V23);

        _writer.init();

        initBufferHeader();
        configureDmaAdc();
    }

    void reset()
    {
        _isRecordingReady = false;
        _isRecording = false;

        _writer.reset();

        initBufferHeader();
    }
    ```

    –ú–µ—Ç–æ–¥ `init` —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–¥ –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–ª–∞—Å—Å–∞ `Mic`. –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ –¥–ª—è –ø–∏–Ω–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç —Ñ–ª—ç—à-–ø–∞–º—è—Ç—å, –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ WAV –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç DMAC. –ú–µ—Ç–æ–¥ `reset` —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Ñ–ª—ç—à-–ø–∞–º—è—Ç—å –∏ –∑–∞–Ω–æ–≤–æ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –∞—É–¥–∏–æ –±—ã–ª–æ –∑–∞—Ö–≤–∞—á–µ–Ω–æ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ.

### –ó–∞–¥–∞—á–∞ - –∑–∞—Ö–≤–∞—Ç –∞—É–¥–∏–æ

1. –í —Ñ–∞–π–ª–µ `main.cpp` –¥–æ–±–∞–≤—å—Ç–µ –¥–∏—Ä–µ–∫—Ç–∏–≤—É –≤–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–æ—á–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ `mic.h`:

    ```cpp
    #include "mic.h"
    ```

1. –í —Ñ—É–Ω–∫—Ü–∏–∏ `setup` –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –∫–Ω–æ–ø–∫—É C. –ó–∞—Ö–≤–∞—Ç –∞—É–¥–∏–æ –Ω–∞—á–Ω–µ—Ç—Å—è –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ —ç—Ç–æ–π –∫–Ω–æ–ø–∫–∏ –∏ –±—É–¥–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å—Å—è 4 —Å–µ–∫—É–Ω–¥—ã:

    ```cpp
    pinMode(WIO_KEY_C, INPUT_PULLUP);
    ```

1. –ù–∏–∂–µ —ç—Ç–æ–≥–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –º–∏–∫—Ä–æ—Ñ–æ–Ω, –∑–∞—Ç–µ–º –≤—ã–≤–µ–¥–∏—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ –∑–∞—Ö–≤–∞—Ç—É –∞—É–¥–∏–æ:

    ```cpp
    mic.init();

    Serial.println("Ready.");
    ```

1. –ù–∞–¥ —Ñ—É–Ω–∫—Ü–∏–µ–π `loop` –æ–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞—Ö–≤–∞—á–µ–Ω–Ω–æ–≥–æ –∞—É–¥–∏–æ. –ü–æ–∫–∞ –æ–Ω–∞ –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ—Ç, –Ω–æ –ø–æ–∑–∂–µ –≤ —ç—Ç–æ–º —É—Ä–æ–∫–µ –æ–Ω–∞ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ä–µ—á—å –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –≤ —Ç–µ–∫—Å—Ç:

    ```cpp
    void processAudio()
    {
    
    }
    ```

1. –î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–µ–µ –≤ —Ñ—É–Ω–∫—Ü–∏—é `loop`:

    ```cpp
    void loop()
    {
        if (digitalRead(WIO_KEY_C) == LOW && !mic.isRecording())
        {
            Serial.println("Starting recording...");
            mic.startRecording();
        }
    
        if (!mic.isRecording() && mic.isRecordingReady())
        {
            Serial.println("Finished recording");
    
            processAudio();
    
            mic.reset();
        }
    }
    ```

    –≠—Ç–æ—Ç –∫–æ–¥ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–Ω–æ–ø–∫—É C, –∏ –µ—Å–ª–∏ –æ–Ω–∞ –Ω–∞–∂–∞—Ç–∞ –∏ –∑–∞–ø–∏—Å—å –µ—â–µ –Ω–µ –Ω–∞—á–∞–ª–∞—Å—å, —Ç–æ –ø–æ–ª–µ `_isRecording` –∫–ª–∞—Å—Å–∞ `Mic` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ –∑–Ω–∞—á–µ–Ω–∏–µ `true`. –≠—Ç–æ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ —Ç–æ–º—É, —á—Ç–æ –º–µ—Ç–æ–¥ `audioCallback` –∫–ª–∞—Å—Å–∞ `Mic` –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∞—É–¥–∏–æ –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –Ω–µ –±—É–¥–µ—Ç –∑–∞—Ö–≤–∞—á–µ–Ω–æ 4 —Å–µ–∫—É–Ω–¥—ã. –ü–æ—Å–ª–µ –∑–∞—Ö–≤–∞—Ç–∞ 4 —Å–µ–∫—É–Ω–¥ –∞—É–¥–∏–æ –ø–æ–ª–µ `_isRecording` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ –∑–Ω–∞—á–µ–Ω–∏–µ `false`, –∞ –ø–æ–ª–µ `_isRecordingReady` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ –∑–Ω–∞—á–µ–Ω–∏–µ `true`. –≠—Ç–æ –∑–∞—Ç–µ–º –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `loop`, –∏ –∫–æ–≥–¥–∞ –∑–Ω–∞—á–µ–Ω–∏–µ —Ä–∞–≤–Ω–æ `true`, –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è `processAudio`, –∑–∞—Ç–µ–º –∫–ª–∞—Å—Å `Mic` —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è.

1. –°–æ–±–µ—Ä–∏—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥, –∑–∞–≥—Ä—É–∑–∏—Ç–µ –µ–≥–æ –Ω–∞ –≤–∞—à Wio Terminal –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —á–µ—Ä–µ–∑ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É C (—Ç—É, –∫–æ—Ç–æ—Ä–∞—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Å–ª–µ–≤–∞, –±–ª–∏–∂–µ –≤—Å–µ–≥–æ –∫ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—é –ø–∏—Ç–∞–Ω–∏—è) –∏ –≥–æ–≤–æ—Ä–∏—Ç–µ. –ë—É–¥–µ—Ç –∑–∞—Ö–≤–∞—á–µ–Ω–æ 4 —Å–µ–∫—É–Ω–¥—ã –∞—É–¥–∏–æ.

    ```output
    --- Available filters and text transformations: colorize, debug, default, direct, hexlify, log2file, nocontrol, printable, send_on_enter, time
    --- More details at http://bit.ly/pio-monitor-filters
    --- Miniterm on /dev/cu.usbmodem1101  9600,8,N,1 ---
    --- Quit: Ctrl+C | Menu: Ctrl+T | Help: Ctrl+T followed by Ctrl+H ---
    Ready.
    Starting recording...
    Finished recording
    ```
üíÅ –í—ã –º–æ–∂–µ—Ç–µ –Ω–∞–π—Ç–∏ —ç—Ç–æ—Ç –∫–æ–¥ –≤ –ø–∞–ø–∫–µ [code-record/wio-terminal](../../../../../6-consumer/lessons/1-speech-recognition/code-record/wio-terminal).
–í–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∑–∞–ø–∏—Å–∏ –∞—É–¥–∏–æ —Å—Ç–∞–ª–æ —É—Å–ø–µ—à–Ω—ã–º!

---

**–û—Ç–∫–∞–∑ –æ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏**:  
–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –±—ã–ª –ø–µ—Ä–µ–≤–µ–¥–µ–Ω —Å –ø–æ–º–æ—â—å—é —Å–µ—Ä–≤–∏—Å–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ–≤–æ–¥–∞ [Co-op Translator](https://github.com/Azure/co-op-translator). –ù–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –Ω–∞—à–∏ —É—Å–∏–ª–∏—è –æ–±–µ—Å–ø–µ—á–∏—Ç—å —Ç–æ—á–Ω–æ—Å—Ç—å, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–µ—Ä–µ–≤–æ–¥—ã –º–æ–≥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –æ—à–∏–±–∫–∏ –∏–ª–∏ –Ω–µ—Ç–æ—á–Ω–æ—Å—Ç–∏. –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –Ω–∞ –µ–≥–æ —Ä–æ–¥–Ω–æ–º —è–∑—ã–∫–µ —Å–ª–µ–¥—É–µ—Ç —Å—á–∏—Ç–∞—Ç—å –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º. –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥ —á–µ–ª–æ–≤–µ–∫–æ–º. –ú—ã –Ω–µ –Ω–µ—Å–µ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ –ª—é–±—ã–µ –Ω–µ–¥–æ—Ä–∞–∑—É–º–µ–Ω–∏—è –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏, –≤–æ–∑–Ω–∏–∫—à–∏–µ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω–æ–≥–æ –ø–µ—Ä–µ–≤–æ–¥–∞.