<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "f7bb24ba53fb627ddb38a8b24a05e594",
  "translation_date": "2025-08-27T23:27:03+00:00",
  "source_file": "2-farm/lessons/3-automated-plant-watering/README.md",
  "language_code": "cs"
}
-->
# Automatick√© zavla≈æov√°n√≠ rostlin

![P≈ôehled t√©to lekce ve formƒõ sketchnote](../../../../../translated_images/lesson-7.30b5f577d3cb8e031238751475cb519c7d6dbaea261b5df4643d086ffb2a03bb.cs.jpg)

> Sketchnote od [Nitya Narasimhan](https://github.com/nitya). Kliknƒõte na obr√°zek pro vƒõt≈°√≠ verzi.

Tato lekce byla souƒç√°st√≠ [IoT pro zaƒç√°teƒçn√≠ky Projekt 2 - s√©rie Digit√°ln√≠ zemƒõdƒõlstv√≠](https://youtube.com/playlist?list=PLmsFUfdnGr3yCutmcVg6eAUEfsGiFXgcx) od [Microsoft Reactor](https://developer.microsoft.com/reactor/?WT.mc_id=academic-17441-jabenn).

[![Automatick√© zavla≈æov√°n√≠ rostlin poh√°nƒõn√© IoT](https://img.youtube.com/vi/g9FfZwv9R58/0.jpg)](https://youtu.be/g9FfZwv9R58)

## Kv√≠z p≈ôed lekc√≠

[Kv√≠z p≈ôed lekc√≠](https://black-meadow-040d15503.1.azurestaticapps.net/quiz/13)

## √övod

V minul√© lekci jste se nauƒçili, jak monitorovat vlhkost p≈Ødy. V t√©to lekci se nauƒç√≠te, jak vytvo≈ôit z√°kladn√≠ komponenty automatick√©ho zavla≈æovac√≠ho syst√©mu, kter√Ω reaguje na vlhkost p≈Ødy. Tak√© se dozv√≠te o naƒçasov√°n√≠ ‚Äì jak senzory mohou pot≈ôebovat ƒças na reakci na zmƒõny a jak aktu√°tory mohou pot≈ôebovat ƒças na zmƒõnu vlastnost√≠ mƒõ≈ôen√Ωch senzory.

V t√©to lekci se zamƒõ≈ô√≠me na:

* [Ovl√°d√°n√≠ za≈ô√≠zen√≠ s vysok√Ωm v√Ωkonem z IoT za≈ô√≠zen√≠ s n√≠zk√Ωm v√Ωkonem](../../../../../2-farm/lessons/3-automated-plant-watering)
* [Ovl√°d√°n√≠ rel√©](../../../../../2-farm/lessons/3-automated-plant-watering)
* [Ovl√°d√°n√≠ rostliny p≈ôes MQTT](../../../../../2-farm/lessons/3-automated-plant-watering)
* [Naƒçasov√°n√≠ senzor≈Ø a aktu√°tor≈Ø](../../../../../2-farm/lessons/3-automated-plant-watering)
* [P≈ôid√°n√≠ naƒçasov√°n√≠ do serveru pro ovl√°d√°n√≠ rostlin](../../../../../2-farm/lessons/3-automated-plant-watering)

## Ovl√°d√°n√≠ za≈ô√≠zen√≠ s vysok√Ωm v√Ωkonem z IoT za≈ô√≠zen√≠ s n√≠zk√Ωm v√Ωkonem

IoT za≈ô√≠zen√≠ pou≈æ√≠vaj√≠ n√≠zk√© napƒõt√≠. Zat√≠mco to staƒç√≠ pro senzory a aktu√°tory s n√≠zk√Ωm v√Ωkonem, jako jsou LED diody, je to p≈ô√≠li≈° m√°lo na ovl√°d√°n√≠ vƒõt≈°√≠ho hardwaru, nap≈ô√≠klad vodn√≠ho ƒçerpadla pou≈æ√≠van√©ho pro zavla≈æov√°n√≠. I mal√° ƒçerpadla, kter√° byste mohli pou≈æ√≠t pro pokojov√© rostliny, spot≈ôebov√°vaj√≠ p≈ô√≠li≈° mnoho proudu pro IoT v√Ωvojovou desku a mohly by ji po≈°kodit.

> üéì Proud, mƒõ≈ôen√Ω v amp√©rech (A), je mno≈æstv√≠ elekt≈ôiny, kter√© proch√°z√≠ obvodem. Napƒõt√≠ poskytuje tlak, proud urƒçuje, kolik je tlaƒçeno. V√≠ce o proudu si m≈Ø≈æete p≈ôeƒç√≠st na [str√°nce o elektrick√©m proudu na Wikipedii](https://wikipedia.org/wiki/Electric_current).

≈òe≈°en√≠m je m√≠t ƒçerpadlo p≈ôipojen√© k extern√≠mu zdroji nap√°jen√≠ a pou≈æ√≠t aktu√°tor k zapnut√≠ ƒçerpadla, podobnƒõ jako byste zapnuli svƒõtlo. K zapnut√≠ vyp√≠naƒçe staƒç√≠ mal√° mno≈æstv√≠ energie (ve formƒõ energie va≈°eho tƒõla), co≈æ p≈ôipoj√≠ svƒõtlo k s√≠≈•ov√©mu nap√°jen√≠ bƒõ≈æ√≠c√≠mu na 110V/240V.

![Vyp√≠naƒç zap√≠n√° nap√°jen√≠ svƒõtla](../../../../../translated_images/light-switch.760317ad6ab8bd6d611da5352dfe9c73a94a0822ccec7df3c8bae35da18e1658.cs.png)

> üéì [S√≠≈•ov√° elekt≈ôina](https://wikipedia.org/wiki/Mains_electricity) oznaƒçuje elekt≈ôinu dod√°vanou do dom√°cnost√≠ a podnik≈Ø prost≈ôednictv√≠m n√°rodn√≠ infrastruktury v mnoha ƒç√°stech svƒõta.

‚úÖ IoT za≈ô√≠zen√≠ obvykle poskytuj√≠ 3,3V nebo 5V, p≈ôi m√©nƒõ ne≈æ 1 amp√©ru (1A) proudu. Porovnejte to se s√≠≈•ovou elekt≈ôinou, kter√° je nejƒçastƒõji na 230V (120V v Severn√≠ Americe a 100V v Japonsku) a m≈Ø≈æe nap√°jet za≈ô√≠zen√≠, kter√° spot≈ôebov√°vaj√≠ 30A.

Existuje ≈ôada aktu√°tor≈Ø, kter√© to dok√°≈æou, vƒçetnƒõ mechanick√Ωch za≈ô√≠zen√≠, kter√° m≈Ø≈æete p≈ôipojit k existuj√≠c√≠m vyp√≠naƒç≈Øm a napodobit prst, kter√Ω je zap√≠n√°. Nejobl√≠benƒõj≈°√≠ je rel√©.

### Rel√©

Rel√© je elektromechanick√Ω sp√≠naƒç, kter√Ω p≈ôev√°d√≠ elektrick√Ω sign√°l na mechanick√Ω pohyb, kter√Ω zapne sp√≠naƒç. J√°drem rel√© je elektromagnet.

> üéì [Elektromagnety](https://wikipedia.org/wiki/Electromagnet) jsou magnety, kter√© vznikaj√≠ pr≈Øchodem elekt≈ôiny c√≠vkou dr√°tu. Kdy≈æ je elekt≈ôina zapnuta, c√≠vka se zmagnetizuje. Kdy≈æ je elekt≈ôina vypnuta, c√≠vka ztr√°c√≠ magnetismus.

![Kdy≈æ je zapnuto, elektromagnet vytv√°≈ô√≠ magnetick√© pole, kter√© zapne sp√≠naƒç v√Ωstupn√≠ho obvodu](../../../../../translated_images/relay-on.4db16a0fd6b669262fd6699aff3fbcd31b6057c06d90411b6bddc06326d1cf75.cs.png)

V rel√© nap√°j√≠ ovl√°dac√≠ obvod elektromagnet. Kdy≈æ je elektromagnet zapnut√Ω, p≈ôit√°hne p√°ku, kter√° pohne sp√≠naƒçem, uzav≈ôe p√°r kontakt≈Ø a dokonƒç√≠ v√Ωstupn√≠ obvod.

![Kdy≈æ je vypnuto, elektromagnet nevytv√°≈ô√≠ magnetick√© pole, kter√© vypne sp√≠naƒç v√Ωstupn√≠ho obvodu](../../../../../translated_images/relay-off.c34a178a2960fecdc3c6400d43e633ed11c6746cd653cfb4a768fa097c40394c.cs.png)

Kdy≈æ je ovl√°dac√≠ obvod vypnut√Ω, elektromagnet se vypne, uvoln√≠ p√°ku a otev≈ôe kontakty, ƒç√≠m≈æ vypne v√Ωstupn√≠ obvod. Rel√© jsou digit√°ln√≠ aktu√°tory ‚Äì vysok√Ω sign√°l rel√© zapne, n√≠zk√Ω sign√°l ho vypne.

V√Ωstupn√≠ obvod m≈Ø≈æe b√Ωt pou≈æit k nap√°jen√≠ dal≈°√≠ho hardwaru, nap≈ô√≠klad zavla≈æovac√≠ho syst√©mu. IoT za≈ô√≠zen√≠ m≈Ø≈æe rel√© zapnout, ƒç√≠m≈æ dokonƒç√≠ v√Ωstupn√≠ obvod nap√°jej√≠c√≠ zavla≈æovac√≠ syst√©m, a rostliny se zalij√≠. IoT za≈ô√≠zen√≠ m≈Ø≈æe pot√© rel√© vypnout, ƒç√≠m≈æ p≈ôeru≈°√≠ nap√°jen√≠ zavla≈æovac√≠ho syst√©mu a zastav√≠ vodu.

![Rel√© zap√≠n√° ƒçerpadlo, kter√© pos√≠l√° vodu k rostlinƒõ](../../../../../images/strawberry-pump.gif)

Ve videu v√Ω≈°e je rel√© zapnuto. LED na rel√© se rozsv√≠t√≠, aby indikovala, ≈æe je zapnuto (nƒõkter√© desky rel√© maj√≠ LED diody, kter√© indikuj√≠, zda je rel√© zapnuto nebo vypnuto), a nap√°jen√≠ je posl√°no do ƒçerpadla, kter√© se zapne a pumpuje vodu do rostliny.

> üíÅ Rel√© m≈Ø≈æe b√Ωt tak√© pou≈æito k p≈ôep√≠n√°n√≠ mezi dvƒõma v√Ωstupn√≠mi obvody m√≠sto zap√≠n√°n√≠ a vyp√≠n√°n√≠ jednoho. Jak se p√°ka pohybuje, p≈ôep√≠n√° sp√≠naƒç z dokonƒçen√≠ jednoho v√Ωstupn√≠ho obvodu na dokonƒçen√≠ jin√©ho v√Ωstupn√≠ho obvodu, obvykle sd√≠lej√≠c√≠ho spoleƒçn√© nap√°jen√≠ nebo spoleƒçn√© uzemnƒõn√≠.

‚úÖ Udƒõlejte si pr≈Øzkum: Existuje nƒõkolik typ≈Ø rel√©, s rozd√≠ly, jako je to, zda ovl√°dac√≠ obvod rel√© zapne nebo vypne, kdy≈æ je nap√°jen, nebo v√≠ce v√Ωstupn√≠ch obvod≈Ø. Zjistƒõte v√≠ce o tƒõchto r≈Øzn√Ωch typech.

Kdy≈æ se p√°ka pohybuje, obvykle sly≈°√≠te, jak se dotkne elektromagnetu s dob≈ôe definovan√Ωm kliknut√≠m.

> üíÅ Rel√© m≈Ø≈æe b√Ωt zapojeno tak, ≈æe vytvo≈ôen√≠ spojen√≠ vlastnƒõ p≈ôeru≈°√≠ nap√°jen√≠ rel√©, ƒç√≠m≈æ rel√© vypne, co≈æ pak po≈°le nap√°jen√≠ zpƒõt do rel√©, aby se znovu zapnulo, a tak d√°le. To znamen√°, ≈æe rel√© bude kliknout velmi rychle a vyd√°vat bzuƒçiv√Ω zvuk. Takto fungovaly nƒõkter√© z prvn√≠ch bzuƒç√°k≈Ø pou≈æ√≠van√Ωch v elektrick√Ωch zvonc√≠ch.

### Nap√°jen√≠ rel√©

Elektromagnet nepot≈ôebuje mnoho energie k aktivaci a p≈ôita≈æen√≠ p√°ky, m≈Ø≈æe b√Ωt ovl√°d√°n pomoc√≠ 3,3V nebo 5V v√Ωstupu z IoT v√Ωvojov√© desky. V√Ωstupn√≠ obvod m≈Ø≈æe p≈ôen√°≈°et mnohem v√≠ce energie, v z√°vislosti na rel√©, vƒçetnƒõ s√≠≈•ov√©ho napƒõt√≠ nebo dokonce vy≈°≈°√≠ch √∫rovn√≠ v√Ωkonu pro pr≈Ømyslov√© pou≈æit√≠. T√≠mto zp≈Øsobem m≈Ø≈æe IoT v√Ωvojov√° deska ovl√°dat zavla≈æovac√≠ syst√©m, od mal√©ho ƒçerpadla pro jednu rostlinu a≈æ po masivn√≠ pr≈Ømyslov√Ω syst√©m pro cel√© komerƒçn√≠ farmy.

![Rel√© Grove s oznaƒçen√Ωm ovl√°dac√≠m obvodem, v√Ωstupn√≠m obvodem a rel√©](../../../../../translated_images/grove-relay-labelled.293e068f5c3c2a199bd7892f2661fdc9e10c920b535cfed317fbd6d1d4ae1168.cs.png)

Obr√°zek v√Ω≈°e ukazuje rel√© Grove. Ovl√°dac√≠ obvod se p≈ôipojuje k IoT za≈ô√≠zen√≠ a zap√≠n√° nebo vyp√≠n√° rel√© pomoc√≠ 3,3V nebo 5V. V√Ωstupn√≠ obvod m√° dva termin√°ly, jeden m≈Ø≈æe b√Ωt nap√°jen√≠ nebo uzemnƒõn√≠. V√Ωstupn√≠ obvod m≈Ø≈æe zvl√°dnout a≈æ 250V p≈ôi 10A, co≈æ je dost pro ≈ôadu za≈ô√≠zen√≠ nap√°jen√Ωch ze s√≠tƒõ. M≈Ø≈æete z√≠skat rel√©, kter√° zvl√°dnou je≈°tƒõ vy≈°≈°√≠ √∫rovnƒõ v√Ωkonu.

![ƒåerpadlo zapojen√© p≈ôes rel√©](../../../../../translated_images/pump-wired-to-relay.66c5cfc0d89189900cd601777f5caeb39ee35c6250f6c86bf38feaceedb21fe9.cs.png)

Na obr√°zku v√Ω≈°e je ƒçerpadlo nap√°jeno p≈ôes rel√©. ƒåerven√Ω dr√°t spojuje +5V termin√°l USB nap√°jec√≠ho zdroje s jedn√≠m termin√°lem v√Ωstupn√≠ho obvodu rel√© a dal≈°√≠ ƒçerven√Ω dr√°t spojuje druh√Ω termin√°l v√Ωstupn√≠ho obvodu s ƒçerpadlem. ƒåern√Ω dr√°t spojuje ƒçerpadlo s uzemnƒõn√≠m USB nap√°jec√≠ho zdroje. Kdy≈æ se rel√© zapne, dokonƒç√≠ obvod, po≈°le 5V do ƒçerpadla a zapne ƒçerpadlo.

## Ovl√°d√°n√≠ rel√©

Rel√© m≈Ø≈æete ovl√°dat z va≈°√≠ IoT v√Ωvojov√© desky.

### √ökol - ovl√°d√°n√≠ rel√©

Projdƒõte si p≈ô√≠slu≈°n√Ω n√°vod k ovl√°d√°n√≠ rel√© pomoc√≠ va≈°eho IoT za≈ô√≠zen√≠:

* [Arduino - Wio Terminal](wio-terminal-relay.md)
* [Jednodeskov√Ω poƒç√≠taƒç - Raspberry Pi](pi-relay.md)
* [Jednodeskov√Ω poƒç√≠taƒç - Virtu√°ln√≠ za≈ô√≠zen√≠](virtual-device-relay.md)

## Ovl√°d√°n√≠ rostliny p≈ôes MQTT

Doposud bylo va≈°e rel√© ovl√°d√°no p≈ô√≠mo IoT za≈ô√≠zen√≠m na z√°kladƒõ jednoho mƒõ≈ôen√≠ vlhkosti p≈Ødy. V komerƒçn√≠m zavla≈æovac√≠m syst√©mu bude ≈ô√≠dic√≠ logika centralizovan√°, co≈æ umo≈æn√≠ rozhodov√°n√≠ o zavla≈æov√°n√≠ na z√°kladƒõ dat z v√≠ce senzor≈Ø a umo≈æn√≠ zmƒõnu konfigurace na jednom m√≠stƒõ. Pro simulaci tohoto procesu m≈Ø≈æete ovl√°dat rel√© p≈ôes MQTT.

### √ökol - ovl√°d√°n√≠ rel√© p≈ôes MQTT

1. P≈ôidejte p≈ô√≠slu≈°n√© MQTT knihovny/pip bal√≠ƒçky a k√≥d do va≈°eho projektu `soil-moisture-sensor`, aby se p≈ôipojil k MQTT. Pojmenujte ID klienta jako `soilmoisturesensor_client` s p≈ôedponou va≈°eho ID.

    > ‚ö†Ô∏è M≈Ø≈æete se odkazovat na [instrukce pro p≈ôipojen√≠ k MQTT v projektu 1, lekce 4, pokud je to pot≈ôeba](../../../1-getting-started/lessons/4-connect-internet/README.md#connect-your-iot-device-to-mqtt).

1. P≈ôidejte p≈ô√≠slu≈°n√Ω k√≥d za≈ô√≠zen√≠ pro odes√≠l√°n√≠ telemetrie s nastaven√≠m vlhkosti p≈Ødy. Pro telemetrickou zpr√°vu pojmenujte vlastnost `soil_moisture`.

    > ‚ö†Ô∏è M≈Ø≈æete se odkazovat na [instrukce pro odes√≠l√°n√≠ telemetrie do MQTT v projektu 1, lekce 4, pokud je to pot≈ôeba](../../../1-getting-started/lessons/4-connect-internet/README.md#send-telemetry-from-your-iot-device).

1. Vytvo≈ôte m√≠stn√≠ serverov√Ω k√≥d pro odbƒõr telemetrie a odes√≠l√°n√≠ p≈ô√≠kazu k ovl√°d√°n√≠ rel√© ve slo≈æce nazvan√© `soil-moisture-sensor-server`. Pojmenujte vlastnost v p≈ô√≠kazov√© zpr√°vƒõ `relay_on` a nastavte ID klienta jako `soilmoisturesensor_server` s p≈ôedponou va≈°eho ID. Zachovejte stejnou strukturu jako serverov√Ω k√≥d, kter√Ω jste napsali pro projekt 1, lekce 4, proto≈æe k tomuto k√≥du budete p≈ôid√°vat pozdƒõji v t√©to lekci.

    > ‚ö†Ô∏è M≈Ø≈æete se odkazovat na [instrukce pro odes√≠l√°n√≠ telemetrie do MQTT](../../../1-getting-started/lessons/4-connect-internet/README.md#write-the-server-code) a [odes√≠l√°n√≠ p≈ô√≠kaz≈Ø p≈ôes MQTT](../../../1-getting-started/lessons/4-connect-internet/README.md#send-commands-to-the-mqtt-broker) v projektu 1, lekce 4, pokud je to pot≈ôeba.

1. P≈ôidejte p≈ô√≠slu≈°n√Ω k√≥d za≈ô√≠zen√≠ pro ovl√°d√°n√≠ rel√© z p≈ôijat√Ωch p≈ô√≠kaz≈Ø, pomoc√≠ vlastnosti `relay_on` ze zpr√°vy. Odes√≠lejte hodnotu true pro `relay_on`, pokud je `soil_moisture` vƒõt≈°√≠ ne≈æ 450, jinak odes√≠lejte false, stejnƒõ jako logiku, kterou jste p≈ôidali pro IoT za≈ô√≠zen√≠ d≈ô√≠ve.

    > ‚ö†Ô∏è M≈Ø≈æete se odkazovat na [instrukce pro reakci na p≈ô√≠kazy z MQTT v projektu 1, lekce 4, pokud je to pot≈ôeba](../../../1-getting-started/lessons/4-connect-internet/README.md#handle-commands-on-the-iot-device).

> üíÅ Tento k√≥d najdete ve slo≈æce [code-mqtt](../../../../../2-farm/lessons/3-automated-plant-watering/code-mqtt).

Ujistƒõte se, ≈æe k√≥d bƒõ≈æ√≠ na va≈°em za≈ô√≠zen√≠ a m√≠stn√≠m serveru, a otestujte ho zmƒõnou √∫rovn√≠ vlhkosti p≈Ødy, buƒè zmƒõnou hodnot odes√≠lan√Ωch virtu√°ln√≠m senzorem, nebo zmƒõnou √∫rovn√≠ vlhkosti p≈Ødy p≈ôid√°n√≠m vody nebo odstranƒõn√≠m senzoru z p≈Ødy.

## Naƒçasov√°n√≠ senzor≈Ø a aktu√°tor≈Ø

V lekci 3 jste vytvo≈ôili noƒçn√≠ svƒõtlo ‚Äì LED, kter√° se rozsv√≠t√≠, jakmile senzor svƒõtla detekuje n√≠zkou √∫rove≈à svƒõtla. Senzor svƒõtla detekoval zmƒõnu √∫rovnƒõ svƒõtla okam≈æitƒõ a za≈ô√≠zen√≠ mohlo rychle reagovat, omezeno pouze d√©lkou zpo≈ædƒõn√≠ ve funkci `loop` nebo smyƒçce `while True:`. Jako IoT v√Ωvoj√°≈ô se nem≈Ø≈æete v≈ædy spol√©hat na tak rychlou zpƒõtnou vazbu.

### Naƒçasov√°n√≠ pro vlhkost p≈Ødy

Pokud jste v minul√© lekci pracovali s fyzick√Ωm senzorem vlhkosti p≈Ødy, mohli jste si v≈°imnout, ≈æe trvalo nƒõkolik sekund, ne≈æ se hodnota vlhkosti p≈Ødy sn√≠≈æila pot√©, co jste zalili rostlinu. To nen√≠ zp≈Øsobeno pomalost√≠ senzoru, ale t√≠m, ≈æe voda pot≈ôebuje ƒças na pros√°knut√≠ p≈Ødou.
üíÅ Pokud jste zal√©vali p≈ô√≠li≈° bl√≠zko senzoru, mohli jste si v≈°imnout, ≈æe hodnota rychle klesla a pot√© se opƒõt zv√Ω≈°ila ‚Äì to je zp≈Øsobeno t√≠m, ≈æe voda v bl√≠zkosti senzoru se roz≈°√≠≈ôila do zbytku p≈Ødy, co≈æ sn√≠≈æilo vlhkost p≈Ødy v okol√≠ senzoru.
![Mƒõ≈ôen√≠ vlhkosti p≈Ødy 658 se bƒõhem zal√©v√°n√≠ nemƒõn√≠, klesne na 320 a≈æ po zal√©v√°n√≠, kdy≈æ voda pros√°kne p≈Ødou](../../../../../translated_images/soil-moisture-travel.a0e31af222cf14385de5380dfc32c7b8213960965228b8e4f7b7ab7f73b310a3.cs.png)

Na diagramu v√Ω≈°e je zobrazeno mƒõ≈ôen√≠ vlhkosti p≈Ødy s hodnotou 658. Rostlina je zal√©v√°na, ale tato hodnota se okam≈æitƒõ nezmƒõn√≠, proto≈æe voda je≈°tƒõ nedos√°hla senzoru. Zal√©v√°n√≠ m≈Ø≈æe dokonce skonƒçit d≈ô√≠ve, ne≈æ voda dos√°hne senzoru, a hodnota klesne, aby odr√°≈æela novou √∫rove≈à vlhkosti.

Pokud byste psali k√≥d pro ovl√°d√°n√≠ zavla≈æovac√≠ho syst√©mu pomoc√≠ rel√© na z√°kladƒõ √∫rovn√≠ vlhkosti p≈Ødy, museli byste vz√≠t tento zpo≈ædƒõn√≠ v √∫vahu a vytvo≈ôit chyt≈ôej≈°√≠ ƒçasov√°n√≠ pro va≈°e IoT za≈ô√≠zen√≠.

‚úÖ Zamyslete se na chv√≠li, jak byste to mohli udƒõlat.

### Ovl√°d√°n√≠ ƒçasov√°n√≠ senzoru a aktu√°toru

P≈ôedstavte si, ≈æe m√°te za √∫kol vytvo≈ôit zavla≈æovac√≠ syst√©m pro farmu. Na z√°kladƒõ typu p≈Ødy byla ide√°ln√≠ √∫rove≈à vlhkosti p≈Ødy pro pƒõstovan√© rostliny stanovena na analogov√© napƒõt√≠ v rozmez√≠ 400‚Äì450.

Mohli byste naprogramovat za≈ô√≠zen√≠ podobnƒõ jako noƒçn√≠ svƒõtlo ‚Äì poka≈æd√©, kdy≈æ senzor namƒõ≈ô√≠ hodnotu nad 450, zapne rel√©, kter√© spust√≠ ƒçerpadlo. Probl√©m je, ≈æe voda pot≈ôebuje ƒças, aby se z ƒçerpadla dostala p≈ôes p≈Ødu k senzoru. Senzor zastav√≠ vodu, kdy≈æ detekuje √∫rove≈à 450, ale √∫rove≈à vlhkosti bude nad√°le klesat, proto≈æe ƒçerpan√° voda st√°le prosakuje p≈Ødou. V√Ωsledkem je pl√Ωtv√°n√≠ vodou a riziko po≈°kozen√≠ ko≈ôen≈Ø.

‚úÖ Pamatujte ‚Äì p≈ô√≠li≈° mnoho vody m≈Ø≈æe b√Ωt pro rostliny stejnƒõ ≈°patn√© jako p≈ô√≠li≈° m√°lo a pl√Ωtv√° cenn√Ωm zdrojem.

Lep≈°√≠m ≈ôe≈°en√≠m je pochopit, ≈æe mezi zapnut√≠m aktu√°toru a zmƒõnou vlastnosti, kterou senzor mƒõ≈ô√≠, existuje zpo≈ædƒõn√≠. To znamen√°, ≈æe senzor by mƒõl nejen chv√≠li poƒçkat, ne≈æ znovu zmƒõ≈ô√≠ hodnotu, ale aktu√°tor by mƒõl b√Ωt vypnut√Ω na urƒçitou dobu p≈ôed dal≈°√≠m mƒõ≈ôen√≠m senzoru.

Jak dlouho by mƒõlo b√Ωt rel√© zapnut√© p≈ôi ka≈æd√©m cyklu? Je lep≈°√≠ b√Ωt opatrn√Ω a zapnout rel√© jen na kr√°tkou dobu, poƒçkat, a≈æ voda pros√°kne, a pot√© znovu zkontrolovat √∫rove≈à vlhkosti. Koneckonc≈Ø, m≈Ø≈æete v≈ædy znovu zapnout ƒçerpadlo, abyste p≈ôidali v√≠ce vody, ale nem≈Ø≈æete vodu z p≈Ødy odebrat.

> üíÅ Tento typ ƒçasov√©ho ovl√°d√°n√≠ je velmi specifick√Ω pro IoT za≈ô√≠zen√≠, kter√© stav√≠te, vlastnost, kterou mƒõ≈ô√≠te, a pou≈æit√© senzory a aktu√°tory.

![Jahodov√° rostlina p≈ôipojen√° k vodƒõ p≈ôes ƒçerpadlo, ƒçerpadlo je p≈ôipojeno k rel√©. Rel√© a senzor vlhkosti p≈Ødy v rostlinƒõ jsou oba p≈ôipojeny k Raspberry Pi](../../../../../translated_images/strawberry-with-pump.b410fc72ac6aabad3e28de9775bf2393ead73dcfec6fd8c9bc01cf107ecd171a.cs.png)

Nap≈ô√≠klad m√°m jahodovou rostlinu se senzorem vlhkosti p≈Ødy a ƒçerpadlem ovl√°dan√Ωm rel√©. Zjistil jsem, ≈æe kdy≈æ p≈ôid√°m vodu, trv√° asi 20 sekund, ne≈æ se mƒõ≈ôen√≠ vlhkosti p≈Ødy stabilizuje. To znamen√°, ≈æe mus√≠m rel√© vypnout a poƒçkat 20 sekund, ne≈æ zkontroluji √∫rove≈à vlhkosti. Radƒõji budu m√≠t m√°lo vody ne≈æ p≈ô√≠li≈° mnoho ‚Äì ƒçerpadlo mohu v≈ædy znovu zapnout, ale nemohu vodu z rostliny odebrat.

![Krok 1: zmƒõ≈ôit hodnotu. Krok 2: p≈ôidat vodu. Krok 3: poƒçkat, a≈æ voda pros√°kne p≈Ødou. Krok 4: znovu zmƒõ≈ôit hodnotu](../../../../../translated_images/soil-moisture-delay.865f3fae206db01d5f8f100f4f44040215d44a0412dd3450aef7ff7b93b6d273.cs.png)

To znamen√°, ≈æe nejlep≈°√≠ proces by byl zavla≈æovac√≠ cyklus, kter√Ω vypad√° takto:

* Zapnout ƒçerpadlo na 5 sekund
* Poƒçkat 20 sekund
* Zkontrolovat vlhkost p≈Ødy
* Pokud je √∫rove≈à st√°le nad po≈æadovanou hodnotou, opakovat v√Ω≈°e uveden√© kroky

5 sekund m≈Ø≈æe b√Ωt pro ƒçerpadlo p≈ô√≠li≈° dlouh√° doba, zvl√°≈°tƒõ pokud jsou √∫rovnƒõ vlhkosti jen m√≠rnƒõ nad po≈æadovanou hodnotou. Nejlep≈°√≠ zp≈Øsob, jak zjistit, jak√© ƒçasov√°n√≠ pou≈æ√≠t, je vyzkou≈°et to, pot√© upravit na z√°kladƒõ dat ze senzoru, s neust√°lou zpƒõtnou vazbou. To m≈Ø≈æe dokonce v√©st k jemnƒõj≈°√≠mu ƒçasov√°n√≠, nap≈ô√≠klad zapnut√≠ ƒçerpadla na 1 sekundu za ka≈æd√Ωch 100 nad po≈æadovanou √∫rove≈à vlhkosti p≈Ødy, m√≠sto pevnƒõ stanoven√Ωch 5 sekund.

‚úÖ Udƒõlejte si pr≈Øzkum: Existuj√≠ dal≈°√≠ ƒçasov√© faktory, kter√© je t≈ôeba zv√°≈æit? M≈Ø≈æe b√Ωt rostlina zal√©v√°na kdykoli, kdy≈æ je vlhkost p≈Ødy p≈ô√≠li≈° n√≠zk√°, nebo existuj√≠ konkr√©tn√≠ denn√≠ doby, kter√© jsou vhodn√© a nevhodn√© pro zal√©v√°n√≠ rostlin?

> üíÅ P≈ôedpovƒõdi poƒças√≠ mohou b√Ωt tak√© zohlednƒõny p≈ôi ovl√°d√°n√≠ automatizovan√Ωch zavla≈æovac√≠ch syst√©m≈Ø pro venkovn√≠ pƒõstov√°n√≠. Pokud se oƒçek√°v√° d√©≈°≈•, zavla≈æov√°n√≠ m≈Ø≈æe b√Ωt odlo≈æeno a≈æ po skonƒçen√≠ de≈°tƒõ. V t√© chv√≠li m≈Ø≈æe b√Ωt p≈Øda dostateƒçnƒõ vlhk√°, tak≈æe nen√≠ pot≈ôeba zal√©vat, co≈æ je mnohem efektivnƒõj≈°√≠ ne≈æ pl√Ωtv√°n√≠ vodou tƒõsnƒõ p≈ôed de≈°tƒõm.

## P≈ôid√°n√≠ ƒçasov√°n√≠ do serveru pro ovl√°d√°n√≠ rostlin

K√≥d serveru m≈Ø≈æe b√Ωt upraven tak, aby p≈ôidal kontrolu nad ƒçasov√°n√≠m zavla≈æovac√≠ho cyklu a ƒçek√°n√≠m na zmƒõnu √∫rovn√≠ vlhkosti p≈Ødy. Logika serveru pro ovl√°d√°n√≠ ƒçasov√°n√≠ rel√© je:

1. P≈ôijmout telemetrickou zpr√°vu
1. Zkontrolovat √∫rove≈à vlhkosti p≈Ødy
1. Pokud je v po≈ô√°dku, nedƒõlat nic. Pokud je hodnota p≈ô√≠li≈° vysok√° (co≈æ znamen√°, ≈æe vlhkost p≈Ødy je p≈ô√≠li≈° n√≠zk√°), pak:
    1. Poslat p≈ô√≠kaz k zapnut√≠ rel√©
    1. Poƒçkat 5 sekund
    1. Poslat p≈ô√≠kaz k vypnut√≠ rel√©
    1. Poƒçkat 20 sekund, ne≈æ se √∫rove≈à vlhkosti p≈Ødy stabilizuje

Zavla≈æovac√≠ cyklus, proces od p≈ôijet√≠ telemetrick√© zpr√°vy po p≈ôipravenost zpracovat √∫rovnƒõ vlhkosti p≈Ødy znovu, trv√° asi 25 sekund. Pos√≠l√°me √∫rovnƒõ vlhkosti p≈Ødy ka≈æd√Ωch 10 sekund, tak≈æe existuje p≈ôekryv, kdy je zpr√°va p≈ôijata, zat√≠mco server ƒçek√° na stabilizaci √∫rovn√≠ vlhkosti p≈Ødy, co≈æ by mohlo spustit dal≈°√≠ zavla≈æovac√≠ cyklus.

Existuj√≠ dvƒõ mo≈ænosti, jak tento probl√©m vy≈ôe≈°it:

* Zmƒõnit k√≥d IoT za≈ô√≠zen√≠ tak, aby pos√≠lalo telemetrii pouze ka≈ædou minutu, t√≠m p√°dem bude zavla≈æovac√≠ cyklus dokonƒçen p≈ôed odesl√°n√≠m dal≈°√≠ zpr√°vy
* Odhl√°sit se z telemetrie bƒõhem zavla≈æovac√≠ho cyklu

Prvn√≠ mo≈ænost nen√≠ v≈ædy dobr√Ωm ≈ôe≈°en√≠m pro velk√© farmy. Farm√°≈ô m≈Ø≈æe cht√≠t zachytit √∫rovnƒõ vlhkosti p≈Ødy bƒõhem zavla≈æov√°n√≠ pro pozdƒõj≈°√≠ anal√Ωzu, nap≈ô√≠klad aby byl informov√°n o pr≈Øtoku vody v r≈Øzn√Ωch oblastech farmy a mohl l√©pe c√≠lit zavla≈æov√°n√≠. Druh√° mo≈ænost je lep≈°√≠ ‚Äì k√≥d jednodu≈°e ignoruje telemetrii, kdy≈æ ji nem≈Ø≈æe vyu≈æ√≠t, ale telemetrie je st√°le k dispozici pro jin√© slu≈æby, kter√© ji mohou odeb√≠rat.

> üíÅ IoT data nejsou pos√≠l√°na pouze z jednoho za≈ô√≠zen√≠ do jedn√© slu≈æby, m√≠sto toho mnoho za≈ô√≠zen√≠ m≈Ø≈æe pos√≠lat data do brokeru a mnoho slu≈æeb m≈Ø≈æe data z brokeru poslouchat. Nap≈ô√≠klad jedna slu≈æba m≈Ø≈æe poslouchat data o vlhkosti p≈Ødy a ukl√°dat je do datab√°ze pro anal√Ωzu pozdƒõji. Jin√° slu≈æba m≈Ø≈æe poslouchat stejnou telemetrii pro ovl√°d√°n√≠ zavla≈æovac√≠ho syst√©mu.

### √ökol ‚Äì p≈ôid√°n√≠ ƒçasov√°n√≠ do serveru pro ovl√°d√°n√≠ rostlin

Aktualizujte k√≥d serveru tak, aby rel√© bƒõ≈æelo 5 sekund, pot√© ƒçekalo 20 sekund.

1. Otev≈ôete slo≈æku `soil-moisture-sensor-server` ve VS Code, pokud ji≈æ nen√≠ otev≈ôen√°. Ujistƒõte se, ≈æe je aktivov√°no virtu√°ln√≠ prost≈ôed√≠.

1. Otev≈ôete soubor `app.py`

1. P≈ôidejte n√°sleduj√≠c√≠ k√≥d do souboru `app.py` pod st√°vaj√≠c√≠ importy:

    ```python
    import threading
    ```

    Tento p≈ô√≠kaz importuje `threading` z knihoven Pythonu, co≈æ umo≈æ≈àuje Pythonu vykon√°vat jin√Ω k√≥d bƒõhem ƒçek√°n√≠.

1. P≈ôidejte n√°sleduj√≠c√≠ k√≥d p≈ôed funkci `handle_telemetry`, kter√° zpracov√°v√° telemetrick√© zpr√°vy p≈ôijat√© serverov√Ωm k√≥dem:

    ```python
    water_time = 5
    wait_time = 20
    ```

    T√≠m se definuje, jak dlouho m√° rel√© bƒõ≈æet (`water_time`) a jak dlouho m√° ƒçekat pot√©, ne≈æ zkontroluje vlhkost p≈Ødy (`wait_time`).

1. Pod tento k√≥d p≈ôidejte n√°sleduj√≠c√≠:

    ```python
    def send_relay_command(client, state):
        command = { 'relay_on' : state }
        print("Sending message:", command)
        client.publish(server_command_topic, json.dumps(command))
    ```

    Tento k√≥d definuje funkci nazvanou `send_relay_command`, kter√° pos√≠l√° p≈ô√≠kaz p≈ôes MQTT k ovl√°d√°n√≠ rel√©. Telemetrie je vytvo≈ôena jako slovn√≠k, pot√© p≈ôevedena na JSON ≈ôetƒõzec. Hodnota p≈ôedan√° do `state` urƒçuje, zda m√° b√Ωt rel√© zapnuto nebo vypnuto.

1. Po funkci `send_relay_code` p≈ôidejte n√°sleduj√≠c√≠ k√≥d:

    ```python
    def control_relay(client):
        print("Unsubscribing from telemetry")
        mqtt_client.unsubscribe(client_telemetry_topic)
    
        send_relay_command(client, True)
        time.sleep(water_time)
        send_relay_command(client, False)
    
        time.sleep(wait_time)
    
        print("Subscribing to telemetry")
        mqtt_client.subscribe(client_telemetry_topic)
    ```

    T√≠m se definuje funkce pro ovl√°d√°n√≠ rel√© na z√°kladƒõ po≈æadovan√©ho ƒçasov√°n√≠. Zaƒç√≠n√° odhl√°≈°en√≠m z telemetrie, aby zpr√°vy o vlhkosti p≈Ødy nebyly zpracov√°v√°ny bƒõhem zavla≈æov√°n√≠. Pot√© pos√≠l√° p≈ô√≠kaz k zapnut√≠ rel√©. N√°slednƒõ ƒçek√° po dobu `water_time`, ne≈æ po≈°le p≈ô√≠kaz k vypnut√≠ rel√©. Nakonec ƒçek√° na stabilizaci √∫rovn√≠ vlhkosti p≈Ødy po dobu `wait_time` sekund. Pot√© se znovu p≈ôihl√°s√≠ k telemetrii.

1. Zmƒõ≈àte funkci `handle_telemetry` na n√°sleduj√≠c√≠:

    ```python
    def handle_telemetry(client, userdata, message):
        payload = json.loads(message.payload.decode())
        print("Message received:", payload)
    
        if payload['soil_moisture'] > 450:
            threading.Thread(target=control_relay, args=(client,)).start()
    ```

    Tento k√≥d kontroluje √∫rove≈à vlhkosti p≈Ødy. Pokud je vy≈°≈°√≠ ne≈æ 450, p≈Øda pot≈ôebuje zal√≠t, tak≈æe vol√° funkci `control_relay`. Tato funkce bƒõ≈æ√≠ na samostatn√©m vl√°knƒõ, kter√© bƒõ≈æ√≠ na pozad√≠.

1. Ujistƒõte se, ≈æe va≈°e IoT za≈ô√≠zen√≠ bƒõ≈æ√≠, pot√© spus≈•te tento k√≥d. Zmƒõ≈àte √∫rovnƒõ vlhkosti p≈Ødy a sledujte, co se dƒõje s rel√© ‚Äì mƒõlo by se zapnout na 5 sekund, pot√© z≈Østat vypnut√© alespo≈à 20 sekund, zapnout se pouze tehdy, pokud √∫rovnƒõ vlhkosti p≈Ødy nejsou dostateƒçn√©.

    ```output
    (.venv) ‚ûú  soil-moisture-sensor-server ‚úó python app.py
    Message received: {'soil_moisture': 457}
    Unsubscribing from telemetry
    Sending message: {'relay_on': True}
    Sending message: {'relay_on': False}
    Subscribing to telemetry
    Message received: {'soil_moisture': 302}
    ```

    Dobr√Ω zp≈Øsob, jak to otestovat v simulovan√©m zavla≈æovac√≠m syst√©mu, je pou≈æ√≠t suchou p≈Ødu, pot√© ruƒçnƒõ nal√≠t vodu, zat√≠mco je rel√© zapnut√©, a p≈ôestat nal√©vat, kdy≈æ se rel√© vypne.

> üíÅ Tento k√≥d najdete ve slo≈æce [code-timing](../../../../../2-farm/lessons/3-automated-plant-watering/code-timing).

> üíÅ Pokud chcete pou≈æ√≠t ƒçerpadlo k vytvo≈ôen√≠ skuteƒçn√©ho zavla≈æovac√≠ho syst√©mu, m≈Ø≈æete pou≈æ√≠t [6V vodn√≠ ƒçerpadlo](https://www.seeedstudio.com/6V-Mini-Water-Pump-p-1945.html) s [USB nap√°jec√≠m termin√°lem](https://www.adafruit.com/product/3628). Ujistƒõte se, ≈æe nap√°jen√≠ do nebo z ƒçerpadla je p≈ôipojeno p≈ôes rel√©.

---

## üöÄ V√Ωzva

Napad√° v√°s nƒõjak√© jin√© IoT nebo elektrick√© za≈ô√≠zen√≠, kter√© m√° podobn√Ω probl√©m, kdy trv√° nƒõjakou dobu, ne≈æ v√Ωsledky aktu√°toru dos√°hnou senzoru? Pravdƒõpodobnƒõ m√°te nƒõkolik takov√Ωch za≈ô√≠zen√≠ doma nebo ve ≈°kole.

* Jak√© vlastnosti mƒõ≈ô√≠?
* Jak dlouho trv√°, ne≈æ se vlastnost zmƒõn√≠ po pou≈æit√≠ aktu√°toru?
* Je v po≈ô√°dku, pokud se vlastnost zmƒõn√≠ nad po≈æadovanou hodnotu?
* Jak ji lze vr√°tit zpƒõt na po≈æadovanou hodnotu, pokud je to pot≈ôeba?

## Kv√≠z po p≈ôedn√°≈°ce

[Kv√≠z po p≈ôedn√°≈°ce](https://black-meadow-040d15503.1.azurestaticapps.net/quiz/14)

## P≈ôehled & Samostudium

* P≈ôeƒçtƒõte si v√≠ce o rel√©, vƒçetnƒõ jejich historick√©ho vyu≈æit√≠ v telefonn√≠ch √∫st≈ôedn√°ch, na [str√°nce Wikipedia o rel√©](https://wikipedia.org/wiki/Relay).

## Zad√°n√≠

[Vybudujte efektivnƒõj≈°√≠ zavla≈æovac√≠ cyklus](assignment.md)

---

**Prohl√°≈°en√≠**:  
Tento dokument byl p≈ôelo≈æen pomoc√≠ slu≈æby pro automatick√Ω p≈ôeklad [Co-op Translator](https://github.com/Azure/co-op-translator). I kdy≈æ se sna≈æ√≠me o p≈ôesnost, mƒõjte na pamƒõti, ≈æe automatick√© p≈ôeklady mohou obsahovat chyby nebo nep≈ôesnosti. P≈Øvodn√≠ dokument v jeho p≈Øvodn√≠m jazyce by mƒõl b√Ωt pova≈æov√°n za autoritativn√≠ zdroj. Pro kritick√© informace se doporuƒçuje profesion√°ln√≠ lidsk√Ω p≈ôeklad. Nenese odpovƒõdnost za ≈æ√°dn√© nedorozumƒõn√≠ nebo nespr√°vn√© interpretace vypl√Ωvaj√≠c√≠ z pou≈æit√≠ tohoto p≈ôekladu.