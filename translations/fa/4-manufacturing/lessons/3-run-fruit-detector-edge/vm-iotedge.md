<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "24dc783a600e20251211987b36370e93",
  "translation_date": "2025-08-25T21:08:38+00:00",
  "source_file": "4-manufacturing/lessons/3-run-fruit-detector-edge/vm-iotedge.md",
  "language_code": "fa"
}
-->
# ایجاد یک ماشین مجازی با IoT Edge

در Azure، می‌توانید یک ماشین مجازی ایجاد کنید - یک کامپیوتر در فضای ابری که می‌توانید آن را به هر شکلی که می‌خواهید پیکربندی کنید و نرم‌افزار خود را روی آن اجرا کنید.

> 💁 می‌توانید اطلاعات بیشتری درباره ماشین‌های مجازی در [صفحه ماشین مجازی در ویکی‌پدیا](https://wikipedia.org/wiki/Virtual_machine) بخوانید.

## وظیفه - راه‌اندازی یک ماشین مجازی IoT Edge

1. دستور زیر را اجرا کنید تا یک ماشین مجازی ایجاد کنید که Azure IoT Edge از قبل روی آن نصب شده باشد:

    ```sh
    az deployment group create \
                --resource-group fruit-quality-detector \
                --template-uri https://raw.githubusercontent.com/Azure/iotedge-vm-deploy/1.2.0/edgeDeploy.json \
                --parameters dnsLabelPrefix=<vm_name> \
                --parameters adminUsername=<username> \
                --parameters deviceConnectionString="<connection_string>" \
                --parameters authenticationType=password \
                --parameters adminPasswordOrKey="<password>"
    ```

    `<vm_name>` را با یک نام برای این ماشین مجازی جایگزین کنید. این نام باید به صورت جهانی یکتا باشد، بنابراین از چیزی مانند `fruit-quality-detector-vm-` به همراه نام خودتان یا یک مقدار دیگر در انتها استفاده کنید.

    `<username>` و `<password>` را با یک نام کاربری و رمز عبور برای ورود به ماشین مجازی جایگزین کنید. این مقادیر باید نسبتاً امن باشند، بنابراین نمی‌توانید از admin/password استفاده کنید.

    `<connection_string>` را با رشته اتصال دستگاه IoT Edge خود به نام `fruit-quality-detector-edge` جایگزین کنید.

    این دستور یک ماشین مجازی با پیکربندی `DS1 v2` ایجاد می‌کند. این دسته‌بندی‌ها نشان‌دهنده قدرت ماشین و در نتیجه هزینه آن هستند. این ماشین مجازی دارای 1 CPU و 3.5 گیگابایت RAM است.

    > 💰 می‌توانید قیمت فعلی این ماشین‌های مجازی را در [راهنمای قیمت‌گذاری ماشین‌های مجازی Azure](https://azure.microsoft.com/pricing/details/virtual-machines/linux/?WT.mc_id=academic-17441-jabenn) مشاهده کنید.

    پس از ایجاد ماشین مجازی، IoT Edge runtime به صورت خودکار نصب می‌شود و برای اتصال به IoT Hub شما به عنوان دستگاه `fruit-quality-detector-edge` پیکربندی می‌شود.

1. برای فراخوانی طبقه‌بندی‌کننده تصویر از این ماشین، به آدرس IP یا نام DNS ماشین مجازی نیاز دارید. دستور زیر را اجرا کنید تا این اطلاعات را دریافت کنید:

    ```sh
    az vm list --resource-group fruit-quality-detector \
               --output table \
               --show-details
    ```

    مقدار فیلد `PublicIps` یا فیلد `Fqdns` را کپی کنید.

1. ماشین‌های مجازی هزینه دارند. در زمان نگارش این متن، یک ماشین DS1 حدود 0.06 دلار در ساعت هزینه دارد. برای کاهش هزینه‌ها، باید ماشین مجازی را زمانی که از آن استفاده نمی‌کنید خاموش کنید و پس از اتمام پروژه آن را حذف کنید.

    می‌توانید ماشین مجازی خود را طوری پیکربندی کنید که به صورت خودکار در یک زمان مشخص هر روز خاموش شود. این کار باعث می‌شود اگر فراموش کردید آن را خاموش کنید، هزینه‌ای بیشتر از زمان تا خاموشی خودکار پرداخت نکنید. از دستور زیر برای تنظیم این کار استفاده کنید:

    ```sh
    az vm auto-shutdown --resource-group fruit-quality-detector \
                        --name <vm_name> \
                        --time <shutdown_time_utc>
    ```

    `<vm_name>` را با نام ماشین مجازی خود جایگزین کنید.

    `<shutdown_time_utc>` را با زمان UTC که می‌خواهید ماشین مجازی خاموش شود جایگزین کنید. این زمان باید به صورت 4 رقمی به شکل HHMM باشد. برای مثال، اگر می‌خواهید در نیمه‌شب UTC خاموش شود، مقدار `0000` را تنظیم کنید. برای ساعت 7:30 عصر در ساحل غربی آمریکا، مقدار `0230` را وارد کنید (7:30 عصر در ساحل غربی آمریکا برابر با 2:30 صبح UTC است).

1. طبقه‌بندی‌کننده تصویر شما روی این دستگاه Edge اجرا خواهد شد و به پورت 80 (پورت استاندارد HTTP) گوش می‌دهد. به طور پیش‌فرض، پورت‌های ورودی در ماشین‌های مجازی مسدود هستند، بنابراین باید پورت 80 را فعال کنید. پورت‌ها در گروه‌های امنیتی شبکه فعال می‌شوند، بنابراین ابتدا باید نام گروه امنیتی شبکه ماشین مجازی خود را بدانید که می‌توانید با دستور زیر پیدا کنید:

    ```sh
    az network nsg list --resource-group fruit-quality-detector \
                        --output table
    ```

    مقدار فیلد `Name` را کپی کنید.

1. دستور زیر را اجرا کنید تا یک قانون برای باز کردن پورت 80 در گروه امنیتی شبکه اضافه کنید:

    ```sh
    az network nsg rule create \
                        --resource-group fruit-quality-detector \
                        --name Port_80 \
                        --protocol tcp \
                        --priority 1010 \
                        --destination-port-range 80 \
                        --nsg-name <nsg name>
    ```

    `<nsg name>` را با نام گروه امنیتی شبکه از مرحله قبل جایگزین کنید.

### وظیفه - مدیریت ماشین مجازی برای کاهش هزینه‌ها

1. زمانی که از ماشین مجازی خود استفاده نمی‌کنید، باید آن را خاموش کنید. برای خاموش کردن ماشین مجازی، از دستور زیر استفاده کنید:

    ```sh
    az vm deallocate --resource-group fruit-quality-detector \
                     --name <vm_name>
    ```

    `<vm_name>` را با نام ماشین مجازی خود جایگزین کنید.

    > 💁 یک دستور `az vm stop` وجود دارد که ماشین مجازی را متوقف می‌کند، اما کامپیوتر همچنان به شما اختصاص داده می‌شود، بنابراین همچنان هزینه‌ای مشابه زمانی که در حال اجرا است پرداخت می‌کنید.

1. برای راه‌اندازی مجدد ماشین مجازی، از دستور زیر استفاده کنید:

    ```sh
    az vm start --resource-group fruit-quality-detector \
                --name <vm_name>
    ```

    `<vm_name>` را با نام ماشین مجازی خود جایگزین کنید.

**سلب مسئولیت**:  
این سند با استفاده از سرویس ترجمه هوش مصنوعی [Co-op Translator](https://github.com/Azure/co-op-translator) ترجمه شده است. در حالی که ما تلاش می‌کنیم دقت را حفظ کنیم، لطفاً توجه داشته باشید که ترجمه‌های خودکار ممکن است شامل خطاها یا نادرستی‌ها باشند. سند اصلی به زبان اصلی آن باید به عنوان منبع معتبر در نظر گرفته شود. برای اطلاعات حساس، توصیه می‌شود از ترجمه حرفه‌ای انسانی استفاده کنید. ما مسئولیتی در قبال سوء تفاهم‌ها یا تفسیرهای نادرست ناشی از استفاده از این ترجمه نداریم.