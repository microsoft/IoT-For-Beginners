<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "0ac0afcfb40cb5970ef4cb74f01c32e9",
  "translation_date": "2025-08-25T22:41:23+00:00",
  "source_file": "6-consumer/lessons/1-speech-recognition/pi-audio.md",
  "language_code": "fa"
}
-->
# ุถุจุท ุตุฏุง - ุฑุฒุจุฑ ูพุง

ุฏุฑ ุงู ุจุฎุด ุงุฒ ุฏุฑุณุ ุดูุง ฺฉุฏ ุฎูุงูุฏ ููุดุช ฺฉู ุตุฏุง ุฑุง ุฑู ุฑุฒุจุฑ ูพุง ุถุจุท ฺฉูุฏ. ุถุจุท ุตุฏุง ุชูุณุท ฺฉ ุฏฺฉูู ฺฉูุชุฑู ุฎูุงูุฏ ุดุฏ.

## ุณุฎุชโุงูุฒุงุฑ

ุฑุฒุจุฑ ูพุง ุจู ฺฉ ุฏฺฉูู ูุงุฒ ุฏุงุฑุฏ ุชุง ุถุจุท ุตุฏุง ุฑุง ฺฉูุชุฑู ฺฉูุฏ.

ุฏฺฉููโุง ฺฉู ุงุณุชูุงุฏู ูโฺฉูุฏ ฺฉ ุฏฺฉูู Grove ุงุณุช. ุงู ฺฉ ุญุณฺฏุฑ ุฏุฌุชุงู ุงุณุช ฺฉู ุณฺฏูุงู ุฑุง ุฑูุดู ุง ุฎุงููุด ูโฺฉูุฏ. ุงู ุฏฺฉููโูุง ูโุชูุงููุฏ ุทูุฑ ุชูุธู ุดููุฏ ฺฉู ููฺฏุงู ูุดุงุฑ ุฏุงุฏู ุฏฺฉูู ุณฺฏูุงู ุจุงูุง ุงุฑุณุงู ฺฉููุฏ ู ููุช ูุดุงุฑ ุฏุงุฏู ูุดุฏู ุณฺฏูุงู ูพุงูุ ุง ุจุฑุนฺฉุณ.

ุงฺฏุฑ ุงุฒ ูฺฉุฑูููู ReSpeaker 2-Mics Pi HAT ุงุณุชูุงุฏู ูโฺฉูุฏุ ูุงุฒ ุจู ุงุชุตุงู ุฏฺฉูู ูุณุช ุฒุฑุง ุงู ูุช ฺฉ ุฏฺฉูู ุฏุงุฎู ุฏุงุฑุฏ. ุจู ุจุฎุด ุจุนุฏ ุจุฑูุฏ.

### ุงุชุตุงู ุฏฺฉูู

ุฏฺฉูู ูโุชูุงูุฏ ุจู ูุช ูพุงู Grove ูุชุตู ุดูุฏ.

#### ูุธูู - ุงุชุตุงู ุฏฺฉูู

![ฺฉ ุฏฺฉูู Grove](../../../../../translated_images/grove-button.a70cfbb809a8563681003250cf5b06d68cdcc68624f9e2f493d5a534ae2da1e5.fa.png)

1. ฺฉ ุณุฑ ฺฉุงุจู Grove ุฑุง ุจู ุณูฺฉุช ุฑู ูุงฺูู ุฏฺฉูู ูุงุฑุฏ ฺฉูุฏ. ฺฉุงุจู ููุท ุจู ฺฉ ุฌูุช ูุงุฑุฏ ูโุดูุฏ.

1. ุจุง ุฎุงููุด ุจูุฏู ุฑุฒุจุฑ ูพุงุ ุณุฑ ุฏฺฏุฑ ฺฉุงุจู Grove ุฑุง ุจู ุณูฺฉุช ุฏุฌุชุงู ุจุง ุนูุงูุช **D5** ุฑู ูุช ูพุงู Grove ฺฉู ุจู ูพุง ูุชุตู ุงุณุช ูุตู ฺฉูุฏ. ุงู ุณูฺฉุช ุฏููู ุณูฺฉุช ุงุฒ ุณูุช ฺูพ ุฏุฑ ุฑุฏู ุณูฺฉุชโูุง ฺฉูุงุฑ ูพูโูุง GPIO ุงุณุช.

![ุฏฺฉูู Grove ูุชุตู ุจู ุณูฺฉุช D5](../../../../../translated_images/pi-button.c7a1a4f55943341ce1baf1057658e9a205804d4131d258e820c93f951df0abf3.fa.png)

## ุถุจุท ุตุฏุง

ุดูุง ูโุชูุงูุฏ ุจุง ุงุณุชูุงุฏู ุงุฒ ฺฉุฏ ูพุงุชูู ุตุฏุง ุฑุง ุงุฒ ูฺฉุฑูููู ุถุจุท ฺฉูุฏ.

### ูุธูู - ุถุจุท ุตุฏุง

1. ูพุง ุฑุง ุฑูุดู ฺฉูุฏ ู ููุชุธุฑ ุจูุงูุฏ ุชุง ุจูุช ุดูุฏ.

1. VS Code ุฑุง ุงุฌุฑุง ฺฉูุฏุ ุง ูุณุชููุงู ุฑู ูพุง ุง ุงุฒ ุทุฑู ุงูุฒููู Remote SSH ูุชุตู ุดูุฏ.

1. ุจุณุชู PyAudio Pip ุฏุงุฑุง ุชูุงุจุน ุจุฑุง ุถุจุท ู ูพุฎุด ุตุฏุง ุงุณุช. ุงู ุจุณุชู ุจู ุจุฑุฎ ฺฉุชุงุจุฎุงููโูุง ุตูุช ูุงุฒ ุฏุงุฑุฏ ฺฉู ุงุจุชุฏุง ุจุงุฏ ูุตุจ ุดููุฏ. ุฏุณุชูุฑุงุช ุฒุฑ ุฑุง ุฏุฑ ุชุฑููุงู ุงุฌุฑุง ฺฉูุฏ ุชุง ุงู ฺฉุชุงุจุฎุงููโูุง ูุตุจ ุดููุฏ:

    ```sh
    sudo apt update
    sudo apt install libportaudio0 libportaudio2 libportaudiocpp0 portaudio19-dev libasound2-plugins --yes 
    ```

1. ุจุณุชู PyAudio Pip ุฑุง ูุตุจ ฺฉูุฏ.

    ```sh
    pip3 install pyaudio
    ```

1. ฺฉ ูพูุดู ุฌุฏุฏ ุจู ูุงู `smart-timer` ุงุฌุงุฏ ฺฉูุฏ ู ฺฉ ูุงู ุจู ูุงู `app.py` ุจู ุงู ูพูุดู ุงุถุงูู ฺฉูุฏ.

1. ูุงุฑุฏุงุช ุฒุฑ ุฑุง ุจู ุจุงูุง ุงู ูุงู ุงุถุงูู ฺฉูุฏ:

    ```python
    import io
    import pyaudio
    import time
    import wave
    
    from grove.factory import Factory
    ```

    ุงู ฺฉุฏ ูุงฺูู `pyaudio`ุ ุจุฑุฎ ูุงฺููโูุง ุงุณุชุงูุฏุงุฑุฏ ูพุงุชูู ุจุฑุง ูุฏุฑุช ูุงูโูุง wave ู ูุงฺูู `grove.factory` ุฑุง ุจุฑุง ูุงุฑุฏ ฺฉุฑุฏู ฺฉ ฺฉูุงุณ ุฏฺฉูู ุงุฒ Factory ูุงุฑุฏ ูโฺฉูุฏ.

1. ุฏุฑ ุฒุฑ ุงู ูุงุฑุฏุงุชุ ฺฉุฏ ุจุฑุง ุงุฌุงุฏ ฺฉ ุฏฺฉูู Grove ุงุถุงูู ฺฉูุฏ.

    ุงฺฏุฑ ุงุฒ ReSpeaker 2-Mics Pi HAT ุงุณุชูุงุฏู ูโฺฉูุฏุ ุงุฒ ฺฉุฏ ุฒุฑ ุงุณุชูุงุฏู ฺฉูุฏ:

    ```python
    # The button on the ReSpeaker 2-Mics Pi HAT
    button = Factory.getButton("GPIO-LOW", 17)
    ```

    ุงู ฺฉุฏ ฺฉ ุฏฺฉูู ุฑู ูพูุฑุช **D17** ุงุฌุงุฏ ูโฺฉูุฏุ ูพูุฑุช ฺฉู ุฏฺฉูู ุฑู ReSpeaker 2-Mics Pi HAT ุจู ุขู ูุชุตู ุงุณุช. ุงู ุฏฺฉูู ุทูุฑ ุชูุธู ุดุฏู ฺฉู ููฺฏุงู ูุดุงุฑ ุฏุงุฏู ุณฺฏูุงู ูพุงู ุงุฑุณุงู ฺฉูุฏ.

    ุงฺฏุฑ ุงุฒ ReSpeaker 2-Mics Pi HAT ุงุณุชูุงุฏู ููโฺฉูุฏ ู ุงุฒ ุฏฺฉูู Grove ูุชุตู ุจู ูุช ูพุงู ุงุณุชูุงุฏู ูโฺฉูุฏุ ุงุฒ ุงู ฺฉุฏ ุงุณุชูุงุฏู ฺฉูุฏ:

    ```python
    button = Factory.getButton("GPIO-HIGH", 5)
    ```

    ุงู ฺฉุฏ ฺฉ ุฏฺฉูู ุฑู ูพูุฑุช **D5** ุงุฌุงุฏ ูโฺฉูุฏ ฺฉู ุทูุฑ ุชูุธู ุดุฏู ฺฉู ููฺฏุงู ูุดุงุฑ ุฏุงุฏู ุณฺฏูุงู ุจุงูุง ุงุฑุณุงู ฺฉูุฏ.

1. ุฏุฑ ุฒุฑ ุงู ฺฉุฏุ ฺฉ ููููู ุงุฒ ฺฉูุงุณ PyAudio ุจุฑุง ูุฏุฑุช ุตุฏุง ุงุฌุงุฏ ฺฉูุฏ:

    ```python
    audio = pyaudio.PyAudio()
    ```

1. ุดูุงุฑู ฺฉุงุฑุช ุณุฎุชโุงูุฒุงุฑ ุจุฑุง ูฺฉุฑูููู ู ุจููุฏฺฏู ุฑุง ุงุนูุงู ฺฉูุฏ. ุงู ุดูุงุฑู ฺฉุงุฑุช ููุงู ุดูุงุฑูโุง ุงุณุช ฺฉู ุจุง ุงุฌุฑุง `arecord -l` ู `aplay -l` ุฏุฑ ุจุฎุด ูุจู ุฏุฑุณ ูพุฏุง ฺฉุฑุฏุฏ.

    ```python
    microphone_card_number = <microphone card number>
    speaker_card_number = <speaker card number>
    ```

    `<microphone card number>` ุฑุง ุจุง ุดูุงุฑู ฺฉุงุฑุช ูฺฉุฑูููู ุฎูุฏ ุฌุงฺฏุฒู ฺฉูุฏ.

    `<speaker card number>` ุฑุง ุจุง ุดูุงุฑู ฺฉุงุฑุช ุจููุฏฺฏู ุฎูุฏ ุฌุงฺฏุฒู ฺฉูุฏุ ููุงู ุดูุงุฑูโุง ฺฉู ุฏุฑ ูุงู `alsa.conf` ุชูุธู ฺฉุฑุฏุฏ.

1. ุฏุฑ ุฒุฑ ุงู ฺฉุฏุ ูุฑุฎ ูููููโุจุฑุฏุงุฑ ุจุฑุง ุถุจุท ู ูพุฎุด ุตุฏุง ุฑุง ุงุนูุงู ฺฉูุฏ. ููฺฉู ุงุณุช ูุงุฒู ุจุงุดุฏ ุงู ููุฏุงุฑ ุฑุง ุจุณุชู ุจู ุณุฎุชโุงูุฒุงุฑ ุฎูุฏ ุชุบุฑ ุฏูุฏ.

    ```python
    rate = 48000 #48KHz
    ```

    ุงฺฏุฑ ููฺฏุงู ุงุฌุฑุง ุงู ฺฉุฏ ุฎุทุงูุง ูุฑุฎ ูููููโุจุฑุฏุงุฑ ุฏุฑุงูุช ฺฉุฑุฏุฏุ ุงู ููุฏุงุฑ ุฑุง ุจู `44100` ุง `16000` ุชุบุฑ ุฏูุฏ. ูุฑฺู ููุฏุงุฑ ุจุงูุงุชุฑ ุจุงุดุฏุ ฺฉูุช ุตุฏุง ุจูุชุฑ ุฎูุงูุฏ ุจูุฏ.

1. ุฏุฑ ุฒุฑ ุงู ฺฉุฏุ ฺฉ ุชุงุจุน ุฌุฏุฏ ุจู ูุงู `capture_audio` ุงุฌุงุฏ ฺฉูุฏ. ุงู ุชุงุจุน ุจุฑุง ุถุจุท ุตุฏุง ุงุฒ ูฺฉุฑูููู ูุฑุงุฎูุงู ุฎูุงูุฏ ุดุฏ:

    ```python
    def capture_audio():
    ```

1. ุฏุงุฎู ุงู ุชุงุจุนุ ฺฉุฏ ุฒุฑ ุฑุง ุจุฑุง ุถุจุท ุตุฏุง ุงุถุงูู ฺฉูุฏ:

    ```python
    stream = audio.open(format = pyaudio.paInt16,
                        rate = rate,
                        channels = 1, 
                        input_device_index = microphone_card_number,
                        input = True,
                        frames_per_buffer = 4096)

    frames = []

    while button.is_pressed():
        frames.append(stream.read(4096))

    stream.stop_stream()
    stream.close()
    ```

    ุงู ฺฉุฏ ฺฉ ุฌุฑุงู ูุฑูุฏ ุตูุช ุจุง ุงุณุชูุงุฏู ุงุฒ ุด PyAudio ุจุงุฒ ูโฺฉูุฏ. ุงู ุฌุฑุงู ุตุฏุง ุฑุง ุงุฒ ูฺฉุฑูููู ุจุง ูุฑุฎ 16KHz ุถุจุท ูโฺฉูุฏ ู ุขู ุฑุง ุฏุฑ ุจุงูุฑูุง ุจู ุงูุฏุงุฒู 4096 ุจุงุช ุฐุฎุฑู ูโฺฉูุฏ.

    ฺฉุฏ ุณูพุณ ุฏุฑ ุญุงู ฺฉู ุฏฺฉูู Grove ูุดุงุฑ ุฏุงุฏู ุดุฏู ุงุณุชุ ุงู ุจุงูุฑูุง 4096 ุจุงุช ุฑุง ุฏุฑ ฺฉ ุขุฑุงู ูโุฎูุงูุฏ.

    > ๐ ูโุชูุงูุฏ ุงุทูุงุนุงุช ุจุดุชุฑ ุฏุฑุจุงุฑู ฺฏุฒููโูุง ุงุฑุณุงู ุดุฏู ุจู ูุชุฏ `open` ุฏุฑ [ูุณุชูุฏุงุช PyAudio](https://people.csail.mit.edu/hubert/pyaudio/docs/) ุจุฎูุงูุฏ.

    ููุช ุฏฺฉูู ุฑูุง ุดุฏุ ุฌุฑุงู ูุชููู ู ุจุณุชู ูโุดูุฏ.

1. ฺฉุฏ ุฒุฑ ุฑุง ุจู ุงูุชูุง ุงู ุชุงุจุน ุงุถุงูู ฺฉูุฏ:

    ```python
    wav_buffer = io.BytesIO()
    with wave.open(wav_buffer, 'wb') as wavefile:
        wavefile.setnchannels(1)
        wavefile.setsampwidth(audio.get_sample_size(pyaudio.paInt16))
        wavefile.setframerate(rate)
        wavefile.writeframes(b''.join(frames))
        wav_buffer.seek(0)

    return wav_buffer
    ```

    ุงู ฺฉุฏ ฺฉ ุจุงูุฑ ุจุงูุฑ ุงุฌุงุฏ ูโฺฉูุฏ ู ุชูุงู ุตุฏุง ุถุจุท ุดุฏู ุฑุง ุจู ุนููุงู ฺฉ [ูุงู WAV](https://wikipedia.org/wiki/WAV) ูโููุณุฏ. ุงู ฺฉ ุฑูุด ุงุณุชุงูุฏุงุฑุฏ ุจุฑุง ููุดุชู ุตุฏุง ูุดุฑุฏูโูุดุฏู ุฏุฑ ฺฉ ูุงู ุงุณุช. ุณูพุณ ุงู ุจุงูุฑ ุจุงุฒฺฏุฑุฏุงูุฏู ูโุดูุฏ.

1. ุชุงุจุน ุฒุฑ ุจู ูุงู `play_audio` ุฑุง ุจุฑุง ูพุฎุด ุจุงูุฑ ุตูุช ุงุถุงูู ฺฉูุฏ:

    ```python
    def play_audio(buffer):
        stream = audio.open(format = pyaudio.paInt16,
                            rate = rate,
                            channels = 1,
                            output_device_index = speaker_card_number,
                            output = True)
    
        with wave.open(buffer, 'rb') as wf:
            data = wf.readframes(4096)
    
            while len(data) > 0:
                stream.write(data)
                data = wf.readframes(4096)
    
            stream.close()
    ```

    ุงู ุชุงุจุน ฺฉ ุฌุฑุงู ุตูุช ุฏฺฏุฑ ุจุงุฒ ูโฺฉูุฏุ ุงู ุจุงุฑ ุจุฑุง ุฎุฑูุฌ - ุจุฑุง ูพุฎุด ุตุฏุง. ุงุฒ ุชูุธูุงุช ูุดุงุจู ุฌุฑุงู ูุฑูุฏ ุงุณุชูุงุฏู ูโฺฉูุฏ. ุจุงูุฑ ุจู ุนููุงู ฺฉ ูุงู wave ุจุงุฒ ูโุดูุฏ ู ุฏุฑ ูุทุนุงุช 4096 ุจุงุช ุจู ุฌุฑุงู ุฎุฑูุฌ ููุดุชู ูโุดูุฏุ ุตุฏุง ุฑุง ูพุฎุด ูโฺฉูุฏ. ุณูพุณ ุฌุฑุงู ุจุณุชู ูโุดูุฏ.

1. ฺฉุฏ ุฒุฑ ุฑุง ุฏุฑ ุฒุฑ ุชุงุจุน `capture_audio` ุงุถุงูู ฺฉูุฏ ุชุง ุญูููโุง ุงุฌุงุฏ ุดูุฏ ฺฉู ุชุง ุฒูุงู ฺฉู ุฏฺฉูู ูุดุงุฑ ุฏุงุฏู ุดูุฏ ุงุฌุฑุง ุดูุฏ. ููุช ุฏฺฉูู ูุดุงุฑ ุฏุงุฏู ุดุฏุ ุตุฏุง ุถุจุท ู ุณูพุณ ูพุฎุด ูโุดูุฏ.

    ```python
    while True:
        while not button.is_pressed():
            time.sleep(.1)
        
        buffer = capture_audio()
        play_audio(buffer)
    ```

1. ฺฉุฏ ุฑุง ุงุฌุฑุง ฺฉูุฏ. ุฏฺฉูู ุฑุง ูุดุงุฑ ุฏูุฏ ู ุฏุฑ ูฺฉุฑูููู ุตุญุจุช ฺฉูุฏ. ููุช ฺฉุงุฑุชุงู ุชูุงู ุดุฏ ุฏฺฉูู ุฑุง ุฑูุง ฺฉูุฏ ู ุถุจุท ุฑุง ุจุดููุฏ.

    ููฺฉู ุงุณุช ููฺฏุงู ุงุฌุงุฏ ููููู PyAudio ุฎุทุงูุง ALSA ุฏุฑุงูุช ฺฉูุฏ. ุงู ุฎุทุงูุง ุจู ุฏูู ุชูุธูุงุช ูพุง ุจุฑุง ุฏุณุชฺฏุงูโูุง ุตูุช ุงุณุช ฺฉู ูุฏุงุฑุฏ. ูโุชูุงูุฏ ุงู ุฎุทุงูุง ุฑุง ูุงุฏุฏู ุจฺฏุฑุฏ.

    ```output
    pi@raspberrypi:~/smart-timer $ python3 app.py 
    ALSA lib pcm.c:2565:(snd_pcm_open_noupdate) Unknown PCM cards.pcm.front
    ALSA lib pcm.c:2565:(snd_pcm_open_noupdate) Unknown PCM cards.pcm.rear
    ALSA lib pcm.c:2565:(snd_pcm_open_noupdate) Unknown PCM cards.pcm.center_lfe
    ALSA lib pcm.c:2565:(snd_pcm_open_noupdate) Unknown PCM cards.pcm.side
    ```

    ุงฺฏุฑ ุฎุทุง ุฒุฑ ุฑุง ุฏุฑุงูุช ฺฉุฑุฏุฏ:

    ```output
    OSError: [Errno -9997] Invalid sample rate
    ```

    ูุฑุฎ `rate` ุฑุง ุจู 44100 ุง 16000 ุชุบุฑ ุฏูุฏ.

> ๐ ูโุชูุงูุฏ ุงู ฺฉุฏ ุฑุง ุฏุฑ ูพูุดู [code-record/pi](../../../../../6-consumer/lessons/1-speech-recognition/code-record/pi) ูพุฏุง ฺฉูุฏ.

๐ ุจุฑูุงูู ุถุจุท ุตุฏุง ุดูุง ููููุชโุขูุฒ ุจูุฏ!

**ุณูุจ ูุณุฆููุช**:  
ุงู ุณูุฏ ุจุง ุงุณุชูุงุฏู ุงุฒ ุณุฑูุณ ุชุฑุฌูู ููุด ูุตููุน [Co-op Translator](https://github.com/Azure/co-op-translator) ุชุฑุฌูู ุดุฏู ุงุณุช. ุฏุฑ ุญุงู ฺฉู ูุง ุชูุงุด ูโฺฉูู ุฏูุช ุฑุง ุญูุธ ฺฉููุ ูุทูุงู ุชูุฌู ุฏุงุดุชู ุจุงุดุฏ ฺฉู ุชุฑุฌููโูุง ุฎูุฏฺฉุงุฑ ููฺฉู ุงุณุช ุดุงูู ุฎุทุงูุง ุง ูุงุฏุฑุณุชโูุง ุจุงุดูุฏ. ุณูุฏ ุงุตู ุจู ุฒุจุงู ุงุตู ุขู ุจุงุฏ ุจู ุนููุงู ููุจุน ูุนุชุจุฑ ุฏุฑ ูุธุฑ ฺฏุฑูุชู ุดูุฏ. ุจุฑุง ุงุทูุงุนุงุช ุญุณุงุณุ ุชูุตู ูโุดูุฏ ุงุฒ ุชุฑุฌูู ุญุฑููโุง ุงูุณุงู ุงุณุชูุงุฏู ฺฉูุฏ. ูุง ูุณุฆููุช ุฏุฑ ูุจุงู ุณูุก ุชูุงููโูุง ุง ุชูุณุฑูุง ูุงุฏุฑุณุช ูุงุด ุงุฒ ุงุณุชูุงุฏู ุงุฒ ุงู ุชุฑุฌูู ูุฏุงุฑู.