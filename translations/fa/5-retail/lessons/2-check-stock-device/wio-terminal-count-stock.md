<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "0b2ae20b0fc8e73c9598dea937cac038",
  "translation_date": "2025-08-25T20:46:52+00:00",
  "source_file": "5-retail/lessons/2-check-stock-device/wio-terminal-count-stock.md",
  "language_code": "fa"
}
-->
# ุดูุงุฑุด ููุฌูุฏ ุงุฒ ุฏุณุชฺฏุงู IoT ุดูุง - Wio Terminal

ุชุฑฺฉุจ ุงุฒ ูพุดโุจูโูุง ู ุฌุนุจูโูุง ูุญุฏูุฏฺฉููุฏู ูโุชูุงูุฏ ุจุฑุง ุดูุงุฑุด ููุฌูุฏ ุฏุฑ ฺฉ ุชุตูุฑ ุงุณุชูุงุฏู ุดูุฏ.

## ุดูุงุฑุด ููุฌูุฏ

![4 ููุท ุฑุจ ฺฏูุฌูโูุฑูฺฏ ุจุง ุฌุนุจูโูุง ูุญุฏูุฏฺฉููุฏู ุฏูุฑ ูุฑ ููุท](../../../../../translated_images/rpi-stock-with-bounding-boxes.b5540e2ecb7cd49f1271828d3be412671d950e87625c5597ea97c90f11e01097.fa.jpg)

ุฏุฑ ุชุตูุฑ ุจุงูุงุ ุฌุนุจูโูุง ูุญุฏูุฏฺฉููุฏู ฺฉู ุจุง ูู ูููพูุดุงู ุฏุงุฑูุฏ. ุงฺฏุฑ ุงู ูููพูุดุงู ุจุณุงุฑ ุจุฒุฑฺฏโุชุฑ ุจูุฏุ ููฺฉู ุจูุฏ ุฌุนุจูโูุง ูุญุฏูุฏฺฉููุฏู ูุดุงูโุฏููุฏู ฺฉ ุดุก ฺฉุณุงู ุจุงุดูุฏ. ุจุฑุง ุดูุงุฑุด ุตุญุญ ุงุดุงุกุ ุจุงุฏ ุฌุนุจูโูุง ุจุง ูููพูุดุงู ูุงุจูโุชูุฌู ุฑุง ูุงุฏุฏู ุจฺฏุฑุฏ.

### ูุธูู - ุดูุงุฑุด ููุฌูุฏ ุจุง ูุงุฏุฏู ฺฏุฑูุชู ูููพูุดุงู

1. ูพุฑูฺู `stock-counter` ุฎูุฏ ุฑุง ุจุงุฒ ฺฉูุฏุ ุงฺฏุฑ ูุจูุงู ุจุงุฒ ูุณุช.

1. ุจุงูุง ุชุงุจุน `processPredictions` ฺฉุฏ ุฒุฑ ุฑุง ุงุถุงูู ฺฉูุฏ:

    ```cpp
    const float overlap_threshold = 0.20f;
    ```

    ุงู ฺฉุฏ ุฏุฑุตุฏ ูููพูุดุงู ูุฌุงุฒ ุฑุง ูุจู ุงุฒ ุงูฺฉู ุฌุนุจูโูุง ูุญุฏูุฏฺฉููุฏู ุจูโุนููุงู ฺฉ ุดุก ฺฉุณุงู ุฏุฑ ูุธุฑ ฺฏุฑูุชู ุดููุฏุ ุชุนุฑู ูโฺฉูุฏ. ููุฏุงุฑ 0.20 ูุดุงูโุฏููุฏู 20ูช ูููพูุดุงู ุงุณุช.

1. ุฒุฑ ุงู ฺฉุฏ ู ุจุงูุง ุชุงุจุน `processPredictions`ุ ฺฉุฏ ุฒุฑ ุฑุง ุจุฑุง ูุญุงุณุจู ูููพูุดุงู ุจู ุฏู ูุณุชุทู ุงุถุงูู ฺฉูุฏ:

    ```cpp
    struct Point {
        float x, y;
    };

    struct Rect {
        Point topLeft, bottomRight;
    };

    float area(Rect rect)
    {
        return abs(rect.bottomRight.x - rect.topLeft.x) * abs(rect.bottomRight.y - rect.topLeft.y);
    }
     
    float overlappingArea(Rect rect1, Rect rect2)
    {
        float left = max(rect1.topLeft.x, rect2.topLeft.x);
        float right = min(rect1.bottomRight.x, rect2.bottomRight.x);
        float top = max(rect1.topLeft.y, rect2.topLeft.y);
        float bottom = min(rect1.bottomRight.y, rect2.bottomRight.y);
    
    
        if ( right > left && bottom > top )
        {
            return (right-left)*(bottom-top);
        }
        
        return 0.0f;
    }
    ```

    ุงู ฺฉุฏ ฺฉ ุณุงุฎุชุงุฑ `Point` ุจุฑุง ุฐุฎุฑู ููุงุท ุฑู ุชุตูุฑ ู ฺฉ ุณุงุฎุชุงุฑ `Rect` ุจุฑุง ุชุนุฑู ฺฉ ูุณุชุทู ุจุง ุงุณุชูุงุฏู ุงุฒ ูุฎุชุตุงุช ุจุงูุง-ฺูพ ู ูพุงู-ุฑุงุณุช ุชุนุฑู ูโฺฉูุฏ. ุณูพุณ ฺฉ ุชุงุจุน `area` ุชุนุฑู ูโฺฉูุฏ ฺฉู ูุณุงุญุช ฺฉ ูุณุชุทู ุฑุง ุงุฒ ูุฎุชุตุงุช ุจุงูุง-ฺูพ ู ูพุงู-ุฑุงุณุช ูุญุงุณุจู ูโฺฉูุฏ.

    ุณูพุณ ฺฉ ุชุงุจุน `overlappingArea` ุชุนุฑู ูโฺฉูุฏ ฺฉู ูุณุงุญุช ูููพูุดุงู ุฏู ูุณุชุทู ุฑุง ูุญุงุณุจู ูโฺฉูุฏ. ุงฺฏุฑ ูููพูุดุงู ูุฌูุฏ ูุฏุงุดุชู ุจุงุดุฏุ ููุฏุงุฑ 0 ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ.

1. ุฒุฑ ุชุงุจุน `overlappingArea`ุ ฺฉ ุชุงุจุน ุจุฑุง ุชุจุฏู ฺฉ ุฌุนุจู ูุญุฏูุฏฺฉููุฏู ุจู ฺฉ `Rect` ุชุนุฑู ฺฉูุฏ:

    ```cpp
    Rect rectFromBoundingBox(JsonVariant prediction)
    {
        JsonObject bounding_box = prediction["boundingBox"].as<JsonObject>();
    
        float left = bounding_box["left"].as<float>();
        float top = bounding_box["top"].as<float>();
        float width = bounding_box["width"].as<float>();
        float height = bounding_box["height"].as<float>();
    
        Point topLeft = {left, top};
        Point bottomRight = {left + width, top + height};
    
        return {topLeft, bottomRight};
    }
    ```

    ุงู ุชุงุจุน ฺฉ ูพุดโุจู ุงุฒ ุขุดฺฉุงุฑุณุงุฒ ุงุดุงุก ูโฺฏุฑุฏุ ุฌุนุจู ูุญุฏูุฏฺฉููุฏู ุฑุง ุงุณุชุฎุฑุงุฌ ูโฺฉูุฏ ู ุงุฒ ููุงุฏุฑ ุขู ุจุฑุง ุชุนุฑู ฺฉ ูุณุชุทู ุงุณุชูุงุฏู ูโฺฉูุฏ. ุณูุช ุฑุงุณุช ุงุฒ ุฌูุน ููุฏุงุฑ ฺูพ ู ุนุฑุถ ูุญุงุณุจู ูโุดูุฏ. ูพุงู ูุฒ ุงุฒ ุฌูุน ููุฏุงุฑ ุจุงูุง ู ุงุฑุชูุงุน ูุญุงุณุจู ูโุดูุฏ.

1. ูพุดโุจูโูุง ุจุงุฏ ุจุง ฺฉุฏฺฏุฑ ููุงุณู ุดููุฏุ ู ุงฺฏุฑ ุฏู ูพุดโุจู ูููพูุดุงู ุจุดุชุฑ ุงุฒ ุขุณุชุงูู ุฏุงุดุชู ุจุงุดูุฏุ ฺฉ ุงุฒ ุขูโูุง ุจุงุฏ ุญุฐู ุดูุฏ. ุขุณุชุงูู ูููพูุดุงู ฺฉ ุฏุฑุตุฏ ุงุณุชุ ุจูุงุจุฑุงู ุจุงุฏ ุฏุฑ ุงูุฏุงุฒู ฺฉูฺฺฉโุชุฑู ุฌุนุจู ูุญุฏูุฏฺฉููุฏู ุถุฑุจ ุดูุฏ ุชุง ุจุฑุฑุณ ุดูุฏ ฺฉู ุขุง ูููพูุดุงู ุงุฒ ุฏุฑุตุฏ ูุดุฎุตโุดุฏู ุฌุนุจู ูุญุฏูุฏฺฉููุฏู ูุฑุงุชุฑ ูโุฑูุฏ ุง ุฎุฑุ ูู ุฏุฑุตุฏ ูุดุฎุตโุดุฏู ฺฉู ุชุตูุฑ. ุงุจุชุฏุง ูุญุชูุง ุชุงุจุน `processPredictions` ุฑุง ุญุฐู ฺฉูุฏ.

1. ฺฉุฏ ุฒุฑ ุฑุง ุจู ุชุงุจุน ุฎุงู `processPredictions` ุงุถุงูู ฺฉูุฏ:

    ```cpp
    std::vector<JsonVariant> passed_predictions;

    for (int i = 0; i < predictions.size(); ++i)
    {
        Rect prediction_1_rect = rectFromBoundingBox(predictions[i]);
        float prediction_1_area = area(prediction_1_rect);
        bool passed = true;

        for (int j = i + 1; j < predictions.size(); ++j)
        {
            Rect prediction_2_rect = rectFromBoundingBox(predictions[j]);
            float prediction_2_area = area(prediction_2_rect);

            float overlap = overlappingArea(prediction_1_rect, prediction_2_rect);
            float smallest_area = min(prediction_1_area, prediction_2_area);

            if (overlap > (overlap_threshold * smallest_area))
            {
                passed = false;
                break;
            }
        }

        if (passed)
        {
            passed_predictions.push_back(predictions[i]);
        }
    }
    ```

    ุงู ฺฉุฏ ฺฉ ุจุฑุฏุงุฑ ุจุฑุง ุฐุฎุฑู ูพุดโุจูโูุง ฺฉู ูููพูุดุงู ูุฏุงุฑูุฏ ุชุนุฑู ูโฺฉูุฏ. ุณูพุณ ุงุฒ ุทุฑู ุชูุงู ูพุดโุจูโูุง ุญููู ูโุฒูุฏ ู ฺฉ `Rect` ุงุฒ ุฌุนุจู ูุญุฏูุฏฺฉููุฏู ุงุฌุงุฏ ูโฺฉูุฏ.

    ุณูพุณ ุงู ฺฉุฏ ุงุฒ ุทุฑู ูพุดโุจูโูุง ุจุงูโูุงูุฏู ุญููู ูโุฒูุฏุ ุงุฒ ูพุดโุจู ุจุนุฏ ุจู ุจุนุฏ. ุงู ฺฉุงุฑ ุงุฒ ููุงุณู ุฏูุจุงุฑู ูพุดโุจูโูุง ุฌููฺฏุฑ ูโฺฉูุฏ - ููุช 1 ู 2 ููุงุณู ุดุฏูุฏุ ูุงุฒ ุจู ููุงุณู 2 ุจุง 1 ูุณุชุ ููุท ุจุง 3ุ 4 ู ุบุฑู.

    ุจุฑุง ูุฑ ุฌูุช ูพุดโุจูุ ูุณุงุญุช ูููพูุดุงู ูุญุงุณุจู ูโุดูุฏ. ุณูพุณ ุงู ููุฏุงุฑ ุจุง ูุณุงุญุช ฺฉูฺฺฉโุชุฑู ุฌุนุจู ูุญุฏูุฏฺฉููุฏู ููุงุณู ูโุดูุฏ - ุงฺฏุฑ ูููพูุดุงู ุงุฒ ุฏุฑุตุฏ ุขุณุชุงูู ฺฉูฺฺฉโุชุฑู ุฌุนุจู ูุญุฏูุฏฺฉููุฏู ูุฑุงุชุฑ ุฑูุฏุ ูพุดโุจู ุจูโุนููุงู ุฑุฏุดุฏู ุนูุงูุชโฺฏุฐุงุฑ ูโุดูุฏ. ุงฺฏุฑ ูพุณ ุงุฒ ููุงุณู ุชูุงู ูููพูุดุงูโูุงุ ูพุดโุจู ุงุฒ ุจุฑุฑุณโูุง ุนุจูุฑ ฺฉูุฏุ ุจู ูุฌููุนู `passed_predictions` ุงุถุงูู ูโุดูุฏ.

    > ๐ ุงู ฺฉ ุฑูุด ุจุณุงุฑ ุณุงุฏู ุจุฑุง ุญุฐู ูููพูุดุงูโูุง ุงุณุชุ ููุท ุงููู ููุฑุฏ ุฏุฑ ฺฉ ุฌูุช ูููพูุดุงู ุญุฐู ูโุดูุฏ. ุจุฑุง ฺฉุฏ ุชููุฏุ ุจุงุฏ ููุทู ุจุดุชุฑ ุฏุฑ ุงูุฌุง ูุฑุงุฑ ุฏูุฏุ ูุงููุฏ ุฏุฑ ูุธุฑ ฺฏุฑูุชู ูููพูุดุงู ุจู ฺูุฏู ุดุกุ ุง ุงฺฏุฑ ฺฉ ุฌุนุจู ูุญุฏูุฏฺฉููุฏู ุฏุฑูู ุฏฺฏุฑ ูุฑุงุฑ ุฏุงุฑุฏ.

1. ูพุณ ุงุฒ ุงูุ ฺฉุฏ ุฒุฑ ุฑุง ุจุฑุง ุงุฑุณุงู ุฌุฒุฆุงุช ูพุดโุจูโูุง ูพุฐุฑูุชูโุดุฏู ุจู ูุงูุชูุฑ ุณุฑุงู ุงุถุงูู ฺฉูุฏ:

    ```cpp
    for(JsonVariant prediction : passed_predictions)
    {
        String boundingBox = prediction["boundingBox"].as<String>();
        String tag = prediction["tagName"].as<String>();
        float probability = prediction["probability"].as<float>();

        char buff[32];
        sprintf(buff, "%s:\t%.2f%%\t%s", tag.c_str(), probability * 100.0, boundingBox.c_str());
        Serial.println(buff);
    }
    ```

    ุงู ฺฉุฏ ุงุฒ ุทุฑู ูพุดโุจูโูุง ูพุฐุฑูุชูโุดุฏู ุญููู ูโุฒูุฏ ู ุฌุฒุฆุงุช ุขูโูุง ุฑุง ุจู ูุงูุชูุฑ ุณุฑุงู ฺุงูพ ูโฺฉูุฏ.

1. ุฒุฑ ุงู ฺฉุฏุ ฺฉุฏ ุจุฑุง ฺุงูพ ุชุนุฏุงุฏ ุงููุงู ุดูุงุฑุดโุดุฏู ุจู ูุงูุชูุฑ ุณุฑุงู ุงุถุงูู ฺฉูุฏ:

    ```cpp
    Serial.print("Counted ");
    Serial.print(passed_predictions.size());
    Serial.println(" stock items.");
    ```

    ุงู ููุฏุงุฑ ุณูพุณ ูโุชูุงูุฏ ุจู ฺฉ ุณุฑูุณ IoT ุงุฑุณุงู ุดูุฏ ุชุง ุฏุฑ ุตูุฑุช ฺฉูุจูุฏ ููุฌูุฏ ูุดุฏุงุฑ ุฏูุฏ.

1. ฺฉุฏ ุฎูุฏ ุฑุง ุขูพููุฏ ู ุงุฌุฑุง ฺฉูุฏ. ุฏูุฑุจู ุฑุง ุจู ุณูุช ุงุดุงุก ุฑู ฺฉ ููุณู ุจฺฏุฑุฏ ู ุฏฺฉูู C ุฑุง ูุดุงุฑ ุฏูุฏ. ุณุน ฺฉูุฏ ููุฏุงุฑ `overlap_threshold` ุฑุง ุชูุธู ฺฉูุฏ ุชุง ูพุดโุจูโูุง ฺฉู ูุงุฏุฏู ฺฏุฑูุชู ูโุดููุฏ ุฑุง ูุดุงูุฏู ฺฉูุฏ.

    ```output
    Connecting to WiFi..
    Connected!
    Image captured
    Image read to buffer with length 17416
    tomato paste:   35.84%  {"left":0.395631,"top":0.215897,"width":0.180768,"height":0.359364}
    tomato paste:   35.87%  {"left":0.378554,"top":0.583012,"width":0.14824,"height":0.359382}
    tomato paste:   34.11%  {"left":0.699024,"top":0.592617,"width":0.124411,"height":0.350456}
    tomato paste:   35.16%  {"left":0.513006,"top":0.647853,"width":0.187472,"height":0.325817}
    Counted 4 stock items.
    ```

> ๐ ูโุชูุงูุฏ ุงู ฺฉุฏ ุฑุง ุฏุฑ ูพูุดู [code-count/wio-terminal](../../../../../5-retail/lessons/2-check-stock-device/code-count/wio-terminal) ูพุฏุง ฺฉูุฏ.

๐ ุจุฑูุงูู ุดูุงุฑุด ููุฌูุฏ ุดูุง ููููุชโุขูุฒ ุจูุฏ!

**ุณูุจ ูุณุฆููุช**:  
ุงู ุณูุฏ ุจุง ุงุณุชูุงุฏู ุงุฒ ุณุฑูุณ ุชุฑุฌูู ููุด ูุตููุน [Co-op Translator](https://github.com/Azure/co-op-translator) ุชุฑุฌูู ุดุฏู ุงุณุช. ุฏุฑ ุญุงู ฺฉู ูุง ุชูุงุด ูโฺฉูู ุฏูุช ุฑุง ุญูุธ ฺฉููุ ูุทูุงู ุชูุฌู ุฏุงุดุชู ุจุงุดุฏ ฺฉู ุชุฑุฌููโูุง ุฎูุฏฺฉุงุฑ ููฺฉู ุงุณุช ุดุงูู ุฎุทุงูุง ุง ูุงุฏุฑุณุชโูุง ุจุงุดูุฏ. ุณูุฏ ุงุตู ุจู ุฒุจุงู ุงุตู ุขู ุจุงุฏ ุจู ุนููุงู ููุจุน ูุนุชุจุฑ ุฏุฑ ูุธุฑ ฺฏุฑูุชู ุดูุฏ. ุจุฑุง ุงุทูุงุนุงุช ุญุณุงุณุ ุชูุตู ูโุดูุฏ ุงุฒ ุชุฑุฌูู ุญุฑููโุง ุงูุณุงู ุงุณุชูุงุฏู ฺฉูุฏ. ูุง ูุณุฆููุช ุฏุฑ ูุจุงู ุณูุก ุชูุงููโูุง ุง ุชูุณุฑูุง ูุงุฏุฑุณุช ูุงุด ุงุฒ ุงุณุชูุงุฏู ุงุฒ ุงู ุชุฑุฌูู ูุฏุงุฑู.