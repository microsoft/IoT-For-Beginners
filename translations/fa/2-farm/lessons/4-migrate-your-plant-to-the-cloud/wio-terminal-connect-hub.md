<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "28320305a35ea3bc59c41fe146a2e6ed",
  "translation_date": "2025-08-25T21:47:57+00:00",
  "source_file": "2-farm/lessons/4-migrate-your-plant-to-the-cloud/wio-terminal-connect-hub.md",
  "language_code": "fa"
}
-->
# ุงุชุตุงู ุฏุณุชฺฏุงู IoT ุดูุง ุจู ุงุจุฑ - Wio Terminal

ุฏุฑ ุงู ุจุฎุด ุงุฒ ุฏุฑุณุ ุดูุง Wio Terminal ุฎูุฏ ุฑุง ุจู IoT Hub ูุชุตู ูโฺฉูุฏ ุชุง ุฏุงุฏูโูุง ุชููโูุชุฑ ุงุฑุณุงู ฺฉุฑุฏู ู ุฏุณุชูุฑุงุช ุฏุฑุงูุช ฺฉูุฏ.

## ุงุชุตุงู ุฏุณุชฺฏุงู ุจู IoT Hub

ฺฏุงู ุจุนุฏ ุงุชุตุงู ุฏุณุชฺฏุงู ุดูุง ุจู IoT Hub ุงุณุช.

### ูุธูู - ุงุชุตุงู ุจู IoT Hub

1. ูพุฑูฺู `soil-moisture-sensor` ุฑุง ุฏุฑ VS Code ุจุงุฒ ฺฉูุฏ.

1. ูุงู `platformio.ini` ุฑุง ุจุงุฒ ฺฉูุฏ. ูุงุจุณุชฺฏ ฺฉุชุงุจุฎุงูู `knolleary/PubSubClient` ุฑุง ุญุฐู ฺฉูุฏ. ุงู ฺฉุชุงุจุฎุงูู ุจุฑุง ุงุชุตุงู ุจู ุจุฑูฺฉุฑ ุนููู MQTT ุงุณุชูุงุฏู ูโุดุฏ ู ุจุฑุง ุงุชุตุงู ุจู IoT Hub ูุงุฒ ุจู ุขู ูุณุช.

1. ูุงุจุณุชฺฏโูุง ฺฉุชุงุจุฎุงูู ุฒุฑ ุฑุง ุงุถุงูู ฺฉูุฏ:

    ```ini
    seeed-studio/Seeed Arduino RTC @ 2.0.0
    arduino-libraries/AzureIoTHub @ 1.6.0
    azure/AzureIoTUtility @ 1.6.1
    azure/AzureIoTProtocol_MQTT @ 1.6.0
    azure/AzureIoTProtocol_HTTP @ 1.6.0
    azure/AzureIoTSocket_WiFi @ 1.0.2
    ```

    ฺฉุชุงุจุฎุงูู `Seeed Arduino RTC` ฺฉุฏ ุจุฑุง ุชุนุงูู ุจุง ุณุงุนุช ูุงูุน ุฏุฑ Wio Terminal ูุฑุงูู ูโฺฉูุฏ ฺฉู ุจุฑุง ุฑุฏุงุจ ุฒูุงู ุงุณุชูุงุฏู ูโุดูุฏ. ุณุงุฑ ฺฉุชุงุจุฎุงููโูุง ุจู ุฏุณุชฺฏุงู IoT ุดูุง ุงุฌุงุฒู ูโุฏููุฏ ุจู IoT Hub ูุชุตู ุดูุฏ.

1. ููุฑุฏ ุฒุฑ ุฑุง ุจู ุงูุชูุง ูุงู `platformio.ini` ุงุถุงูู ฺฉูุฏ:

    ```ini
    build_flags =
        -DDONT_USE_UPLOADTOBLOB
    ```

    ุงู ฺฉ ููฺฏ ฺฉุงููพุงูุฑ ุชูุธู ูโฺฉูุฏ ฺฉู ููฺฏุงู ฺฉุงููพุงู ฺฉุฏ Arduino IoT Hub ููุฑุฏ ูุงุฒ ุงุณุช.

1. ูุงู ูุฏุฑ `config.h` ุฑุง ุจุงุฒ ฺฉูุฏ. ุชูุงู ุชูุธูุงุช MQTT ุฑุง ุญุฐู ฺฉุฑุฏู ู ุซุงุจุช ุฒุฑ ุฑุง ุจุฑุง ุฑุดุชู ุงุชุตุงู ุฏุณุชฺฏุงู ุงุถุงูู ฺฉูุฏ:

    ```cpp
    // IoT Hub settings
    const char *CONNECTION_STRING = "<connection string>";
    ```

    `<connection string>` ุฑุง ุจุง ุฑุดุชู ุงุชุตุงู ุฏุณุชฺฏุงู ุฎูุฏ ฺฉู ูุจูุงู ฺฉูพ ฺฉุฑุฏูโุงุฏ ุฌุงฺฏุฒู ฺฉูุฏ.

1. ุงุชุตุงู ุจู IoT Hub ุงุฒ ฺฉ ุชูฺฉู ูุจุชู ุจุฑ ุฒูุงู ุงุณุชูุงุฏู ูโฺฉูุฏ. ุงู ุจุฏุงู ูุนูุงุณุช ฺฉู ุฏุณุชฺฏุงู IoT ุจุงุฏ ุฒูุงู ูุนู ุฑุง ุจุฏุงูุฏ. ุจุฑุฎูุงู ุณุณุชูโุนุงููโูุง ูุงููุฏ ููุฏูุฒุ macOS ุง ูููฺฉุณุ ูฺฉุฑูฺฉูุชุฑูุฑูุง ุจูโุทูุฑ ุฎูุฏฺฉุงุฑ ุฒูุงู ูุนู ุฑุง ุงุฒ ุทุฑู ุงูุชุฑูุช ููฺฏุงูโุณุงุฒ ููโฺฉููุฏ. ุจูุงุจุฑุงู ุจุงุฏ ฺฉุฏ ุงุถุงูู ฺฉูุฏ ุชุง ุฒูุงู ูุนู ุฑุง ุงุฒ ฺฉ [NTP](https://wikipedia.org/wiki/Network_Time_Protocol) ุณุฑูุฑ ุฏุฑุงูุช ฺฉูุฏ. ูพุณ ุงุฒ ุฏุฑุงูุช ุฒูุงูุ ูโุชูุงู ุขู ุฑุง ุฏุฑ ฺฉ ุณุงุนุช ูุงูุน ุฏุฑ Wio Terminal ุฐุฎุฑู ฺฉุฑุฏุ ุจูโุทูุฑ ฺฉู ุฒูุงู ุตุญุญ ุฏุฑ ุชุงุฑุฎ ุจุนุฏ ุฏุฑุฎูุงุณุช ุดูุฏุ ุจู ุดุฑุท ฺฉู ุฏุณุชฺฏุงู ุจุฑู ุฎูุฏ ุฑุง ุงุฒ ุฏุณุช ูุฏูุฏ. ฺฉ ูุงู ุฌุฏุฏ ุจู ูุงู `ntp.h` ุจุง ฺฉุฏ ุฒุฑ ุงุถุงูู ฺฉูุฏ:

    ```cpp
    #pragma once
    
    #include "DateTime.h"
    #include <time.h>
    #include "samd/NTPClientAz.h"
    #include <sys/time.h>

    static void initTime()
    {
        WiFiUDP _udp;
        time_t epochTime = (time_t)-1;
        NTPClientAz ntpClient;

        ntpClient.begin();

        while (true)
        {
            epochTime = ntpClient.getEpochTime("0.pool.ntp.org");

            if (epochTime == (time_t)-1)
            {
                Serial.println("Fetching NTP epoch time failed! Waiting 2 seconds to retry.");
                delay(2000);
            }
            else
            {
                Serial.print("Fetched NTP epoch time is: ");

                char buff[32];
                sprintf(buff, "%.f", difftime(epochTime, (time_t)0));
                Serial.println(buff);
                break;
            }
        }

        ntpClient.end();

        struct timeval tv;
        tv.tv_sec = epochTime;
        tv.tv_usec = 0;

        settimeofday(&tv, NULL);
    }
    ```

    ุฌุฒุฆุงุช ุงู ฺฉุฏ ุฎุงุฑุฌ ุงุฒ ูุญุฏูุฏู ุงู ุฏุฑุณ ุงุณุช. ุงู ฺฉุฏ ุฑุง ุชุนุฑู ูโฺฉูุฏ ฺฉู ุชุงุจุน ุจู ูุงู `initTime` ุฏุงุฑุฏ ฺฉู ุฒูุงู ูุนู ุฑุง ุงุฒ ฺฉ ุณุฑูุฑ NTP ุฏุฑุงูุช ฺฉุฑุฏู ู ุงุฒ ุขู ุจุฑุง ุชูุธู ุณุงุนุช ุฏุฑ Wio Terminal ุงุณุชูุงุฏู ูโฺฉูุฏ.

1. ูุงู `main.cpp` ุฑุง ุจุงุฒ ฺฉูุฏ ู ุชูุงู ฺฉุฏูุง MQTTุ ุงุฒ ุฌููู ูุงู ูุฏุฑ `PubSubClient.h`ุ ุงุนูุงู ูุชุบุฑ `PubSubClient`ุ ูุชุฏูุง `reconnectMQTTClient` ู `createMQTTClient` ู ูุฑฺฏููู ูุฑุงุฎูุงู ุจู ุงู ูุชุบุฑูุง ู ูุชุฏูุง ุฑุง ุญุฐู ฺฉูุฏ. ุงู ูุงู ุจุงุฏ ููุท ุดุงูู ฺฉุฏ ุจุฑุง ุงุชุตุงู ุจู WiFiุ ุฏุฑุงูุช ุฑุทูุจุช ุฎุงฺฉ ู ุงุฌุงุฏ ฺฉ ุณูุฏ JSON ุจุง ุขู ุจุงุดุฏ.

1. ุฏุณุชูุฑุงุช `#include` ุฒุฑ ุฑุง ุจู ุจุงูุง ูุงู `main.cpp` ุงุถุงูู ฺฉูุฏ ุชุง ูุงูโูุง ูุฏุฑ ุจุฑุง ฺฉุชุงุจุฎุงููโูุง IoT Hub ู ุชูุธู ุฒูุงู ุฑุง ุดุงูู ุดูุฏ:

    ```cpp
    #include <AzureIoTHub.h>
    #include <AzureIoTProtocol_MQTT.h>
    #include <iothubtransportmqtt.h>
    #include "ntp.h"
    ```

1. ูุฑุงุฎูุงู ุฒุฑ ุฑุง ุจู ุงูุชูุง ุชุงุจุน `setup` ุงุถุงูู ฺฉูุฏ ุชุง ุฒูุงู ูุนู ุชูุธู ุดูุฏ:

    ```cpp
    initTime();
    ```

1. ุงุนูุงู ูุชุบุฑ ุฒุฑ ุฑุง ุจู ุจุงูุง ูุงูุ ุฏุฑุณุช ุฒุฑ ุฏุณุชูุฑุงุช include ุงุถุงูู ฺฉูุฏ:

    ```cpp
    IOTHUB_DEVICE_CLIENT_LL_HANDLE _device_ll_handle;
    ```

    ุงู ฺฉ `IOTHUB_DEVICE_CLIENT_LL_HANDLE` ุฑุง ุงุนูุงู ูโฺฉูุฏุ ฺฉู ฺฉ ููุฏู ุจุฑุง ุงุชุตุงู ุจู IoT Hub ุงุณุช.

1. ฺฉุฏ ุฒุฑ ุฑุง ุฏุฑ ุฒุฑ ุงู ุงุนูุงู ุงุถุงูู ฺฉูุฏ:

    ```cpp
    static void connectionStatusCallback(IOTHUB_CLIENT_CONNECTION_STATUS result, IOTHUB_CLIENT_CONNECTION_STATUS_REASON reason, void *user_context)
    {
        if (result == IOTHUB_CLIENT_CONNECTION_AUTHENTICATED)
        {
            Serial.println("The device client is connected to iothub");
        }
        else
        {
            Serial.println("The device client has been disconnected");
        }
    }
    ```

    ุงู ฺฉ ุชุงุจุน callback ุงุนูุงู ูโฺฉูุฏ ฺฉู ููุช ุงุชุตุงู ุจู IoT Hub ูุถุนุช ุฎูุฏ ุฑุง ุชุบุฑ ูโุฏูุฏุ ูุงููุฏ ุงุชุตุงู ุง ูุทุน ุงุชุตุงูุ ูุฑุงุฎูุงู ูโุดูุฏ. ูุถุนุช ุจู ูพูุฑุช ุณุฑุงู ุงุฑุณุงู ูโุดูุฏ.

1. ุฏุฑ ุฒุฑ ุงูุ ฺฉ ุชุงุจุน ุจุฑุง ุงุชุตุงู ุจู IoT Hub ุงุถุงูู ฺฉูุฏ:

    ```cpp
    void connectIoTHub()
    {
        IoTHub_Init();
    
        _device_ll_handle = IoTHubDeviceClient_LL_CreateFromConnectionString(CONNECTION_STRING, MQTT_Protocol);
        
        if (_device_ll_handle == NULL)
        {
            Serial.println("Failure creating Iothub device. Hint: Check your connection string.");
            return;
        }
    
        IoTHubDeviceClient_LL_SetConnectionStatusCallback(_device_ll_handle, connectionStatusCallback, NULL);
    }
    ```

    ุงู ฺฉุฏ ฺฉุชุงุจุฎุงูู IoT Hub ุฑุง ููุฏุงุฑุฏู ุงููู ูโฺฉูุฏุ ุณูพุณ ุจุง ุงุณุชูุงุฏู ุงุฒ ุฑุดุชู ุงุชุตุงู ุฏุฑ ูุงู ูุฏุฑ `config.h` ฺฉ ุงุชุตุงู ุงุฌุงุฏ ูโฺฉูุฏ. ุงู ุงุชุตุงู ุจุฑ ุงุณุงุณ MQTT ุงุณุช. ุงฺฏุฑ ุงุชุตุงู ุดฺฉุณุช ุจุฎูุฑุฏุ ุงู ููุถูุน ุจู ูพูุฑุช ุณุฑุงู ุงุฑุณุงู ูโุดูุฏ - ุงฺฏุฑ ุงู ุฑุง ุฏุฑ ุฎุฑูุฌ ูุดุงูุฏู ฺฉุฑุฏุฏุ ุฑุดุชู ุงุชุตุงู ุฑุง ุจุฑุฑุณ ฺฉูุฏ. ุฏุฑ ููุงุชุ callback ูุถุนุช ุงุชุตุงู ุชูุธู ูโุดูุฏ.

1. ุงู ุชุงุจุน ุฑุง ุฏุฑ ุชุงุจุน `setup` ุฒุฑ ูุฑุงุฎูุงู `initTime` ูุฑุงุฎูุงู ฺฉูุฏ:

    ```cpp
    connectIoTHub();
    ```

1. ุฏุฑุณุช ูุงููุฏ ฺฉูุงูุช MQTTุ ุงู ฺฉุฏ ุฑู ฺฉ ุฑุดุชู ูุงุญุฏ ุงุฌุฑุง ูโุดูุฏุ ุจูุงุจุฑุงู ุจุฑุง ูพุฑุฏุงุฒุด ูพุงูโูุง ฺฉู ุชูุณุท ูุงุจ ุงุฑุณุงู ู ุฏุฑุงูุช ูโุดููุฏุ ุจู ุฒูุงู ูุงุฒ ุฏุงุฑุฏ. ููุฑุฏ ุฒุฑ ุฑุง ุจู ุจุงูุง ุชุงุจุน `loop` ุงุถุงูู ฺฉูุฏ ุชุง ุงู ฺฉุงุฑ ุงูุฌุงู ุดูุฏ:

    ```cpp
    IoTHubDeviceClient_LL_DoWork(_device_ll_handle);
    ```

1. ุงู ฺฉุฏ ุฑุง ุจุณุงุฒุฏ ู ุขูพููุฏ ฺฉูุฏ. ุงุชุตุงู ุฑุง ุฏุฑ ูุงูุชูุฑ ุณุฑุงู ูุดุงูุฏู ุฎูุงูุฏ ฺฉุฑุฏ:

    ```output
    Connecting to WiFi..
    Connected!
    Fetched NTP epoch time is: 1619983687
    Sending telemetry {"soil_moisture":391}
    The device client is connected to iothub
    ```

    ุฏุฑ ุฎุฑูุฌ ูโุชูุงูุฏ ูุดุงูุฏู ฺฉูุฏ ฺฉู ุฒูุงู NTP ุฏุฑุงูุช ูโุดูุฏุ ุณูพุณ ฺฉูุงูุช ุฏุณุชฺฏุงู ูุชุตู ูโุดูุฏ. ููฺฉู ุงุณุช ฺูุฏ ุซุงูู ุทูู ุจฺฉุดุฏ ุชุง ุงุชุตุงู ุจุฑูุฑุงุฑ ุดูุฏุ ุจูุงุจุฑุงู ููฺฉู ุงุณุช ุฑุทูุจุช ุฎุงฺฉ ุฑุง ุฏุฑ ุฎุฑูุฌ ูุดุงูุฏู ฺฉูุฏ ุฏุฑ ุญุงู ฺฉู ุฏุณุชฺฏุงู ุฏุฑ ุญุงู ุงุชุตุงู ุงุณุช.

    > ๐ ูโุชูุงูุฏ ุฒูุงู ููฺฉุณ NTP ุฑุง ุจู ูุณุฎูโุง ุฎูุงูุงุชุฑ ุจุง ุงุณุชูุงุฏู ุงุฒ ูุจโุณุงุช ูุงููุฏ [unixtimestamp.com](https://www.unixtimestamp.com) ุชุจุฏู ฺฉูุฏ.

## ุงุฑุณุงู ุชููโูุชุฑ

ุงฺฉููู ฺฉู ุฏุณุชฺฏุงู ุดูุง ูุชุตู ุงุณุชุ ูโุชูุงูุฏ ุชููโูุชุฑ ุฑุง ุจู IoT Hub ุงุฑุณุงู ฺฉูุฏุ ุจู ุฌุง ุจุฑูฺฉุฑ MQTT.

### ูุธูู - ุงุฑุณุงู ุชููโูุชุฑ

1. ุชุงุจุน ุฒุฑ ุฑุง ุจุงูุง ุชุงุจุน `setup` ุงุถุงูู ฺฉูุฏ:

    ```cpp
    void sendTelemetry(const char *telemetry)
    {
        IOTHUB_MESSAGE_HANDLE message_handle = IoTHubMessage_CreateFromString(telemetry);
        IoTHubDeviceClient_LL_SendEventAsync(_device_ll_handle, message_handle, NULL, NULL);
        IoTHubMessage_Destroy(message_handle);
    }
    ```

    ุงู ฺฉุฏ ฺฉ ูพุงู IoT Hub ุงุฒ ฺฉ ุฑุดุชู ฺฉู ุจูโุนููุงู ูพุงุฑุงูุชุฑ ุงุฑุณุงู ุดุฏู ุงุฌุงุฏ ูโฺฉูุฏุ ุขู ุฑุง ุจู ูุงุจ ุงุฑุณุงู ูโฺฉูุฏุ ุณูพุณ ุดุก ูพุงู ุฑุง ูพุงฺฉ ูโฺฉูุฏ.

1. ุงู ฺฉุฏ ุฑุง ุฏุฑ ุชุงุจุน `loop`ุ ุฏุฑุณุช ุจุนุฏ ุงุฒ ุฎุท ฺฉู ุชููโูุชุฑ ุจู ูพูุฑุช ุณุฑุงู ุงุฑุณุงู ูโุดูุฏุ ูุฑุงุฎูุงู ฺฉูุฏ:

    ```cpp
    sendTelemetry(telemetry.c_str());
    ```

## ูุฏุฑุช ุฏุณุชูุฑุงุช

ุฏุณุชฺฏุงู ุดูุง ุจุงุฏ ุฏุณุชูุฑ ุงุฒ ฺฉุฏ ุณุฑูุฑ ุจุฑุง ฺฉูุชุฑู ุฑูู ุฏุฑุงูุช ฺฉูุฏ. ุงู ุฏุณุชูุฑ ุจูโุนููุงู ฺฉ ุฏุฑุฎูุงุณุช ูุชุฏ ูุณุชูู ุงุฑุณุงู ูโุดูุฏ.

### ูุธูู - ูุฏุฑุช ฺฉ ุฏุฑุฎูุงุณุช ูุชุฏ ูุณุชูู

1. ฺฉุฏ ุฒุฑ ุฑุง ูุจู ุงุฒ ุชุงุจุน `connectIoTHub` ุงุถุงูู ฺฉูุฏ:

    ```cpp
    int directMethodCallback(const char *method_name, const unsigned char *payload, size_t size, unsigned char **response, size_t *response_size, void *userContextCallback)
    {
        Serial.printf("Direct method received %s\r\n", method_name);
    
        if (strcmp(method_name, "relay_on") == 0)
        {
            digitalWrite(PIN_WIRE_SCL, HIGH);
        }
        else if (strcmp(method_name, "relay_off") == 0)
        {
            digitalWrite(PIN_WIRE_SCL, LOW);
        }
    }
    ```

    ุงู ฺฉุฏ ฺฉ ูุชุฏ callback ุชุนุฑู ูโฺฉูุฏ ฺฉู ฺฉุชุงุจุฎุงูู IoT Hub ูโุชูุงูุฏ ููฺฏุงู ุฏุฑุงูุช ฺฉ ุฏุฑุฎูุงุณุช ูุชุฏ ูุณุชูู ุขู ุฑุง ูุฑุงุฎูุงู ฺฉูุฏ. ูุชุฏ ฺฉู ุฏุฑุฎูุงุณุช ุดุฏู ุฏุฑ ูพุงุฑุงูุชุฑ `method_name` ุงุฑุณุงู ูโุดูุฏ. ุงู ุชุงุจุน ูุชุฏ ูุฑุงุฎูุงู ุดุฏู ุฑุง ุจู ูพูุฑุช ุณุฑุงู ฺุงูพ ูโฺฉูุฏุ ุณูพุณ ุจุณุชู ุจู ูุงู ูุชุฏุ ุฑูู ุฑุง ุฑูุดู ุง ุฎุงููุด ูโฺฉูุฏ.

    > ๐ ุงู ูโุชูุงูุณุช ุฏุฑ ฺฉ ุฏุฑุฎูุงุณุช ูุชุฏ ูุณุชูู ูุงุญุฏ ูุฒ ูพุงุฏูโุณุงุฒ ุดูุฏุ ุจุง ุงุฑุณุงู ูุถุนุช ููุฑุฏ ูุธุฑ ุฑูู ุฏุฑ ฺฉ payload ฺฉู ูโุชูุงูุฏ ุจุง ุฏุฑุฎูุงุณุช ูุชุฏ ุงุฑุณุงู ุดูุฏ ู ุงุฒ ูพุงุฑุงูุชุฑ `payload` ุฏุฑ ุฏุณุชุฑุณ ุจุงุดุฏ.

1. ฺฉุฏ ุฒุฑ ุฑุง ุจู ุงูุชูุง ุชุงุจุน `directMethodCallback` ุงุถุงูู ฺฉูุฏ:

    ```cpp
    char resultBuff[16];
    sprintf(resultBuff, "{\"Result\":\"\"}");
    *response_size = strlen(resultBuff);
    *response = (unsigned char *)malloc(*response_size);
    memcpy(*response, resultBuff, *response_size);

    return IOTHUB_CLIENT_OK;
    ```

    ุฏุฑุฎูุงุณุชโูุง ูุชุฏ ูุณุชูู ุจู ฺฉ ูพุงุณุฎ ูุงุฒ ุฏุงุฑูุฏุ ู ูพุงุณุฎ ุฏุฑ ุฏู ุจุฎุด ุงุณุช - ฺฉ ูพุงุณุฎ ุจูโุตูุฑุช ูุชู ู ฺฉ ฺฉุฏ ุจุงุฒฺฏุดุช. ุงู ฺฉุฏ ฺฉ ูุชุฌู ุจูโุตูุฑุช ุณูุฏ JSON ุฒุฑ ุงุฌุงุฏ ูโฺฉูุฏ:

    ```JSON
    {
        "Result": ""
    }
    ```

    ุณูพุณ ุงู ูุชุฌู ุฏุฑ ูพุงุฑุงูุชุฑ `response` ฺฉูพ ูโุดูุฏ ู ุงูุฏุงุฒู ุงู ูพุงุณุฎ ุฏุฑ ูพุงุฑุงูุชุฑ `response_size` ุชูุธู ูโุดูุฏ. ุงู ฺฉุฏ ุณูพุณ `IOTHUB_CLIENT_OK` ุฑุง ุจุงุฒูโฺฏุฑุฏุงูุฏ ุชุง ูุดุงู ุฏูุฏ ูุชุฏ ุจูโุฏุฑุณุช ูุฏุฑุช ุดุฏู ุงุณุช.

1. callback ุฑุง ุจุง ุงุถุงูู ฺฉุฑุฏู ููุฑุฏ ุฒุฑ ุจู ุงูุชูุง ุชุงุจุน `connectIoTHub` ูุชุตู ฺฉูุฏ:

    ```cpp
    IoTHubClient_LL_SetDeviceMethodCallback(_device_ll_handle, directMethodCallback, NULL);
    ```

1. ุชุงุจุน `loop` ุชุงุจุน `IoTHubDeviceClient_LL_DoWork` ุฑุง ุจุฑุง ูพุฑุฏุงุฒุด ุฑูุฏุงุฏูุง ุงุฑุณุงู ุดุฏู ุชูุณุท IoT Hub ูุฑุงุฎูุงู ูโฺฉูุฏ. ุงู ุชุงุจุน ููุท ูุฑ 10 ุซุงูู ุจู ุฏูู `delay` ูุฑุงุฎูุงู ูโุดูุฏุ ุจู ุงู ูุนู ฺฉู ูุชุฏูุง ูุณุชูู ููุท ูุฑ 10 ุซุงูู ูพุฑุฏุงุฒุด ูโุดููุฏ. ุจุฑุง ฺฉุงุฑุขูุฏุชุฑ ฺฉุฑุฏู ุงู ูุฑุขูุฏุ ูโุชูุงู ุชุฃุฎุฑ 10 ุซุงููโุง ุฑุง ุจู ุชุฃุฎุฑูุง ฺฉูุชุงูโุชุฑ ุชูุณู ฺฉุฑุฏ ู ูุฑ ุจุงุฑ `IoTHubDeviceClient_LL_DoWork` ุฑุง ูุฑุงุฎูุงู ฺฉุฑุฏ. ุจุฑุง ุงูุฌุงู ุงู ฺฉุงุฑุ ฺฉุฏ ุฒุฑ ุฑุง ุจุงูุง ุชุงุจุน `loop` ุงุถุงูู ฺฉูุฏ:

    ```cpp
    void work_delay(int delay_time)
    {
        int current = 0;
        do
        {
            IoTHubDeviceClient_LL_DoWork(_device_ll_handle);
            delay(100);
            current += 100;
        } while (current < delay_time);
    }
    ```

    ุงู ฺฉุฏ ุจูโุทูุฑ ูฺฉุฑุฑ ุญููู ูโุฒูุฏุ `IoTHubDeviceClient_LL_DoWork` ุฑุง ูุฑุงุฎูุงู ฺฉุฑุฏู ู ูุฑ ุจุงุฑ 100 ููโุซุงูู ุชุฃุฎุฑ ูโุงูุฏุงุฒุฏ. ุงู ฺฉุงุฑ ุฑุง ุจู ุชุนุฏุงุฏ ุฏูุนุงุช ูุงุฒู ุจุฑุง ุชุฃุฎุฑ ุจู ูุฏุช ุฒูุงู ุฏุงุฏู ุดุฏู ุฏุฑ ูพุงุฑุงูุชุฑ `delay_time` ุงูุฌุงู ูโุฏูุฏ. ุงู ุจุฏุงู ูุนูุงุณุช ฺฉู ุฏุณุชฺฏุงู ุญุฏุงฺฉุซุฑ 100 ููโุซุงูู ุจุฑุง ูพุฑุฏุงุฒุด ุฏุฑุฎูุงุณุชโูุง ูุชุฏ ูุณุชูู ููุชุธุฑ ูโูุงูุฏ.

1. ุฏุฑ ุชุงุจุน `loop`ุ ูุฑุงุฎูุงู ุจู `IoTHubDeviceClient_LL_DoWork` ุฑุง ุญุฐู ฺฉุฑุฏู ู ูุฑุงุฎูุงู `delay(10000)` ุฑุง ุจุง ููุฑุฏ ุฒุฑ ุฌุงฺฏุฒู ฺฉูุฏ ุชุง ุงู ุชุงุจุน ุฌุฏุฏ ูุฑุงุฎูุงู ุดูุฏ:

    ```cpp
    work_delay(10000);
    ```

> ๐ ูโุชูุงูุฏ ุงู ฺฉุฏ ุฑุง ุฏุฑ ูพูุดู [code/wio-terminal](../../../../../2-farm/lessons/4-migrate-your-plant-to-the-cloud/code/wio-terminal) ูพุฏุง ฺฉูุฏ.

๐ ุจุฑูุงูู ุญุณฺฏุฑ ุฑุทูุจุช ุฎุงฺฉ ุดูุง ุจู IoT Hub ูุชุตู ุดุฏ!

**ุณูุจ ูุณุฆููุช**:  
ุงู ุณูุฏ ุจุง ุงุณุชูุงุฏู ุงุฒ ุณุฑูุณ ุชุฑุฌูู ููุด ูุตููุน [Co-op Translator](https://github.com/Azure/co-op-translator) ุชุฑุฌูู ุดุฏู ุงุณุช. ุฏุฑ ุญุงู ฺฉู ูุง ุชูุงุด ูโฺฉูู ุฏูุช ุฑุง ุญูุธ ฺฉููุ ูุทูุงู ุชูุฌู ุฏุงุดุชู ุจุงุดุฏ ฺฉู ุชุฑุฌููโูุง ุฎูุฏฺฉุงุฑ ููฺฉู ุงุณุช ุดุงูู ุฎุทุงูุง ุง ูุงุฏุฑุณุชโูุง ุจุงุดูุฏ. ุณูุฏ ุงุตู ุจู ุฒุจุงู ุงุตู ุขู ุจุงุฏ ุจู ุนููุงู ููุจุน ูุนุชุจุฑ ุฏุฑ ูุธุฑ ฺฏุฑูุชู ุดูุฏ. ุจุฑุง ุงุทูุงุนุงุช ุญุงุชุ ุชุฑุฌูู ุญุฑููโุง ุงูุณุงู ุชูุตู ูโุดูุฏ. ูุง ูุณุฆููุช ุฏุฑ ูุจุงู ุณูุก ุชูุงููโูุง ุง ุชูุณุฑูุง ูุงุฏุฑุณุช ูุงุด ุงุฒ ุงุณุชูุงุฏู ุงุฒ ุงู ุชุฑุฌูู ูุฏุงุฑู.