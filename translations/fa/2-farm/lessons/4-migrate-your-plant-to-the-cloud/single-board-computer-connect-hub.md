<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "3ac42e284a7222c0e83d2d43231a364f",
  "translation_date": "2025-08-25T21:46:55+00:00",
  "source_file": "2-farm/lessons/4-migrate-your-plant-to-the-cloud/single-board-computer-connect-hub.md",
  "language_code": "fa"
}
-->
# ุงุชุตุงู ุฏุณุชฺฏุงู IoT ุดูุง ุจู ุงุจุฑ - ุณุฎุชโุงูุฒุงุฑ ูุฌุงุฒ IoT ู Raspberry Pi

ุฏุฑ ุงู ุจุฎุด ุงุฒ ุฏุฑุณุ ุฏุณุชฺฏุงู IoT ูุฌุงุฒ ุง Raspberry Pi ุฎูุฏ ุฑุง ุจู IoT Hub ูุชุตู ูโฺฉูุฏ ุชุง ุฏุงุฏูโูุง ุชููโูุชุฑ ุงุฑุณุงู ฺฉุฑุฏู ู ุฏุณุชูุฑุงุช ุฏุฑุงูุช ฺฉูุฏ.

## ุงุชุตุงู ุฏุณุชฺฏุงู ุจู IoT Hub

ฺฏุงู ุจุนุฏ ุงุชุตุงู ุฏุณุชฺฏุงู ุดูุง ุจู IoT Hub ุงุณุช.

### ูุธูู - ุงุชุตุงู ุจู IoT Hub

1. ูพูุดู `soil-moisture-sensor` ุฑุง ุฏุฑ VS Code ุจุงุฒ ฺฉูุฏ. ุงฺฏุฑ ุงุฒ ฺฉ ุฏุณุชฺฏุงู IoT ูุฌุงุฒ ุงุณุชูุงุฏู ูโฺฉูุฏุ ูุทูุฆู ุดูุฏ ฺฉู ูุญุท ูุฌุงุฒ ุฏุฑ ุชุฑููุงู ุฏุฑ ุญุงู ุงุฌุฑุง ุงุณุช.

1. ฺูุฏ ุจุณุชู ุงุถุงู Pip ูุตุจ ฺฉูุฏ:

    ```sh
    pip3 install azure-iot-device
    ```

    ฺฉุชุงุจุฎุงูู `azure-iot-device` ุจุฑุง ุงุฑุชุจุงุท ุจุง IoT Hub ุดูุง ุงุณุชูุงุฏู ูโุดูุฏ.

1. ูุงุฑุฏุงุช ุฒุฑ ุฑุง ุจู ุจุงูุง ูุงู `app.py`ุ ุฒุฑ ูุงุฑุฏุงุช ููุฌูุฏ ุงุถุงูู ฺฉูุฏ:

    ```python
    from azure.iot.device import IoTHubDeviceClient, Message, MethodResponse
    ```

    ุงู ฺฉุฏ SDK ุฑุง ุจุฑุง ุงุฑุชุจุงุท ุจุง IoT Hub ุดูุง ูุงุฑุฏ ูโฺฉูุฏ.

1. ุฎุท `import paho.mqtt.client as mqtt` ุฑุง ุญุฐู ฺฉูุฏ ุฒุฑุง ุฏฺฏุฑ ุจู ุงู ฺฉุชุงุจุฎุงูู ูุงุฒ ูุณุช. ุชูุงู ฺฉุฏูุง MQTT ุดุงูู ูุงู ููุถูุนุงุชุ ุชูุงู ฺฉุฏูุง ฺฉู ุงุฒ `mqtt_client` ุงุณุชูุงุฏู ูโฺฉููุฏ ู `handle_command` ุฑุง ุญุฐู ฺฉูุฏ. ุญููู `while True:` ุฑุง ูฺฏู ุฏุงุฑุฏุ ููุท ุฎุท `mqtt_client.publish` ุฑุง ุงุฒ ุงู ุญููู ุญุฐู ฺฉูุฏ.

1. ฺฉุฏ ุฒุฑ ุฑุง ุฒุฑ ุฏุณุชูุฑุงุช ูุงุฑุฏุงุช ุงุถุงูู ฺฉูุฏ:

    ```python
    connection_string = "<connection string>"
    ```

    `<connection string>` ุฑุง ุจุง ุฑุดุชู ุงุชุตุงู ฺฉู ูุจูุงู ุฏุฑ ุงู ุฏุฑุณ ุจุฑุง ุฏุณุชฺฏุงู ุจุงุฒุงุจ ฺฉุฑุฏูโุงุฏ ุฌุงฺฏุฒู ฺฉูุฏ.

    > ๐ ุงู ุจูุชุฑู ุฑูุด ูุณุช. ุฑุดุชูโูุง ุงุชุตุงู ูุฑฺฏุฒ ูุจุงุฏ ุฏุฑ ฺฉุฏ ููุจุน ุฐุฎุฑู ุดููุฏุ ุฒุฑุง ููฺฉู ุงุณุช ุฏุฑ ฺฉูุชุฑู ูุณุฎู ฺฉุฏ ุจุฑุฑุณ ุดุฏู ู ุชูุณุท ูุฑ ฺฉุณ ูพุฏุง ุดููุฏ. ูุง ุงูุฌุง ุจุฑุง ุณุงุฏูโุณุงุฒ ุงู ฺฉุงุฑ ุฑุง ุงูุฌุงู ูโุฏูู. ุงุฏูโุขู ุงู ุงุณุช ฺฉู ุงุฒ ฺุฒ ูุงููุฏ ฺฉ ูุชุบุฑ ูุญุท ู ุงุจุฒุงุฑ ูุงููุฏ [`python-dotenv`](https://pypi.org/project/python-dotenv/) ุงุณุชูุงุฏู ฺฉูุฏ. ุฏุฑ ุฏุฑุณ ุขูุฏู ุจุดุชุฑ ุฏุฑ ุงู ููุฑุฏ ุงุฏ ุฎูุงูุฏ ฺฏุฑูุช.

1. ุฒุฑ ุงู ฺฉุฏุ ฺฉุฏ ุฒุฑ ุฑุง ุงุถุงูู ฺฉูุฏ ุชุง ฺฉ ุดุก client ุฏุณุชฺฏุงู ุงุฌุงุฏ ฺฉูุฏ ฺฉู ุจุชูุงูุฏ ุจุง IoT Hub ุงุฑุชุจุงุท ุจุฑูุฑุงุฑ ฺฉูุฏ ู ุขู ุฑุง ูุชุตู ฺฉูุฏ:

    ```python
    device_client = IoTHubDeviceClient.create_from_connection_string(connection_string)

    print('Connecting')
    device_client.connect()
    print('Connected')
    ```

1. ุงู ฺฉุฏ ุฑุง ุงุฌุฑุง ฺฉูุฏ. ุฎูุงูุฏ ุฏุฏ ฺฉู ุฏุณุชฺฏุงู ุดูุง ูุชุตู ูโุดูุฏ.

    ```output
    pi@raspberrypi:~/soil-moisture-sensor $ python3 app.py 
    Connecting
    Connected
    Soil moisture: 379
    ```

## ุงุฑุณุงู ุชููโูุชุฑ

ุงฺฉููู ฺฉู ุฏุณุชฺฏุงู ุดูุง ูุชุตู ุงุณุชุ ูโุชูุงูุฏ ุฏุงุฏูโูุง ุชููโูุชุฑ ุฑุง ุจู ุฌุง MQTT broker ุจู IoT Hub ุงุฑุณุงู ฺฉูุฏ.

### ูุธูู - ุงุฑุณุงู ุชููโูุชุฑ

1. ฺฉุฏ ุฒุฑ ุฑุง ุฏุงุฎู ุญููู `while True`ุ ุฏุฑุณุช ูุจู ุงุฒ sleep ุงุถุงูู ฺฉูุฏ:

    ```python
    message = Message(json.dumps({ 'soil_moisture': soil_moisture }))
    device_client.send_message(message)
    ```

    ุงู ฺฉุฏ ฺฉ `Message` ุงุฒ IoT Hub ุงุฌุงุฏ ูโฺฉูุฏ ฺฉู ุดุงูู ุฎูุงูุด ุฑุทูุจุช ุฎุงฺฉ ุจู ุตูุฑุช ฺฉ ุฑุดุชู JSON ุงุณุช ู ุณูพุณ ุขู ุฑุง ุจู ุนููุงู ฺฉ ูพุงู ุฏุณุชฺฏุงู ุจู ุงุจุฑ ุจู IoT Hub ุงุฑุณุงู ูโฺฉูุฏ.

## ูุฏุฑุช ุฏุณุชูุฑุงุช

ุฏุณุชฺฏุงู ุดูุง ุจุงุฏ ุฏุณุชูุฑ ุงุฒ ฺฉุฏ ุณุฑูุฑ ุจุฑุง ฺฉูุชุฑู ุฑูู ุฏุฑุงูุช ฺฉูุฏ. ุงู ุฏุณุชูุฑ ุจู ุนููุงู ฺฉ ุฏุฑุฎูุงุณุช ุฑูุด ูุณุชูู ุงุฑุณุงู ูโุดูุฏ.

## ูุธูู - ูุฏุฑุช ฺฉ ุฏุฑุฎูุงุณุช ุฑูุด ูุณุชูู

1. ฺฉุฏ ุฒุฑ ุฑุง ูุจู ุงุฒ ุญููู `while True` ุงุถุงูู ฺฉูุฏ:

    ```python
    def handle_method_request(request):
        print("Direct method received - ", request.name)
    
        if request.name == "relay_on":
            relay.on()
        elif request.name == "relay_off":
            relay.off()    
    ```

    ุงู ฺฉุฏ ฺฉ ูุชุฏ ุจู ูุงู `handle_method_request` ุชุนุฑู ูโฺฉูุฏ ฺฉู ููุช ฺฉ ุฑูุด ูุณุชูู ุชูุณุท IoT Hub ูุฑุงุฎูุงู ูโุดูุฏุ ุงุฌุฑุง ูโุดูุฏ. ูุฑ ุฑูุด ูุณุชูู ฺฉ ูุงู ุฏุงุฑุฏ ู ุงู ฺฉุฏ ุงูุชุธุงุฑ ุฏุงุฑุฏ ฺฉู ฺฉ ุฑูุด ุจู ูุงู `relay_on` ุจุฑุง ุฑูุดู ฺฉุฑุฏู ุฑูู ู `relay_off` ุจุฑุง ุฎุงููุด ฺฉุฑุฏู ุฑูู ูุฌูุฏ ุฏุงุดุชู ุจุงุดุฏ.

    > ๐ ุงู ฺฉุงุฑ ููฺูู ูโุชูุงูุฏ ุฏุฑ ฺฉ ุฏุฑุฎูุงุณุช ุฑูุด ูุณุชูู ูุงุญุฏ ูพุงุฏูโุณุงุฒ ุดูุฏุ ุจู ุทูุฑ ฺฉู ุญุงูุช ููุฑุฏ ูุธุฑ ุฑูู ุฏุฑ ฺฉ payload ุงุฑุณุงู ุดูุฏ ฺฉู ูโุชูุงูุฏ ุจุง ุฏุฑุฎูุงุณุช ุฑูุด ุงุฑุณุงู ุดุฏู ู ุงุฒ ุดุก `request` ุฏุฑ ุฏุณุชุฑุณ ุจุงุดุฏ.

1. ุฑูุดโูุง ูุณุชูู ูุงุฒ ุจู ฺฉ ูพุงุณุฎ ุฏุงุฑูุฏ ุชุง ุจู ฺฉุฏ ูุฑุงุฎูุงู ุจฺฏููุฏ ฺฉู ุฏุฑุฎูุงุณุช ุขูโูุง ูพุฑุฏุงุฒุด ุดุฏู ุงุณุช. ฺฉุฏ ุฒุฑ ุฑุง ุฏุฑ ุงูุชูุง ุชุงุจุน `handle_method_request` ุงุถุงูู ฺฉูุฏ ุชุง ฺฉ ูพุงุณุฎ ุจู ุฏุฑุฎูุงุณุช ุงุฌุงุฏ ฺฉูุฏ:

    ```python
    method_response = MethodResponse.create_from_method_request(request, 200)
    device_client.send_method_response(method_response)
    ```

    ุงู ฺฉุฏ ฺฉ ูพุงุณุฎ ุจู ุฏุฑุฎูุงุณุช ุฑูุด ูุณุชูู ุจุง ฺฉุฏ ูุถุนุช HTTP 200 ุงุฑุณุงู ูโฺฉูุฏ ู ุขู ุฑุง ุจู IoT Hub ุจุงุฒูโฺฏุฑุฏุงูุฏ.

1. ฺฉุฏ ุฒุฑ ุฑุง ุฒุฑ ุชุนุฑู ุงู ุชุงุจุน ุงุถุงูู ฺฉูุฏ:

    ```python
    device_client.on_method_request_received = handle_method_request
    ```

    ุงู ฺฉุฏ ุจู ฺฉูุงูุช IoT Hub ูโฺฏูุฏ ฺฉู ููุช ฺฉ ุฑูุด ูุณุชูู ูุฑุงุฎูุงู ูโุดูุฏุ ุชุงุจุน `handle_method_request` ุฑุง ุงุฌุฑุง ฺฉูุฏ.

> ๐ ูโุชูุงูุฏ ุงู ฺฉุฏ ุฑุง ุฏุฑ ูพูุดู [code/pi](../../../../../2-farm/lessons/4-migrate-your-plant-to-the-cloud/code/pi) ุง [code/virtual-device](../../../../../2-farm/lessons/4-migrate-your-plant-to-the-cloud/code/virtual-device) ูพุฏุง ฺฉูุฏ.

๐ ุจุฑูุงูู ุญุณฺฏุฑ ุฑุทูุจุช ุฎุงฺฉ ุดูุง ุจู IoT Hub ูุชุตู ุดุฏ!

**ุณูุจ ูุณุฆููุช**:  
ุงู ุณูุฏ ุจุง ุงุณุชูุงุฏู ุงุฒ ุณุฑูุณ ุชุฑุฌูู ููุด ูุตููุน [Co-op Translator](https://github.com/Azure/co-op-translator) ุชุฑุฌูู ุดุฏู ุงุณุช. ุฏุฑ ุญุงู ฺฉู ูุง ุชูุงุด ูโฺฉูู ุฏูุช ุฑุง ุญูุธ ฺฉููุ ูุทูุงู ุชูุฌู ุฏุงุดุชู ุจุงุดุฏ ฺฉู ุชุฑุฌููโูุง ุฎูุฏฺฉุงุฑ ููฺฉู ุงุณุช ุญุงู ุฎุทุงูุง ุง ูุงุฏุฑุณุชโูุง ุจุงุดูุฏ. ุณูุฏ ุงุตู ุจู ุฒุจุงู ุงุตู ุขู ุจุงุฏ ุจู ุนููุงู ููุจุน ูุนุชุจุฑ ุฏุฑ ูุธุฑ ฺฏุฑูุชู ุดูุฏ. ุจุฑุง ุงุทูุงุนุงุช ุญุณุงุณุ ุชุฑุฌูู ุญุฑููโุง ุงูุณุงู ุชูุตู ูโุดูุฏ. ูุง ูฺ ูุณุฆููุช ุฏุฑ ูุจุงู ุณูุกุชูุงููโูุง ุง ุชูุณุฑูุง ูุงุฏุฑุณุช ูุงุด ุงุฒ ุงุณุชูุงุฏู ุงุฒ ุงู ุชุฑุฌูู ูุฏุงุฑู.