<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "3f92edf2975175577174910caca4a389",
  "translation_date": "2025-08-27T14:16:46+00:00",
  "source_file": "6-consumer/lessons/1-speech-recognition/wio-terminal-speech-to-text.md",
  "language_code": "mr"
}
-->
# рднрд╛рд╖рдг рддреЗ рдордЬрдХреВрд░ - Wio Terminal

рдпрд╛ рдзрдбреНрдпрд╛рдЪреНрдпрд╛ рдпрд╛ рднрд╛рдЧрд╛рдд, рддреБрдореНрд╣реА рдХреЕрдкреНрдЪрд░ рдХреЗрд▓реЗрд▓реНрдпрд╛ рдСрдбрд┐рдУрдордзреАрд▓ рднрд╛рд╖рдг рдордЬрдХреВрд░рд╛рдд рд░реВрдкрд╛рдВрддрд░рд┐рдд рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рднрд╛рд╖рдг рд╕реЗрд╡реЗрд╕рд╛рдареА рдХреЛрдб рд▓рд┐рд╣рд╛рд▓.

## рдСрдбрд┐рдУ рднрд╛рд╖рдг рд╕реЗрд╡реЗрд▓рд╛ рдкрд╛рдард╡рд╛

рдСрдбрд┐рдУ REST API рдЪрд╛ рд╡рд╛рдкрд░ рдХрд░реВрди рднрд╛рд╖рдг рд╕реЗрд╡реЗрд▓рд╛ рдкрд╛рдард╡рддрд╛ рдпреЗрддреЛ. рднрд╛рд╖рдг рд╕реЗрд╡рд╛ рд╡рд╛рдкрд░рдгреНрдпрд╛рд╕рд╛рдареА, рдкреНрд░рдердо рддреБрдореНрд╣рд╛рд▓рд╛ рдкреНрд░рд╡реЗрд╢ рдЯреЛрдХрдирдЪреА рд╡рд┐рдирдВрддреА рдХрд░рд╛рд╡реА рд▓рд╛рдЧреЗрд▓, рдирдВрддрд░ рддреНрдпрд╛ рдЯреЛрдХрдирдЪрд╛ рд╡рд╛рдкрд░ рдХрд░реВрди REST API рд▓рд╛ рдкреНрд░рд╡реЗрд╢ рдорд┐рд│рд╡рд╛. рд╣реЗ рдкреНрд░рд╡реЗрд╢ рдЯреЛрдХрди 10 рдорд┐рдирд┐рдЯрд╛рдВрдирдВрддрд░ рдХрд╛рд▓рдмрд╛рд╣реНрдп рд╣реЛрддрд╛рдд, рддреНрдпрд╛рдореБрд│реЗ рддреБрдордЪреНрдпрд╛ рдХреЛрдбрдиреЗ рдирд┐рдпрдорд┐рддрдкрдгреЗ рддреНрдпрд╛рдВрдЪреА рд╡рд┐рдирдВрддреА рдХреЗрд▓реА рдкрд╛рд╣рд┐рдЬреЗ рдЬреЗрдгреЗрдХрд░реВрди рддреЗ рдиреЗрд╣рдореА рдЕрджреНрдпрдпрд╛рд╡рдд рд░рд╛рд╣рддреАрд▓.

### рдХрд╛рд░реНрдп - рдкреНрд░рд╡реЗрд╢ рдЯреЛрдХрди рдорд┐рд│рд╡рд╛

1. `smart-timer` рдкреНрд░рдХрд▓реНрдк рдЙрдШрдбрд╛, рдЬрд░ рддреЛ рдЖрдзреАрдЪ рдЙрдШрдбрд▓реЗрд▓рд╛ рдирд╕реЗрд▓.

1. WiFi рдЖрдгрд┐ JSON рд╣рд╛рддрд╛рд│рдгреНрдпрд╛рд╕рд╛рдареА `platformio.ini` рдлрд╛рдЗрд▓рдордзреНрдпреЗ рдЦрд╛рд▓реАрд▓ рд▓рд╛рдпрдмреНрд░рд░реА рдЕрд╡рд▓рдВрдмрд┐рддреНрд╡реЗ рдЬреЛрдбрд╛:

    ```ini
    seeed-studio/Seeed Arduino rpcWiFi @ 1.0.5
    seeed-studio/Seeed Arduino rpcUnified @ 2.1.3
    seeed-studio/Seeed_Arduino_mbedtls @ 3.0.1
    seeed-studio/Seeed Arduino RTC @ 2.0.0
    bblanchon/ArduinoJson @ 6.17.3
    ```

1. `config.h` рд╣реЗрдбрд░ рдлрд╛рдЗрд▓рдордзреНрдпреЗ рдЦрд╛рд▓реАрд▓ рдХреЛрдб рдЬреЛрдбрд╛:

    ```cpp
    const char *SSID = "<SSID>";
    const char *PASSWORD = "<PASSWORD>";
    
    const char *SPEECH_API_KEY = "<API_KEY>";
    const char *SPEECH_LOCATION = "<LOCATION>";
    const char *LANGUAGE = "<LANGUAGE>";

    const char *TOKEN_URL = "https://%s.api.cognitive.microsoft.com/sts/v1.0/issuetoken";
    ```

    `<SSID>` рдЖрдгрд┐ `<PASSWORD>` рддреБрдордЪреНрдпрд╛ WiFi рд╕рд╛рдареА рд╕рдВрдмрдВрдзрд┐рдд рдореВрд▓реНрдпрд╛рдВрдиреА рдмрджрд▓рд╛.

    `<API_KEY>` рд▓рд╛ рддреБрдордЪреНрдпрд╛ рднрд╛рд╖рдг рд╕реЗрд╡рд╛ рд╕реНрддреНрд░реЛрддрд╛рд╕рд╛рдареА API рдХреАрдиреЗ рдмрджрд▓рд╛. `<LOCATION>` рд▓рд╛ рддреБрдореНрд╣реА рднрд╛рд╖рдг рд╕реЗрд╡рд╛ рд╕реНрддреНрд░реЛрдд рддрдпрд╛рд░ рдХрд░рддрд╛рдирд╛ рд╡рд╛рдкрд░рд▓реЗрд▓реНрдпрд╛ рд╕реНрдерд╛рдирд╛рдиреЗ рдмрджрд▓рд╛.

    `<LANGUAGE>` рд▓рд╛ рддреБрдореНрд╣реА рдмреЛрд▓рдд рдЕрд╕рд▓реЗрд▓реНрдпрд╛ рднрд╛рд╖реЗрд╕рд╛рдареА рд╕реНрдерд╛рдирд┐рдХ рдирд╛рд╡рд╛рдиреЗ рдмрджрд▓рд╛, рдЙрджрд╛рд╣рд░рдгрд╛рд░реНрде рдЗрдВрдЧреНрд░рдЬреАрд╕рд╛рдареА `en-GB`, рдХрд┐рдВрд╡рд╛ рдХреЕрдиреНрдЯреЛрдиреАрдЬрд╕рд╛рдареА `zn-HK`. рд╕рдорд░реНрдерд┐рдд рднрд╛рд╖рд╛ рдЖрдгрд┐ рддреНрдпрд╛рдВрдЪреА рд╕реНрдерд╛рдирд┐рдХ рдирд╛рд╡реЗ [Microsoft Docs рд╡рд░реАрд▓ рднрд╛рд╖рд╛ рдЖрдгрд┐ рдЖрд╡рд╛рдЬ рд╕рдорд░реНрдерди рджрд╕реНрддрдРрд╡рдЬ](https://docs.microsoft.com/azure/cognitive-services/speech-service/language-support?WT.mc_id=academic-17441-jabenn#speech-to-text) рдордзреНрдпреЗ рд╕рд╛рдкрдбрддреАрд▓.

    `TOKEN_URL` рд╕реНрдерд┐рд░рд╛рдВрдХ рд╣рд╛ рд╕реНрдерд╛рдирд╛рд╢рд┐рд╡рд╛рдп рдЯреЛрдХрди рдЬрд╛рд░реАрдХрд░реНрддреНрдпрд╛рдЪрд╛ URL рдЖрд╣реЗ. рд╣реЗ рдирдВрддрд░ рд╕реНрдерд╛рдирд╛рд╕рд╣ рдПрдХрддреНрд░рд┐рдд рдХреЗрд▓реЗ рдЬрд╛рдИрд▓ рдЬреЗрдгреЗрдХрд░реВрди рдкреВрд░реНрдг URL рдорд┐рд│реЗрд▓.

1. Custom Vision рд╢реА рдХрдиреЗрдХреНрдЯ рдХрд░рдгреНрдпрд╛рдкреНрд░рдорд╛рдгреЗрдЪ, рддреБрдореНрд╣рд╛рд▓рд╛ рдЯреЛрдХрди рдЬрд╛рд░реА рдХрд░рдгрд╛рд▒реНрдпрд╛ рд╕реЗрд╡реЗрд╢реА рдХрдиреЗрдХреНрдЯ рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА HTTPS рдХрдиреЗрдХреНрд╢рди рд╡рд╛рдкрд░рд╛рд╡реЗ рд▓рд╛рдЧреЗрд▓. `config.h` рдЪреНрдпрд╛ рд╢реЗрд╡рдЯреА рдЦрд╛рд▓реАрд▓ рдХреЛрдб рдЬреЛрдбрд╛:

    ```cpp
    const char *TOKEN_CERTIFICATE =
        "-----BEGIN CERTIFICATE-----\r\n"
        "MIIF8zCCBNugAwIBAgIQAueRcfuAIek/4tmDg0xQwDANBgkqhkiG9w0BAQwFADBh\r\n"
        "MQswCQYDVQQGEwJVUzEVMBMGA1UEChMMRGlnaUNlcnQgSW5jMRkwFwYDVQQLExB3\r\n"
        "d3cuZGlnaWNlcnQuY29tMSAwHgYDVQQDExdEaWdpQ2VydCBHbG9iYWwgUm9vdCBH\r\n"
        "MjAeFw0yMDA3MjkxMjMwMDBaFw0yNDA2MjcyMzU5NTlaMFkxCzAJBgNVBAYTAlVT\r\n"
        "MR4wHAYDVQQKExVNaWNyb3NvZnQgQ29ycG9yYXRpb24xKjAoBgNVBAMTIU1pY3Jv\r\n"
        "c29mdCBBenVyZSBUTFMgSXNzdWluZyBDQSAwNjCCAiIwDQYJKoZIhvcNAQEBBQAD\r\n"
        "ggIPADCCAgoCggIBALVGARl56bx3KBUSGuPc4H5uoNFkFH4e7pvTCxRi4j/+z+Xb\r\n"
        "wjEz+5CipDOqjx9/jWjskL5dk7PaQkzItidsAAnDCW1leZBOIi68Lff1bjTeZgMY\r\n"
        "iwdRd3Y39b/lcGpiuP2d23W95YHkMMT8IlWosYIX0f4kYb62rphyfnAjYb/4Od99\r\n"
        "ThnhlAxGtfvSbXcBVIKCYfZgqRvV+5lReUnd1aNjRYVzPOoifgSx2fRyy1+pO1Uz\r\n"
        "aMMNnIOE71bVYW0A1hr19w7kOb0KkJXoALTDDj1ukUEDqQuBfBxReL5mXiu1O7WG\r\n"
        "0vltg0VZ/SZzctBsdBlx1BkmWYBW261KZgBivrql5ELTKKd8qgtHcLQA5fl6JB0Q\r\n"
        "gs5XDaWehN86Gps5JW8ArjGtjcWAIP+X8CQaWfaCnuRm6Bk/03PQWhgdi84qwA0s\r\n"
        "sRfFJwHUPTNSnE8EiGVk2frt0u8PG1pwSQsFuNJfcYIHEv1vOzP7uEOuDydsmCjh\r\n"
        "lxuoK2n5/2aVR3BMTu+p4+gl8alXoBycyLmj3J/PUgqD8SL5fTCUegGsdia/Sa60\r\n"
        "N2oV7vQ17wjMN+LXa2rjj/b4ZlZgXVojDmAjDwIRdDUujQu0RVsJqFLMzSIHpp2C\r\n"
        "Zp7mIoLrySay2YYBu7SiNwL95X6He2kS8eefBBHjzwW/9FxGqry57i71c2cDAgMB\r\n"
        "AAGjggGtMIIBqTAdBgNVHQ4EFgQU1cFnOsKjnfR3UltZEjgp5lVou6UwHwYDVR0j\r\n"
        "BBgwFoAUTiJUIBiV5uNu5g/6+rkS7QYXjzkwDgYDVR0PAQH/BAQDAgGGMB0GA1Ud\r\n"
        "JQQWMBQGCCsGAQUFBwMBBggrBgEFBQcDAjASBgNVHRMBAf8ECDAGAQH/AgEAMHYG\r\n"
        "CCsGAQUFBwEBBGowaDAkBggrBgEFBQcwAYYYaHR0cDovL29jc3AuZGlnaWNlcnQu\r\n"
        "Y29tMEAGCCsGAQUFBzAChjRodHRwOi8vY2FjZXJ0cy5kaWdpY2VydC5jb20vRGln\r\n"
        "aUNlcnRHbG9iYWxSb290RzIuY3J0MHsGA1UdHwR0MHIwN6A1oDOGMWh0dHA6Ly9j\r\n"
        "cmwzLmRpZ2ljZXJ0LmNvbS9EaWdpQ2VydEdsb2JhbFJvb3RHMi5jcmwwN6A1oDOG\r\n"
        "MWh0dHA6Ly9jcmw0LmRpZ2ljZXJ0LmNvbS9EaWdpQ2VydEdsb2JhbFJvb3RHMi5j\r\n"
        "cmwwHQYDVR0gBBYwFDAIBgZngQwBAgEwCAYGZ4EMAQICMBAGCSsGAQQBgjcVAQQD\r\n"
        "AgEAMA0GCSqGSIb3DQEBDAUAA4IBAQB2oWc93fB8esci/8esixj++N22meiGDjgF\r\n"
        "+rA2LUK5IOQOgcUSTGKSqF9lYfAxPjrqPjDCUPHCURv+26ad5P/BYtXtbmtxJWu+\r\n"
        "cS5BhMDPPeG3oPZwXRHBJFAkY4O4AF7RIAAUW6EzDflUoDHKv83zOiPfYGcpHc9s\r\n"
        "kxAInCedk7QSgXvMARjjOqdakor21DTmNIUotxo8kHv5hwRlGhBJwps6fEVi1Bt0\r\n"
        "trpM/3wYxlr473WSPUFZPgP1j519kLpWOJ8z09wxay+Br29irPcBYv0GMXlHqThy\r\n"
        "8y4m/HyTQeI2IMvMrQnwqPpY+rLIXyviI2vLoI+4xKE4Rn38ZZ8m\r\n"
        "-----END CERTIFICATE-----\r\n";
    ```

    рд╣рд╛ рддреЛрдЪ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдЖрд╣реЗ рдЬреЛ рддреБрдореНрд╣реА Custom Vision рд╢реА рдХрдиреЗрдХреНрдЯ рдХрд░рддрд╛рдирд╛ рд╡рд╛рдкрд░рд▓рд╛ рд╣реЛрддрд╛.

1. `main.cpp` рдлрд╛рдЗрд▓рдЪреНрдпрд╛ рд╢реАрд░реНрд╖рд╕реНрдерд╛рдиреА WiFi рд╣реЗрдбрд░ рдлрд╛рдЗрд▓ рдЖрдгрд┐ config рд╣реЗрдбрд░ рдлрд╛рдЗрд▓рд╕рд╛рдареА рд╕рдорд╛рд╡рд┐рд╖реНрдЯ рдЬреЛрдбрд╛:

    ```cpp
    #include <rpcWiFi.h>

    #include "config.h"
    ```

1. `setup` рдлрдВрдХреНрд╢рдирдЪреНрдпрд╛ рд╡рд░ `main.cpp` рдордзреНрдпреЗ WiFi рд╢реА рдХрдиреЗрдХреНрдЯ рд╣реЛрдгреНрдпрд╛рд╕рд╛рдареА рдХреЛрдб рдЬреЛрдбрд╛:

    ```cpp
    void connectWiFi()
    {
        while (WiFi.status() != WL_CONNECTED)
        {
            Serial.println("Connecting to WiFi..");
            WiFi.begin(SSID, PASSWORD);
            delay(500);
        }
    
        Serial.println("Connected!");
    }
    ```

1. `setup` рдлрдВрдХреНрд╢рдирдордзреВрди, рд╕рд┐рд░реАрдпрд▓ рдХрдиреЗрдХреНрд╢рди рд╕реНрдерд╛рдкрди рдЭрд╛рд▓реНрдпрд╛рдирдВрддрд░ рдпрд╛ рдлрдВрдХреНрд╢рдирд▓рд╛ рдХреЙрд▓ рдХрд░рд╛:

    ```cpp
    connectWiFi();
    ```

1. `src` рдлреЛрд▓реНрдбрд░рдордзреНрдпреЗ `speech_to_text.h` рдирд╛рд╡рд╛рдЪреА рдирд╡реАрди рд╣реЗрдбрд░ рдлрд╛рдЗрд▓ рддрдпрд╛рд░ рдХрд░рд╛. рдпрд╛ рд╣реЗрдбрд░ рдлрд╛рдЗрд▓рдордзреНрдпреЗ рдЦрд╛рд▓реАрд▓ рдХреЛрдб рдЬреЛрдбрд╛:

    ```cpp
    #pragma once
    
    #include <Arduino.h>
    #include <ArduinoJson.h>
    #include <HTTPClient.h>
    #include <WiFiClientSecure.h>
    
    #include "config.h"
    #include "mic.h"
    
    class SpeechToText
    {
    public:

    private:

    };

    SpeechToText speechToText;
    ```

    рдпрд╛рдд HTTP рдХрдиреЗрдХреНрд╢рди, рдХреЙрдиреНрдлрд┐рдЧрд░реЗрд╢рди рдЖрдгрд┐ `mic.h` рд╣реЗрдбрд░ рдлрд╛рдЗрд▓рд╕рд╛рдареА рдЖрд╡рд╢реНрдпрдХ рд╣реЗрдбрд░ рдлрд╛рдЗрд▓реНрд╕ рд╕рдорд╛рд╡рд┐рд╖реНрдЯ рдЖрд╣реЗрдд, рдЖрдгрд┐ `SpeechToText` рдирд╛рд╡рд╛рдЪрд╛ рд╡рд░реНрдЧ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХреЗрд▓рд╛ рдЖрд╣реЗ, рдирдВрддрд░ рдирдВрддрд░ рд╡рд╛рдкрд░рддрд╛ рдпреЗрдгрд╛рд▒реНрдпрд╛ рддреНрдпрд╛ рд╡рд░реНрдЧрд╛рдЪреА рдПрдХ рдЙрджрд╛рд╣рд░рдгреЗ рдШреЛрд╖рд┐рдд рдХреЗрд▓реА рдЖрд╣реЗ.

1. рдпрд╛ рд╡рд░реНрдЧрд╛рдЪреНрдпрд╛ `private` рд╡рд┐рднрд╛рдЧрд╛рдд рдЦрд╛рд▓реАрд▓ 2 рдлреАрд▓реНрдб рдЬреЛрдбрд╛:

    ```cpp
    WiFiClientSecure _token_client;
    String _access_token;
    ```

    `_token_client` рд╣рд╛ HTTPS рд╡рд╛рдкрд░рдгрд╛рд░рд╛ WiFi рдХреНрд▓рд╛рдпрдВрдЯ рдЖрд╣реЗ рдЖрдгрд┐ рддреЛ рдкреНрд░рд╡реЗрд╢ рдЯреЛрдХрди рдорд┐рд│рд╡рдгреНрдпрд╛рд╕рд╛рдареА рд╡рд╛рдкрд░рд▓рд╛ рдЬрд╛рдИрд▓. рд╣реЗ рдЯреЛрдХрди рдирдВрддрд░ `_access_token` рдордзреНрдпреЗ рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХреЗрд▓реЗ рдЬрд╛рдИрд▓.

1. `private` рд╡рд┐рднрд╛рдЧрд╛рдд рдЦрд╛рд▓реАрд▓ рдкрджреНрдзрдд рдЬреЛрдбрд╛:

    ```cpp
    String getAccessToken()
    {
        char url[128];
        sprintf(url, TOKEN_URL, SPEECH_LOCATION);
    
        HTTPClient httpClient;
        httpClient.begin(_token_client, url);
    
        httpClient.addHeader("Ocp-Apim-Subscription-Key", SPEECH_API_KEY);
        int httpResultCode = httpClient.POST("{}");
    
        if (httpResultCode != 200)
        {
            Serial.println("Error getting access token, trying again...");
            delay(10000);
            return getAccessToken();
        }
    
        Serial.println("Got access token.");
        String result = httpClient.getString();
    
        httpClient.end();
    
        return result;
    }
    ```

    рд╣рд╛ рдХреЛрдб рднрд╛рд╖рдг рд╕реНрддреНрд░реЛрддрд╛рдЪреНрдпрд╛ рд╕реНрдерд╛рдирд╛рдЪрд╛ рд╡рд╛рдкрд░ рдХрд░реВрди рдЯреЛрдХрди рдЬрд╛рд░реАрдХрд░реНрддрд╛ API рд╕рд╛рдареА URL рддрдпрд╛рд░ рдХрд░рддреЛ. рддреНрдпрд╛рдирдВрддрд░ рд╡реЗрдм рд╡рд┐рдирдВрддреА рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА `HTTPClient` рддрдпрд╛рд░ рдХрд░рддреЛ, рдЯреЛрдХрди рдПрдВрдбрдкреЙрдЗрдВрдЯреНрд╕ рдкреНрд░рдорд╛рдгрдкрддреНрд░рд╛рд╕рд╣ WiFi рдХреНрд▓рд╛рдпрдВрдЯ рд╡рд╛рдкрд░рдгреНрдпрд╛рд╕рд╛рдареА рд╕реЗрдЯ рдХрд░рддреЛ. рдХреЙрд▓рд╕рд╛рдареА API рдХреА рд╣реЗрдбрд░ рдореНрд╣рдгреВрди рд╕реЗрдЯ рдХрд░рддреЛ. рдирдВрддрд░ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдорд┐рд│рд╡рдгреНрдпрд╛рд╕рд╛рдареА POST рд╡рд┐рдирдВрддреА рдХрд░рддреЛ, рдЬрд░ рдХрд╛рд╣реА рддреНрд░реБрдЯреА рдЖрд▓реНрдпрд╛ рддрд░ рдкреБрдиреНрд╣рд╛ рдкреНрд░рдпрддреНрди рдХрд░рддреЛ. рд╢реЗрд╡рдЯреА рдкреНрд░рд╡реЗрд╢ рдЯреЛрдХрди рдкрд░рдд рдХреЗрд▓реЗ рдЬрд╛рддреЗ.

1. `public` рд╡рд┐рднрд╛рдЧрд╛рдд, рдкреНрд░рд╡реЗрд╢ рдЯреЛрдХрди рдорд┐рд│рд╡рдгреНрдпрд╛рд╕рд╛рдареА рдкрджреНрдзрдд рдЬреЛрдбрд╛. рд╣реЗ рдирдВрддрд░рдЪреНрдпрд╛ рдзрдбреНрдпрд╛рдВрдордзреНрдпреЗ рдордЬрдХреВрд░ рднрд╛рд╖рдгрд╛рдд рд░реВрдкрд╛рдВрддрд░рд┐рдд рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рдЖрд╡рд╢реНрдпрдХ рдЕрд╕реЗрд▓.

    ```cpp
    String AccessToken()
    {
        return _access_token;
    }
    ```

1. `public` рд╡рд┐рднрд╛рдЧрд╛рдд, рдЯреЛрдХрди рдХреНрд▓рд╛рдпрдВрдЯ рд╕реЗрдЯ рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА `init` рдкрджреНрдзрдд рдЬреЛрдбрд╛:

    ```cpp
    void init()
    {
        _token_client.setCACert(TOKEN_CERTIFICATE);
        _access_token = getAccessToken();
    }
    ```

    рд╣реЗ WiFi рдХреНрд▓рд╛рдпрдВрдЯрд╡рд░ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рд╕реЗрдЯ рдХрд░рддреЗ, рдирдВрддрд░ рдкреНрд░рд╡реЗрд╢ рдЯреЛрдХрди рдорд┐рд│рд╡рддреЗ.

1. `main.cpp` рдордзреНрдпреЗ, рдпрд╛ рдирд╡реАрди рд╣реЗрдбрд░ рдлрд╛рдЗрд▓рд▓рд╛ рд╕рдорд╛рд╡рд┐рд╖реНрдЯ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдордзреНрдпреЗ рдЬреЛрдбрд╛:

    ```cpp
    #include "speech_to_text.h"
    ```

1. `setup` рдлрдВрдХреНрд╢рдирдЪреНрдпрд╛ рд╢реЗрд╡рдЯреА, `mic.init` рдХреЙрд▓рдирдВрддрд░ рдкрдг `Ready` рд╕рд┐рд░реАрдпрд▓ рдореЙрдирд┐рдЯрд░рд╡рд░ рд▓рд┐рд╣рд┐рдгреНрдпрд╛рдкреВрд░реНрд╡реА `SpeechToText` рд╡рд░реНрдЧ рдкреНрд░рд╛рд░рдВрдн рдХрд░рд╛:

    ```cpp
    speechToText.init();
    ```

### рдХрд╛рд░реНрдп - рдлреНрд▓реЕрд╢ рдореЗрдорд░реАрдордзреВрди рдСрдбрд┐рдУ рд╡рд╛рдЪрд╛

1. рдпрд╛ рдзрдбреНрдпрд╛рдЪреНрдпрд╛ рдЖрдзреАрдЪреНрдпрд╛ рднрд╛рдЧрд╛рдд, рдСрдбрд┐рдУ рдлреНрд▓реЕрд╢ рдореЗрдорд░реАрдордзреНрдпреЗ рд░реЗрдХреЙрд░реНрдб рдХреЗрд▓рд╛ рдЧреЗрд▓рд╛ рд╣реЛрддрд╛. рд╣рд╛ рдСрдбрд┐рдУ рднрд╛рд╖рдг рд╕реЗрд╡рд╛рдВрдЪреНрдпрд╛ REST API рд▓рд╛ рдкрд╛рдард╡рд▓рд╛ рдЬрд╛рдИрд▓, рддреНрдпрд╛рдореБрд│реЗ рддреЛ рдлреНрд▓реЕрд╢ рдореЗрдорд░реАрдордзреВрди рд╡рд╛рдЪрд▓рд╛ рдкрд╛рд╣рд┐рдЬреЗ. рддреЛ рдЗрди-рдореЗрдорд░реА рдмрдлрд░рдордзреНрдпреЗ рд▓реЛрдб рдХреЗрд▓рд╛ рдЬрд╛рдК рд╢рдХрдд рдирд╛рд╣реА рдХрд╛рд░рдг рддреЛ рдЦреВрдк рдореЛрдард╛ рдЕрд╕реЗрд▓. `HTTPClient` рд╡рд░реНрдЧ рдЬреЛ REST рдХреЙрд▓ рдХрд░рддреЛ рддреЛ Arduino Stream рд╡рд╛рдкрд░реВрди рдбреЗрдЯрд╛ рдкреНрд░рд╡рд╛рд╣рд┐рдд рдХрд░реВ рд╢рдХрддреЛ - рдПрдХ рд╡рд░реНрдЧ рдЬреЛ рдбреЗрдЯрд╛ рд▓рд╣рд╛рди рддреБрдХрдбреНрдпрд╛рдВрдордзреНрдпреЗ рд▓реЛрдб рдХрд░реВ рд╢рдХрддреЛ, рд╡рд┐рдирдВрддреАрдЪрд╛ рднрд╛рдЧ рдореНрд╣рдгреВрди рдПрдХрд╛рд╡реЗрд│реА рдПрдХ рддреБрдХрдбрд╛ рдкрд╛рдард╡рддреЛ. рддреБрдореНрд╣реА рд╕реНрдЯреНрд░реАрдорд╡рд░ `read` рдХреЙрд▓ рдХреЗрд▓реНрдпрд╛рд╡рд░ рдкреНрд░рддреНрдпреЗрдХ рд╡реЗрд│реА рддреЛ рдкреБрдвреАрд▓ рдбреЗрдЯрд╛ рдмреНрд▓реЙрдХ рдкрд░рдд рдХрд░рддреЛ. Arduino рд╕реНрдЯреНрд░реАрдо рддрдпрд╛рд░ рдХреЗрд▓рд╛ рдЬрд╛рдК рд╢рдХрддреЛ рдЬреЛ рдлреНрд▓реЕрд╢ рдореЗрдорд░реАрдордзреВрди рд╡рд╛рдЪреВ рд╢рдХрддреЛ. `src` рдлреЛрд▓реНрдбрд░рдордзреНрдпреЗ `flash_stream.h` рдирд╛рд╡рд╛рдЪреА рдирд╡реАрди рдлрд╛рдЗрд▓ рддрдпрд╛рд░ рдХрд░рд╛ рдЖрдгрд┐ рддреНрдпрд╛рдд рдЦрд╛рд▓реАрд▓ рдХреЛрдб рдЬреЛрдбрд╛:

    ```cpp
    #pragma once
    
    #include <Arduino.h>
    #include <HTTPClient.h>
    #include <sfud.h>

    #include "config.h"
    
    class FlashStream : public Stream
    {
    public:
        virtual size_t write(uint8_t val)
        {    
        }
    
        virtual int available()
        {
        }
    
        virtual int read()
        {
        }
    
        virtual int peek()
        {
        }
    private:
    
    };
    ```

    рд╣реЗ `FlashStream` рд╡рд░реНрдЧ рдШреЛрд╖рд┐рдд рдХрд░рддреЗ, рдЬреЛ Arduino `Stream` рд╡рд░реНрдЧрд╛рд╡рд░реВрди рд╡реНрдпреБрддреНрдкрдиреНрди рдХреЗрд▓рд╛ рдЬрд╛рддреЛ. рд╣рд╛ рдПрдХ рдЕрдореВрд░реНрдд рд╡рд░реНрдЧ рдЖрд╣реЗ - рд╡реНрдпреБрддреНрдкрдиреНрди рд╡рд░реНрдЧрд╛рдВрдиреА рдХрд╛рд╣реА рдкрджреНрдзрддреА рд▓рд╛рдЧреВ рдХрд░рд╛рд╡реНрдпрд╛ рд▓рд╛рдЧрддрд╛рдд, рддреНрдпрд╛рдирдВрддрд░рдЪ рд╡рд░реНрдЧ рдЙрджрд╛рд╣рд░рдг рддрдпрд╛рд░ рдХреЗрд▓рд╛ рдЬрд╛рдК рд╢рдХрддреЛ.

    тЬЕ Arduino Streams рдмрджреНрджрд▓ рдЕрдзрд┐рдХ рд╡рд╛рдЪрд╛ [Arduino Stream рджрд╕реНрддрдРрд╡рдЬ](https://www.arduino.cc/reference/en/language/functions/communication/stream/) рдордзреНрдпреЗ.

1. `private` рд╡рд┐рднрд╛рдЧрд╛рдд рдЦрд╛рд▓реАрд▓ рдлреАрд▓реНрдб рдЬреЛрдбрд╛:

    ```cpp
    size_t _pos;
    size_t _flash_address;
    const sfud_flash *_flash;

    byte _buffer[HTTP_TCP_BUFFER_SIZE];
    ```

    рд╣реЗ рдлреНрд▓реЕрд╢ рдореЗрдорд░реАрдордзреВрди рд╡рд╛рдЪрд▓реЗрд▓реНрдпрд╛ рдбреЗрдЯрд╛ рд╕рд╛рдард╡рдгреНрдпрд╛рд╕рд╛рдареА рддрд╛рддреНрдкреБрд░рддрд╛ рдмрдлрд░ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддреЗ, рдмрдлрд░рдордзреВрди рд╡рд╛рдЪрддрд╛рдирд╛ рдЪрд╛рд▓реВ рд╕реНрдерд┐рддреА рд╕рд╛рдард╡рдгреНрдпрд╛рд╕рд╛рдареА рдлреАрд▓реНрдб, рдлреНрд▓реЕрд╢ рдореЗрдорд░реАрдордзреВрди рд╡рд╛рдЪрдгреНрдпрд╛рд╕рд╛рдареА рдЪрд╛рд▓реВ рдкрддреНрддрд╛, рдЖрдгрд┐ рдлреНрд▓реЕрд╢ рдореЗрдорд░реА рдбрд┐рд╡реНрд╣рд╛рдЗрд╕.

1. `private` рд╡рд┐рднрд╛рдЧрд╛рдд рдЦрд╛рд▓реАрд▓ рдкрджреНрдзрдд рдЬреЛрдбрд╛:

    ```cpp
    void populateBuffer()
    {
        sfud_read(_flash, _flash_address, HTTP_TCP_BUFFER_SIZE, _buffer);
        _flash_address += HTTP_TCP_BUFFER_SIZE;
        _pos = 0;
    }
    ```

    рд╣рд╛ рдХреЛрдб рдлреНрд▓реЕрд╢ рдореЗрдорд░реАрдордзреВрди рдЪрд╛рд▓реВ рдкрддреНрддреНрдпрд╛рд╡рд░реВрди рд╡рд╛рдЪрддреЛ рдЖрдгрд┐ рдбреЗрдЯрд╛ рдмрдлрд░рдордзреНрдпреЗ рд╕рд╛рдард╡рддреЛ. рдирдВрддрд░ рдкрддреНрддрд╛ рд╡рд╛рдврд╡рддреЛ, рддреНрдпрд╛рдореБрд│реЗ рдкреБрдвреАрд▓ рдХреЙрд▓ рдкреБрдвреАрд▓ рдореЗрдорд░реА рдмреНрд▓реЙрдХ рд╡рд╛рдЪрддреЛ. рдмрдлрд░ HTTPClient рдПрдХрд╛рд╡реЗрд│реА REST API рд▓рд╛ рдкрд╛рдард╡реЗрд▓ рдЕрд╢рд╛ рд╕рд░реНрд╡рд╛рдд рдореЛрдареНрдпрд╛ рддреБрдХрдбреНрдпрд╛рдЪреНрдпрд╛ рдЖрдХрд╛рд░рд╛рд╡рд░ рдЖрдзрд╛рд░рд┐рдд рдЖрд╣реЗ.

    > ЁЯТБ рдлреНрд▓реЕрд╢ рдореЗрдорд░реА рдорд┐рдЯрд╡рдгреЗ рдзрд╛рдиреНрдпрд╛рдЪреНрдпрд╛ рдЖрдХрд╛рд░рд╛рдиреЗ рдХрд░рд╛рд╡реЗ рд▓рд╛рдЧрддреЗ, рд╡рд╛рдЪрди рдорд╛рддреНрд░ рддрд╕реЗ рдирд╛рд╣реА.

1. рдпрд╛ рд╡рд░реНрдЧрд╛рдЪреНрдпрд╛ `public` рд╡рд┐рднрд╛рдЧрд╛рдд рдПрдХ рдХрдиреНрд╕реНрдЯреНрд░рдХреНрдЯрд░ рдЬреЛрдбрд╛:

    ```cpp
    FlashStream()
    {
        _pos = 0;
        _flash_address = 0;
        _flash = sfud_get_device_table() + 0;
        
        populateBuffer();
    }
    ```

    рд╣рд╛ рдХрдиреНрд╕реНрдЯреНрд░рдХреНрдЯрд░ рд╕рд░реНрд╡ рдлреАрд▓реНрдбреНрд╕ рдлреНрд▓реЕрд╢ рдореЗрдорд░реА рдмреНрд▓реЙрдХрдЪреНрдпрд╛ рд╕реБрд░реБрд╡рд╛рддреАрдкрд╛рд╕реВрди рд╡рд╛рдЪрдгреНрдпрд╛рд╕ рд╕реЗрдЯ рдХрд░рддреЛ, рдЖрдгрд┐ рдкрд╣рд┐рд▓рд╛ рдбреЗрдЯрд╛ рдмреНрд▓реЙрдХ рдмрдлрд░рдордзреНрдпреЗ рд▓реЛрдб рдХрд░рддреЛ.

1. `write` рдкрджреНрдзрдд рд▓рд╛рдЧреВ рдХрд░рд╛. рд╣рд╛ рд╕реНрдЯреНрд░реАрдо рдлрдХреНрдд рдбреЗрдЯрд╛ рд╡рд╛рдЪреЗрд▓, рддреНрдпрд╛рдореБрд│реЗ рд╣реЗ рдХрд╛рд╣реАрд╣реА рдХрд░реВ рд╢рдХрдд рдирд╛рд╣реА рдЖрдгрд┐ 0 рдкрд░рдд рдХрд░реВ рд╢рдХрддреЗ:

    ```cpp
    virtual size_t write(uint8_t val)
    {
        return 0;
    }
    ```

1. `peek` рдкрджреНрдзрдд рд▓рд╛рдЧреВ рдХрд░рд╛. рд╣реЗ рд╕реНрдЯреНрд░реАрдо рдкреБрдвреЗ рди рд╣рд▓рд╡рддрд╛ рдЪрд╛рд▓реВ рд╕реНрдерд┐рддреАрд╡рд░реАрд▓ рдбреЗрдЯрд╛ рдкрд░рдд рдХрд░рддреЗ. рдЬрд░ рдбреЗрдЯрд╛ рд╡рд╛рдЪрд▓рд╛ рдЧреЗрд▓рд╛ рдирд╛рд╣реА рддрд░ `peek` рдЕрдиреЗрдХ рд╡реЗрд│рд╛ рдХреЙрд▓ рдХреЗрд▓реНрдпрд╛рд╡рд░ рдиреЗрд╣рдореА рд╕рдорд╛рди рдбреЗрдЯрд╛ рдкрд░рдд рдХрд░реЗрд▓.

    ```cpp
    virtual int peek()
    {
        return _buffer[_pos];
    }
    ```

1. `available` рдлрдВрдХреНрд╢рди рд▓рд╛рдЧреВ рдХрд░рд╛. рд╣реЗ рд╕реНрдЯреНрд░реАрдордордзреВрди рдХрд┐рддреА рдмрд╛рдЗрдЯреНрд╕ рд╡рд╛рдЪрд▓реЗ рдЬрд╛рдК рд╢рдХрддрд╛рдд рддреЗ рдкрд░рдд рдХрд░рддреЗ, рдХрд┐рдВрд╡рд╛ рд╕реНрдЯреНрд░реАрдо рдкреВрд░реНрдг рдЭрд╛рд▓реНрдпрд╛рд╕ -1 рдкрд░рдд рдХрд░рддреЗ. рдпрд╛ рд╡рд░реНрдЧрд╛рд╕рд╛рдареА, рдЬрд╛рд╕реНрддреАрдд рдЬрд╛рд╕реНрдд рдЙрдкрд▓рдмреНрдзрддрд╛ HTTPClient рдЪреНрдпрд╛ рддреБрдХрдбреНрдпрд╛рдЪреНрдпрд╛ рдЖрдХрд╛рд░рд╛рдкреЗрдХреНрд╖рд╛ рдЬрд╛рд╕реНрдд рдирд╕рд╛рд╡реА. рдЬреЗрд╡реНрд╣рд╛ рд╣рд╛ рд╕реНрдЯреНрд░реАрдо HTTP рдХреНрд▓рд╛рдпрдВрдЯрдордзреНрдпреЗ рд╡рд╛рдкрд░рд▓рд╛ рдЬрд╛рддреЛ рддреЗрд╡реНрд╣рд╛ рддреЛ рдХрд┐рддреА рдбреЗрдЯрд╛ рдЙрдкрд▓рдмреНрдз рдЖрд╣реЗ рддреЗ рдкрд╛рд╣рдгреНрдпрд╛рд╕рд╛рдареА рд╣реЗ рдлрдВрдХреНрд╢рди рдХреЙрд▓ рдХрд░рддреЛ, рдирдВрддрд░ REST API рд▓рд╛ рдкрд╛рдард╡рдгреНрдпрд╛рд╕рд╛рдареА рддреНрдпрд╛ рдкреНрд░рдорд╛рдгрд╛рдд рдбреЗрдЯрд╛ рд╡рд┐рдирдВрддреА рдХрд░рддреЛ. рдЖрдореНрд╣рд╛рд▓рд╛ рдкреНрд░рддреНрдпреЗрдХ рддреБрдХрдбрд╛ HTTP рдХреНрд▓рд╛рдпрдВрдЯрдЪреНрдпрд╛ рддреБрдХрдбреНрдпрд╛рдЪреНрдпрд╛ рдЖрдХрд╛рд░рд╛рдкреЗрдХреНрд╖рд╛ рдЬрд╛рд╕реНрдд рдирдХреЛ рдЖрд╣реЗ, рддреНрдпрд╛рдореБрд│реЗ рдЬрд░ рдЬрд╛рд╕реНрдд рдЙрдкрд▓рдмреНрдз рдЕрд╕реЗрд▓ рддрд░ рддреБрдХрдбреНрдпрд╛рдЪрд╛ рдЖрдХрд╛рд░ рдкрд░рдд рдХреЗрд▓рд╛ рдЬрд╛рддреЛ. рдЬрд░ рдХрдореА рдЕрд╕реЗрд▓, рддрд░ рдЬреЗ рдЙрдкрд▓рдмреНрдз рдЖрд╣реЗ рддреЗ рдкрд░рдд рдХреЗрд▓реЗ рдЬрд╛рддреЗ. рд╕рд░реНрд╡ рдбреЗрдЯрд╛ рдкреНрд░рд╡рд╛рд╣рд┐рдд рдЭрд╛рд▓реНрдпрд╛рд╡рд░, -1 рдкрд░рдд рдХреЗрд▓реЗ рдЬрд╛рддреЗ.

    ```cpp
    virtual int available()
    {
        int remaining = BUFFER_SIZE - ((_flash_address - HTTP_TCP_BUFFER_SIZE) + _pos);
        int bytes_available = min(HTTP_TCP_BUFFER_SIZE, remaining);

        if (bytes_available == 0)
        {
            bytes_available = -1;
        }

        return bytes_available;
    }
    ```

1. `read` рдкрджреНрдзрдд рд▓рд╛рдЧреВ рдХрд░рд╛ рдЬреА рдмрдлрд░рдордзреВрди рдкреБрдвреАрд▓ рдмрд╛рдЗрдЯ рдкрд░рдд рдХрд░рддреЗ, рд╕реНрдерд┐рддреА рд╡рд╛рдврд╡рддреЗ. рдЬрд░ рд╕реНрдерд┐рддреА рдмрдлрд░рдЪреНрдпрд╛ рдЖрдХрд╛рд░рд╛рдкреЗрдХреНрд╖рд╛ рдЬрд╛рд╕реНрдд рдЕрд╕реЗрд▓, рддрд░ рддреА рдлреНрд▓реЕрд╢ рдореЗрдорд░реАрдордзреВрди рдкреБрдвреАрд▓ рдмреНрд▓реЙрдХрдиреЗ рдмрдлрд░ рднрд░рддреЗ рдЖрдгрд┐ рд╕реНрдерд┐рддреА рд░реАрд╕реЗрдЯ рдХрд░рддреЗ.

    ```cpp
    virtual int read()
    {
        int retVal = _buffer[_pos++];

        if (_pos == HTTP_TCP_BUFFER_SIZE)
        {
            populateBuffer();
        }

        return retVal;
    }
    ```

1. `speech_to_text.h` рд╣реЗрдбрд░ рдлрд╛рдЗрд▓рдордзреНрдпреЗ, рдпрд╛ рдирд╡реАрди рд╣реЗрдбрд░ рдлрд╛рдЗрд▓рд╕рд╛рдареА рд╕рдорд╛рд╡рд┐рд╖реНрдЯ рдирд┐рд░реНрджреЗрд╢ рдЬреЛрдбрд╛:

    ```cpp
    #include "flash_stream.h"
    ```

### рдХрд╛рд░реНрдп - рднрд╛рд╖рдг рдордЬрдХреВрд░рд╛рдд рд░реВрдкрд╛рдВрддрд░рд┐рдд рдХрд░рд╛

1. рднрд╛рд╖рдг рдордЬрдХреВрд░рд╛рдд рд░реВрдкрд╛рдВрддрд░рд┐рдд рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рдСрдбрд┐рдУ рднрд╛рд╖рдг рд╕реЗрд╡реЗрд▓рд╛ REST API рдЪреНрдпрд╛ рдорд╛рдзреНрдпрдорд╛рддреВрди рдкрд╛рдард╡рд▓рд╛ рдЬрд╛рдК рд╢рдХрддреЛ. рдпрд╛ REST API рд▓рд╛ рдЯреЛрдХрди рдЬрд╛рд░реАрдХрд░реНрддреНрдпрд╛рдкреЗрдХреНрд╖рд╛ рд╡реЗрдЧрд│реЗ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдЖрд╣реЗ, рддреНрдпрд╛рдореБрд│реЗ `config.h` рд╣реЗрдбрд░ рдлрд╛рдЗрд▓рдордзреНрдпреЗ рдЦрд╛рд▓реАрд▓ рдХреЛрдб рдЬреЛрдбрд╛:

    ```cpp
    const char *SPEECH_CERTIFICATE =
        "-----BEGIN CERTIFICATE-----\r\n"
        "MIIF8zCCBNugAwIBAgIQCq+mxcpjxFFB6jvh98dTFzANBgkqhkiG9w0BAQwFADBh\r\n"
        "MQswCQYDVQQGEwJVUzEVMBMGA1UEChMMRGlnaUNlcnQgSW5jMRkwFwYDVQQLExB3\r\n"
        "d3cuZGlnaWNlcnQuY29tMSAwHgYDVQQDExdEaWdpQ2VydCBHbG9iYWwgUm9vdCBH\r\n"
        "MjAeFw0yMDA3MjkxMjMwMDBaFw0yNDA2MjcyMzU5NTlaMFkxCzAJBgNVBAYTAlVT\r\n"
        "MR4wHAYDVQQKExVNaWNyb3NvZnQgQ29ycG9yYXRpb24xKjAoBgNVBAMTIU1pY3Jv\r\n"
        "c29mdCBBenVyZSBUTFMgSXNzdWluZyBDQSAwMTCCAiIwDQYJKoZIhvcNAQEBBQAD\r\n"
        "ggIPADCCAgoCggIBAMedcDrkXufP7pxVm1FHLDNA9IjwHaMoaY8arqqZ4Gff4xyr\r\n"
        "RygnavXL7g12MPAx8Q6Dd9hfBzrfWxkF0Br2wIvlvkzW01naNVSkHp+OS3hL3W6n\r\n"
        "l/jYvZnVeJXjtsKYcXIf/6WtspcF5awlQ9LZJcjwaH7KoZuK+THpXCMtzD8XNVdm\r\n"
        "GW/JI0C/7U/E7evXn9XDio8SYkGSM63aLO5BtLCv092+1d4GGBSQYolRq+7Pd1kR\r\n"
        "EkWBPm0ywZ2Vb8GIS5DLrjelEkBnKCyy3B0yQud9dpVsiUeE7F5sY8Me96WVxQcb\r\n"
        "OyYdEY/j/9UpDlOG+vA+YgOvBhkKEjiqygVpP8EZoMMijephzg43b5Qi9r5UrvYo\r\n"
        "o19oR/8pf4HJNDPF0/FJwFVMW8PmCBLGstin3NE1+NeWTkGt0TzpHjgKyfaDP2tO\r\n"
        "4bCk1G7pP2kDFT7SYfc8xbgCkFQ2UCEXsaH/f5YmpLn4YPiNFCeeIida7xnfTvc4\r\n"
        "7IxyVccHHq1FzGygOqemrxEETKh8hvDR6eBdrBwmCHVgZrnAqnn93JtGyPLi6+cj\r\n"
        "WGVGtMZHwzVvX1HvSFG771sskcEjJxiQNQDQRWHEh3NxvNb7kFlAXnVdRkkvhjpR\r\n"
        "GchFhTAzqmwltdWhWDEyCMKC2x/mSZvZtlZGY+g37Y72qHzidwtyW7rBetZJAgMB\r\n"
        "AAGjggGtMIIBqTAdBgNVHQ4EFgQUDyBd16FXlduSzyvQx8J3BM5ygHYwHwYDVR0j\r\n"
        "BBgwFoAUTiJUIBiV5uNu5g/6+rkS7QYXjzkwDgYDVR0PAQH/BAQDAgGGMB0GA1Ud\r\n"
        "JQQWMBQGCCsGAQUFBwMBBggrBgEFBQcDAjASBgNVHRMBAf8ECDAGAQH/AgEAMHYG\r\n"
        "CCsGAQUFBwEBBGowaDAkBggrBgEFBQcwAYYYaHR0cDovL29jc3AuZGlnaWNlcnQu\r\n"
        "Y29tMEAGCCsGAQUFBzAChjRodHRwOi8vY2FjZXJ0cy5kaWdpY2VydC5jb20vRGln\r\n"
        "aUNlcnRHbG9iYWxSb290RzIuY3J0MHsGA1UdHwR0MHIwN6A1oDOGMWh0dHA6Ly9j\r\n"
        "cmwzLmRpZ2ljZXJ0LmNvbS9EaWdpQ2VydEdsb2JhbFJvb3RHMi5jcmwwN6A1oDOG\r\n"
        "MWh0dHA6Ly9jcmw0LmRpZ2ljZXJ0LmNvbS9EaWdpQ2VydEdsb2JhbFJvb3RHMi5j\r\n"
        "cmwwHQYDVR0gBBYwFDAIBgZngQwBAgEwCAYGZ4EMAQICMBAGCSsGAQQBgjcVAQQD\r\n"
        "AgEAMA0GCSqGSIb3DQEBDAUAA4IBAQAlFvNh7QgXVLAZSsNR2XRmIn9iS8OHFCBA\r\n"
        "WxKJoi8YYQafpMTkMqeuzoL3HWb1pYEipsDkhiMnrpfeYZEA7Lz7yqEEtfgHcEBs\r\n"
        "K9KcStQGGZRfmWU07hPXHnFz+5gTXqzCE2PBMlRgVUYJiA25mJPXfB00gDvGhtYa\r\n"
        "+mENwM9Bq1B9YYLyLjRtUz8cyGsdyTIG/bBM/Q9jcV8JGqMU/UjAdh1pFyTnnHEl\r\n"
        "Y59Npi7F87ZqYYJEHJM2LGD+le8VsHjgeWX2CJQko7klXvcizuZvUEDTjHaQcs2J\r\n"
        "+kPgfyMIOY1DMJ21NxOJ2xPRC/wAh/hzSBRVtoAnyuxtkZ4VjIOh\r\n"
        "-----END CERTIFICATE-----\r\n";
    ```

1. рдпрд╛ рдлрд╛рдЗрд▓рдордзреНрдпреЗ рд╕реНрдерд╛рдирд╛рд╢рд┐рд╡рд╛рдп рднрд╛рд╖рдг URL рд╕рд╛рдареА рдПрдХ рд╕реНрдерд┐рд░рд╛рдВрдХ рдЬреЛрдбрд╛. рд╣реЗ рдирдВрддрд░ рд╕реНрдерд╛рди рдЖрдгрд┐ рднрд╛рд╖реЗрд╕рд╣ рдПрдХрддреНрд░рд┐рдд рдХреЗрд▓реЗ рдЬрд╛рдИрд▓ рдЬреЗрдгреЗрдХрд░реВрди рдкреВрд░реНрдг URL рдорд┐рд│реЗрд▓.

    ```cpp
    const char *SPEECH_URL = "https://%s.stt.speech.microsoft.com/speech/recognition/conversation/cognitiveservices/v1?language=%s";
    ```

1. `speech_to_text.h` рд╣реЗрдбрд░ рдлрд╛рдЗрд▓рдордзреНрдпреЗ, `SpeechToText` рд╡рд░реНрдЧрд╛рдЪреНрдпрд╛ `private` рд╡рд┐рднрд╛рдЧрд╛рдд, рднрд╛рд╖рдг рдкреНрд░рдорд╛рдгрдкрддреНрд░ рд╡рд╛рдкрд░рдгрд╛рд▒реНрдпрд╛ WiFi рдХреНрд▓рд╛рдпрдВрдЯрд╕рд╛рдареА рдлреАрд▓реНрдб рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рд╛:

    ```cpp
    WiFiClientSecure _speech_client;
    ```

1. `init` рдкрджреНрдзрддреАрдордзреНрдпреЗ, рдпрд╛ WiFi рдХреНрд▓рд╛рдпрдВрдЯрд╡рд░ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рд╕реЗрдЯ рдХрд░рд╛:

    ```cpp
    _speech_client.setCACert(SPEECH_CERTIFICATE);
    ```

1. `SpeechToText` рд╡рд░реНрдЧрд╛рдЪреНрдпрд╛ `public` рд╡рд┐рднрд╛рдЧрд╛рдд рднрд╛рд╖рдг рдордЬрдХреВрд░рд╛рдд рд░реВрдкрд╛рдВрддрд░рд┐рдд рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рдкрджреНрдзрдд рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рдЦрд╛рд▓реАрд▓ рдХреЛрдб рдЬреЛрдбрд╛:

    ```cpp
    String convertSpeechToText()
    {
        
    }
    ```

1. рдпрд╛ рдкрджреНрдзрддреАрдордзреНрдпреЗ рдЦрд╛рд▓реАрд▓ рдХреЛрдб рдЬреЛрдбрд╛ рдЬреЗ рднрд╛рд╖рдг рдкреНрд░рдорд╛рдгрдкрддреНрд░рд╛рд╕рд╣ рдХреЙрдиреНрдлрд┐рдЧрд░ рдХреЗрд▓реЗрд▓реНрдпрд╛ WiFi рдХреНрд▓рд╛рдпрдВрдЯрдЪрд╛ рд╡рд╛рдкрд░ рдХрд░реВрди HTTP рдХреНрд▓рд╛рдпрдВрдЯ рддрдпрд╛рд░ рдХрд░рддреЗ, рдЖрдгрд┐ рднрд╛рд╖рдг URL рд╕реНрдерд╛рди рдЖрдгрд┐ рднрд╛рд╖реЗрд╕рд╣ рд╕реЗрдЯ рдХрд░рддреЗ:

    ```cpp
    char url[128];
    sprintf(url, SPEECH_URL, SPEECH_LOCATION, LANGUAGE);

    HTTPClient httpClient;
    httpClient.begin(_speech_client, url);
    ```

1. рдХрдиреЗрдХреНрд╢рдирд╡рд░ рдХрд╛рд╣реА рд╣реЗрдбрд░ рд╕реЗрдЯ рдХрд░рдгреЗ рдЖрд╡рд╢реНрдпрдХ рдЖрд╣реЗ:

    ```cpp
    httpClient.addHeader("Authorization", String("Bearer ") + _access_token);
    httpClient.addHeader("Content-Type", String("audio/wav; codecs=audio/pcm; samplerate=") + String(RATE));
    httpClient.addHeader("Accept", "application/json;text/xml");
    ```

    рд╣реЗ рдЕрдзрд┐рдХреГрддрддреЗрд╕рд╛рдареА рдкреНрд░рд╡реЗрд╢ рдЯреЛрдХрди, рдСрдбрд┐рдУ рд╕реНрд╡рд░реВрдкрд╛рд╕рд╛рдареА рдирдореБрдирд╛ рджрд░, рдЖрдгрд┐ рдХреНрд▓рд╛рдпрдВрдЯрд▓рд╛ JSON рд╕реНрд╡рд░реВрдкрд╛рдд рдкрд░рд┐рдгрд╛рдо рдЕрдкреЗрдХреНрд╖рд┐рдд рдЕрд╕рд▓реНрдпрд╛рдЪреЗ рд╕реЗрдЯ рдХрд░рддреЗ.

1. рдпрд╛рдирдВрддрд░, REST API рдХреЙрд▓ рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рдЦрд╛рд▓реАрд▓ рдХреЛрдб рдЬреЛрдбрд╛:

    ```cpp
    Serial.println("Sending speech...");

    FlashStream stream;
    int httpResponseCode = httpClient.sendRequest("POST", &stream, BUFFER_SIZE);

    Serial.println("Speech sent!");
    ```

    рд╣реЗ `FlashStream` рддрдпрд╛рд░ рдХрд░рддреЗ рдЖрдгрд┐ REST API рд▓рд╛ рдбреЗрдЯрд╛ рдкреНрд░рд╡рд╛рд╣рд┐рдд рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рддреНрдпрд╛рдЪрд╛ рд╡рд╛рдкрд░ рдХрд░рддреЗ.

1. рдпрд╛рдЦрд╛рд▓реА, рдЦрд╛рд▓реАрд▓ рдХреЛрдб рдЬреЛрдбрд╛:

    ```cpp
    String text = "";

    if (httpResponseCode == 200)
    {
        String result = httpClient.getString();
        Serial.println(result);

        DynamicJsonDocument doc(1024);
        deserializeJson(doc, result.c_str());

        JsonObject obj = doc.as<JsonObject>();
        text = obj["DisplayText"].as<String>();
    }
    else if (httpResponseCode == 401)
    {
        Serial.println("Access token expired, trying again with a new token");
        _access_token = getAccessToken();
        return convertSpeechToText();
    }
    else
    {
        Serial.print("Failed to convert text to speech - error ");
        Serial.println(httpResponseCode);
    }
    ```

    рд╣рд╛ рдХреЛрдб рдкреНрд░рддрд┐рд╕рд╛рдж рдХреЛрдб рддрдкрд╛рд╕рддреЛ.

    рдЬрд░ рддреЛ 200 рдЕрд╕реЗрд▓, рдпрд╢рд╛рд╕рд╛рдареА рдХреЛрдб, рддрд░ рдкрд░рд┐рдгрд╛рдо рдкреНрд░рд╛рдкреНрдд рдХреЗрд▓рд╛ рдЬрд╛рддреЛ, JSON рдордзреВрди рдбрд┐рдХреЛрдб рдХреЗрд▓рд╛ рдЬрд╛рддреЛ, рдЖрдгрд┐ `DisplayText` рдкреНрд░реЙрдкрд░реНрдЯреА `text` рд╡реНрд╣реЗрд░рд┐рдПрдмрд▓рдордзреНрдпреЗ рд╕реЗрдЯ рдХреЗрд▓реА рдЬрд╛рддреЗ. рднрд╛рд╖рдгрд╛рдЪрд╛ рдордЬрдХреВрд░ рдкрд░рдд рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рд╣реА рдкреНрд░реЙрдкрд░реНрдЯреА рд╡рд╛рдкрд░рд▓реА рдЬрд╛рддреЗ.

    рдЬрд░ рдкреНрд░рддрд┐рд╕рд╛рдж рдХреЛрдб 401 рдЕрд╕реЗрд▓, рддрд░ рдкреНрд░рд╡реЗрд╢ рдЯреЛрдХрди рдХрд╛рд▓рдмрд╛рд╣реНрдп рдЭрд╛рд▓реЗ рдЖрд╣реЗ (рд╣реА рдЯреЛрдХрди рдлрдХреНрдд 10 рдорд┐рдирд┐рдЯреЗ рдЯрд┐рдХрддрд╛рдд). рдирд╡реАрди рдкреНрд░рд╡реЗрд╢ рдЯреЛрдХрдирдЪреА рд╡рд┐рдирдВрддреА рдХреЗрд▓реА рдЬрд╛рддреЗ, рдЖрдгрд┐ рдХреЙрд▓ рдкреБрдиреНрд╣рд╛ рдХреЗрд▓рд╛ рдЬрд╛рддреЛ.

    рдЕрдиреНрдпрдерд╛, рд╕рд┐рд░реАрдпрд▓ рдореЙрдирд┐рдЯрд░рд╡рд░ рддреНрд░реБрдЯреА рдкрд╛рдард╡рд▓реА рдЬрд╛рддреЗ, рдЖрдгрд┐ `text` рд░рд┐рдХрд╛рдореЗ рдареЗрд╡рд▓реЗ рдЬрд╛рддреЗ.

1. рдпрд╛ рдкрджреНрдзрддреАрдЪреНрдпрд╛ рд╢реЗрд╡рдЯреА рдЦрд╛рд▓реАрд▓ рдХреЛрдб рдЬреЛрдбрд╛ рдЬреЗ HTTP рдХреНрд▓рд╛рдпрдВрдЯ рдмрдВрдж рдХрд░рддреЗ рдЖрдгрд┐ рдордЬрдХреВрд░ рдкрд░рдд рдХрд░рддреЗ:

    ```cpp
    httpClient.end();

    return text;
    ```

1. `main.cpp` рдордзреНрдпреЗ, `processAudio` рдлрдВрдХреНрд╢рдирдордзреНрдпреЗ рдпрд╛ рдирд╡реАрди `convertSpeechToText` рдкрджреНрдзрддреАрд▓рд╛ рдХреЙрд▓ рдХрд░рд╛, рдирдВрддрд░ рднрд╛рд╖рдг рд╕рд┐рд░реАрдпрд▓ рдореЙрдирд┐рдЯрд░рд╡рд░ рд▓реЙрдЧ рдХрд░рд╛:

    ```cpp
    String text = speechToText.convertSpeechToText();
    Serial.println(text);
    ```

1. рд╣рд╛ рдХреЛрдб рддрдпрд╛рд░ рдХрд░рд╛, Wio Terminal рд╡рд░ рдЕрдкрд▓реЛрдб рдХрд░рд╛ рдЖрдгрд┐ рд╕рд┐рд░реАрдпрд▓ рдореЙрдирд┐рдЯрд░рджреНрд╡рд╛рд░реЗ рддрдкрд╛рд╕рд╛. рдПрдХрджрд╛ рддреБрдореНрд╣рд╛рд▓рд╛ рд╕рд┐рд░реАрдпрд▓ рдореЙрдирд┐рдЯрд░рдордзреНрдпреЗ `Ready` рджрд┐рд╕рд▓реНрдпрд╛рд╡рд░, C рдмрдЯрдг рджрд╛рдмрд╛ (рдбрд╛рд╡реНрдпрд╛ рдмрд╛рдЬреВрд▓рд╛, рдкреЙрд╡рд░ рд╕реНрд╡рд┐рдЪрдЬрд╡рд│реАрд▓), рдЖрдгрд┐ рдмреЛрд▓рд╛. 4 рд╕реЗрдХрдВрджрд╛рдВрдЪрд╛ рдСрдбрд┐рдУ рдХреЕрдкреНрдЪрд░ рдХреЗрд▓рд╛ рдЬрд╛рдИрд▓, рдирдВрддрд░ рдордЬрдХреВрд░рд╛рдд рд░реВрдкрд╛рдВрддрд░рд┐рдд рдХреЗрд▓рд╛ рдЬрд╛рдИрд▓.

    ```output
    --- Available filters and text transformations: colorize, debug, default, direct, hexlify, log2file, nocontrol, printable, send_on_enter, time
    --- More details at http://bit.ly/pio-monitor-filters
    --- Miniterm on /dev/cu.usbmodem1101  9600,8,N,1 ---
    --- Quit: Ctrl+C | Menu: Ctrl+T | Help: Ctrl+T followed by Ctrl+H ---
    Connecting to WiFi..
    Connected!
    Got access token.
    Ready.
    Starting recording...
    Finished recording
    Sending speech...
    Speech sent!
    {"RecognitionStatus":"Success","DisplayText":"Set a 2 minute and 27 second timer.","Offset":4700000,"Duration":35300000}
    Set a 2 minute and 27 second timer.
    ```

> ЁЯТБ рддреБрдореНрд╣рд╛рд▓рд╛ рд╣рд╛ рдХреЛрдб [code-speech-to-text/wio-terminal](../../../../../6-consumer/lessons/1-speech-recognition/code-speech-to-text/wio-terminal) рдлреЛрд▓реНрдбрд░рдордзреНрдпреЗ рд╕рд╛рдкрдбреЗрд▓.

ЁЯША рддреБрдордЪрд╛ рднрд╛рд╖рдг рддреЗ рдордЬрдХреВрд░ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдпрд╢рд╕реНрд╡реА рдЭрд╛рд▓рд╛!

---

**рдЕрд╕реНрд╡реАрдХрд░рдг**:  
рд╣рд╛ рджрд╕реНрддрдРрд╡рдЬ AI рднрд╛рд╖рд╛рдВрддрд░ рд╕реЗрд╡рд╛ [Co-op Translator](https://github.com/Azure/co-op-translator) рдЪрд╛ рд╡рд╛рдкрд░ рдХрд░реВрди рднрд╛рд╖рд╛рдВрддрд░рд┐рдд рдХрд░рдгреНрдпрд╛рдд рдЖрд▓рд╛ рдЖрд╣реЗ. рдЖрдореНрд╣реА рдЕрдЪреВрдХрддреЗрд╕рд╛рдареА рдкреНрд░рдпрддреНрдирд╢реАрд▓ рдЕрд╕рд▓реЛ рддрд░реА рдХреГрдкрдпрд╛ рд▓рдХреНрд╖рд╛рдд рдареЗрд╡рд╛ рдХреА рд╕реНрд╡рдпрдВрдЪрд▓рд┐рдд рднрд╛рд╖рд╛рдВрддрд░реЗ рддреНрд░реБрдЯреА рдХрд┐рдВрд╡рд╛ рдЕрдЪреВрдХрддреЗрдЪреНрдпрд╛ рдЕрднрд╛рд╡рд╛рдиреЗ рдЧреНрд░рд╕реНрдд рдЕрд╕реВ рд╢рдХрддрд╛рдд. рдореВрд│ рднрд╛рд╖реЗрддреАрд▓ рджрд╕реНрддрдРрд╡рдЬ рд╣рд╛ рдЕрдзрд┐рдХреГрдд рд╕реНрд░реЛрдд рдорд╛рдирд▓рд╛ рдЬрд╛рд╡рд╛. рдорд╣рддреНрддреНрд╡рд╛рдЪреНрдпрд╛ рдорд╛рд╣рд┐рддреАрд╕рд╛рдареА рд╡реНрдпрд╛рд╡рд╕рд╛рдпрд┐рдХ рдорд╛рдирд╡реА рднрд╛рд╖рд╛рдВрддрд░рд╛рдЪреА рд╢рд┐рдлрд╛рд░рд╕ рдХреЗрд▓реА рдЬрд╛рддреЗ. рдпрд╛ рднрд╛рд╖рд╛рдВрддрд░рд╛рдЪрд╛ рд╡рд╛рдкрд░ рдХрд░реВрди рдирд┐рд░реНрдорд╛рдг рд╣реЛрдгрд╛рд▒реНрдпрд╛ рдХреЛрдгрддреНрдпрд╛рд╣реА рдЧреИрд░рд╕рдордЬ рдХрд┐рдВрд╡рд╛ рдЪреБрдХреАрдЪреНрдпрд╛ рдЕрд░реНрдерд╛рд╕рд╛рдареА рдЖрдореНрд╣реА рдЬрдмрд╛рдмрджрд╛рд░ рд░рд╛рд╣рдгрд╛рд░ рдирд╛рд╣реА.