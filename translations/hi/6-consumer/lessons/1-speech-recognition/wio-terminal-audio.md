<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "2f336726b9410e97c3aaed76cc89b0d8",
  "translation_date": "2025-08-25T17:53:43+00:00",
  "source_file": "6-consumer/lessons/1-speech-recognition/wio-terminal-audio.md",
  "language_code": "hi"
}
-->
# рдСрдбрд┐рдпреЛ рдХреИрдкреНрдЪрд░ рдХрд░реЗрдВ - Wio Terminal

рдЗрд╕ рдкрд╛рда рдХреЗ рдЗрд╕ рднрд╛рдЧ рдореЗрдВ, рдЖрдк рдЕрдкрдиреЗ Wio Terminal рдкрд░ рдСрдбрд┐рдпреЛ рдХреИрдкреНрдЪрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЛрдб рд▓рд┐рдЦреЗрдВрдЧреЗред рдСрдбрд┐рдпреЛ рдХреИрдкреНрдЪрд░ Wio Terminal рдХреЗ рдКрдкрд░ рджрд┐рдП рдЧрдП рдмрдЯрди рдореЗрдВ рд╕реЗ рдПрдХ рджреНрд╡рд╛рд░рд╛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред

## рдбрд┐рд╡рд╛рдЗрд╕ рдХреЛ рдСрдбрд┐рдпреЛ рдХреИрдкреНрдЪрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХрд░реЗрдВ

рдЖрдк рдорд╛рдЗрдХреНрд░реЛрдлреЛрди рд╕реЗ рдСрдбрд┐рдпреЛ C++ рдХреЛрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХреИрдкреНрдЪрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред Wio Terminal рдореЗрдВ рдХреЗрд╡рд▓ 192KB RAM рд╣реИ, рдЬреЛ рдХреБрдЫ рд╕реЗрдХрдВрдб рд╕реЗ рдЕрдзрд┐рдХ рдСрдбрд┐рдпреЛ рдХреИрдкреНрдЪрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рдирд╣реАрдВ рд╣реИред рдЗрд╕рдореЗрдВ 4MB рдлреНрд▓реИрд╢ рдореЗрдореЛрд░реА рднреА рд╣реИ, рдЬрд┐рд╕реЗ рдЗрд╕рдХреЗ рдмрдЬрд╛рдп рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдФрд░ рдХреИрдкреНрдЪрд░ рдХрд┐рдП рдЧрдП рдСрдбрд┐рдпреЛ рдХреЛ рдлреНрд▓реИрд╢ рдореЗрдореЛрд░реА рдореЗрдВ рд╕реЗрд╡ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

рдмрд┐рд▓реНрдЯ-рдЗрди рдорд╛рдЗрдХреНрд░реЛрдлреЛрди рдПрдХ рдПрдирд╛рд▓реЙрдЧ рд╕рд┐рдЧреНрдирд▓ рдХреИрдкреНрдЪрд░ рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕реЗ рдбрд┐рдЬрд┐рдЯрд▓ рд╕рд┐рдЧреНрдирд▓ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд┐рд╕реЗ Wio Terminal рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдЬрдм рдСрдбрд┐рдпреЛ рдХреИрдкреНрдЪрд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдбреЗрдЯрд╛ рдХреЛ рд╕рд╣реА рд╕рдордп рдкрд░ рдХреИрдкреНрдЪрд░ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ - рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, 16KHz рдкрд░ рдСрдбрд┐рдпреЛ рдХреИрдкреНрдЪрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдСрдбрд┐рдпреЛ рдХреЛ рдареАрдХ 16,000 рдмрд╛рд░ рдкреНрд░рддрд┐ рд╕реЗрдХрдВрдб рдХреИрдкреНрдЪрд░ рдХрд░рдирд╛ рд╣реЛрдЧрд╛, рдкреНрд░рддреНрдпреЗрдХ рд╕реИрдВрдкрд▓ рдХреЗ рдмреАрдЪ рд╕рдорд╛рди рдЕрдВрддрд░рд╛рд▓ рдХреЗ рд╕рд╛рдеред рдЖрдкрдХреЗ рдХреЛрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рдмрдЬрд╛рдп, рдЖрдк рдбрд╛рдпрд░реЗрдХреНрдЯ рдореЗрдореЛрд░реА рдПрдХреНрд╕реЗрд╕ рдХрдВрдЯреНрд░реЛрд▓рд░ (DMAC) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдпрд╣ рдПрдХ рд╕рд░реНрдХрд┐рдЯреНрд░реА рд╣реИ рдЬреЛ рдХрд╣реАрдВ рд╕реЗ рд╕рд┐рдЧреНрдирд▓ рдХреИрдкреНрдЪрд░ рдХрд░ рд╕рдХрддреА рд╣реИ рдФрд░ рдореЗрдореЛрд░реА рдореЗрдВ рд▓рд┐рдЦ рд╕рдХрддреА рд╣реИ, рдмрд┐рдирд╛ рдЖрдкрдХреЗ рдкреНрд░реЛрд╕реЗрд╕рд░ рдкрд░ рдЪрд▓ рд░рд╣реЗ рдХреЛрдб рдХреЛ рдмрд╛рдзрд┐рдд рдХрд┐рдПред

тЬЕ DMA рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдкрдврд╝реЗрдВ [Wikipedia рдкрд░ рдбрд╛рдпрд░реЗрдХреНрдЯ рдореЗрдореЛрд░реА рдПрдХреНрд╕реЗрд╕ рдкреЗрдЬ](https://wikipedia.org/wiki/Direct_memory_access) рдкрд░ред

![рдорд╛рдЗрдХреНрд░реЛрдлреЛрди рд╕реЗ рдСрдбрд┐рдпреЛ ADC рдореЗрдВ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдлрд┐рд░ DMAC рдореЗрдВред рдпрд╣ рдПрдХ рдмрдлрд░ рдореЗрдВ рд▓рд┐рдЦрддрд╛ рд╣реИред рдЬрдм рдпрд╣ рдмрдлрд░ рднрд░ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЗрд╕реЗ рдкреНрд░реЛрд╕реЗрд╕ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ DMAC рджреВрд╕рд░реЗ рдмрдлрд░ рдореЗрдВ рд▓рд┐рдЦрддрд╛ рд╣реИ](../../../../../translated_images/dmac-adc-buffers.4509aee49145c90bc2e1be472b8ed2ddfcb2b6a81ad3e559114aca55f5fff759.hi.png)

DMAC ADC рд╕реЗ рдСрдбрд┐рдпреЛ рдХреЛ рдирд┐рд╢реНрдЪрд┐рдд рдЕрдВрддрд░рд╛рд▓ рдкрд░ рдХреИрдкреНрдЪрд░ рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдЬреИрд╕реЗ 16KHz рдСрдбрд┐рдпреЛ рдХреЗ рд▓рд┐рдП рдкреНрд░рддрд┐ рд╕реЗрдХрдВрдб 16,000 рдмрд╛рд░ред рдпрд╣ рдХреИрдкреНрдЪрд░ рдХрд┐рдП рдЧрдП рдбреЗрдЯрд╛ рдХреЛ рдПрдХ рдкреНрд░реА-рдЕрд▓реЛрдХреЗрдЯреЗрдб рдореЗрдореЛрд░реА рдмрдлрд░ рдореЗрдВ рд▓рд┐рдЦ рд╕рдХрддрд╛ рд╣реИ, рдФрд░ рдЬрдм рдпрд╣ рднрд░ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЗрд╕реЗ рдкреНрд░реЛрд╕реЗрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЗ рдХреЛрдб рдХреЛ рдЙрдкрд▓рдмреНрдз рдХрд░рд╛рддрд╛ рд╣реИред рдЗрд╕ рдореЗрдореЛрд░реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдСрдбрд┐рдпреЛ рдХреИрдкреНрдЪрд░ рдореЗрдВ рджреЗрд░реА рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЖрдк рдХрдИ рдмрдлрд░ рд╕реЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред DMAC рдмрдлрд░ 1 рдореЗрдВ рд▓рд┐рдЦрддрд╛ рд╣реИ, рдлрд┐рд░ рдЬрдм рдпрд╣ рднрд░ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЖрдкрдХреЗ рдХреЛрдб рдХреЛ рдмрдлрд░ 1 рдХреЛ рдкреНрд░реЛрд╕реЗрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реВрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЬрдмрдХрд┐ DMAC рдмрдлрд░ 2 рдореЗрдВ рд▓рд┐рдЦрддрд╛ рд╣реИред рдЬрдм рдмрдлрд░ 2 рднрд░ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдпрд╣ рдЖрдкрдХреЗ рдХреЛрдб рдХреЛ рд╕реВрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдлрд┐рд░ рдмрдлрд░ 1 рдореЗрдВ рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд╛рдкрд╕ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕ рддрд░рд╣, рдЬрдм рддрдХ рдЖрдк рдкреНрд░рддреНрдпреЗрдХ рдмрдлрд░ рдХреЛ рднрд░рдиреЗ рдореЗрдВ рд▓рдЧрдиреЗ рд╡рд╛рд▓реЗ рд╕рдордп рд╕реЗ рдХрдо рд╕рдордп рдореЗрдВ рдкреНрд░реЛрд╕реЗрд╕ рдХрд░рддреЗ рд╣реИрдВ, рдЖрдк рдХреЛрдИ рдбреЗрдЯрд╛ рдирд╣реАрдВ рдЦреЛрдПрдВрдЧреЗред

рдПрдХ рдмрд╛рд░ рдЬрдм рдкреНрд░рддреНрдпреЗрдХ рдмрдлрд░ рдХреИрдкреНрдЪрд░ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЗрд╕реЗ рдлреНрд▓реИрд╢ рдореЗрдореЛрд░реА рдореЗрдВ рд▓рд┐рдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдлреНрд▓реИрд╢ рдореЗрдореЛрд░реА рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдПрдбреНрд░реЗрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд▓рд┐рдЦрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рдпрд╣ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддреЗ рд╣реБрдП рдХрд┐ рдХрд╣рд╛рдВ рд▓рд┐рдЦрдирд╛ рд╣реИ рдФрд░ рдХрд┐рддрдирд╛ рдмрдбрд╝рд╛ рд▓рд┐рдЦрдирд╛ рд╣реИ, рдореЗрдореЛрд░реА рдореЗрдВ рдмрд╛рдЗрдЯреНрд╕ рдХреЗ рдПрдХ рдПрд░реЗ рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рдиреЗ рдХреЗ рд╕рдорд╛рдиред рдлреНрд▓реИрд╢ рдореЗрдореЛрд░реА рдореЗрдВ рдЧреНрд░реИрдиреНрдпреБрд▓реИрд░рд┐рдЯреА рд╣реЛрддреА рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ рдЗрд░реЗрдЬрд╝ рдФрд░ рд▓рд┐рдЦрдиреЗ рдХреЗ рдСрдкрд░реЗрд╢рди рди рдХреЗрд╡рд▓ рдПрдХ рдирд┐рд╢реНрдЪрд┐рдд рдЖрдХрд╛рд░ рдХреЗ рд╣реЛрдиреЗ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддреЗ рд╣реИрдВ, рдмрд▓реНрдХрд┐ рдЙрд╕ рдЖрдХрд╛рд░ рдХреЗ рд╕рд╛рде рд╕рдВрд░реЗрдЦрд┐рдд рд╣реЛрдиреЗ рдкрд░ рднреА рдирд┐рд░реНрднрд░ рдХрд░рддреЗ рд╣реИрдВред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдпрджрд┐ рдЧреНрд░реИрдиреНрдпреБрд▓реИрд░рд┐рдЯреА 4096 рдмрд╛рдЗрдЯреНрд╕ рд╣реИ рдФрд░ рдЖрдк рдПрдбреНрд░реЗрд╕ 4200 рдкрд░ рдЗрд░реЗрдЬрд╝ рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдпрд╣ рдПрдбреНрд░реЗрд╕ 4096 рд╕реЗ 8192 рддрдХ рдХрд╛ рд╕рд╛рд░рд╛ рдбреЗрдЯрд╛ рдорд┐рдЯрд╛ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЬрдм рдЖрдк рдСрдбрд┐рдпреЛ рдбреЗрдЯрд╛ рдХреЛ рдлреНрд▓реИрд╢ рдореЗрдореЛрд░реА рдореЗрдВ рд▓рд┐рдЦрддреЗ рд╣реИрдВ, рддреЛ рдЗрд╕реЗ рд╕рд╣реА рдЖрдХрд╛рд░ рдХреЗ рдЪрдВрдХреНрд╕ рдореЗрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред

### рдХрд╛рд░реНрдп - рдлреНрд▓реИрд╢ рдореЗрдореЛрд░реА рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░реЗрдВ

1. PlatformIO рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рдирдпрд╛ Wio Terminal рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдмрдирд╛рдПрдВред рдЗрд╕ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХреЛ `smart-timer` рдирд╛рдо рджреЗрдВред `setup` рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ рд╕реАрд░рд┐рдпрд▓ рдкреЛрд░реНрдЯ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЛрдб рдЬреЛрдбрд╝реЗрдВред

1. рдлреНрд▓реИрд╢ рдореЗрдореЛрд░реА рддрдХ рдкрд╣реБрдВрдЪ рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП `platformio.ini` рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдбрд┐рдкреЗрдВрдбреЗрдВрд╕реА рдЬреЛрдбрд╝реЗрдВ:

    ```ini
    lib_deps =
        seeed-studio/Seeed Arduino FS @ 2.1.1
        seeed-studio/Seeed Arduino SFUD @ 2.0.2
    ```

1. `main.cpp` рдлрд╝рд╛рдЗрд▓ рдЦреЛрд▓реЗрдВ рдФрд░ рдлрд╝рд╛рдЗрд▓ рдХреЗ рд╢реАрд░реНрд╖ рдкрд░ рдлреНрд▓реИрд╢ рдореЗрдореЛрд░реА рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЗрдирдХреНрд▓реВрдб рдбрд╛рдпрд░реЗрдХреНрдЯрд┐рд╡ рдЬреЛрдбрд╝реЗрдВ:

    ```cpp
    #include <sfud.h>
    #include <SPI.h>
    ```

    > ЁЯОУ SFUD рдХрд╛ рдорддрд▓рдм рд╣реИ Serial Flash Universal Driver, рдФрд░ рдпрд╣ рдПрдХ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рд╣реИ рдЬреЛ рд╕рднреА рдлреНрд▓реИрд╢ рдореЗрдореЛрд░реА рдЪрд┐рдкреНрд╕ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХреА рдЧрдИ рд╣реИред

1. `setup` рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ, рдлреНрд▓реИрд╢ рд╕реНрдЯреЛрд░реЗрдЬ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреЛ рд╕реЗрдЯрдЕрдк рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛрдб рдЬреЛрдбрд╝реЗрдВ:

    ```cpp
    while (!(sfud_init() == SFUD_SUCCESS))
        ;

    sfud_qspi_fast_read_enable(sfud_get_device(SFUD_W25Q32_DEVICE_INDEX), 2);
    ```

    рдпрд╣ рддрдм рддрдХ рд▓реВрдк рдХрд░рддрд╛ рд╣реИ рдЬрдм рддрдХ SFUD рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдЗрдирд┐рд╢рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдирд╣реАрдВ рд╣реЛ рдЬрд╛рддреА, рдлрд┐рд░ рддреЗрдЬрд╝ рд░реАрдбреНрд╕ рдЪрд╛рд▓реВ рдХрд░рддрд╛ рд╣реИред рдмрд┐рд▓реНрдЯ-рдЗрди рдлреНрд▓реИрд╢ рдореЗрдореЛрд░реА рдХреЛ Queued Serial Peripheral Interface (QSPI) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХреНрд╕реЗрд╕ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬреЛ рдПрдХ рдкреНрд░рдХрд╛рд░ рдХрд╛ SPI рдХрдВрдЯреНрд░реЛрд▓рд░ рд╣реИ рдЬреЛ рдиреНрдпреВрдирддрдо рдкреНрд░реЛрд╕реЗрд╕рд░ рдЙрдкрдпреЛрдЧ рдХреЗ рд╕рд╛рде рдПрдХ рдХрддрд╛рд░ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдирд┐рд░рдВрддрд░ рдПрдХреНрд╕реЗрд╕ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдЗрд╕рд╕реЗ рдлреНрд▓реИрд╢ рдореЗрдореЛрд░реА рдХреЛ рдкрдврд╝рдирд╛ рдФрд░ рд▓рд┐рдЦрдирд╛ рддреЗрдЬрд╝ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред

1. `src` рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рдПрдХ рдирдИ рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдПрдВ рдЬрд┐рд╕рдХрд╛ рдирд╛рдо `flash_writer.h` рд╣реЛред

1. рдЗрд╕ рдлрд╝рд╛рдЗрд▓ рдХреЗ рд╢реАрд░реНрд╖ рдкрд░ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЬреЛрдбрд╝реЗрдВ:

    ```cpp
    #pragma once

    #include <Arduino.h>
    #include <sfud.h>
    ```

    рдЗрд╕рдореЗрдВ рдХреБрдЫ рдЖрд╡рд╢реНрдпрдХ рд╣реЗрдбрд░ рдлрд╝рд╛рдЗрд▓реЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ, рдЬрд┐рдирдореЗрдВ рдлреНрд▓реИрд╢ рдореЗрдореЛрд░реА рдХреЗ рд╕рд╛рде рдЗрдВрдЯрд░реИрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП SFUD рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреА рд╣реЗрдбрд░ рдлрд╝рд╛рдЗрд▓ рд╢рд╛рдорд┐рд▓ рд╣реИред

1. рдЗрд╕ рдирдИ рд╣реЗрдбрд░ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ `FlashWriter` рдирд╛рдордХ рдПрдХ рдХреНрд▓рд╛рд╕ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░реЗрдВ:

    ```cpp
    class FlashWriter
    {
    public:
    
    private:
    };
    ```

1. `private` рд╕реЗрдХреНрд╢рди рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛрдб рдЬреЛрдбрд╝реЗрдВ:

    ```cpp
    byte *_sfudBuffer;
    size_t _sfudBufferSize;
    size_t _sfudBufferPos;
    size_t _sfudBufferWritePos;

    const sfud_flash *_flash;
    ```

    рдпрд╣ рдлреНрд▓реИрд╢ рдореЗрдореЛрд░реА рдореЗрдВ рд▓рд┐рдЦрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдбреЗрдЯрд╛ рдХреЛ рд╕реНрдЯреЛрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдмрдлрд░ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рдлрд╝реАрд▓реНрдбреНрд╕ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддрд╛ рд╣реИред `_sfudBuffer` рдПрдХ рдмрд╛рдЗрдЯ рдПрд░реЗ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдбреЗрдЯрд╛ рд▓рд┐рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдЬрдм рдпрд╣ рднрд░ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдбреЗрдЯрд╛ рдлреНрд▓реИрд╢ рдореЗрдореЛрд░реА рдореЗрдВ рд▓рд┐рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИред `_sfudBufferPos` рдлрд╝реАрд▓реНрдб рдЗрд╕ рдмрдлрд░ рдореЗрдВ рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд░реНрддрдорд╛рди рд╕реНрдерд╛рди рдХреЛ рд╕реНрдЯреЛрд░ рдХрд░рддрд╛ рд╣реИ, рдФрд░ `_sfudBufferWritePos` рдлреНрд▓реИрд╢ рдореЗрдореЛрд░реА рдореЗрдВ рд▓рд┐рдЦрдиреЗ рдХреЗ рд╕реНрдерд╛рди рдХреЛ рд╕реНрдЯреЛрд░ рдХрд░рддрд╛ рд╣реИред `_flash` рдлреНрд▓реИрд╢ рдореЗрдореЛрд░реА рдХреЛ рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдкреЙрдЗрдВрдЯрд░ рд╣реИ - рдХреБрдЫ рдорд╛рдЗрдХреНрд░реЛрдХрдВрдЯреНрд░реЛрд▓рд░реНрд╕ рдореЗрдВ рдХрдИ рдлреНрд▓реИрд╢ рдореЗрдореЛрд░реА рдЪрд┐рдкреНрд╕ рд╣реЛрддреЗ рд╣реИрдВред

1. рдЗрд╕ рдХреНрд▓рд╛рд╕ рдХреЛ рдЗрдирд┐рд╢рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП `public` рд╕реЗрдХреНрд╢рди рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдореЗрдердб рдЬреЛрдбрд╝реЗрдВ:

    ```cpp
    void init()
    {
        _flash = sfud_get_device_table() + 0;
        _sfudBufferSize = _flash->chip.erase_gran;
        _sfudBuffer = new byte[_sfudBufferSize];
        _sfudBufferPos = 0;
        _sfudBufferWritePos = 0;
    }
    ```

    рдпрд╣ Wio Terminal рдкрд░ рдлреНрд▓реИрд╢ рдореЗрдореЛрд░реА рдХреЛ рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдлреНрд▓реИрд╢ рдореЗрдореЛрд░реА рдХреЗ рдЧреНрд░реЗрди рд╕рд╛рдЗрдЬ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдмрдлрд░ рд╕реЗрдЯ рдХрд░рддрд╛ рд╣реИред рдпрд╣ рдПрдХ `init` рдореЗрдердб рдореЗрдВ рд╣реИ, рди рдХрд┐ рдПрдХ рдХрдВрд╕реНрдЯреНрд░рдХреНрдЯрд░ рдореЗрдВ, рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕реЗ `setup` рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ рдлреНрд▓реИрд╢ рдореЗрдореЛрд░реА рд╕реЗрдЯрдЕрдк рдХреЗ рдмрд╛рдж рдХреЙрд▓ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред

1. `public` рд╕реЗрдХреНрд╢рди рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛрдб рдЬреЛрдбрд╝реЗрдВ:

    ```cpp
    void writeSfudBuffer(byte b)
    {
        _sfudBuffer[_sfudBufferPos++] = b;
        if (_sfudBufferPos == _sfudBufferSize)
        {
            sfud_erase_write(_flash, _sfudBufferWritePos, _sfudBufferSize, _sfudBuffer);
            _sfudBufferWritePos += _sfudBufferSize;
            _sfudBufferPos = 0;
        }
    }

    void writeSfudBuffer(byte *b, size_t len)
    {
        for (size_t i = 0; i < len; ++i)
        {
            writeSfudBuffer(b[i]);
        }
    }

    void flushSfudBuffer()
    {
        if (_sfudBufferPos > 0)
        {
            sfud_erase_write(_flash, _sfudBufferWritePos, _sfudBufferSize, _sfudBuffer);
            _sfudBufferWritePos += _sfudBufferSize;
            _sfudBufferPos = 0;
        }
    }
    ```

    рдпрд╣ рдХреЛрдб рдлреНрд▓реИрд╢ рд╕реНрдЯреЛрд░реЗрдЬ рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдмрд╛рдЗрдЯреНрд╕ рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдореЗрдердбреНрд╕ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддрд╛ рд╣реИред рдпрд╣ рдлреНрд▓реИрд╢ рдореЗрдореЛрд░реА рдХреЗ рд▓рд┐рдП рд╕рд╣реА рдЖрдХрд╛рд░ рдХреЗ рдЗрди-рдореЗрдореЛрд░реА рдмрдлрд░ рдореЗрдВ рд▓рд┐рдЦрдХрд░ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдЬрдм рдпрд╣ рднрд░ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЗрд╕реЗ рдлреНрд▓реИрд╢ рдореЗрдореЛрд░реА рдореЗрдВ рд▓рд┐рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЙрд╕ рд╕реНрдерд╛рди рдкрд░ рдХрд┐рд╕реА рднреА рдореМрдЬреВрджрд╛ рдбреЗрдЯрд╛ рдХреЛ рдорд┐рдЯрд╛рддреЗ рд╣реБрдПред рдЗрд╕рдореЗрдВ рдПрдХ `flushSfudBuffer` рднреА рд╣реИ рдЬреЛ рдПрдХ рдЕрдзреВрд░рд╛ рдмрдлрд░ рд▓рд┐рдЦрддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдХреИрдкреНрдЪрд░ рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рдбреЗрдЯрд╛ рдлреНрд▓реИрд╢ рдореЗрдореЛрд░реА рдХреЗ рдЧреНрд░реЗрди рд╕рд╛рдЗрдЬ рдХреЗ рд╕рдЯреАрдХ рдЧреБрдгрдЬ рдирд╣реАрдВ рд╣реЛрдЧрд╛, рдЗрд╕рд▓рд┐рдП рдбреЗрдЯрд╛ рдХрд╛ рдЕрдВрддрд┐рдо рднрд╛рдЧ рд▓рд┐рдЦрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред

    > ЁЯТБ рдбреЗрдЯрд╛ рдХрд╛ рдЕрдВрддрд┐рдо рднрд╛рдЧ рдЕрддрд┐рд░рд┐рдХреНрдд рдЕрд╡рд╛рдВрдЫрд┐рдд рдбреЗрдЯрд╛ рд▓рд┐рдЦреЗрдЧрд╛, рд▓реЗрдХрд┐рди рдпрд╣ рдареАрдХ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдХреЗрд╡рд▓ рдЖрд╡рд╢реНрдпрдХ рдбреЗрдЯрд╛ рд╣реА рдкрдврд╝рд╛ рдЬрд╛рдПрдЧрд╛ред

### рдХрд╛рд░реНрдп - рдСрдбрд┐рдпреЛ рдХреИрдкреНрдЪрд░ рд╕реЗрдЯ рдХрд░реЗрдВ

1. `src` рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рдПрдХ рдирдИ рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдПрдВ рдЬрд┐рд╕рдХрд╛ рдирд╛рдо `config.h` рд╣реЛред

1. рдЗрд╕ рдлрд╝рд╛рдЗрд▓ рдХреЗ рд╢реАрд░реНрд╖ рдкрд░ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЬреЛрдбрд╝реЗрдВ:

    ```cpp
    #pragma once

    #define RATE 16000
    #define SAMPLE_LENGTH_SECONDS 4
    #define SAMPLES RATE * SAMPLE_LENGTH_SECONDS
    #define BUFFER_SIZE (SAMPLES * 2) + 44
    #define ADC_BUF_LEN 1600
    ```

    рдпрд╣ рдХреЛрдб рдСрдбрд┐рдпреЛ рдХреИрдкреНрдЪрд░ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рдХреЙрдиреНрд╕реНрдЯреЗрдВрдЯреНрд╕ рд╕реЗрдЯ рдХрд░рддрд╛ рд╣реИред

    | рдХреЙрдиреНрд╕реНрдЯреЗрдВрдЯ              | рдорд╛рди  | рд╡рд┐рд╡рд░рдг |
    | --------------------- | -----: | - |
    | RATE                  | 16000  | рдСрдбрд┐рдпреЛ рдХреЗ рд▓рд┐рдП рд╕реИрдВрдкрд▓ рд░реЗрдЯред 16,000 рдХрд╛ рдорддрд▓рдм рд╣реИ 16KHz |
    | SAMPLE_LENGTH_SECONDS | 4      | рдХреИрдкреНрдЪрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдСрдбрд┐рдпреЛ рдХреА рд▓рдВрдмрд╛рдИред рдЗрд╕реЗ 4 рд╕реЗрдХрдВрдб рдкрд░ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рд▓рдВрдмреЗ рдСрдбрд┐рдпреЛ рд░рд┐рдХреЙрд░реНрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЗрд╕реЗ рдмрдврд╝рд╛рдПрдВред |
    | SAMPLES               | 64000  | рдХреИрдкреНрдЪрд░ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдСрдбрд┐рдпреЛ рд╕реИрдВрдкрд▓ рдХреА рдХреБрд▓ рд╕рдВрдЦреНрдпрд╛ред рдЗрд╕реЗ рд╕реИрдВрдкрд▓ рд░реЗрдЯ * рд╕реЗрдХрдВрдб рдХреА рд╕рдВрдЦреНрдпрд╛ рдкрд░ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред |
    | BUFFER_SIZE           | 128044 | рдСрдбрд┐рдпреЛ рдмрдлрд░ рдХрд╛ рдЖрдХрд╛рд░ рдХреИрдкреНрдЪрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред рдСрдбрд┐рдпреЛ рдХреЛ WAV рдлрд╝рд╛рдЗрд▓ рдХреЗ рд░реВрдк рдореЗрдВ рдХреИрдкреНрдЪрд░ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдЬрд┐рд╕рдореЗрдВ 44 рдмрд╛рдЗрдЯреНрд╕ рдХрд╛ рд╣реЗрдбрд░ рд╣реЛрдЧрд╛, рдлрд┐рд░ 128,000 рдмрд╛рдЗрдЯреНрд╕ рдХрд╛ рдСрдбрд┐рдпреЛ рдбреЗрдЯрд╛ (рдкреНрд░рддреНрдпреЗрдХ рд╕реИрдВрдкрд▓ 2 рдмрд╛рдЗрдЯреНрд╕ рдХрд╛ рд╣реЛрддрд╛ рд╣реИ)ред |
    | ADC_BUF_LEN           | 1600   | DMAC рд╕реЗ рдСрдбрд┐рдпреЛ рдХреИрдкреНрдЪрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдмрдлрд░ рдХрд╛ рдЖрдХрд╛рд░ред |

    > ЁЯТБ рдпрджрд┐ рдЖрдкрдХреЛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ 4 рд╕реЗрдХрдВрдб рдЯрд╛рдЗрдорд░ рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рдХрдо рд╣реИ, рддреЛ рдЖрдк `SAMPLE_LENGTH_SECONDS` рдорд╛рди рдмрдврд╝рд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдЕрдиреНрдп рд╕рднреА рдорд╛рди рдкреБрдирдГ рдЧрдгрдирд╛ рдХрд░реЗрдВрдЧреЗред

1. `src` рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рдПрдХ рдирдИ рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдПрдВ рдЬрд┐рд╕рдХрд╛ рдирд╛рдо `mic.h` рд╣реЛред

1. рдЗрд╕ рдлрд╝рд╛рдЗрд▓ рдХреЗ рд╢реАрд░реНрд╖ рдкрд░ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЬреЛрдбрд╝реЗрдВ:

    ```cpp
    #pragma once

    #include <Arduino.h>

    #include "config.h"
    #include "flash_writer.h"
    ```

    рдЗрд╕рдореЗрдВ рдХреБрдЫ рдЖрд╡рд╢реНрдпрдХ рд╣реЗрдбрд░ рдлрд╝рд╛рдЗрд▓реЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ, рдЬрд┐рдирдореЗрдВ `config.h` рдФрд░ `FlashWriter` рд╣реЗрдбрд░ рдлрд╝рд╛рдЗрд▓реЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИрдВред

1. рдорд╛рдЗрдХреНрд░реЛрдлреЛрди рд╕реЗ рдХреИрдкреНрдЪрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ `Mic` рдХреНрд▓рд╛рд╕ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЬреЛрдбрд╝реЗрдВ:

    ```cpp
    class Mic
    {
    public:
        Mic()
        {
            _isRecording = false;
            _isRecordingReady = false;
        }
    
        void startRecording()
        {
            _isRecording = true;
            _isRecordingReady = false;
        }
    
        bool isRecording()
        {
            return _isRecording;
        }
    
        bool isRecordingReady()
        {
            return _isRecordingReady;
        }
    
    private:
        volatile bool _isRecording;
        volatile bool _isRecordingReady;
        FlashWriter _writer;
    };
    
    Mic mic;
    ```

    рдЗрд╕ рдХреНрд▓рд╛рд╕ рдореЗрдВ рд╡рд░реНрддрдорд╛рди рдореЗрдВ рдХреЗрд╡рд▓ рдХреБрдЫ рдлрд╝реАрд▓реНрдбреНрд╕ рд╣реИрдВ рдЬреЛ рдЯреНрд░реИрдХ рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рд░рд┐рдХреЙрд░реНрдбрд┐рдВрдЧ рд╢реБрд░реВ рд╣реБрдИ рд╣реИ рдпрд╛ рдирд╣реАрдВ, рдФрд░ рдХреНрдпрд╛ рд░рд┐рдХреЙрд░реНрдбрд┐рдВрдЧ рдЙрдкрдпреЛрдЧ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рд╣реИред рдЬрдм DMAC рд╕реЗрдЯрдЕрдк рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдпрд╣ рд▓рдЧрд╛рддрд╛рд░ рдореЗрдореЛрд░реА рдмрдлрд░ рдореЗрдВ рд▓рд┐рдЦрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП `_isRecording` рдлреНрд▓реИрдЧ рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдЗрдиреНрд╣реЗрдВ рдкреНрд░реЛрд╕реЗрд╕ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рдпрд╛ рдЕрдирджреЗрдЦрд╛ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред `_isRecordingReady` рдлреНрд▓реИрдЧ рддрдм рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдЬрдм рдЖрд╡рд╢реНрдпрдХ 4 рд╕реЗрдХрдВрдб рдХрд╛ рдСрдбрд┐рдпреЛ рдХреИрдкреНрдЪрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реЛред `_writer` рдлрд╝реАрд▓реНрдб рдСрдбрд┐рдпреЛ рдбреЗрдЯрд╛ рдХреЛ рдлреНрд▓реИрд╢ рдореЗрдореЛрд░реА рдореЗрдВ рд╕реЗрд╡ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

    рдлрд┐рд░ `Mic` рдХреНрд▓рд╛рд╕ рдХреЗ рдПрдХ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХреЗ рд▓рд┐рдП рдПрдХ рдЧреНрд▓реЛрдмрд▓ рд╡реЗрд░рд┐рдПрдмрд▓ рдШреЛрд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

1. `Mic` рдХреНрд▓рд╛рд╕ рдХреЗ `private` рд╕реЗрдХреНрд╢рди рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛрдб рдЬреЛрдбрд╝реЗрдВ:

    ```cpp
    typedef struct
    {
        uint16_t btctrl;
        uint16_t btcnt;
        uint32_t srcaddr;
        uint32_t dstaddr;
        uint32_t descaddr;
    } dmacdescriptor;

    // Globals - DMA and ADC
    volatile dmacdescriptor _wrb[DMAC_CH_NUM] __attribute__((aligned(16)));
    dmacdescriptor _descriptor_section[DMAC_CH_NUM] __attribute__((aligned(16)));
    dmacdescriptor _descriptor __attribute__((aligned(16)));

    void configureDmaAdc()
    {
        // Configure DMA to sample from ADC at a regular interval (triggered by timer/counter)
        DMAC->BASEADDR.reg = (uint32_t)_descriptor_section;                    // Specify the location of the descriptors
        DMAC->WRBADDR.reg = (uint32_t)_wrb;                                    // Specify the location of the write back descriptors
        DMAC->CTRL.reg = DMAC_CTRL_DMAENABLE | DMAC_CTRL_LVLEN(0xf);           // Enable the DMAC peripheral
        DMAC->Channel[1].CHCTRLA.reg = DMAC_CHCTRLA_TRIGSRC(TC5_DMAC_ID_OVF) | // Set DMAC to trigger on TC5 timer overflow
                                        DMAC_CHCTRLA_TRIGACT_BURST;             // DMAC burst transfer

        _descriptor.descaddr = (uint32_t)&_descriptor_section[1];                    // Set up a circular descriptor
        _descriptor.srcaddr = (uint32_t)&ADC1->RESULT.reg;                           // Take the result from the ADC0 RESULT register
        _descriptor.dstaddr = (uint32_t)_adc_buf_0 + sizeof(uint16_t) * ADC_BUF_LEN; // Place it in the adc_buf_0 array
        _descriptor.btcnt = ADC_BUF_LEN;                                             // Beat count
        _descriptor.btctrl = DMAC_BTCTRL_BEATSIZE_HWORD |                            // Beat size is HWORD (16-bits)
                                DMAC_BTCTRL_DSTINC |                                    // Increment the destination address
                                DMAC_BTCTRL_VALID |                                     // Descriptor is valid
                                DMAC_BTCTRL_BLOCKACT_SUSPEND;                           // Suspend DMAC channel 0 after block transfer
        memcpy(&_descriptor_section[0], &_descriptor, sizeof(_descriptor));          // Copy the descriptor to the descriptor section

        _descriptor.descaddr = (uint32_t)&_descriptor_section[0];                    // Set up a circular descriptor
        _descriptor.srcaddr = (uint32_t)&ADC1->RESULT.reg;                           // Take the result from the ADC0 RESULT register
        _descriptor.dstaddr = (uint32_t)_adc_buf_1 + sizeof(uint16_t) * ADC_BUF_LEN; // Place it in the adc_buf_1 array
        _descriptor.btcnt = ADC_BUF_LEN;                                             // Beat count
        _descriptor.btctrl = DMAC_BTCTRL_BEATSIZE_HWORD |                            // Beat size is HWORD (16-bits)
                                DMAC_BTCTRL_DSTINC |                                    // Increment the destination address
                                DMAC_BTCTRL_VALID |                                     // Descriptor is valid
                                DMAC_BTCTRL_BLOCKACT_SUSPEND;                           // Suspend DMAC channel 0 after block transfer
        memcpy(&_descriptor_section[1], &_descriptor, sizeof(_descriptor));          // Copy the descriptor to the descriptor section

        // Configure NVIC
        NVIC_SetPriority(DMAC_1_IRQn, 0); // Set the Nested Vector Interrupt Controller (NVIC) priority for DMAC1 to 0 (highest)
        NVIC_EnableIRQ(DMAC_1_IRQn);      // Connect DMAC1 to Nested Vector Interrupt Controller (NVIC)

        // Activate the suspend (SUSP) interrupt on DMAC channel 1
        DMAC->Channel[1].CHINTENSET.reg = DMAC_CHINTENSET_SUSP;

        // Configure ADC
        ADC1->INPUTCTRL.bit.MUXPOS = ADC_INPUTCTRL_MUXPOS_AIN12_Val; // Set the analog input to ADC0/AIN2 (PB08 - A4 on Metro M4)
        while (ADC1->SYNCBUSY.bit.INPUTCTRL)
            ;                              // Wait for synchronization
        ADC1->SAMPCTRL.bit.SAMPLEN = 0x00; // Set max Sampling Time Length to half divided ADC clock pulse (2.66us)
        while (ADC1->SYNCBUSY.bit.SAMPCTRL)
            ;                                         // Wait for synchronization
        ADC1->CTRLA.reg = ADC_CTRLA_PRESCALER_DIV128; // Divide Clock ADC GCLK by 128 (48MHz/128 = 375kHz)
        ADC1->CTRLB.reg = ADC_CTRLB_RESSEL_12BIT |    // Set ADC resolution to 12 bits
                            ADC_CTRLB_FREERUN;          // Set ADC to free run mode
        while (ADC1->SYNCBUSY.bit.CTRLB)
            ;                       // Wait for synchronization
        ADC1->CTRLA.bit.ENABLE = 1; // Enable the ADC
        while (ADC1->SYNCBUSY.bit.ENABLE)
            ;                       // Wait for synchronization
        ADC1->SWTRIG.bit.START = 1; // Initiate a software trigger to start an ADC conversion
        while (ADC1->SYNCBUSY.bit.SWTRIG)
            ; // Wait for synchronization

        // Enable DMA channel 1
        DMAC->Channel[1].CHCTRLA.bit.ENABLE = 1;

        // Configure Timer/Counter 5
        GCLK->PCHCTRL[TC5_GCLK_ID].reg = GCLK_PCHCTRL_CHEN |     // Enable peripheral channel for TC5
                                            GCLK_PCHCTRL_GEN_GCLK1; // Connect generic clock 0 at 48MHz

        TC5->COUNT16.WAVE.reg = TC_WAVE_WAVEGEN_MFRQ; // Set TC5 to Match Frequency (MFRQ) mode
        TC5->COUNT16.CC[0].reg = 3000 - 1;            // Set the trigger to 16 kHz: (4Mhz / 16000) - 1
        while (TC5->COUNT16.SYNCBUSY.bit.CC0)
            ; // Wait for synchronization

        // Start Timer/Counter 5
        TC5->COUNT16.CTRLA.bit.ENABLE = 1; // Enable the TC5 timer
        while (TC5->COUNT16.SYNCBUSY.bit.ENABLE)
            ; // Wait for synchronization
    }

    uint16_t _adc_buf_0[ADC_BUF_LEN];
    uint16_t _adc_buf_1[ADC_BUF_LEN];
    ```

    рдпрд╣ рдХреЛрдб рдПрдХ `configureDmaAdc` рдореЗрдердб рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддрд╛ рд╣реИ рдЬреЛ DMAC рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рддрд╛ рд╣реИ, рдЗрд╕реЗ ADC рд╕реЗ рдЬреЛрдбрд╝рддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рджреЛ рдЕрд▓рдЧ-рдЕрд▓рдЧ рд╡реИрдХрд▓реНрдкрд┐рдХ рдмрдлрд░, `_adc_buf_0` рдФрд░ `_adc_buf_1` рдХреЛ рдкреЙрдкреНрдпреБрд▓реЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реЗрдЯ рдХрд░рддрд╛ рд╣реИред

    > ЁЯТБ рдорд╛рдЗрдХреНрд░реЛрдХрдВрдЯреНрд░реЛрд▓рд░ рдбреЗрд╡рд▓рдкрдореЗрдВрдЯ рдХреА рдПрдХ рдХрдореА рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ рдХреЗ рд╕рд╛рде рдЗрдВрдЯрд░реИрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рдХреЛрдб рдХреА рдЬрдЯрд┐рд▓рддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдЖрдкрдХрд╛ рдХреЛрдб рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ рдХреЗ рд╕рд╛рде рд╕реАрдзреЗ рдмрд╣реБрдд рдирд┐рдореНрди рд╕реНрддрд░ рдкрд░ рдЗрдВрдЯрд░реИрдХреНрдЯ рдХрд░рддрд╛ рд╣реИред рдпрд╣ рдХреЛрдб рдПрдХ рд╕рд┐рдВрдЧрд▓-рдмреЛрд░реНрдб рдХрдВрдкреНрдпреВрдЯрд░ рдпрд╛ рдбреЗрд╕реНрдХрдЯреЙрдк рдХрдВрдкреНрдпреВрдЯрд░ рдХреЗ рд▓рд┐рдП рд▓рд┐рдЦреЗ рдЧрдП рдХреЛрдб рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдХреЛрдИ рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдорджрдж рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ рд╣реИред рдХреБрдЫ рд▓рд╛рдЗрдмреНрд░реЗрд░реАрдЬрд╝ рдЙрдкрд▓рдмреНрдз рд╣реИрдВ рдЬреЛ рдЗрд╕реЗ рд╕рд░рд▓ рдмрдирд╛ рд╕рдХрддреА рд╣реИрдВ, рд▓реЗрдХрд┐рди рдлрд┐рд░ рднреА рдмрд╣реБрдд рдЬрдЯрд┐рд▓рддрд╛ рд╣реЛрддреА рд╣реИред

1. рдЗрд╕рдХреЗ рдиреАрдЪреЗ, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛрдб рдЬреЛрдбрд╝реЗрдВ:

    ```cpp
    // WAV files have a header. This struct defines that header
    struct wavFileHeader
    {
        char riff[4];         /* "RIFF"                                  */
        long flength;         /* file length in bytes                    */
        char wave[4];         /* "WAVE"                                  */
        char fmt[4];          /* "fmt "                                  */
        long chunk_size;      /* size of FMT chunk in bytes (usually 16) */
        short format_tag;     /* 1=PCM, 257=Mu-Law, 258=A-Law, 259=ADPCM */
        short num_chans;      /* 1=mono, 2=stereo                        */
        long srate;           /* Sampling rate in samples per second     */
        long bytes_per_sec;   /* bytes per second = srate*bytes_per_samp */
        short bytes_per_samp; /* 2=16-bit mono, 4=16-bit stereo          */
        short bits_per_samp;  /* Number of bits per sample               */
        char data[4];         /* "data"                                  */
        long dlength;         /* data length in bytes (filelength - 44)  */
    };

    void initBufferHeader()
    {
        wavFileHeader wavh;

        strncpy(wavh.riff, "RIFF", 4);
        strncpy(wavh.wave, "WAVE", 4);
        strncpy(wavh.fmt, "fmt ", 4);
        strncpy(wavh.data, "data", 4);

        wavh.chunk_size = 16;
        wavh.format_tag = 1; // PCM
        wavh.num_chans = 1;  // mono
        wavh.srate = RATE;
        wavh.bytes_per_sec = (RATE * 1 * 16 * 1) / 8;
        wavh.bytes_per_samp = 2;
        wavh.bits_per_samp = 16;
        wavh.dlength = RATE * 2 * 1 * 16 / 2;
        wavh.flength = wavh.dlength + 44;

        _writer.writeSfudBuffer((byte *)&wavh, 44);
    }
    ```

    рдпрд╣ рдХреЛрдб WAV рд╣реЗрдбрд░ рдХреЛ рдПрдХ рд╕реНрдЯреНрд░рдХреНрдЪрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдореЗрдореЛрд░реА рдореЗрдВ 44 рдмрд╛рдЗрдЯреНрд╕ рд▓реЗрддрд╛ рд╣реИред рдпрд╣ рдСрдбрд┐рдпреЛ рдлрд╝рд╛рдЗрд▓ рд░реЗрдЯ, рдЖрдХрд╛рд░, рдФрд░ рдЪреИрдирд▓реЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╡рд┐рд╡рд░рдг рд▓рд┐рдЦрддрд╛ рд╣реИред рдлрд┐рд░ рдЗрд╕ рд╣реЗрдбрд░ рдХреЛ рдлреНрд▓реИрд╢ рдореЗрдореЛрд░реА рдореЗрдВ рд▓рд┐рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИред

1. рдЗрд╕ рдХреЛрдб рдХреЗ рдиреАрдЪреЗ, рдСрдбрд┐рдпреЛ рдмрдлрд░ рдкреНрд░реЛрд╕реЗрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рд╣реЛрдиреЗ рдкрд░ рдХреЙрд▓ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдореЗрдердб рдХреЛ рдШреЛрд╖рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЬреЛрдбрд╝реЗрдВ:

    ```cpp
    void audioCallback(uint16_t *buf, uint32_t buf_len)
    {
        static uint32_t idx = 44;

        if (_isRecording)
        {
            for (uint32_t i = 0; i < buf_len; i++)
            {
                int16_t audio_value = ((int16_t)buf[i] - 2048) * 16;

                _writer.writeSfudBuffer(audio_value & 0xFF);
                _writer.writeSfudBuffer((audio_value >> 8) & 0xFF);
            }

            idx += buf_len;
                
            if (idx >= BUFFER_SIZE)
            {
                _writer.flushSfudBuffer();
                idx = 44;
                _isRecording = false;
                _isRecordingReady = true;
            }
        }
    }
    ```

    рдСрдбрд┐рдпреЛ рдмрдлрд░ 16-рдмрд┐рдЯ рдЗрдВрдЯреАрдЬрд░ рдХреЗ рдПрд░реЗ рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ ADC рд╕реЗ рдСрдбрд┐рдпреЛ рдХреЛ рдХреИрдкреНрдЪрд░ рдХрд░рддреЗ рд╣реИрдВред ADC 12-рдмрд┐рдЯ рдЕрдирд╕рд╛рдЗрди рд╡реИрд▓реНрдпреВ (0-1023) рд▓реМрдЯрд╛рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЗрдиреНрд╣реЗрдВ 16-рдмрд┐рдЯ рд╕рд╛рдЗрди рд╡реИрд▓реНрдпреВ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рдФрд░ рдлрд┐рд░ рдЗрдиреНрд╣реЗрдВ рд░реЙ рдмрд╛рдЗрдирд░реА рдбреЗрдЯрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рд╕реНрдЯреЛрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП 2 рдмрд╛рдЗрдЯреНрд╕ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

    рдпреЗ рдмрд╛рдЗрдЯреНрд╕ рдлреНрд▓реИрд╢ рдореЗрдореЛрд░реА рдмрдлрд░ рдореЗрдВ рд▓рд┐рдЦреЗ рдЬрд╛рддреЗ рд╣реИрдВред рд▓рд┐рдЦрдирд╛ рдЗрдВрдбреЗрдХреНрд╕ 44 рд╕реЗ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ - рдпрд╣ WAV рдлрд╝рд╛рдЗрд▓ рд╣реЗрдбрд░ рдХреЗ рд░реВрдк рдореЗрдВ рд▓рд┐рдЦреЗ рдЧрдП 44 рдмрд╛рдЗрдЯреНрд╕ рдХрд╛ рдСрдлрд╕реЗрдЯ рд╣реИред рдПрдХ рдмрд╛рд░ рдЬрдм рдЖрд╡рд╢реНрдпрдХ рдСрдбрд┐рдпреЛ рд▓рдВрдмрд╛рдИ рдХреЗ рд▓рд┐рдП рд╕рднреА рдмрд╛рдЗрдЯреНрд╕ рдХреИрдкреНрдЪрд░ рдХрд░ рд▓рд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ, рддреЛ рд╢реЗрд╖ рдбреЗрдЯрд╛ рдлреНрд▓реИрд╢ рдореЗрдореЛрд░реА рдореЗрдВ рд▓рд┐рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИред

1. `Mic` рдХреНрд▓рд╛рд╕ рдХреЗ `public` рд╕реЗрдХреНрд╢рди рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛрдб рдЬреЛрдбрд╝реЗрдВ:

    ```cpp
    void dmaHandler()
    {
        static uint8_t count = 0;

        if (DMAC->Channel[1].CHINTFLAG.bit.SUSP)
        {
            DMAC->Channel[1].CHCTRLB.reg = DMAC_CHCTRLB_CMD_RESUME;
            DMAC->Channel[1].CHINTFLAG.bit.SUSP = 1;

            if (count)
            {
                audioCallback(_adc_buf_0, ADC_BUF_LEN);
            }
            else
            {
                audioCallback(_adc_buf_1, ADC_BUF_LEN);
            }

            count = (count + 1) % 2;
        }
    }
    ```

    рдпрд╣ рдХреЛрдб DMAC рджреНрд╡рд╛рд░рд╛ рдЖрдкрдХреЗ рдХреЛрдб рдХреЛ рдмрдлрд░ рдкреНрд░реЛрд╕реЗрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред рдпрд╣ рдЬрд╛рдВрдЪрддрд╛ рд╣реИ рдХрд┐ рдкреНрд░реЛрд╕реЗрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдбреЗрдЯрд╛ рд╣реИ, рдФрд░ рд╕рдВрдмрдВрдзрд┐рдд рдмрдлрд░ рдХреЗ рд╕рд╛рде `audioCallback` рдореЗрдердб рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИред

1. рдХреНрд▓рд╛рд╕ рдХреЗ рдмрд╛рд╣рд░, `Mic mic;` рдШреЛрд╖рдгрд╛ рдХреЗ рдмрд╛рдж, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛрдб рдЬреЛрдбрд╝реЗрдВ:

    ```cpp
    void DMAC_1_Handler()
    {
        mic.dmaHandler();
    }
    ```

    `DMAC_1_Handler` DMAC рджреНрд╡рд╛рд░рд╛ рддрдм рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдЬрдм рдмрдлрд░ рдкреНрд░реЛрд╕реЗрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рд╣реЛрдВред рдЗрд╕ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдирд╛рдо рд╕реЗ рдкрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЗрд╕реЗ рдХреЗрд╡рд▓ рдореМрдЬреВрдж рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рддрд╛рдХрд┐ рдЗрд╕реЗ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред

1. `Mic` рдХреНрд▓рд╛рд╕ рдХреЗ `public` рд╕реЗрдХреНрд╢рди рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рджреЛ рдореЗрдердб рдЬреЛрдбрд╝реЗрдВ:

    ```cpp
    void init()
    {
        analogReference(AR_INTERNAL2V23);

        _writer.init();

        initBufferHeader();
        configureDmaAdc();
    }

    void reset()
    {
        _isRecordingReady = false;
        _isRecording = false;

        _writer.reset();

        initBufferHeader();
    }
    ```

    `init` рдореЗрдердб рдореЗрдВ `Mic` рдХреНрд▓рд╛рд╕ рдХреЛ рдЗрдирд┐рд╢рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЛрдб рд╣реЛрддрд╛ рд╣реИред рдпрд╣ рдореЗрдердб Mic рдкрд┐рди рдХреЗ рд▓рд┐рдП рд╕рд╣реА рд╡реЛрд▓реНрдЯреЗрдЬ рд╕реЗрдЯ рдХрд░рддрд╛ рд╣реИ, рдлреНрд▓реИрд╢ рдореЗрдореЛрд░реА рд░рд╛рдЗрдЯрд░ рдХреЛ рд╕реЗрдЯ рдХрд░рддрд╛ рд╣реИ, WAV рдлрд╝рд╛рдЗрд▓ рд╣реЗрдбрд░ рд▓рд┐рдЦрддрд╛ рд╣реИ, рдФрд░ DMAC рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рддрд╛ рд╣реИред `reset` рдореЗрдердб рдлреНрд▓реИрд╢ рдореЗрдореЛрд░реА рдХреЛ рд░реАрд╕реЗрдЯ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдСрдбрд┐рдпреЛ рдХреИрдкреНрдЪрд░ рдФрд░ рдЙрдкрдпреЛрдЧ рдХреЗ рдмрд╛рдж рд╣реЗрдбрд░ рдХреЛ рдлрд┐рд░ рд╕реЗ рд▓рд┐рдЦрддрд╛ рд╣реИред

### рдХрд╛рд░реНрдп - рдСрдбрд┐рдпреЛ рдХреИрдкреНрдЪрд░ рдХрд░реЗрдВ

1. `main.cpp` рдлрд╝рд╛рдЗрд▓ рдореЗрдВ, `mic.h` рд╣реЗрдбрд░ рдлрд╝рд╛рдЗрд▓ рдХреЗ рд▓рд┐рдП рдПрдХ рдЗрдирдХреНрд▓реВрдб рдбрд╛рдпрд░реЗрдХреНрдЯрд┐рд╡ рдЬреЛрдбрд╝реЗрдВ:

    ```cpp
    #include "mic.h"
    ```

1. `setup` рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ, C рдмрдЯрди рдХреЛ рдЗрдирд┐рд╢рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд░реЗрдВред рдЬрдм рдпрд╣ рдмрдЯрди рджрдмрд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛, рддреЛ рдСрдбрд┐рдпреЛ рдХреИрдкреНрдЪрд░ рд╢реБрд░реВ рд╣реЛрдЧрд╛ рдФрд░ 4 рд╕реЗрдХрдВрдб рддрдХ рдЬрд╛рд░реА рд░рд╣реЗрдЧрд╛:

    ```cpp
    pinMode(WIO_KEY_C, INPUT_PULLUP);
    ```

1. рдЗрд╕рдХреЗ рдиреАрдЪреЗ, рдорд╛рдЗрдХреНрд░реЛрдлреЛрди рдХреЛ рдЗрдирд┐рд╢рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд░реЗрдВ, рдлрд┐рд░ рдХрдВрд╕реЛрд▓ рдореЗрдВ рдкреНрд░рд┐рдВрдЯ рдХрд░реЗрдВ рдХрд┐ рдСрдбрд┐рдпреЛ рдХреИрдкреНрдЪрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рд╣реИ:

    ```cpp
    mic.init();

    Serial.println("Ready.");
    ```

1. `loop` рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдКрдкрд░, рдХреИрдкреНрдЪрд░ рдХрд┐рдП рдЧрдП рдСрдбрд┐рдпреЛ рдХреЛ рдкреНрд░реЛрд╕реЗрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░реЗрдВред рдлрд┐рд▓рд╣рд╛рд▓ рдпрд╣ рдХреБрдЫ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕ рдкрд╛рда рдореЗрдВ рдмрд╛рдж рдореЗрдВ рдпрд╣ рд╕реНрдкреАрдЪ рдХреЛ рдЯреЗрдХреНрд╕реНрдЯ рдореЗрдВ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рднреЗрдЬреЗрдЧрд╛:

    ```cpp
    void processAudio()
    {
    
    }
    ```

1. `loop` рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЬреЛрдбрд╝реЗрдВ:

    ```cpp
    void loop()
    {
        if (digitalRead(WIO_KEY_C) == LOW && !mic.isRecording())
        {
            Serial.println("Starting recording...");
            mic.startRecording();
        }
    
        if (!mic.isRecording() && mic.isRecordingReady())
        {
            Serial.println("Finished recording");
    
            processAudio();
    
            mic.reset();
        }
    }
    ```

    рдпрд╣ рдХреЛрдб C рдмрдЯрди рдХреА рдЬрд╛рдВрдЪ рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдпрджрд┐ рдпрд╣ рджрдмрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ рд░рд┐рдХреЙрд░реНрдбрд┐рдВрдЧ рд╢реБрд░реВ рдирд╣реАрдВ рд╣реБрдИ рд╣реИ, рддреЛ `Mic` рдХреНрд▓рд╛рд╕ рдХреЗ `_isRecording` рдлрд╝реАрд▓реНрдб рдХреЛ true рдкрд░ рд╕реЗрдЯ рдХрд░рддрд╛ рд╣реИред рдпрд╣ `Mic` рдХреНрд▓рд╛рд╕ рдХреЗ `audioCallback` рдореЗрдердб рдХреЛ рддрдм рддрдХ рдСрдбрд┐рдпреЛ рд╕реНрдЯреЛрд░ рдХрд░рдиреЗ рдХрд╛ рдХрд╛рд░рдг рдмрдиреЗрдЧрд╛ рдЬрдм рддрдХ рдХрд┐ 4 рд╕реЗрдХрдВрдб рдХрд╛ рдСрдбрд┐рдпреЛ рдХреИрдкреНрдЪрд░ рди рд╣реЛ рдЬрд╛рдПред рдПрдХ рдмрд╛рд░ рдЬрдм 4 рд╕реЗрдХрдВрдб рдХрд╛ рдСрдбрд┐рдпреЛ рдХреИрдкреНрдЪрд░ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ `_isRecording` рдлрд╝реАрд▓реНрдб false рдкрд░ рд╕реЗрдЯ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ `_isRecordingReady` рдлрд╝реАрд▓реНрдб true рдкрд░ рд╕реЗрдЯ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред рдлрд┐рд░ рдЗрд╕реЗ `loop` рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ рдЬрд╛рдВрдЪрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдЬрдм true рд╣реЛрддрд╛ рд╣реИ, рддреЛ `processAudio` рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдлрд┐рд░ mic рдХреНрд▓рд╛рд╕ рдХреЛ рд░реАрд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

1. рдЗрд╕ рдХреЛрдб рдХреЛ рдмрдирд╛рдПрдВ, рдЗрд╕реЗ рдЕрдкрдиреЗ Wio Terminal рдкрд░ рдЕрдк
ЁЯТБ рдЖрдк рдЗрд╕ рдХреЛрдб рдХреЛ [code-record/wio-terminal](../../../../../6-consumer/lessons/1-speech-recognition/code-record/wio-terminal) рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред
ЁЯША рдЖрдкрдХрд╛ рдСрдбрд┐рдпреЛ рд░рд┐рдХреЙрд░реНрдбрд┐рдВрдЧ рдкреНрд░реЛрдЧреНрд░рд╛рдо рд╕рдлрд▓ рд░рд╣рд╛!

**рдЕрд╕реНрд╡реАрдХрд░рдг**:  
рдпрд╣ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ AI рдЕрдиреБрд╡рд╛рдж рд╕реЗрд╡рд╛ [Co-op Translator](https://github.com/Azure/co-op-translator) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдиреБрд╡рд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдЬрдмрдХрд┐ рд╣рдо рд╕рдЯреАрдХрддрд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВ, рдХреГрдкрдпрд╛ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдЕрдиреБрд╡рд╛рдж рдореЗрдВ рддреНрд░реБрдЯрд┐рдпрд╛рдВ рдпрд╛ рдЕрд╢реБрджреНрдзрд┐рдпрд╛рдВ рд╣реЛ рд╕рдХрддреА рд╣реИрдВред рдореВрд▓ рднрд╛рд╖рд╛ рдореЗрдВ рдЙрдкрд▓рдмреНрдз рдореВрд▓ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдХреЛ рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рд╕реНрд░реЛрдд рдорд╛рдирд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред рдорд╣рддреНрд╡рдкреВрд░реНрдг рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП, рдкреЗрд╢реЗрд╡рд░ рдорд╛рдирд╡ рдЕрдиреБрд╡рд╛рдж рдХреА рд╕рд┐рдлрд╛рд░рд┐рд╢ рдХреА рдЬрд╛рддреА рд╣реИред рдЗрд╕ рдЕрдиреБрд╡рд╛рдж рдХреЗ рдЙрдкрдпреЛрдЧ рд╕реЗ рдЙрддреНрдкрдиреНрди рдХрд┐рд╕реА рднреА рдЧрд▓рддрдлрд╣рдореА рдпрд╛ рдЧрд▓рдд рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХреЗ рд▓рд┐рдП рд╣рдо рдЬрд┐рдореНрдореЗрджрд╛рд░ рдирд╣реАрдВ рд╣реИрдВред