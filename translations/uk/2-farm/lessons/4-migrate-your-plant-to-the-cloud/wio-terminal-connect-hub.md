<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "28320305a35ea3bc59c41fe146a2e6ed",
  "translation_date": "2025-08-28T18:04:44+00:00",
  "source_file": "2-farm/lessons/4-migrate-your-plant-to-the-cloud/wio-terminal-connect-hub.md",
  "language_code": "uk"
}
-->
# –ü—ñ–¥–∫–ª—é—á—ñ—Ç—å –≤–∞—à IoT-–ø—Ä–∏—Å—Ç—Ä—ñ–π –¥–æ —Ö–º–∞—Ä–∏ - Wio Terminal

–£ —Ü—ñ–π —á–∞—Å—Ç–∏–Ω—ñ —É—Ä–æ–∫—É –≤–∏ –ø—ñ–¥–∫–ª—é—á–∏—Ç–µ –≤–∞—à Wio Terminal –¥–æ IoT Hub, —â–æ–± –Ω–∞–¥—Å–∏–ª–∞—Ç–∏ —Ç–µ–ª–µ–º–µ—Ç—Ä—ñ—é —Ç–∞ –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –∫–æ–º–∞–Ω–¥–∏.

## –ü—ñ–¥–∫–ª—é—á—ñ—Ç—å –≤–∞—à –ø—Ä–∏—Å—Ç—Ä—ñ–π –¥–æ IoT Hub

–ù–∞—Å—Ç—É–ø–Ω–∏–π –∫—Ä–æ–∫ ‚Äî –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏ –≤–∞—à –ø—Ä–∏—Å—Ç—Ä—ñ–π –¥–æ IoT Hub.

### –ó–∞–≤–¥–∞–Ω–Ω—è - –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ IoT Hub

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ –ø—Ä–æ–µ–∫—Ç `soil-moisture-sensor` —É VS Code.

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ —Ñ–∞–π–ª `platformio.ini`. –í–∏–¥–∞–ª—ñ—Ç—å –∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ `knolleary/PubSubClient`. –í–æ–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–ª–∞—Å—è –¥–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –∑–∞–≥–∞–ª—å–Ω–æ–¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ MQTT-–±—Ä–æ–∫–µ—Ä–∞, –∞–ª–µ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–∞ –¥–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ IoT Hub.

1. –î–æ–¥–∞–π—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –±—ñ–±–ª—ñ–æ—Ç–µ–∫:

    ```ini
    seeed-studio/Seeed Arduino RTC @ 2.0.0
    arduino-libraries/AzureIoTHub @ 1.6.0
    azure/AzureIoTUtility @ 1.6.1
    azure/AzureIoTProtocol_MQTT @ 1.6.0
    azure/AzureIoTProtocol_HTTP @ 1.6.0
    azure/AzureIoTSocket_WiFi @ 1.0.2
    ```

    –ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ `Seeed Arduino RTC` –Ω–∞–¥–∞—î –∫–æ–¥ –¥–ª—è –≤–∑–∞—î–º–æ–¥—ñ—ó –∑ —Ä–µ–∞–ª—å–Ω–∏–º –≥–æ–¥–∏–Ω–Ω–∏–∫–æ–º —É Wio Terminal, —è–∫–∏–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è —á–∞—Å—É. –†–µ—à—Ç–∞ –±—ñ–±–ª—ñ–æ—Ç–µ–∫ –¥–æ–∑–≤–æ–ª—è—é—Ç—å –≤–∞—à–æ–º—É IoT-–ø—Ä–∏—Å—Ç—Ä–æ—é –ø—ñ–¥–∫–ª—é—á–∞—Ç–∏—Å—è –¥–æ IoT Hub.

1. –î–æ–¥–∞–π—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω–µ –≤ –∫—ñ–Ω—Ü—ñ —Ñ–∞–π–ª—É `platformio.ini`:

    ```ini
    build_flags =
        -DDONT_USE_UPLOADTOBLOB
    ```

    –¶–µ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î –ø—Ä–∞–ø–æ—Ä–µ—Ü—å –∫–æ–º–ø—ñ–ª—è—Ç–æ—Ä–∞, –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏–π –¥–ª—è –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó –∫–æ–¥—É Arduino IoT Hub.

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤–∏–π —Ñ–∞–π–ª `config.h`. –í–∏–¥–∞–ª—ñ—Ç—å —É—Å—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è MQTT —ñ –¥–æ–¥–∞–π—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω—É –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É –¥–ª—è —Ä—è–¥–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –ø—Ä–∏—Å—Ç—Ä–æ—é:

    ```cpp
    // IoT Hub settings
    const char *CONNECTION_STRING = "<connection string>";
    ```

    –ó–∞–º—ñ–Ω—ñ—Ç—å `<connection string>` –Ω–∞ —Ä—è–¥–æ–∫ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–ª—è –≤–∞—à–æ–≥–æ –ø—Ä–∏—Å—Ç—Ä–æ—é, —è–∫–∏–π –≤–∏ —Å–∫–æ–ø—ñ—é–≤–∞–ª–∏ —Ä–∞–Ω—ñ—à–µ.

1. –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ IoT Hub –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Ç–æ–∫–µ–Ω, –∑–∞—Å–Ω–æ–≤–∞–Ω–∏–π –Ω–∞ —á–∞—Å—ñ. –¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ IoT-–ø—Ä–∏—Å—Ç—Ä—ñ–π –ø–æ–≤–∏–Ω–µ–Ω –∑–Ω–∞—Ç–∏ –ø–æ—Ç–æ—á–Ω–∏–π —á–∞—Å. –ù–∞ –≤—ñ–¥–º—ñ–Ω—É –≤—ñ–¥ –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω–∏—Ö —Å–∏—Å—Ç–µ–º, —Ç–∞–∫–∏—Ö —è–∫ Windows, macOS –∞–±–æ Linux, –º—ñ–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∏ –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É—é—Ç—å –ø–æ—Ç–æ—á–Ω–∏–π —á–∞—Å —á–µ—Ä–µ–∑ –Ü–Ω—Ç–µ—Ä–Ω–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ. –¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–æ–¥–∞—Ç–∏ –∫–æ–¥ –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–æ—Ç–æ—á–Ω–æ–≥–æ —á–∞—Å—É –∑ [NTP](https://wikipedia.org/wiki/Network_Time_Protocol)-—Å–µ—Ä–≤–µ—Ä–∞. –ü—ñ—Å–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —á–∞—Å—É –π–æ–≥–æ –º–æ–∂–Ω–∞ –∑–±–µ—Ä–µ–≥—Ç–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É –≥–æ–¥–∏–Ω–Ω–∏–∫—É —É Wio Terminal, —â–æ –¥–æ–∑–≤–æ–ª—è—î –∑–∞–ø–∏—Ç—É–≤–∞—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —á–∞—Å –ø—ñ–∑–Ω—ñ—à–µ, —è–∫—â–æ –ø—Ä–∏—Å—Ç—Ä—ñ–π –Ω–µ –≤—Ç—Ä–∞—Ç–∏—Ç—å –∂–∏–≤–ª–µ–Ω–Ω—è. –î–æ–¥–∞–π—Ç–µ –Ω–æ–≤–∏–π —Ñ–∞–π–ª –ø—ñ–¥ –Ω–∞–∑–≤–æ—é `ntp.h` –∑ –Ω–∞—Å—Ç—É–ø–Ω–∏–º –∫–æ–¥–æ–º:

    ```cpp
    #pragma once
    
    #include "DateTime.h"
    #include <time.h>
    #include "samd/NTPClientAz.h"
    #include <sys/time.h>

    static void initTime()
    {
        WiFiUDP _udp;
        time_t epochTime = (time_t)-1;
        NTPClientAz ntpClient;

        ntpClient.begin();

        while (true)
        {
            epochTime = ntpClient.getEpochTime("0.pool.ntp.org");

            if (epochTime == (time_t)-1)
            {
                Serial.println("Fetching NTP epoch time failed! Waiting 2 seconds to retry.");
                delay(2000);
            }
            else
            {
                Serial.print("Fetched NTP epoch time is: ");

                char buff[32];
                sprintf(buff, "%.f", difftime(epochTime, (time_t)0));
                Serial.println(buff);
                break;
            }
        }

        ntpClient.end();

        struct timeval tv;
        tv.tv_sec = epochTime;
        tv.tv_usec = 0;

        settimeofday(&tv, NULL);
    }
    ```

    –î–µ—Ç–∞–ª—ñ —Ü—å–æ–≥–æ –∫–æ–¥—É –≤–∏—Ö–æ–¥—è—Ç—å –∑–∞ –º–µ–∂—ñ —Ü—å–æ–≥–æ —É—Ä–æ–∫—É. –í—ñ–Ω –≤–∏–∑–Ω–∞—á–∞—î —Ñ—É–Ω–∫—Ü—ñ—é `initTime`, —è–∫–∞ –æ—Ç—Ä–∏–º—É—î –ø–æ—Ç–æ—á–Ω–∏–π —á–∞—Å —ñ–∑ NTP-—Å–µ—Ä–≤–µ—Ä–∞ —Ç–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –π–æ–≥–æ –¥–ª—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –≥–æ–¥–∏–Ω–Ω–∏–∫–∞ –Ω–∞ Wio Terminal.

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ —Ñ–∞–π–ª `main.cpp` —ñ –≤–∏–¥–∞–ª—ñ—Ç—å —É–≤–µ—Å—å –∫–æ–¥ MQTT, –≤–∫–ª—é—á–∞—é—á–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤–∏–π —Ñ–∞–π–ª `PubSubClient.h`, –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è –∑–º—ñ–Ω–Ω–æ—ó `PubSubClient`, –º–µ—Ç–æ–¥–∏ `reconnectMQTTClient` —ñ `createMQTTClient`, –∞ —Ç–∞–∫–æ–∂ –±—É–¥—å-—è–∫—ñ –≤–∏–∫–ª–∏–∫–∏ —Ü–∏—Ö –∑–º—ñ–Ω–Ω–∏—Ö —ñ –º–µ—Ç–æ–¥—ñ–≤. –¶–µ–π —Ñ–∞–π–ª –ø–æ–≤–∏–Ω–µ–Ω –º—ñ—Å—Ç–∏—Ç–∏ –ª–∏—à–µ –∫–æ–¥ –¥–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ WiFi, –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –≤–æ–ª–æ–≥–æ—Å—Ç—ñ “ë—Ä—É–Ω—Ç—É —Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è JSON-–¥–æ–∫—É–º–µ–Ω—Ç–∞ –∑ —Ü–∏–º–∏ –¥–∞–Ω–∏–º–∏.

1. –î–æ–¥–∞–π—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω—ñ –¥–∏—Ä–µ–∫—Ç–∏–≤–∏ `#include` —É –≤–µ—Ä—Ö–Ω—ñ–π —á–∞—Å—Ç–∏–Ω—ñ —Ñ–∞–π–ª—É `main.cpp`, —â–æ–± –≤–∫–ª—é—á–∏—Ç–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤—ñ —Ñ–∞–π–ª–∏ –¥–ª—è –±—ñ–±–ª—ñ–æ—Ç–µ–∫ IoT Hub —ñ –¥–ª—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —á–∞—Å—É:

    ```cpp
    #include <AzureIoTHub.h>
    #include <AzureIoTProtocol_MQTT.h>
    #include <iothubtransportmqtt.h>
    #include "ntp.h"
    ```

1. –î–æ–¥–∞–π—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω–∏–π –≤–∏–∫–ª–∏–∫ —É –∫—ñ–Ω—Ü—ñ —Ñ—É–Ω–∫—Ü—ñ—ó `setup`, —â–æ–± –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –ø–æ—Ç–æ—á–Ω–∏–π —á–∞—Å:

    ```cpp
    initTime();
    ```

1. –î–æ–¥–∞–π—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω–µ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è –∑–º—ñ–Ω–Ω–æ—ó —É –≤–µ—Ä—Ö–Ω—ñ–π —á–∞—Å—Ç–∏–Ω—ñ —Ñ–∞–π–ª—É, –æ–¥—Ä–∞–∑—É –ø—ñ–¥ –¥–∏—Ä–µ–∫—Ç–∏–≤–∞–º–∏ include:

    ```cpp
    IOTHUB_DEVICE_CLIENT_LL_HANDLE _device_ll_handle;
    ```

    –¶–µ –æ–≥–æ–ª–æ—à—É—î `IOTHUB_DEVICE_CLIENT_LL_HANDLE`, –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä –¥–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ IoT Hub.

1. –ù–∏–∂—á–µ —Ü—å–æ–≥–æ –¥–æ–¥–∞–π—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω–∏–π –∫–æ–¥:

    ```cpp
    static void connectionStatusCallback(IOTHUB_CLIENT_CONNECTION_STATUS result, IOTHUB_CLIENT_CONNECTION_STATUS_REASON reason, void *user_context)
    {
        if (result == IOTHUB_CLIENT_CONNECTION_AUTHENTICATED)
        {
            Serial.println("The device client is connected to iothub");
        }
        else
        {
            Serial.println("The device client has been disconnected");
        }
    }
    ```

    –¶–µ –æ–≥–æ–ª–æ—à—É—î —Ñ—É–Ω–∫—Ü—ñ—é –∑–≤–æ—Ä–æ—Ç–Ω–æ–≥–æ –≤–∏–∫–ª–∏–∫—É, —è–∫–∞ –±—É–¥–µ –≤–∏–∫–ª–∏–∫–∞–Ω–∞, –∫–æ–ª–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ IoT Hub –∑–º—ñ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –∞–±–æ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è. –°—Ç–∞—Ç—É—Å –±—É–¥–µ –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ –Ω–∞ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–∏–π –ø–æ—Ä—Ç.

1. –ù–∏–∂—á–µ —Ü—å–æ–≥–æ –¥–æ–¥–∞–π—Ç–µ —Ñ—É–Ω–∫—Ü—ñ—é –¥–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ IoT Hub:

    ```cpp
    void connectIoTHub()
    {
        IoTHub_Init();
    
        _device_ll_handle = IoTHubDeviceClient_LL_CreateFromConnectionString(CONNECTION_STRING, MQTT_Protocol);
        
        if (_device_ll_handle == NULL)
        {
            Serial.println("Failure creating Iothub device. Hint: Check your connection string.");
            return;
        }
    
        IoTHubDeviceClient_LL_SetConnectionStatusCallback(_device_ll_handle, connectionStatusCallback, NULL);
    }
    ```

    –¶–µ–π –∫–æ–¥ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î –±—ñ–±–ª—ñ–æ—Ç–µ—á–Ω–∏–π –∫–æ–¥ IoT Hub, –∞ –ø–æ—Ç—ñ–º —Å—Ç–≤–æ—Ä—é—î –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ä—è–¥–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —É –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤–æ–º—É —Ñ–∞–π–ª—ñ `config.h`. –¶–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –±–∞–∑—É—î—Ç—å—Å—è –Ω–∞ MQTT. –Ø–∫—â–æ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –Ω–µ –≤–¥–∞—î—Ç—å—Å—è, —Ü–µ –±—É–¥–µ –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ –Ω–∞ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–∏–π –ø–æ—Ä—Ç ‚Äî —è–∫—â–æ –≤–∏ –±–∞—á–∏—Ç–µ —Ü–µ —É –≤–∏–≤–æ–¥—ñ, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ä—è–¥–æ–∫ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è. –ù–∞—Ä–µ—à—Ç—ñ, –Ω–∞–ª–∞—à—Ç–æ–≤—É—î—Ç—å—Å—è –∑–≤–æ—Ä–æ—Ç–Ω–∏–π –≤–∏–∫–ª–∏–∫ —Å—Ç–∞—Ç—É—Å—É –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è.

1. –í–∏–∫–ª–∏—á—Ç–µ —Ü—é —Ñ—É–Ω–∫—Ü—ñ—é —É —Ñ—É–Ω–∫—Ü—ñ—ó `setup` –Ω–∏–∂—á–µ –≤–∏–∫–ª–∏–∫—É `initTime`:

    ```cpp
    connectIoTHub();
    ```

1. –Ø–∫ —ñ —É –≤–∏–ø–∞–¥–∫—É –∑ –∫–ª—ñ—î–Ω—Ç–æ–º MQTT, —Ü–µ–π –∫–æ–¥ –ø—Ä–∞—Ü—é—î –≤ –æ–¥–Ω–æ–º—É –ø–æ—Ç–æ—Ü—ñ, —Ç–æ–º—É –π–æ–º—É –ø–æ—Ç—Ä—ñ–±–µ–Ω —á–∞—Å –¥–ª—è –æ–±—Ä–æ–±–∫–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å, —è–∫—ñ –Ω–∞–¥—Å–∏–ª–∞—é—Ç—å—Å—è —Ö–∞–±–æ–º —ñ –¥–æ —Ö–∞–±—É. –î–æ–¥–∞–π—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω–µ —É –≤–µ—Ä—Ö–Ω—ñ–π —á–∞—Å—Ç–∏–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó `loop`, —â–æ–± –∑—Ä–æ–±–∏—Ç–∏ —Ü–µ:

    ```cpp
    IoTHubDeviceClient_LL_DoWork(_device_ll_handle);
    ```

1. –ó–±–µ—Ä—ñ—Ç—å —ñ –∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ —Ü–µ–π –∫–æ–¥. –í–∏ –ø–æ–±–∞—á–∏—Ç–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —É –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ–º—É –º–æ–Ω—ñ—Ç–æ—Ä—ñ:

    ```output
    Connecting to WiFi..
    Connected!
    Fetched NTP epoch time is: 1619983687
    Sending telemetry {"soil_moisture":391}
    The device client is connected to iothub
    ```

    –£ –≤–∏–≤–æ–¥—ñ –≤–∏ –º–æ–∂–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏, —è–∫ –æ—Ç—Ä–∏–º—É—î—Ç—å—Å—è —á–∞—Å NTP, –∞ –ø–æ—Ç—ñ–º –∫–ª—ñ—î–Ω—Ç –ø—Ä–∏—Å—Ç—Ä–æ—é –ø—ñ–¥–∫–ª—é—á–∞—î—Ç—å—Å—è. –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –º–æ–∂–µ –∑–∞–π–Ω—è—Ç–∏ –∫—ñ–ª—å–∫–∞ —Å–µ–∫—É–Ω–¥, —Ç–æ–º—É –≤–∏ –º–æ–∂–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –≤–æ–ª–æ–≥—ñ—Å—Ç—å “ë—Ä—É–Ω—Ç—É —É –≤–∏–≤–æ–¥—ñ, –ø–æ–∫–∏ –ø—Ä–∏—Å—Ç—Ä—ñ–π –ø—ñ–¥–∫–ª—é—á–∞—î—Ç—å—Å—è.

    > üíÅ –í–∏ –º–æ–∂–µ—Ç–µ –∫–æ–Ω–≤–µ—Ä—Ç—É–≤–∞—Ç–∏ UNIX-—á–∞—Å –¥–ª—è NTP —É –±—ñ–ª—å—à —á–∏—Ç–∞–±–µ–ª—å–Ω—É –≤–µ—Ä—Å—ñ—é, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –≤–µ–±-—Å–∞–π—Ç, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ [unixtimestamp.com](https://www.unixtimestamp.com).

## –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è —Ç–µ–ª–µ–º–µ—Ç—Ä—ñ—ó

–¢–µ–ø–µ—Ä, –∫–æ–ª–∏ –≤–∞—à –ø—Ä–∏—Å—Ç—Ä—ñ–π –ø—ñ–¥–∫–ª—é—á–µ–Ω–∏–π, –≤–∏ –º–æ–∂–µ—Ç–µ –Ω–∞–¥—Å–∏–ª–∞—Ç–∏ —Ç–µ–ª–µ–º–µ—Ç—Ä—ñ—é –¥–æ IoT Hub –∑–∞–º—ñ—Å—Ç—å MQTT-–±—Ä–æ–∫–µ—Ä–∞.

### –ó–∞–≤–¥–∞–Ω–Ω—è - –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è —Ç–µ–ª–µ–º–µ—Ç—Ä—ñ—ó

1. –î–æ–¥–∞–π—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω—É —Ñ—É–Ω–∫—Ü—ñ—é –Ω–∞–¥ —Ñ—É–Ω–∫—Ü—ñ—î—é `setup`:

    ```cpp
    void sendTelemetry(const char *telemetry)
    {
        IOTHUB_MESSAGE_HANDLE message_handle = IoTHubMessage_CreateFromString(telemetry);
        IoTHubDeviceClient_LL_SendEventAsync(_device_ll_handle, message_handle, NULL, NULL);
        IoTHubMessage_Destroy(message_handle);
    }
    ```

    –¶–µ–π –∫–æ–¥ —Å—Ç–≤–æ—Ä—é—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è IoT Hub —ñ–∑ —Ä—è–¥–∫–∞, –ø–µ—Ä–µ–¥–∞–Ω–æ–≥–æ —è–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä, –Ω–∞–¥—Å–∏–ª–∞—î –π–æ–≥–æ –¥–æ —Ö–∞–±—É, –∞ –ø–æ—Ç—ñ–º –æ—á–∏—â–∞—î –æ–±'—î–∫—Ç –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è.

1. –í–∏–∫–ª–∏—á—Ç–µ —Ü–µ–π –∫–æ–¥ —É —Ñ—É–Ω–∫—Ü—ñ—ó `loop`, –æ–¥—Ä–∞–∑—É –ø—ñ—Å–ª—è —Ä—è–¥–∫–∞, –¥–µ —Ç–µ–ª–µ–º–µ—Ç—Ä—ñ—è –Ω–∞–¥—Å–∏–ª–∞—î—Ç—å—Å—è –Ω–∞ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–∏–π –ø–æ—Ä—Ç:

    ```cpp
    sendTelemetry(telemetry.c_str());
    ```

## –û–±—Ä–æ–±–∫–∞ –∫–æ–º–∞–Ω–¥

–í–∞—à –ø—Ä–∏—Å—Ç—Ä—ñ–π –ø–æ–≤–∏–Ω–µ–Ω –æ–±—Ä–æ–±–ª—è—Ç–∏ –∫–æ–º–∞–Ω–¥—É –≤—ñ–¥ —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ –∫–æ–¥—É –¥–ª—è –∫–µ—Ä—É–≤–∞–Ω–Ω—è —Ä–µ–ª–µ. –¶–µ –Ω–∞–¥—Å–∏–ª–∞—î—Ç—å—Å—è —è–∫ –∑–∞–ø–∏—Ç –ø—Ä—è–º–æ–≥–æ –º–µ—Ç–æ–¥—É.

## –ó–∞–≤–¥–∞–Ω–Ω—è - –æ–±—Ä–æ–±–∫–∞ –∑–∞–ø–∏—Ç—É –ø—Ä—è–º–æ–≥–æ –º–µ—Ç–æ–¥—É

1. –î–æ–¥–∞–π—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω–∏–π –∫–æ–¥ –ø–µ—Ä–µ–¥ —Ñ—É–Ω–∫—Ü—ñ—î—é `connectIoTHub`:

    ```cpp
    int directMethodCallback(const char *method_name, const unsigned char *payload, size_t size, unsigned char **response, size_t *response_size, void *userContextCallback)
    {
        Serial.printf("Direct method received %s\r\n", method_name);
    
        if (strcmp(method_name, "relay_on") == 0)
        {
            digitalWrite(PIN_WIRE_SCL, HIGH);
        }
        else if (strcmp(method_name, "relay_off") == 0)
        {
            digitalWrite(PIN_WIRE_SCL, LOW);
        }
    }
    ```

    –¶–µ–π –∫–æ–¥ –≤–∏–∑–Ω–∞—á–∞—î –º–µ—Ç–æ–¥ –∑–≤–æ—Ä–æ—Ç–Ω–æ–≥–æ –≤–∏–∫–ª–∏–∫—É, —è–∫–∏–π –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ IoT Hub –º–æ–∂–µ –≤–∏–∫–ª–∏–∫–∞—Ç–∏, –∫–æ–ª–∏ –æ—Ç—Ä–∏–º—É—î –∑–∞–ø–∏—Ç –ø—Ä—è–º–æ–≥–æ –º–µ—Ç–æ–¥—É. –ú–µ—Ç–æ–¥, —è–∫–∏–π –∑–∞–ø–∏—Ç—É—î—Ç—å—Å—è, –ø–µ—Ä–µ–¥–∞—î—Ç—å—Å—è —É –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ `method_name`. –¶—è —Ñ—É–Ω–∫—Ü—ñ—è –¥—Ä—É–∫—É—î –≤–∏–∫–ª–∏–∫–∞–Ω–∏–π –º–µ—Ç–æ–¥ –Ω–∞ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–∏–π –ø–æ—Ä—Ç, –∞ –ø–æ—Ç—ñ–º –≤–º–∏–∫–∞—î –∞–±–æ –≤–∏–º–∏–∫–∞—î —Ä–µ–ª–µ –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –Ω–∞–∑–≤–∏ –º–µ—Ç–æ–¥—É.

    > üíÅ –¶–µ —Ç–∞–∫–æ–∂ –º–æ–∂–Ω–∞ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –≤ –æ–¥–Ω–æ–º—É –∑–∞–ø–∏—Ç—ñ –ø—Ä—è–º–æ–≥–æ –º–µ—Ç–æ–¥—É, –ø–µ—Ä–µ–¥–∞—é—á–∏ –±–∞–∂–∞–Ω–∏–π —Å—Ç–∞–Ω —Ä–µ–ª–µ —É –∫–æ—Ä–∏—Å–Ω–æ–º—É –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ, —è–∫–µ –º–æ–∂–Ω–∞ –ø–µ—Ä–µ–¥–∞—Ç–∏ —ñ–∑ –∑–∞–ø–∏—Ç–æ–º –º–µ—Ç–æ–¥—É —Ç–∞ –æ—Ç—Ä–∏–º–∞—Ç–∏ –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `payload`.

1. –î–æ–¥–∞–π—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω–∏–π –∫–æ–¥ —É –∫—ñ–Ω—Ü—ñ —Ñ—É–Ω–∫—Ü—ñ—ó `directMethodCallback`:

    ```cpp
    char resultBuff[16];
    sprintf(resultBuff, "{\"Result\":\"\"}");
    *response_size = strlen(resultBuff);
    *response = (unsigned char *)malloc(*response_size);
    memcpy(*response, resultBuff, *response_size);

    return IOTHUB_CLIENT_OK;
    ```

    –ó–∞–ø–∏—Ç–∏ –ø—Ä—è–º–æ–≥–æ –º–µ—Ç–æ–¥—É –ø–æ—Ç—Ä–µ–±—É—é—Ç—å –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ, —ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—å —Å–∫–ª–∞–¥–∞—î—Ç—å—Å—è –∑ –¥–≤–æ—Ö —á–∞—Å—Ç–∏–Ω ‚Äî –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ —É –≤–∏–≥–ª—è–¥—ñ —Ç–µ–∫—Å—Ç—É —Ç–∞ –∫–æ–¥—É –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è. –¶–µ–π –∫–æ–¥ —Å—Ç–≤–æ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É –≤–∏–≥–ª—è–¥—ñ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ JSON-–¥–æ–∫—É–º–µ–Ω—Ç–∞:

    ```JSON
    {
        "Result": ""
    }
    ```

    –ü–æ—Ç—ñ–º —Ü–µ –∫–æ–ø—ñ—é—î—Ç—å—Å—è —É –ø–∞—Ä–∞–º–µ—Ç—Ä `response`, –∞ —Ä–æ–∑–º—ñ—Ä —Ü—ñ—î—ó –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î—Ç—å—Å—è —É –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ `response_size`. –¶–µ–π –∫–æ–¥ –ø–æ—Ç—ñ–º –ø–æ–≤–µ—Ä—Ç–∞—î `IOTHUB_CLIENT_OK`, —â–æ–± –ø–æ–∫–∞–∑–∞—Ç–∏, —â–æ –º–µ—Ç–æ–¥ –±—É–≤ –æ–±—Ä–æ–±–ª–µ–Ω–∏–π –ø—Ä–∞–≤–∏–ª—å–Ω–æ.

1. –ü—ñ–¥–∫–ª—é—á—ñ—Ç—å –∑–≤–æ—Ä–æ—Ç–Ω–∏–π –≤–∏–∫–ª–∏–∫, –¥–æ–¥–∞–≤—à–∏ –Ω–∞—Å—Ç—É–ø–Ω–µ —É –∫—ñ–Ω—Ü—ñ —Ñ—É–Ω–∫—Ü—ñ—ó `connectIoTHub`:

    ```cpp
    IoTHubClient_LL_SetDeviceMethodCallback(_device_ll_handle, directMethodCallback, NULL);
    ```

1. –§—É–Ω–∫—Ü—ñ—è `loop` –≤–∏–∫–ª–∏–∫–∞—Ç–∏–º–µ —Ñ—É–Ω–∫—Ü—ñ—é `IoTHubDeviceClient_LL_DoWork` –¥–ª—è –æ–±—Ä–æ–±–∫–∏ –ø–æ–¥—ñ–π, –Ω–∞–¥—ñ—Å–ª–∞–Ω–∏—Ö IoT Hub. –¶–µ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –ª–∏—à–µ –∫–æ–∂–Ω—ñ 10 —Å–µ–∫—É–Ω–¥ —á–µ—Ä–µ–∑ `delay`, —â–æ –æ–∑–Ω–∞—á–∞—î, —â–æ –ø—Ä—è–º—ñ –º–µ—Ç–æ–¥–∏ –æ–±—Ä–æ–±–ª—è—é—Ç—å—Å—è –ª–∏—à–µ –∫–æ–∂–Ω—ñ 10 —Å–µ–∫—É–Ω–¥. –©–æ–± –∑—Ä–æ–±–∏—Ç–∏ —Ü–µ –±—ñ–ª—å—à –µ—Ñ–µ–∫—Ç–∏–≤–Ω–∏–º, –∑–∞—Ç—Ä–∏–º–∫—É –≤ 10 —Å–µ–∫—É–Ω–¥ –º–æ–∂–Ω–∞ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —è–∫ –±–∞–≥–∞—Ç–æ –∫–æ—Ä–æ—Ç—à–∏—Ö –∑–∞—Ç—Ä–∏–º–æ–∫, –≤–∏–∫–ª–∏–∫–∞—é—á–∏ `IoTHubDeviceClient_LL_DoWork` –∫–æ–∂–Ω–æ–≥–æ —Ä–∞–∑—É. –î–ª—è —Ü—å–æ–≥–æ –¥–æ–¥–∞–π—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω–∏–π –∫–æ–¥ –Ω–∞–¥ —Ñ—É–Ω–∫—Ü—ñ—î—é `loop`:

    ```cpp
    void work_delay(int delay_time)
    {
        int current = 0;
        do
        {
            IoTHubDeviceClient_LL_DoWork(_device_ll_handle);
            delay(100);
            current += 100;
        } while (current < delay_time);
    }
    ```

    –¶–µ–π –∫–æ–¥ –±—É–¥–µ –ø–æ–≤—Ç–æ—Ä—é–≤–∞—Ç–∏—Å—è, –≤–∏–∫–ª–∏–∫–∞—é—á–∏ `IoTHubDeviceClient_LL_DoWork` —ñ –∑–∞—Ç—Ä–∏–º—É—é—á–∏ –Ω–∞ 100 –º—Å –∫–æ–∂–Ω–æ–≥–æ —Ä–∞–∑—É. –í—ñ–Ω —Ä–æ–±–∏—Ç–∏–º–µ —Ü–µ —Å—Ç—ñ–ª—å–∫–∏ —Ä–∞–∑—ñ–≤, —Å–∫—ñ–ª—å–∫–∏ –ø–æ—Ç—Ä—ñ–±–Ω–æ, —â–æ–± –∑–∞—Ç—Ä–∏–º–∞—Ç–∏ –Ω–∞ —á–∞—Å, –∑–∞–¥–∞–Ω–∏–π —É –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ `delay_time`. –¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ –ø—Ä–∏—Å—Ç—Ä—ñ–π —á–µ–∫–∞—î –º–∞–∫—Å–∏–º—É–º 100 –º—Å –¥–ª—è –æ–±—Ä–æ–±–∫–∏ –∑–∞–ø–∏—Ç—ñ–≤ –ø—Ä—è–º–æ–≥–æ –º–µ—Ç–æ–¥—É.

1. –£ —Ñ—É–Ω–∫—Ü—ñ—ó `loop` –≤–∏–¥–∞–ª—ñ—Ç—å –≤–∏–∫–ª–∏–∫ `IoTHubDeviceClient_LL_DoWork` —ñ –∑–∞–º—ñ–Ω—ñ—Ç—å –≤–∏–∫–ª–∏–∫ `delay(10000)` –Ω–∞—Å—Ç—É–ø–Ω–∏–º, —â–æ–± –≤–∏–∫–ª–∏–∫–∞—Ç–∏ —Ü—é –Ω–æ–≤—É —Ñ—É–Ω–∫—Ü—ñ—é:

    ```cpp
    work_delay(10000);
    ```

> üíÅ –í–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ —Ü–µ–π –∫–æ–¥ —É –ø–∞–ø—Ü—ñ [code/wio-terminal](../../../../../2-farm/lessons/4-migrate-your-plant-to-the-cloud/code/wio-terminal).

üòÄ –í–∞—à–∞ –ø—Ä–æ–≥—Ä–∞–º–∞ –¥–∞—Ç—á–∏–∫–∞ –≤–æ–ª–æ–≥–æ—Å—Ç—ñ “ë—Ä—É–Ω—Ç—É –ø—ñ–¥–∫–ª—é—á–µ–Ω–∞ –¥–æ –≤–∞—à–æ–≥–æ IoT Hub!

---

**–í—ñ–¥–º–æ–≤–∞ –≤—ñ–¥ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ—Å—Ç—ñ**:  
–¶–µ–π –¥–æ–∫—É–º–µ–Ω—Ç –±—É–≤ –ø–µ—Ä–µ–∫–ª–∞–¥–µ–Ω–∏–π –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Å–µ—Ä–≤—ñ—Å—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –ø–µ—Ä–µ–∫–ª–∞–¥—É [Co-op Translator](https://github.com/Azure/co-op-translator). –•–æ—á–∞ –º–∏ –ø—Ä–∞–≥–Ω–µ–º–æ –¥–æ —Ç–æ—á–Ω–æ—Å—Ç—ñ, –±—É–¥—å –ª–∞—Å–∫–∞, –º–∞–π—Ç–µ –Ω–∞ —É–≤–∞–∑—ñ, —â–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ –ø–µ—Ä–µ–∫–ª–∞–¥–∏ –º–æ–∂—É—Ç—å –º—ñ—Å—Ç–∏—Ç–∏ –ø–æ–º–∏–ª–∫–∏ –∞–±–æ –Ω–µ—Ç–æ—á–Ω–æ—Å—Ç—ñ. –û—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–∏–π –¥–æ–∫—É–º–µ–Ω—Ç –Ω–∞ –π–æ–≥–æ —Ä—ñ–¥–Ω—ñ–π –º–æ–≤—ñ —Å–ª—ñ–¥ –≤–≤–∞–∂–∞—Ç–∏ –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç–Ω–∏–º –¥–∂–µ—Ä–µ–ª–æ–º. –î–ª—è –∫—Ä–∏—Ç–∏—á–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó —Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–π –ª—é–¥—Å—å–∫–∏–π –ø–µ—Ä–µ–∫–ª–∞–¥. –ú–∏ –Ω–µ –Ω–µ—Å–µ–º–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ—Å—Ç—ñ –∑–∞ –±—É–¥—å-—è–∫—ñ –Ω–µ–ø–æ—Ä–æ–∑—É–º—ñ–Ω–Ω—è –∞–±–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ñ —Ç–ª—É–º–∞—á–µ–Ω–Ω—è, —â–æ –≤–∏–Ω–∏–∫–∞—é—Ç—å –≤–Ω–∞—Å–ª—ñ–¥–æ–∫ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ü—å–æ–≥–æ –ø–µ—Ä–µ–∫–ª–∞–¥—É.