<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "3ac42e284a7222c0e83d2d43231a364f",
  "translation_date": "2025-10-11T12:31:59+00:00",
  "source_file": "2-farm/lessons/4-migrate-your-plant-to-the-cloud/single-board-computer-connect-hub.md",
  "language_code": "ta"
}
-->
# роЙроЩрпНроХро│рпН IoT роЪро╛родройродрпНродрпИ роорпЗроХродрпНродрпБроЯройрпН роЗрогрпИроХрпНроХро╡рпБроорпН - роорпЖропрпНроиро┐роХро░рпН IoT ро╣ро╛ро░рпНроЯрпНро╡рпЗро░рпБроорпН Raspberry Pi-ропрпБроорпН

роЗроирпНрод рокро╛роЯродрпНродро┐ройрпН роЗроирпНрод рокроХрпБродро┐ропро┐ро▓рпН, роЙроЩрпНроХро│рпН роорпЖропрпНроиро┐роХро░рпН IoT роЪро╛родройродрпНродрпИ роЕро▓рпНро▓родрпБ Raspberry Pi-ропрпИ роЙроЩрпНроХро│рпН IoT Hub-роХрпНроХрпБ роЗрогрпИродрпНродрпБ, роЯрпЖро▓ро┐роорпЖроЯрпНро░ро┐ропрпИ роЕройрпБрокрпНрокро╡рпБроорпН, роХроЯрпНроЯро│рпИроХро│рпИрокрпН рокрпЖро▒ро╡рпБроорпН роЪрпЖропрпНропро▓ро╛роорпН.

## роЙроЩрпНроХро│рпН роЪро╛родройродрпНродрпИ IoT Hub-роХрпНроХрпБ роЗрогрпИроХрпНроХро╡рпБроорпН

роЕроЯрпБродрпНрод рокроЯро┐ропро╛роХ, роЙроЩрпНроХро│рпН роЪро╛родройродрпНродрпИ IoT Hub-роХрпНроХрпБ роЗрогрпИроХрпНроХ ро╡рпЗрогрпНроЯрпБроорпН.

### рокрогро┐роХро│рпН - IoT Hub-роХрпНроХрпБ роЗрогрпИроХрпНроХро╡рпБроорпН

1. VS Code-ро▓рпН `soil-moisture-sensor` роХрпЛрокрпНрокрпБро▒рпИропрпИ родро┐ро▒роХрпНроХро╡рпБроорпН. роирпАроЩрпНроХро│рпН роорпЖропрпНроиро┐роХро░рпН IoT роЪро╛родройродрпНродрпИрокрпН рокропройрпНрокроЯрпБродрпНродро┐ройро╛ро▓рпН, роЯрпЖро░рпНрооро┐ройро▓ро┐ро▓рпН роорпЖропрпНроиро┐роХро░рпН роЪрпВро┤ро▓рпН роЗропроЩрпНроХрпБроХро┐ро▒родро╛ роОройрпНрокродрпИ роЙро▒рпБродро┐рокрпНрокроЯрпБродрпНродро╡рпБроорпН.

1. роЪро┐ро▓ роХрпВроЯрпБродро▓рпН Pip родрпКроХрпБрокрпНрокрпБроХро│рпИ роиро┐ро▒рпБро╡ро╡рпБроорпН:

    ```sh
    pip3 install azure-iot-device
    ```

    `azure-iot-device` роОройрпНрокродрпБ роЙроЩрпНроХро│рпН IoT Hub-ро╡рпБроЯройрпН родрпКроЯро░рпНрокрпБ роХрпКро│рпНро│ роТро░рпБ роирпВро▓роХроорпН.

1. `app.py` роХрпЛрокрпНрокро┐ройрпН роорпЗро▓рпН роЙро│рпНро│ роПро▒рпНроХройро╡рпЗ роЙро│рпНро│ роЗро▒роХрпНроХрпБроородро┐роХро│ро┐ройрпН роХрпАро┤рпН, рокро┐ройрпНро╡ро░рпБроорпН роЗро▒роХрпНроХрпБроородро┐роХро│рпИроЪрпН роЪрпЗро░рпНроХрпНроХро╡рпБроорпН:

    ```python
    from azure.iot.device import IoTHubDeviceClient, Message, MethodResponse
    ```

    роЗроирпНрод роХрпБро▒ро┐ропрпАроЯрпБ роЙроЩрпНроХро│рпН IoT Hub-ро╡рпБроЯройрпН родрпКроЯро░рпНрокрпБ роХрпКро│рпНро│ SDK-ропрпИ роЗро▒роХрпНроХрпБроородро┐ роЪрпЖропрпНроХро┐ро▒родрпБ.

1. `import paho.mqtt.client as mqtt` ро╡ро░ро┐ропрпИ роирпАроХрпНроХро╡рпБроорпН, роПройрпЖройро┐ро▓рпН роЗроирпНрод роирпВро▓роХроорпН роЗройро┐ родрпЗро╡рпИропро┐ро▓рпНро▓рпИ. MQTT роХрпБро▒ро┐ропрпАроЯрпБ, родро▓рпИрокрпНрокрпБрокрпН рокрпЖропро░рпНроХро│рпН, `mqtt_client` рооро▒рпНро▒рпБроорпН `handle_command` рокропройрпНрокроЯрпБродрпНродрпБроорпН роЕройрпИродрпНродрпБ роХрпБро▒ро┐ропрпАроЯрпБроХро│рпИропрпБроорпН роирпАроХрпНроХро╡рпБроорпН. `while True:` роороЯроХрпНроХродрпНродрпИ ро╡рпИродрпНродро┐ро░рпБроХрпНроХро╡рпБроорпН, роЖройро╛ро▓рпН роЗроирпНрод роороЯроХрпНроХродрпНродро┐ро▓рпН роЙро│рпНро│ `mqtt_client.publish` ро╡ро░ро┐ропрпИ роороЯрпНроЯрпБроорпН роирпАроХрпНроХро╡рпБроорпН.

1. роЗро▒роХрпНроХрпБроородро┐ роЕро▒ро┐роХрпНроХрпИроХро│ро┐ройрпН роХрпАро┤рпН рокро┐ройрпНро╡ро░рпБроорпН роХрпБро▒ро┐ропрпАроЯрпБроХро│рпИроЪрпН роЪрпЗро░рпНроХрпНроХро╡рпБроорпН:

    ```python
    connection_string = "<connection string>"
    ```

    `<connection string>`-роР роЗроирпНрод рокро╛роЯродрпНродро┐ро▓рпН роорпБройрпНрокрпБ роЪро╛родройродрпНродро┐ро▒рпНроХро╛роХ роирпАроЩрпНроХро│рпН рокрпЖро▒рпНро▒ роЗрогрпИрокрпНрокрпБ роЪро░родрпНродрпИ рооро╛ро▒рпНро▒ро╡рпБроорпН.

    > ЁЯТБ роЗродрпБ роЪро┐ро▒роирпНрод роироЯрпИроорпБро▒рпИ роЕро▓рпНро▓. роЗрогрпИрокрпНрокрпБ роЪро░роЩрпНроХро│рпН роорпВро▓роХрпН роХрпБро▒ро┐ропрпАроЯрпНроЯро┐ро▓рпН роОрокрпНрокрпЛродрпБроорпН роЪрпЗрооро┐роХрпНроХрокрпНрокроЯроХрпНроХрпВроЯро╛родрпБ, роПройрпЖройро┐ро▓рпН роЗродрпБ роорпВро▓роХрпН роХрпБро▒ро┐ропрпАроЯрпНроЯрпБ роХроЯрпНроЯрпБрокрпНрокро╛роЯрпНроЯро┐ро▓рпН роЪро░ро┐рокро╛ро░рпНроХрпНроХрокрпНрокроЯрпНроЯрпБ ропро╛ро░ро╛ро▓рпБроорпН роХрогрпНроЯрпБрокро┐роЯро┐роХрпНроХрокрпНрокроЯро▓ро╛роорпН. роОро│ро┐роорпИроХрпНроХро╛роХ роЗродрпИ роЗроЩрпНроХрпБ роЪрпЖропрпНроХро┐ро▒рпЛроорпН. ро╡ро┤роХрпНроХрооро╛роХ, роирпАроЩрпНроХро│рпН роЪрпВро┤ро▓рпН рооро╛ро▒ро┐ рооро▒рпНро▒рпБроорпН [`python-dotenv`](https://pypi.org/project/python-dotenv/) рокрпЛройрпНро▒ роТро░рпБ роХро░рпБро╡ро┐ропрпИрокрпН рокропройрпНрокроЯрпБродрпНрод ро╡рпЗрогрпНроЯрпБроорпН. роЗродрпИрокрпН рокро▒рпНро▒ро┐роп роорпЗро▓рпБроорпН родроХро╡ро▓рпИ роирпАроЩрпНроХро│рпН ро╡ро░ро╡ро┐ро░рпБроХрпНроХрпБроорпН рокро╛роЯродрпНродро┐ро▓рпН роХро▒рпНро▒рпБроХрпНроХрпКро│рпНро╡рпАро░рпНроХро│рпН.

1. роЗроирпНрод роХрпБро▒ро┐ропрпАроЯрпНроЯро┐ройрпН роХрпАро┤рпН, IoT Hub-ро╡рпБроЯройрпН родрпКроЯро░рпНрокрпБ роХрпКро│рпНро│рпБроорпН роЪро╛родрой роХро┐ро│рпИропройрпНроЯрпН рокрпКро░рпБро│рпИ роЙро░рпБро╡ро╛роХрпНроХро╡рпБроорпН, роЕродрпИ роЗрогрпИроХрпНроХро╡рпБроорпН:

    ```python
    device_client = IoTHubDeviceClient.create_from_connection_string(connection_string)

    print('Connecting')
    device_client.connect()
    print('Connected')
    ```

1. роЗроирпНрод роХрпБро▒ро┐ропрпАроЯрпНроЯрпИ роЗропроХрпНроХро╡рпБроорпН. роЙроЩрпНроХро│рпН роЪро╛родройроорпН роЗрогрпИроХрпНроХрокрпНрокроЯрпНроЯродрпИ роирпАроЩрпНроХро│рпН роХро╛рогро▓ро╛роорпН.

    ```output
    pi@raspberrypi:~/soil-moisture-sensor $ python3 app.py 
    Connecting
    Connected
    Soil moisture: 379
    ```

## роЯрпЖро▓ро┐роорпЖроЯрпНро░ро┐ропрпИ роЕройрпБрокрпНрокро╡рпБроорпН

роЗрокрпНрокрпЛродрпБ роЙроЩрпНроХро│рпН роЪро╛родройроорпН роЗрогрпИроХрпНроХрокрпНрокроЯрпНроЯрпБро│рпНро│родрпБ, роирпАроЩрпНроХро│рпН MQTT broker-роХрпНроХрпБ рокродро┐ро▓ро╛роХ IoT Hub-роХрпНроХрпБ роЯрпЖро▓ро┐роорпЖроЯрпНро░ро┐ропрпИ роЕройрпБрокрпНрокро▓ро╛роорпН.

### рокрогро┐роХро│рпН - роЯрпЖро▓ро┐роорпЖроЯрпНро░ро┐ропрпИ роЕройрпБрокрпНрокро╡рпБроорпН

1. `while True` роороЯроХрпНроХродрпНродро┐ройрпН роЙро│рпНро│рпЗ, родрпВроХрпНроХродрпНродро┐ро▒рпНроХрпБ роорпБройрпН рокро┐ройрпНро╡ро░рпБроорпН роХрпБро▒ро┐ропрпАроЯрпНроЯрпИроЪрпН роЪрпЗро░рпНроХрпНроХро╡рпБроорпН:

    ```python
    message = Message(json.dumps({ 'soil_moisture': soil_moisture }))
    device_client.send_message(message)
    ```

    роЗроирпНрод роХрпБро▒ро┐ропрпАроЯрпБ роорогрпН роИро░рокрпНрокродроорпН роЕро│ро╡рпАроЯрпНроЯрпИ JSON роЪро░рооро╛роХ IoT Hub `Message` роЖроХ роЙро░рпБро╡ро╛роХрпНроХро┐, роЪро╛родройроорпН-роорпЗроХроорпН роЪрпЖропрпНродро┐ропро╛роХ IoT Hub-роХрпНроХрпБ роЕройрпБрокрпНрокрпБроХро┐ро▒родрпБ.

## роХроЯрпНроЯро│рпИроХро│рпИ роХрпИропро╛ро│ро╡рпБроорпН

роЙроЩрпНроХро│рпН роЪро╛родройроорпН ро░ро┐ро▓рпЗро╡рпИ роХроЯрпНроЯрпБрокрпНрокроЯрпБродрпНрод роЪро░рпНро╡ро░рпН роХрпБро▒ро┐ропрпАроЯрпНроЯро┐ро▓ро┐ро░рпБроирпНродрпБ роТро░рпБ роХроЯрпНроЯро│рпИропрпИ роХрпИропро╛ро│ ро╡рпЗрогрпНроЯрпБроорпН. роЗродрпБ роирпЗро░роЯро┐ роорпБро▒рпИ роХрпЛро░ро┐роХрпНроХрпИропро╛роХ роЕройрпБрокрпНрокрокрпНрокроЯрпБроХро┐ро▒родрпБ.

## рокрогро┐роХро│рпН - роирпЗро░роЯро┐ роорпБро▒рпИ роХрпЛро░ро┐роХрпНроХрпИропрпИ роХрпИропро╛ро│ро╡рпБроорпН

1. `while True` роороЯроХрпНроХродрпНродро┐ро▒рпНроХрпБ роорпБройрпН рокро┐ройрпНро╡ро░рпБроорпН роХрпБро▒ро┐ропрпАроЯрпНроЯрпИроЪрпН роЪрпЗро░рпНроХрпНроХро╡рпБроорпН:

    ```python
    def handle_method_request(request):
        print("Direct method received - ", request.name)
    
        if request.name == "relay_on":
            relay.on()
        elif request.name == "relay_off":
            relay.off()    
    ```

    роЗродрпБ роТро░рпБ роорпБро▒рпИ, `handle_method_request`, роР ро╡ро░рпИропро▒рпБроХрпНроХро┐ро▒родрпБ, роЗродрпБ IoT Hub роорпВро▓роорпН роирпЗро░роЯро┐ роорпБро▒рпИ роЕро┤рпИроХрпНроХрокрпНрокроЯрпБроорпН рокрпЛродрпБ роЕро┤рпИроХрпНроХрокрпНрокроЯрпБроорпН. роТро╡рпНро╡рпКро░рпБ роирпЗро░роЯро┐ роорпБро▒рпИроХрпНроХрпБроорпН роТро░рпБ рокрпЖропро░рпН роЙро│рпНро│родрпБ, роорпЗро▓рпБроорпН роЗроирпНрод роХрпБро▒ро┐ропрпАроЯрпБ ро░ро┐ро▓рпЗро╡рпИ роЗропроХрпНроХ `relay_on` рооро▒рпНро▒рпБроорпН ро░ро┐ро▓рпЗро╡рпИ роЕрогрпИроХрпНроХ `relay_off` роОройрпНро▒ роорпБро▒рпИропрпИ роОродро┐ро░рпНрокро╛ро░рпНроХрпНроХро┐ро▒родрпБ.

    > ЁЯТБ роЗродрпИ роТро░рпБ роорпБро▒рпИ роХрпЛро░ро┐роХрпНроХрпИропро┐ро▓рпН роЪрпЖропро▓рпНрокроЯрпБродрпНродро╡рпБроорпН роорпБроЯро┐ропрпБроорпН, ро░ро┐ро▓рпЗро╡ро┐ройрпН ро╡ро┐ро░рпБроорпНрокро┐роп роиро┐ро▓рпИропрпИ роТро░рпБ payload-ро▓рпН роЕройрпБрокрпНрокро┐, роЗродрпБ роорпБро▒рпИ роХрпЛро░ро┐роХрпНроХрпИропрпБроЯройрпН роЕройрпБрокрпНрокрокрпНрокроЯро▓ро╛роорпН рооро▒рпНро▒рпБроорпН `request` рокрпКро░рпБро│ро┐ро▓ро┐ро░рпБроирпНродрпБ роХро┐роЯрпИроХрпНроХро▓ро╛роорпН.

1. роирпЗро░роЯро┐ роорпБро▒рпИроХро│рпН роЕро╡рпИ роХрпИропро╛ро│рокрпНрокроЯрпНроЯрпБро│рпНро│рой роОройрпНрокродрпИ роЕро┤рпИроХрпНроХрпБроорпН роХрпБро▒ро┐ропрпАроЯрпНроЯро┐ро▒рпНроХрпБ родрпЖро░ро┐ро╡ро┐роХрпНроХ роТро░рпБ рокродро┐ро▓рпИ родрпЗро╡рпИрокрпНрокроЯрпБроорпН. `handle_method_request` роЪрпЖропро▓рпНрокро╛роЯрпНроЯро┐ройрпН роорпБроЯро┐ро╡ро┐ро▓рпН рокро┐ройрпНро╡ро░рпБроорпН роХрпБро▒ро┐ропрпАроЯрпНроЯрпИроЪрпН роЪрпЗро░рпНроХрпНроХро╡рпБроорпН:

    ```python
    method_response = MethodResponse.create_from_method_request(request, 200)
    device_client.send_method_response(method_response)
    ```

    роЗроирпНрод роХрпБро▒ро┐ропрпАроЯрпБ HTTP роиро┐ро▓рпИ роХрпБро▒ро┐ропрпАроЯрпБ 200 роЙроЯройрпН роирпЗро░роЯро┐ роорпБро▒рпИ роХрпЛро░ро┐роХрпНроХрпИроХрпНроХрпБ рокродро┐ро▓рпИ роЕройрпБрокрпНрокрпБроХро┐ро▒родрпБ, роорпЗро▓рпБроорпН роЗродрпИ IoT Hub-роХрпНроХрпБ родро┐ро░рпБрокрпНрокро┐ роЕройрпБрокрпНрокрпБроХро┐ро▒родрпБ.

1. роЗроирпНрод роЪрпЖропро▓рпНрокро╛роЯрпНроЯрпБ ро╡ро░рпИропро▒рпИропро┐ройрпН роХрпАро┤рпН рокро┐ройрпНро╡ро░рпБроорпН роХрпБро▒ро┐ропрпАроЯрпНроЯрпИроЪрпН роЪрпЗро░рпНроХрпНроХро╡рпБроорпН:

    ```python
    device_client.on_method_request_received = handle_method_request
    ```

    роЗроирпНрод роХрпБро▒ро┐ропрпАроЯрпБ IoT Hub роХро┐ро│рпИропройрпНроЯрпН роирпЗро░роЯро┐ роорпБро▒рпИ роЕро┤рпИроХрпНроХрокрпНрокроЯрпБроорпН рокрпЛродрпБ `handle_method_request` роЪрпЖропро▓рпНрокро╛роЯрпНроЯрпИ роЕро┤рпИроХрпНроХроЪрпН роЪрпКро▓рпНро▓рпБроХро┐ро▒родрпБ.

> ЁЯТБ роЗроирпНрод роХрпБро▒ро┐ропрпАроЯрпНроЯрпИ [code/pi](../../../../../2-farm/lessons/4-migrate-your-plant-to-the-cloud/code/pi) роЕро▓рпНро▓родрпБ [code/virtual-device](../../../../../2-farm/lessons/4-migrate-your-plant-to-the-cloud/code/virtual-device) роХрпЛрокрпНрокрпБро▒рпИропро┐ро▓рпН роХро╛рогро▓ро╛роорпН.

ЁЯША роЙроЩрпНроХро│рпН роорогрпН роИро░рокрпНрокродроорпН роЪрпЖройрпНроЪро╛ро░рпН родро┐роЯрпНроЯроорпН роЙроЩрпНроХро│рпН IoT Hub-роХрпНроХрпБ роЗрогрпИроХрпНроХрокрпНрокроЯрпНроЯрпБро│рпНро│родрпБ!

---

**роХрпБро▒ро┐рокрпНрокрпБ**:  
роЗроирпНрод роЖро╡рогроорпН [Co-op Translator](https://github.com/Azure/co-op-translator) роОройрпНро▒ AI роорпКро┤ро┐рокрпЖропро░рпНрокрпНрокрпБ роЪрпЗро╡рпИропрпИрокрпН рокропройрпНрокроЯрпБродрпНродро┐ роорпКро┤ро┐рокрпЖропро░рпНроХрпНроХрокрпНрокроЯрпНроЯрпБро│рпНро│родрпБ. роиро╛роЩрпНроХро│рпН родрпБро▓рпНро▓ро┐ропродрпНродро┐ро▒рпНроХро╛роХ роорпБропро▒рпНроЪро┐роХрпНроХро┐ройрпНро▒рпЛроорпН, роЖройро╛ро▓рпН родро╛ройро┐ропроЩрпНроХро┐ роорпКро┤ро┐рокрпЖропро░рпНрокрпНрокрпБроХро│ро┐ро▓рпН рокро┐ро┤рпИроХро│рпН роЕро▓рпНро▓родрпБ родро╡ро▒ро╛рой родроХро╡ро▓рпНроХро│рпН роЗро░рпБроХрпНроХроХрпНроХрпВроЯрпБроорпН роОройрпНрокродрпИ роХро╡ройродрпНродро┐ро▓рпН роХрпКро│рпНро│ро╡рпБроорпН. роЕродройрпН родро╛ропрпНроорпКро┤ро┐ропро┐ро▓рпН роЙро│рпНро│ роорпВро▓ роЖро╡рогроорпН роЕродро┐роХро╛ро░рокрпНрокрпВро░рпНро╡ роЖродро╛ро░рооро╛роХ роХро░рпБродрокрпНрокроЯ ро╡рпЗрогрпНроЯрпБроорпН. роорпБроХрпНроХро┐ропрооро╛рой родроХро╡ро▓рпНроХро│рпБроХрпНроХрпБ, родрпКро┤ро┐ро▓рпНроорпБро▒рпИ рооройро┐род роорпКро┤ро┐рокрпЖропро░рпНрокрпНрокрпБ рокро░ро┐роирпНродрпБро░рпИроХрпНроХрокрпНрокроЯрпБроХро┐ро▒родрпБ. роЗроирпНрод роорпКро┤ро┐рокрпЖропро░рпНрокрпНрокрпИрокрпН рокропройрпНрокроЯрпБродрпНродрпБро╡родро╛ро▓рпН роПро▒рпНрокроЯрпБроорпН роОроирпНрод родро╡ро▒ро╛рой рокрпБро░ро┐родро▓рпНроХро│рпН роЕро▓рпНро▓родрпБ родро╡ро▒ро╛рой ро╡ро┐ро│роХрпНроХроЩрпНроХро│рпБроХрпНроХрпБ роиро╛роЩрпНроХро│рпН рокрпКро▒рпБрокрпНрокро▓рпНро▓.