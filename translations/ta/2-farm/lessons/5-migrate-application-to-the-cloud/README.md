<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "5f2d2f4a5a023c93ab34a0cc5b47c0c4",
  "translation_date": "2025-10-11T12:38:03+00:00",
  "source_file": "2-farm/lessons/5-migrate-application-to-the-cloud/README.md",
  "language_code": "ta"
}
-->
# роЙроЩрпНроХро│рпН рокропройрпНрокро╛роЯрпНроЯрпБ ро▓ро╛роЬро┐роХрпНроХрпИ роХро┐ро│ро╡рпБроЯрпБроХрпНроХрпБ рооро╛ро▒рпНро▒ро╡рпБроорпН

![роЗроирпНрод рокро╛роЯродрпНродро┐ройрпН ро╕рпНроХрпЖроЯрпНроЪрпН роирпЛроЯрпН](../../../../../translated_images/lesson-9.dfe99c8e891f48e179724520da9f5794392cf9a625079281ccdcbf09bd85e1b6.ta.jpg)

> ро╕рпНроХрпЖроЯрпНроЪрпН роирпЛроЯрпН: [роиро┐родрпНропро╛ роиро░роЪро┐роорпНрооройрпН](https://github.com/nitya). рокроЯродрпНродрпИ роХро┐ро│ро┐роХрпН роЪрпЖропрпНродрпБ рокрпЖро░ро┐роп рокродро┐рокрпНрокрпИрокрпН рокро╛ро░рпБроЩрпНроХро│рпН.

роЗроирпНрод рокро╛роЯроорпН [IoT for Beginners Project 2 - Digital Agriculture series](https://youtube.com/playlist?list=PLmsFUfdnGr3yCutmcVg6eAUEfsGiFXgcx) рооро▒рпНро▒рпБроорпН [Microsoft Reactor](https://developer.microsoft.com/reactor/?WT.mc_id=academic-17441-jabenn) роорпВро▓роорпН роХро▒рпНрокро┐роХрпНроХрокрпНрокроЯрпНроЯродрпБ.

[![роЙроЩрпНроХро│рпН IoT роЪро╛родройродрпНродрпИ роЪро░рпНро╡ро░рпНро▓рпЖро╕рпН роХрпЛроЯрпБроЯройрпН роХроЯрпНроЯрпБрокрпНрокроЯрпБродрпНродрпБроЩрпНроХро│рпН](https://img.youtube.com/vi/VVZDcs5u1_I/0.jpg)](https://youtu.be/VVZDcs5u1_I)

## рокро╛роЯродрпНродро┐ро▒рпНроХрпБ роорпБройрпН роХрпЗро│рпНро╡ро┐

[рокро╛роЯродрпНродро┐ро▒рпНроХрпБ роорпБройрпН роХрпЗро│рпНро╡ро┐](https://black-meadow-040d15503.1.azurestaticapps.net/quiz/17)

## роЕро▒ро┐роорпБроХроорпН

роХроЯроирпНрод рокро╛роЯродрпНродро┐ро▓рпН, роЙроЩрпНроХро│рпН родро╛ро╡ро░ роорогрпН роИро░рокрпНрокродроорпН роХрогрпНроХро╛рогро┐рокрпНрокрпБ рооро▒рпНро▒рпБроорпН ро░ро┐ро▓рпЗ роХроЯрпНроЯрпБрокрпНрокро╛роЯрпНроЯрпИ роХро┐ро│ро╡рпБроЯрпН роЕроЯро┐рокрпНрокроЯрпИропро┐ро▓ро╛рой IoT роЪрпЗро╡рпИроХрпНроХрпБ роЗрогрпИрокрпНрокродрпБ роОрокрпНрокроЯро┐ роОройрпНрокродрпИ роирпАроЩрпНроХро│рпН роХро▒рпНро▒рпБроХрпНроХрпКрогрпНроЯрпАро░рпНроХро│рпН. роЕроЯрпБродрпНрод рокроЯро┐ропро╛роХ, ро░ро┐ро▓рпЗ роирпЗро░родрпНродрпИ роХроЯрпНроЯрпБрокрпНрокроЯрпБродрпНродрпБроорпН роЪро░рпНро╡ро░рпН роХрпЛроЯрпИ роХро┐ро│ро╡рпБроЯрпБроХрпНроХрпБ рооро╛ро▒рпНро▒ ро╡рпЗрогрпНроЯрпБроорпН. роЗроирпНрод рокро╛роЯродрпНродро┐ро▓рпН, роЪро░рпНро╡ро░рпНро▓рпЖро╕рпН роЪрпЖропро▓рпНрокро╛роЯрпБроХро│рпИрокрпН рокропройрпНрокроЯрпБродрпНродро┐ роЗродрпИ роОрокрпНрокроЯро┐ роЪрпЖропрпНро╡родрпБ роОройрпНрокродрпИ роирпАроЩрпНроХро│рпН роХро▒рпНро▒рпБроХрпНроХрпКро│рпНро╡рпАро░рпНроХро│рпН.

роЗроирпНрод рокро╛роЯродрпНродро┐ро▓рпН роиро╛роорпН роХро╡ро░рпБроорпН ро╡ро┐ро╖ропроЩрпНроХро│рпН:

* [роЪро░рпНро╡ро░рпНро▓рпЖро╕рпН роОройрпНро▒ро╛ро▓рпН роОройрпНрой?](../../../../../2-farm/lessons/5-migrate-application-to-the-cloud)
* [роЪро░рпНро╡ро░рпНро▓рпЖро╕рпН рокропройрпНрокро╛роЯрпНроЯрпИ роЙро░рпБро╡ро╛роХрпНроХрпБроЩрпНроХро│рпН](../../../../../2-farm/lessons/5-migrate-application-to-the-cloud)
* [IoT Hub роиро┐роХро┤рпНро╡рпБ роЯро┐ро░ро┐роХро░рпИ роЙро░рпБро╡ро╛роХрпНроХрпБроЩрпНроХро│рпН](../../../../../2-farm/lessons/5-migrate-application-to-the-cloud)
* [роЪро░рпНро╡ро░рпНро▓рпЖро╕рпН роХрпЛроЯро┐ро▓рпН роЗро░рпБроирпНродрпБ роирпЗро░роЯро┐ роорпБро▒рпИ роХрпЛро░ро┐роХрпНроХрпИроХро│рпИ роЕройрпБрокрпНрокрпБроЩрпНроХро│рпН](../../../../../2-farm/lessons/5-migrate-application-to-the-cloud)
* [роЙроЩрпНроХро│рпН роЪро░рпНро╡ро░рпНро▓рпЖро╕рпН роХрпЛроЯрпИ роХро┐ро│ро╡рпБроЯро┐ро▓рпН рокро┐ро░роЪрпБро░ро┐роХрпНроХро╡рпБроорпН](../../../../../2-farm/lessons/5-migrate-application-to-the-cloud)

## роЪро░рпНро╡ро░рпНро▓рпЖро╕рпН роОройрпНро▒ро╛ро▓рпН роОройрпНрой?

роЪро░рпНро╡ро░рпНро▓рпЖро╕рпН, роЕро▓рпНро▓родрпБ роЪро░рпНро╡ро░рпНро▓рпЖро╕рпН роХрогро┐ройро┐ роЪрпЖропро▓рпНрокро╛роЯрпБ, рокро▓рпНро╡рпЗро▒рпБ роиро┐роХро┤рпНро╡рпБроХро│рпБроХрпНроХрпБ рокродро┐ро▓ро│ро┐роХрпНроХрпБроорпН ро╡роХрпИропро┐ро▓рпН роХро┐ро│ро╡рпБроЯро┐ро▓рпН роЪро┐ро▒ро┐роп роХрпЛроЯрпБроХро│ро┐ройрпН родрпКроХрпБродро┐роХро│рпИ роЙро░рпБро╡ро╛роХрпНроХрпБро╡родрпБ роЖроХрпБроорпН. роиро┐роХро┤рпНро╡рпБ роиро┐роХро┤рпБроорпН рокрпЛродрпБ роЙроЩрпНроХро│рпН роХрпЛроЯрпБ роЗропроХрпНроХрокрпНрокроЯрпБроорпН, роорпЗро▓рпБроорпН роиро┐роХро┤рпНро╡ро┐ройрпН родроХро╡ро▓рпНроХро│рпН роХрпЛроЯрпБроХрпНроХрпБ роЕройрпБрокрпНрокрокрпНрокроЯрпБроорпН. роЗроирпНрод роиро┐роХро┤рпНро╡рпБроХро│рпН ро╡ро▓рпИ роХрпЛро░ро┐роХрпНроХрпИроХро│рпН, роТро░рпБ роХро┐ропрпВро╡ро┐ро▓рпН роЪрпЖропрпНродро┐роХро│рпИ ро╡рпИрокрпНрокродрпБ, родро░ро╡рпБродрпНродрпКроХрпБрокрпНрокро┐ро▓рпН рооро╛ро▒рпНро▒роЩрпНроХро│рпН, роЕро▓рпНро▓родрпБ IoT роЪро╛родройроЩрпНроХро│рпН IoT роЪрпЗро╡рпИроХрпНроХрпБ роЕройрпБрокрпНрокрпБроорпН роЪрпЖропрпНродро┐роХро│рпИ роЙро│рпНро│роЯроХрпНроХро▓ро╛роорпН.

![IoT роЪрпЗро╡рпИропро┐ро▓ро┐ро░рпБроирпНродрпБ роЪро░рпНро╡ро░рпНро▓рпЖро╕рпН роЪрпЗро╡рпИроХрпНроХрпБ роЕройрпБрокрпНрокрокрпНрокроЯрпБроорпН роиро┐роХро┤рпНро╡рпБроХро│рпН, рокро▓ роЪрпЖропро▓рпНрокро╛роЯрпБроХро│рпН роТро░рпЗ роирпЗро░родрпНродро┐ро▓рпН роЪрпЖропро▓рпНрокроЯрпБроХро┐ройрпНро▒рой](../../../../../translated_images/iot-messages-to-serverless.0194da1cc0732bb7d0f823aed3fce54735c6b1ad3bf36089804d8aaefc0a774f.ta.png)

> ЁЯТБ роирпАроЩрпНроХро│рпН родро░ро╡рпБродрпНродрпКроХрпБрокрпНрокрпБ роЯро┐ро░ро┐роХро░рпНроХро│рпИрокрпН рокропройрпНрокроЯрпБродрпНродро┐ропро┐ро░рпБроирпНродро╛ро▓рпН, роЗродрпБ роТро░рпБ ро╡ро░ро┐роЪрпИропрпИроЪрпН роЪрпЗро░рпНрокрпНрокродрпБ рокрпЛройрпНро▒ роиро┐роХро┤рпНро╡ро╛ро▓рпН роЗропроХрпНроХрокрпНрокроЯрпБроорпН роХрпЛроЯрпБ роОройрпНро▒рпБ роиро┐ройрпИроХрпНроХро▓ро╛роорпН.

![рокро▓ роиро┐роХро┤рпНро╡рпБроХро│рпН роТро░рпЗ роирпЗро░родрпНродро┐ро▓рпН роЕройрпБрокрпНрокрокрпНрокроЯрпБроорпН рокрпЛродрпБ, роЪро░рпНро╡ро░рпНро▓рпЖро╕рпН роЪрпЗро╡рпИ роЕро╡ро▒рпНро▒рпИ роТро░рпЗ роирпЗро░родрпНродро┐ро▓рпН роЪрпЖропро▓рпНрокроЯрпБродрпНрод роЕродро┐роХ роЕро│ро╡ро┐ро▓рпН роЪрпЖропро▓рпНрокроЯрпБроХро┐ро▒родрпБ](../../../../../translated_images/serverless-scaling.f8c769adf0413fd17be1af4f07ff63016b347e2ff869be6c4abb211f9e93909d.ta.png)

роЙроЩрпНроХро│рпН роХрпЛроЯрпБ роиро┐роХро┤рпНро╡рпБ роиро┐роХро┤рпБроорпН рокрпЛродрпБ роороЯрпНроЯрпБроорпЗ роЗропроХрпНроХрокрпНрокроЯрпБроорпН, рооро▒рпНро▒ роирпЗро░роЩрпНроХро│ро┐ро▓рпН роЙроЩрпНроХро│рпН роХрпЛроЯрпБ роЪрпЖропро▓рпНрокроЯро╛родрпБ. роиро┐роХро┤рпНро╡рпБ роиро┐роХро┤рпБроорпН рокрпЛродрпБ, роЙроЩрпНроХро│рпН роХрпЛроЯрпБ роПро▒рпНро▒рокрпНрокроЯрпНроЯрпБ роЗропроХрпНроХрокрпНрокроЯрпБроорпН. роЗродрпБ роЪро░рпНро╡ро░рпНро▓рпЖро╕рпН роорпБро▒рпИ рооро┐роХро╡рпБроорпН роЕро│ро╡рпАроЯрпНроЯрпБроХрпНроХрпБро░ро┐ропродро╛роХ роЗро░рпБроХрпНроХро┐ро▒родрпБ - рокро▓ роиро┐роХро┤рпНро╡рпБроХро│рпН роТро░рпЗ роирпЗро░родрпНродро┐ро▓рпН роиро┐роХро┤рпНроирпНродро╛ро▓рпН, роХро┐ро│ро╡рпБроЯрпН ро╡ро┤роЩрпНроХрпБроиро░рпН роЙроЩрпНроХро│рпН роЪрпЖропро▓рпНрокро╛роЯрпНроЯрпИ родрпЗро╡рпИропро╛рой роЕро│ро╡рпБроХрпНроХрпБ роТро░рпЗ роирпЗро░родрпНродро┐ро▓рпН роЗропроХрпНроХ роорпБроЯро┐ропрпБроорпН. роЖройро╛ро▓рпН, роиро┐роХро┤рпНро╡рпБроХро│рпБроХрпНроХрпБ роЗроЯрпИропрпЗ родроХро╡ро▓рпНроХро│рпИрокрпН рокроХро┐ро░ ро╡рпЗрогрпНроЯрпБроорпН роОройрпНро▒ро╛ро▓рпН, роЕродрпИ роиро┐ройрпИро╡роХродрпНродро┐ро▓рпН роЪрпЗрооро┐роХрпНроХро╛рооро▓рпН родро░ро╡рпБродрпНродрпКроХрпБрокрпНрокро┐ро▓рпН роЪрпЗрооро┐роХрпНроХ ро╡рпЗрогрпНроЯрпБроорпН.

роЙроЩрпНроХро│рпН роХрпЛроЯрпБ роТро░рпБ роЪрпЖропро▓рпНрокро╛роЯро╛роХ роОро┤рпБродрокрпНрокроЯрпБроорпН, роЗродрпБ роиро┐роХро┤рпНро╡ро┐ройрпН ро╡ро┐ро╡ро░роЩрпНроХро│рпИ роТро░рпБ роЕро│ро╡рпБро░рпБро╡ро╛роХ роОроЯрпБродрпНродрпБроХрпНроХрпКро│рпНро│рпБроорпН. роЗроирпНрод роЪро░рпНро╡ро░рпНро▓рпЖро╕рпН роЪрпЖропро▓рпНрокро╛роЯрпБроХро│рпИ роОро┤рпБрод рокро▓рпНро╡рпЗро▒рпБ роиро┐ро░ро▓ро╛роХрпНроХ роорпКро┤ро┐роХро│рпИ роирпАроЩрпНроХро│рпН рокропройрпНрокроЯрпБродрпНродро▓ро╛роорпН.

> ЁЯОУ роЪро░рпНро╡ро░рпНро▓рпЖро╕рпН "Functions as a service (FaaS)" роОройрпНро▒рпБроорпН роЕро┤рпИроХрпНроХрокрпНрокроЯрпБроХро┐ро▒родрпБ, роПройрпЖройро┐ро▓рпН роТро╡рпНро╡рпКро░рпБ роиро┐роХро┤рпНро╡рпБ роЯро┐ро░ро┐роХро░рпБроорпН роХрпЛроЯро┐ро▓рпН роТро░рпБ роЪрпЖропро▓рпНрокро╛роЯро╛роХ роЪрпЖропро▓рпНрокроЯрпБроХро┐ро▒родрпБ.

роЪро░рпНро╡ро░рпНро▓рпЖро╕рпН роОройрпНро▒ рокрпЖропро░рпН роЗро░рпБроирпНродро╛ро▓рпБроорпН, роЗродрпБ роЙрогрпНроорпИропро┐ро▓рпН роЪро░рпНро╡ро░рпНроХро│рпИрокрпН рокропройрпНрокроЯрпБродрпНродрпБроХро┐ро▒родрпБ. рокрпЖропро░ро┐роЯрокрпНрокроЯрпНроЯ роХро╛ро░рогроорпН, роТро░рпБ роЯрпЖро╡ро▓рокрпНрокро░ро╛роХ роирпАроЩрпНроХро│рпН роЙроЩрпНроХро│рпН роХрпЛроЯрпБ роЗропроХрпНроХрпБро╡родро▒рпНроХро╛рой роЪро░рпНро╡ро░рпНроХро│рпИрокрпН рокро▒рпНро▒ро┐ роХро╡ро▓рпИрокрпНрокроЯ ро╡рпЗрогрпНроЯро┐ропродро┐ро▓рпНро▓рпИ; роЙроЩрпНроХро│рпН роХрпЛроЯрпБ роТро░рпБ роиро┐роХро┤рпНро╡рпБроХрпНроХрпБ рокродро┐ро▓ро│ро┐роХрпНроХ ро╡рпЗрогрпНроЯрпБроорпН роОройрпНрокродрпИропрпЗ роирпАроЩрпНроХро│рпН роХро╡ро▓рпИрокрпНрокроЯрпБроХро┐ро▒рпАро░рпНроХро│рпН. роХро┐ро│ро╡рпБроЯрпН ро╡ро┤роЩрпНроХрпБроиро░рпН роЪро░рпНро╡ро░рпНро▓рпЖро╕рпН *runtime* роорпВро▓роорпН роЪро░рпНро╡ро░рпНроХро│рпН, роирпЖроЯрпНро╡рпКро░рпНроХрпН, роЪрпЗрооро┐рокрпНрокрпБ, CPU, роиро┐ройрпИро╡роХроорпН рооро▒рпНро▒рпБроорпН роЙроЩрпНроХро│рпН роХрпЛроЯрпБ роЗропроХрпНроХрпБро╡родро▒рпНроХро╛рой роЕройрпИродрпНродрпИропрпБроорпН роиро┐ро░рпНро╡роХро┐роХрпНроХро┐ро▒ро╛ро░рпН. роЗроирпНрод роорпБро▒рпИ роирпАроЩрпНроХро│рпН роЪро░рпНро╡ро░рпБроХрпНроХрпБ роЕроЯро┐рокрпНрокроЯрпИропро╛роХ рокрогроорпН роЪрпЖро▓рпБродрпНрод роорпБроЯро┐ропро╛родрпБ, роПройрпЖройро┐ро▓рпН роЪро░рпНро╡ро░рпН роЗро▓рпНро▓рпИ. роЙроЩрпНроХро│рпН роХрпЛроЯрпБ роЗропроХрпНроХрокрпНрокроЯрпБроорпН роирпЗро░родрпНродро┐ро▒рпНроХрпБроорпН, рокропройрпНрокроЯрпБродрпНродрокрпНрокроЯрпБроорпН роиро┐ройрпИро╡роХ роЕро│ро╡ро┐ро▒рпНроХрпБроорпН роирпАроЩрпНроХро│рпН рокрогроорпН роЪрпЖро▓рпБродрпНрод ро╡рпЗрогрпНроЯрпБроорпН.

> ЁЯТ░ роЪро░рпНро╡ро░рпНро▓рпЖро╕рпН роОройрпНрокродрпБ роХро┐ро│ро╡рпБроЯро┐ро▓рпН роХрпЛроЯрпБ роЗропроХрпНроХрпБро╡родро▒рпНроХро╛рой рооро┐роХроХрпН роХрпБро▒рпИроирпНрод роЪрпЖро▓ро╡ро╛рой ро╡ро┤ро┐роХро│ро┐ро▓рпН роТройрпНро▒ро╛роХрпБроорпН. роЙродро╛ро░рогрооро╛роХ, роОро┤рпБродрпБроорпН роирпЗро░родрпНродро┐ро▓рпН, роТро░рпБ роХро┐ро│ро╡рпБроЯрпН ро╡ро┤роЩрпНроХрпБроиро░рпН роЙроЩрпНроХро│рпН роЪро░рпНро╡ро░рпНро▓рпЖро╕рпН роЪрпЖропро▓рпНрокро╛роЯрпБроХро│рпН рооро╛родродрпНродро┐ро▒рпНроХрпБ 1,000,000 роорпБро▒рпИ роЗропроХрпНроХрокрпНрокроЯрпБро╡родро▒рпНроХрпБ роорпБройрпН роХроЯрпНроЯрогроорпН ро╡роЪрпВро▓ро┐роХрпНроХро╡ро┐ро▓рпНро▓рпИ, роЕродро▒рпНроХрпБрокрпН рокро┐ро▒роХрпБ 1,000,000 роЪрпЖропро▓рпНрокро╛роЯрпБроХро│рпБроХрпНроХрпБ US$0.20 ро╡роЪрпВро▓ро┐роХрпНроХро┐ро▒ро╛ро░рпН. роЙроЩрпНроХро│рпН роХрпЛроЯрпБ роЗропроХрпНроХрокрпНрокроЯро╛род роирпЗро░родрпНродро┐ро▓рпН, роирпАроЩрпНроХро│рпН рокрогроорпН роЪрпЖро▓рпБродрпНрод ро╡рпЗрогрпНроЯро┐ропродро┐ро▓рпНро▓рпИ.

IoT роЯрпЖро╡ро▓рокрпНрокро░ро╛роХ, роЪро░рпНро╡ро░рпНро▓рпЖро╕рпН роорпБро▒рпИ рооро┐роХро╡рпБроорпН рокрпКро░рпБродрпНродрооро╛ройродрпБ. роЙроЩрпНроХро│рпН роХрпЛроЯрпБ, роХро┐ро│ро╡рпБроЯрпН-ро╣рпЛро╕рпНроЯроЯрпН IoT роЪрпЗро╡рпИроХрпНроХрпБ роЗрогрпИроХрпНроХрокрпНрокроЯрпНроЯ роОроирпНрод IoT роЪро╛родройродрпНродро┐ро▓ро┐ро░рпБроирпНродрпБроорпН роЕройрпБрокрпНрокрокрпНрокроЯрпБроорпН роЪрпЖропрпНродро┐роХро│рпБроХрпНроХрпБ рокродро┐ро▓ро│ро┐роХрпНроХ роЕро┤рпИроХрпНроХрокрпНрокроЯрпБроорпН. роЙроЩрпНроХро│рпН роХрпЛроЯрпБ роЕройрпБрокрпНрокрокрпНрокроЯрпБроорпН роЕройрпИродрпНродрпБ роЪрпЖропрпНродро┐роХро│рпИропрпБроорпН роХрпИропро╛ро│рпБроорпН, роЖройро╛ро▓рпН родрпЗро╡рпИропро╛рой роирпЗро░родрпНродро┐ро▓рпН роороЯрпНроЯрпБроорпЗ роЗропроХрпНроХрокрпНрокроЯрпБроорпН.

тЬЕ роирпАроЩрпНроХро│рпН MQTT роорпВро▓роорпН роЪрпЖропрпНродро┐роХро│рпИ роХрпЗроЯрпНроХрпБроорпН роЪро░рпНро╡ро░рпН роХрпЛроЯро╛роХ роОро┤рпБродро┐роп роХрпЛроЯрпБроХро│рпИ роорпАрогрпНроЯрпБроорпН рокро╛ро░рпБроЩрпНроХро│рпН. роЗродрпБ роХро┐ро│ро╡рпБроЯро┐ро▓рпН роЪро░рпНро╡ро░рпНро▓рпЖро╕рпН роорпВро▓роорпН роОрокрпНрокроЯро┐ роЗропроХрпНроХрокрпНрокроЯрпБроорпН? роЪро░рпНро╡ро░рпНро▓рпЖро╕рпН роХрогро┐ройро┐ роЪрпЖропро▓рпНрокро╛роЯрпНроЯрпИ роЖродро░ро┐роХрпНроХ роХрпЛроЯрпБ роОрокрпНрокроЯро┐ рооро╛ро▒рпНро▒рокрпНрокроЯ ро╡рпЗрогрпНроЯрпБроорпН роОройрпНро▒рпБ роирпАроЩрпНроХро│рпН роиро┐ройрпИроХрпНроХро┐ро▒рпАро░рпНроХро│рпН?

> ЁЯТБ роЪро░рпНро╡ро░рпНро▓рпЖро╕рпН роорпБро▒рпИ, роХрпЛроЯрпБ роЗропроХрпНроХрпБро╡родро▒рпНроХрпБ роХрпВроЯрпБродро▓рпН роХро┐ро│ро╡рпБроЯрпН роЪрпЗро╡рпИроХро│рпБроХрпНроХрпБ роироХро░рпНроХро┐ро▒родрпБ. роЙродро╛ро░рогрооро╛роХ, роХро┐ро│ро╡рпБроЯро┐ро▓рпН роЪро░рпНро╡ро░рпНро▓рпЖро╕рпН родро░ро╡рпБродрпНродрпКроХрпБрокрпНрокрпБроХро│рпН роХро┐роЯрпИроХрпНроХро┐ройрпНро▒рой, роЗродрпБ роТро░рпБ роЪро░рпНро╡ро░рпНро▓рпЖро╕рпН ро╡ро┐ро▓рпИроорпБро▒рпИропрпИрокрпН рокропройрпНрокроЯрпБродрпНродрпБроХро┐ро▒родрпБ, роирпАроЩрпНроХро│рпН родро░ро╡рпБродрпНродрпКроХрпБрокрпНрокро┐ро▓рпН роЪрпЖропрпНропрпБроорпН роТро╡рпНро╡рпКро░рпБ роХрпЛро░ро┐роХрпНроХрпИроХрпНроХрпБроорпН рокрогроорпН роЪрпЖро▓рпБродрпНрод ро╡рпЗрогрпНроЯрпБроорпН, роЙродро╛ро░рогрооро╛роХ роТро░рпБ роХрпЗро│рпНро╡ро┐ роЕро▓рпНро▓родрпБ роЪрпЗро░рпНроХрпНроХрпИ. роХрпЛро░ро┐роХрпНроХрпИропрпИроЪрпН роЪрпЗро╡рпИропро│ро┐роХрпНроХ роЪрпЖропрпНропрокрпНрокроЯрпБроорпН ро╡рпЗро▓рпИ роЕроЯро┐рокрпНрокроЯрпИропро┐ро▓рпН ро╡ро┐ро▓рпИ роиро┐ро░рпНрогропрооро╛роХ роЗро░рпБроХрпНроХрпБроорпН. роЙродро╛ро░рогрооро╛роХ, роТро░рпБ роорпБродройрпНроорпИ ро╡ро┐роЪрпИропрпИ роОродро┐ро░рпНродрпНродрпБ роТро░рпБ ро╡ро░ро┐роЪрпИропрпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБрокрпНрокродрпБ, рокро▓ роЕроЯрпНроЯро╡рогрпИроХро│рпИ роЗрогрпИродрпНродрпБ роЖропро┐ро░роХрпНроХрогроХрпНроХро╛рой ро╡ро░ро┐роЪрпИроХро│рпИродрпН родро┐ро░рпБрокрпНрокрпБроорпН роЪро┐роХрпНроХро▓ро╛рой роЪрпЖропро▓рпНрокро╛роЯрпНроЯрпИ ро╡ро┐роЯ роХрпБро▒рпИро╡ро╛роХ роЪрпЖро▓ро╡ро╛роХрпБроорпН.

## роЪро░рпНро╡ро░рпНро▓рпЖро╕рпН рокропройрпНрокро╛роЯрпНроЯрпИ роЙро░рпБро╡ро╛роХрпНроХрпБроЩрпНроХро│рпН

Microsoft-роЗройрпН роЪро░рпНро╡ро░рпНро▓рпЖро╕рпН роХрогро┐ройро┐ роЪрпЗро╡рпИ Azure Functions роОройрпНро▒рпБ роЕро┤рпИроХрпНроХрокрпНрокроЯрпБроХро┐ро▒родрпБ.

![Azure Functions ро▓рпЛроХрпЛ](../../../../../translated_images/azure-functions-logo.1cfc8e3204c9c44aaf80fcf406fc8544d80d7f00f8d3e8ed6fed764563e17564.ta.png)

роХрпАро┤рпЗ роЙро│рпНро│ роХрпБро▒рпБроХро┐роп ро╡рпАроЯро┐ропрпЛро╡ро┐ро▓рпН Azure Functions рокро▒рпНро▒ро┐роп роТро░рпБ роХрогрпНрогрпЛроЯрпНроЯроорпН роЙро│рпНро│родрпБ:

[![Azure Functions роХрогрпНрогрпЛроЯрпНроЯ ро╡рпАроЯро┐ропрпЛ](https://img.youtube.com/vi/8-jz5f_JyEQ/0.jpg)](https://www.youtube.com/watch?v=8-jz5f_JyEQ)

> ЁЯОе роорпЗро▓рпЗ роЙро│рпНро│ рокроЯродрпНродрпИ роХро┐ро│ро┐роХрпН роЪрпЖропрпНродрпБ ро╡рпАроЯро┐ропрпЛро╡рпИрокрпН рокро╛ро░рпБроЩрпНроХро│рпН.

тЬЕ роТро░рпБ роиро┐рооро┐роЯроорпН роОроЯрпБродрпНродрпБроХрпНроХрпКрогрпНроЯрпБ [Microsoft Azure Functions роЖро╡рогроЩрпНроХро│ро┐ро▓рпН](https://docs.microsoft.com/azure/azure-functions/functions-overview?WT.mc_id=academic-17441-jabenn) Azure Functions рокро▒рпНро▒ро┐роп роХрогрпНрогрпЛроЯрпНроЯродрпНродрпИрокрпН рокроЯро┐роХрпНроХро╡рпБроорпН.

Azure Functions роОро┤рпБрод, роирпАроЩрпНроХро│рпН роЙроЩрпНроХро│рпН ро╡ро┐ро░рпБрокрпНрок роорпКро┤ро┐ропро┐ро▓рпН Azure Functions рокропройрпНрокро╛роЯрпНроЯрпИродрпН родрпКроЯроЩрпНроХ ро╡рпЗрогрпНроЯрпБроорпН. Azure Functions Python, JavaScript, TypeScript, C#, F#, Java рооро▒рпНро▒рпБроорпН Powershell роЖроХро┐ропро╡ро▒рпНро▒рпИ роЖродро░ро┐роХрпНроХро┐ро▒родрпБ. роЗроирпНрод рокро╛роЯродрпНродро┐ро▓рпН Python-роЗро▓рпН Azure Functions рокропройрпНрокро╛роЯрпНроЯрпИ роОро┤рпБродрпБро╡родрпБ роОрокрпНрокроЯро┐ роОройрпНрокродрпИ роирпАроЩрпНроХро│рпН роХро▒рпНро▒рпБроХрпНроХрпКро│рпНро╡рпАро░рпНроХро│рпН.

> ЁЯТБ Azure Functions родройро┐рокрпНрокропройрпН ро╣ро╛рогрпНроЯрпНро▓ро░рпНроХро│рпИропрпБроорпН роЖродро░ро┐роХрпНроХро┐ро▒родрпБ, роОройро╡рпЗ HTTP роХрпЛро░ро┐роХрпНроХрпИроХро│рпИ роЖродро░ро┐роХрпНроХрпБроорпН роОроирпНрод роорпКро┤ро┐ропро┐ро▓рпБроорпН роЙроЩрпНроХро│рпН роЪрпЖропро▓рпНрокро╛роЯрпБроХро│рпИ роОро┤рпБродро▓ро╛роорпН, COBOL рокрпЛройрпНро▒ рокро┤рпИроп роорпКро┤ро┐роХро│рпИропрпБроорпН.

Functions рокропройрпНрокро╛роЯрпБроХро│рпН роТро░рпБ роЕро▓рпНро▓родрпБ роЕродро▒рпНроХрпБ роорпЗро▒рпНрокроЯрпНроЯ *роЯро┐ро░ро┐роХро░рпНроХро│рпИроХрпН* роХрпКрогрпНроЯро┐ро░рпБроХрпНроХрпБроорпН - роиро┐роХро┤рпНро╡рпБроХро│рпБроХрпНроХрпБ рокродро┐ро▓ро│ро┐роХрпНроХрпБроорпН роЪрпЖропро▓рпНрокро╛роЯрпБроХро│рпН. роТро░рпБ Functions рокропройрпНрокро╛роЯрпНроЯро┐ро▓рпН рокро▓ роЯро┐ро░ро┐роХро░рпНроХро│рпН роЗро░рпБроХрпНроХро▓ро╛роорпН, роЕройрпИродрпНродрпБроорпН рокрпКродрпБро╡ро╛рой роХроЯрпНроЯроорпИрокрпНрокрпИрокрпН рокроХро┐ро░рпНроирпНродрпБ роХрпКро│рпНро│рпБроорпН. роЙродро╛ро░рогрооро╛роХ, роЙроЩрпНроХро│рпН Functions рокропройрпНрокро╛роЯрпНроЯро┐ройрпН роХроЯрпНроЯроорпИрокрпНрокрпБ роХрпЛрокрпНрокро┐ро▓рпН роЙроЩрпНроХро│рпН IoT Hub-роЗройрпН роЗрогрпИрокрпНрокрпБ ро╡ро┐ро╡ро░роЩрпНроХро│рпН роЗро░рпБроХрпНроХро▓ро╛роорпН, роорпЗро▓рпБроорпН рокропройрпНрокро╛роЯрпНроЯро┐ро▓рпН роЙро│рпНро│ роЕройрпИродрпНродрпБ роЪрпЖропро▓рпНрокро╛роЯрпБроХро│рпБроорпН роЗродрпИрокрпН рокропройрпНрокроЯрпБродрпНродро┐ роЗрогрпИроирпНродрпБ роиро┐роХро┤рпНро╡рпБроХро│рпИ роХрпЗроЯрпНроХро▓ро╛роорпН.

### рокрогро┐роХро│рпН - Azure Functions роХро░рпБро╡ро┐роХро│рпИ роиро┐ро▒рпБро╡рпБроЩрпНроХро│рпН

> роОро┤рпБродрпБроорпН роирпЗро░родрпНродро┐ро▓рпН, Azure Functions роХрпЛроЯрпБ роХро░рпБро╡ро┐роХро│рпН Apple Silicon-роЗро▓рпН Python родро┐роЯрпНроЯроЩрпНроХро│рпБроЯройрпН роорпБро┤рпБроорпИропро╛роХ ро╡рпЗро▓рпИ роЪрпЖропрпНропро╡ро┐ро▓рпНро▓рпИ. роирпАроЩрпНроХро│рпН Intel роЕроЯро┐рокрпНрокроЯрпИропро┐ро▓ро╛рой Mac, Windows PC роЕро▓рпНро▓родрпБ Linux PC-роР рокропройрпНрокроЯрпБродрпНрод ро╡рпЗрогрпНроЯрпБроорпН.

Azure Functions-роЗройрпН роТро░рпБ роЪро┐ро▒роирпНрод роЕроорпНроЪроорпН, роирпАроЩрпНроХро│рпН роЕро╡ро▒рпНро▒рпИ роЙро│рпНро│рпВро░ро┐ро▓рпН роЗропроХрпНроХ роорпБроЯро┐ропрпБроорпН. роХро┐ро│ро╡рпБроЯро┐ро▓рпН рокропройрпНрокроЯрпБродрпНродрокрпНрокроЯрпБроорпН runtime роЙроЩрпНроХро│рпН роХрогро┐ройро┐ропро┐ро▓рпН роЗропроХрпНроХрокрпНрокроЯро▓ро╛роорпН, роЗродрпБ IoT роЪрпЖропрпНродро┐роХро│рпБроХрпНроХрпБ рокродро┐ро▓ро│ро┐роХрпНроХрпБроорпН роХрпЛроЯрпБроХро│рпИ роОро┤рпБрод роЕройрпБроородро┐роХрпНроХро┐ро▒родрпБ рооро▒рпНро▒рпБроорпН роЕродрпИ роЙро│рпНро│рпВро░ро┐ро▓рпН роЗропроХрпНроХ роорпБроЯро┐ропрпБроорпН. роиро┐роХро┤рпНро╡рпБроХро│рпН роХрпИропро╛ро│рокрпНрокроЯрпБроорпН рокрпЛродрпБ роЙроЩрпНроХро│рпН роХрпЛроЯрпБроХро│рпИ роЯро┐рокроХрпН роЪрпЖропрпНропро╡рпБроорпН роорпБроЯро┐ропрпБроорпН. роЙроЩрпНроХро│рпН роХрпЛроЯрпБ роЪро░ро┐ропро╛роХ роЗро░рпБроХрпНроХрпБроорпНрокрпЛродрпБ, роЕродрпИ роХро┐ро│ро╡рпБроЯро┐ро▓рпН рокро┐ро░роЪрпБро░ро┐роХрпНроХро▓ро╛роорпН.

Azure Functions роХро░рпБро╡ро┐роХро│рпН CLI роЖроХ роХро┐роЯрпИроХрпНроХро┐ройрпНро▒рой, роЗродрпБ Azure Functions Core Tools роОройрпНро▒рпБ роЕро┤рпИроХрпНроХрокрпНрокроЯрпБроХро┐ро▒родрпБ.

1. [Azure Functions Core Tools роЖро╡рогроЩрпНроХро│ро┐ро▓рпН](https://docs.microsoft.com/azure/azure-functions/functions-run-local?WT.mc_id=academic-17441-jabenn) роЙро│рпНро│ ро╡ро┤ро┐роорпБро▒рпИроХро│рпИрокрпН рокро┐ройрпНрокро▒рпНро▒ро┐ Azure Functions Core Tools-роР роиро┐ро▒рпБро╡ро╡рпБроорпН.

1. VS Code-роХрпНроХрпБ Azure Functions роирпАроЯрпНроЯро┐рокрпНрокрпИ роиро┐ро▒рпБро╡ро╡рпБроорпН. роЗроирпНрод роирпАроЯрпНроЯро┐рокрпНрокрпБ Azure Functions роЙро░рпБро╡ро╛роХрпНроХ, роЯро┐рокроХрпН рооро▒рпНро▒рпБроорпН рокро┐ро░роЪрпБро░ро┐роХрпНроХ роЖродро░ро╡рпБ ро╡ро┤роЩрпНроХрпБроХро┐ро▒родрпБ. [Azure Functions роирпАроЯрпНроЯро┐рокрпНрокрпБ роЖро╡рогроЩрпНроХро│ро┐ро▓рпН](https://marketplace.visualstudio.com/items?WT.mc_id=academic-17441-jabenn&itemName=ms-azuretools.vscode-azurefunctions) роЙро│рпНро│ ро╡ро┤ро┐роорпБро▒рпИроХро│рпИрокрпН рокро╛ро░рпНроХрпНроХро╡рпБроорпН.

Azure Functions рокропройрпНрокро╛роЯрпНроЯрпИ роХро┐ро│ро╡рпБроЯро┐ро▓рпН рокро┐ро░роЪрпБро░ро┐роХрпНроХрпБроорпНрокрпЛродрпБ, рокропройрпНрокро╛роЯрпНроЯрпБ роХрпЛрокрпНрокрпБроХро│рпН рооро▒рпНро▒рпБроорпН рокродро┐ро╡рпБ роХрпЛрокрпНрокрпБроХро│рпН рокрпЛройрпНро▒ро╡ро▒рпНро▒рпИ роЪрпЗрооро┐роХрпНроХ роЪро┐ро▒ро┐роп роЕро│ро╡ро┐ро▓ро╛рой роХро┐ро│ро╡рпБроЯрпН роЪрпЗрооро┐рокрпНрокрпБ родрпЗро╡рпИрокрпНрокроЯрпБроорпН. роЙроЩрпНроХро│рпН Functions рокропройрпНрокро╛роЯрпНроЯрпИ роЙро│рпНро│рпВро░ро┐ро▓рпН роЗропроХрпНроХрпБроорпНрокрпЛродрпБ, роирпАроЩрпНроХро│рпН роХро┐ро│ро╡рпБроЯрпН роЪрпЗрооро┐рокрпНрокрпБроЯройрпН роЗрогрпИроХрпНроХ ро╡рпЗрогрпНроЯрпБроорпН, роЖройро╛ро▓рпН роЙрогрпНроорпИропро╛рой роХро┐ро│ро╡рпБроЯрпН роЪрпЗрооро┐рокрпНрокрпИ рокропройрпНрокроЯрпБродрпНродрпБро╡родро▒рпНроХрпБ рокродро┐ро▓ро╛роХ, [Azurite](https://github.com/Azure/Azurite) роОройрпНро▒ роЪрпЗрооро┐рокрпНрокрпБ роОроорпБро▓рпЗроЯрпНроЯро░рпИ рокропройрпНрокроЯрпБродрпНродро▓ро╛роорпН. роЗродрпБ роЙро│рпНро│рпВро░ро┐ро▓рпН роЗропроХрпНроХрокрпНрокроЯрпБроорпН, роЖройро╛ро▓рпН роХро┐ро│ро╡рпБроЯрпН роЪрпЗрооро┐рокрпНрокрпИрокрпН рокрпЛро▓ роЪрпЖропро▓рпНрокроЯрпБроорпН.

> ЁЯОУ Azure-роЗро▓рпН, Azure Functions рокропройрпНрокроЯрпБродрпНродрпБроорпН роЪрпЗрооро┐рокрпНрокрпБ Azure Storage Account роЖроХрпБроорпН. роЗроирпНрод роХрогроХрпНроХрпБроХро│рпН роХрпЛрокрпНрокрпБроХро│рпН, рокрпНро│ро╛рокрпНроХро│рпН, роЕроЯрпНроЯро╡рогрпИроХро│ро┐ро▓рпН родро░ро╡рпБроХро│рпН роЕро▓рпНро▓родрпБ роХро┐ропрпВро╡ро┐ро▓рпН родро░ро╡рпБроХро│рпИ роЪрпЗрооро┐роХрпНроХ роорпБроЯро┐ропрпБроорпН. роирпАроЩрпНроХро│рпН рокро▓ рокропройрпНрокро╛роЯрпБроХро│рпБроХрпНроХрпБ роТро░рпБ роЪрпЗрооро┐рокрпНрокрпБ роХрогроХрпНроХрпИрокрпН рокроХро┐ро░ро▓ро╛роорпН, роЙродро╛ро░рогрооро╛роХ роТро░рпБ Functions рокропройрпНрокро╛роЯрпБ рооро▒рпНро▒рпБроорпН роТро░рпБ ро╡ро▓рпИ рокропройрпНрокро╛роЯрпБ.

1. Azurite роТро░рпБ Node.js рокропройрпНрокро╛роЯро╛роХрпБроорпН, роОройро╡рпЗ роирпАроЩрпНроХро│рпН Node.js-роР роиро┐ро▒рпБро╡ ро╡рпЗрогрпНроЯрпБроорпН. [Node.js роЗрогрпИропродро│родрпНродро┐ро▓рпН](https://nodejs.org/) рокродро┐ро╡ро┐ро▒роХрпНроХроорпН рооро▒рпНро▒рпБроорпН роиро┐ро▒рпБро╡ро▓рпН ро╡ро┤ро┐роорпБро▒рпИроХро│рпИ роирпАроЩрпНроХро│рпН роХро╛рогро▓ро╛роорпН. Mac рокропройрпНрокроЯрпБродрпНродро┐ройро╛ро▓рпН, [Homebrew](https://formulae.brew.sh/formula/node) роорпВро▓роорпН роЕродрпИ роиро┐ро▒рпБро╡ро▓ро╛роорпН.

1. роХрпАро┤рпЗ роЙро│рпНро│ роХроЯрпНроЯро│рпИропрпИрокрпН рокропройрпНрокроЯрпБродрпНродро┐ Azurite-роР роиро┐ро▒рпБро╡ро╡рпБроорпН (`npm` роОройрпНрокродрпБ Node.js-роР роиро┐ро▒рпБро╡рпБроорпНрокрпЛродрпБ роиро┐ро▒рпБро╡рокрпНрокроЯрпБроорпН роТро░рпБ роХро░рпБро╡ро┐):

    ```sh
    npm install -g azurite
    ```

1. Azurite родро░ро╡рпБроХро│рпИ роЪрпЗрооро┐роХрпНроХ рокропройрпНрокроЯрпБродрпНрод роТро░рпБ `azurite` роОройрпНро▒ роХрпЛрокрпНрокрпБро▒рпИропрпИ роЙро░рпБро╡ро╛роХрпНроХро╡рпБроорпН:

    ```sh
    mkdir azurite
    ```

1. Azurite-роР роЗропроХрпНроХро┐, роЗроирпНрод рокрпБродро┐роп роХрпЛрокрпНрокрпБро▒рпИропрпИроЪрпН роЪрпЖро▓рпБродрпНродро╡рпБроорпН:

    ```sh
    azurite --location azurite
    ```

    Azurite роЪрпЗрооро┐рокрпНрокрпБ роОроорпБро▓рпЗроЯрпНроЯро░рпН родрпКроЯроЩрпНроХрпБроорпН рооро▒рпНро▒рпБроорпН роЙро│рпНро│рпВро░рпН Functions runtime роЗрогрпИроХрпНроХ родропро╛ро░ро╛роХ роЗро░рпБроХрпНроХрпБроорпН.

    ```output
    тЮЬ  ~ azurite --location azurite  
    Azurite Blob service is starting at http://127.0.0.1:10000
    Azurite Blob service is successfully listening at http://127.0.0.1:10000
    Azurite Queue service is starting at http://127.0.0.1:10001
    Azurite Queue service is successfully listening at http://127.0.0.1:10001
    Azurite Table service is starting at http://127.0.0.1:10002
    Azurite Table service is successfully listening at http://127.0.0.1:10002
    ```

### рокрогро┐роХро│рпН - Azure Functions родро┐роЯрпНроЯродрпНродрпИ роЙро░рпБро╡ро╛роХрпНроХрпБроЩрпНроХро│рпН

Azure Functions CLI рокрпБродро┐роп Functions рокропройрпНрокро╛роЯрпНроЯрпИ роЙро░рпБро╡ро╛роХрпНроХ рокропройрпНрокроЯрпБродрпНродрокрпНрокроЯро▓ро╛роорпН.

1. роЙроЩрпНроХро│рпН Functions рокропройрпНрокро╛роЯрпНроЯро┐ро▒рпНроХро╛рой роТро░рпБ роХрпЛрокрпНрокрпБро▒рпИропрпИ роЙро░рпБро╡ро╛роХрпНроХро┐ роЕродро┐ро▓рпН роЪрпЖро▓рпНро▓ро╡рпБроорпН. роЗродро▒рпНроХрпБ `soil-moisture-trigger` роОройрпНро▒рпБ рокрпЖропро░ро┐роЯро╡рпБроорпН.

    ```sh
    mkdir soil-moisture-trigger
    cd soil-moisture-trigger
    ```

1. Python роорпЖропрпНроиро┐роХро░рпН роЪрпВро┤ро▓рпИ роЗроирпНрод роХрпЛрокрпНрокрпБро▒рпИропро┐ро▓рпН роЙро░рпБро╡ро╛роХрпНроХро╡рпБроорпН:

    ```sh
    python3 -m venv .venv
    ```

1. роорпЖропрпНроиро┐роХро░рпН роЪрпВро┤ро▓рпИ роЪрпЖропро▓рпНрокроЯрпБродрпНродро╡рпБроорпН:

    * Windows-ро▓рпН:
        * роирпАроЩрпНроХро│рпН Command Prompt роЕро▓рпНро▓родрпБ Windows Terminal ро╡ро┤ро┐ропро╛роХ Command Prompt рокропройрпНрокроЯрпБродрпНродро┐ройро╛ро▓рпН, роХрпАро┤рпЗ роЙро│рпНро│родрпИ роЗропроХрпНроХро╡рпБроорпН:

            ```cmd
            .venv\Scripts\activate.bat
            ```

        * PowerShell рокропройрпНрокроЯрпБродрпНродро┐ройро╛ро▓рпН, роХрпАро┤рпЗ роЙро│рпНро│родрпИ роЗропроХрпНроХро╡рпБроорпН:

            ```powershell
            .\.venv\Scripts\Activate.ps1
            ```

    * macOS роЕро▓рпНро▓родрпБ Linux-ро▓рпН, роХрпАро┤рпЗ роЙро│рпНро│родрпИ роЗропроХрпНроХро╡рпБроорпН:

        ```cmd
        source ./.venv/bin/activate
        ```

    > ЁЯТБ роЗроирпНрод роХроЯрпНроЯро│рпИроХро│рпН роирпАроЩрпНроХро│рпН роорпЖропрпНроиро┐роХро░рпН роЪрпВро┤ро▓рпИ роЙро░рпБро╡ро╛роХрпНроХро┐роп роЗроЯродрпНродро┐ро▓ро┐ро░рпБроирпНродрпБ роЗропроХрпНроХрокрпНрокроЯ ро╡рпЗрогрпНроЯрпБроорпН. `.venv` роХрпЛрокрпНрокрпБро▒рпИроХрпНроХрпБ роирпАроЩрпНроХро│рпН роЪрпЖро▓рпНро▓ ро╡рпЗрогрпНроЯро┐ропродро┐ро▓рпНро▓рпИ; роирпАроЩрпНроХро│рпН роорпЖропрпНроиро┐роХро░рпН роЪрпВро┤ро▓рпИ роЪрпЖропро▓рпНрокроЯрпБродрпНродрпБроорпН роХроЯрпНроЯро│рпИропрпИ роЗропроХрпНроХ ро╡рпЗрогрпНроЯрпБроорпН.

1. Functions рокропройрпНрокро╛роЯрпНроЯрпИ роЗроирпНрод роХрпЛрокрпНрокрпБро▒рпИропро┐ро▓рпН роЙро░рпБро╡ро╛роХрпНроХ роХрпАро┤рпЗ роЙро│рпНро│ роХроЯрпНроЯро│рпИропрпИ роЗропроХрпНроХро╡рпБроорпН:

    ```sh
    func init --worker-runtime python soil-moisture-trigger
    ```

    роЗродрпБ родро▒рпНрокрпЛродрпИроп роХрпЛрокрпНрокрпБро▒рпИропро┐ро▓рпН роорпВройрпНро▒рпБ роХрпЛрокрпНрокрпБроХро│рпИ роЙро░рпБро╡ро╛роХрпНроХрпБроорпН:

    * `host.json` - роЗроирпНрод JSON роЖро╡рогроорпН роЙроЩрпНроХро│рпН Functions рокропройрпНрокро╛роЯрпНроЯро┐ро▒рпНроХро╛рой роЕроорпИрокрпНрокрпБроХро│рпИ роХрпКрогрпНроЯрпБро│рпНро│родрпБ. роЗроирпНрод роЕроорпИрокрпНрокрпБроХро│рпИ роирпАроЩрпНроХро│рпН рооро╛ро▒рпНро▒ ро╡рпЗрогрпНроЯро┐ропродро┐ро▓рпНро▓рпИ.
    * `local.settings.json` - роЗроирпНрод JSON роЖро╡рогроорпН роЙроЩрпНроХро│рпН рокропройрпНрокро╛роЯрпБ роЙро│рпНро│рпВро░ро┐ро▓рпН роЗропроХрпНроХрокрпНрокроЯрпБроорпН рокрпЛродрпБ рокропройрпНрокроЯрпБродрпНродрпБроорпН роЕроорпИрокрпНрокрпБроХро│рпИ роХрпКрогрпНроЯрпБро│рпНро│родрпБ, роЙродро╛ро░рогрооро╛роХ роЙроЩрпНроХро│рпН IoT Hub-роХрпНроХрпБ роЗрогрпИрокрпНрокрпБ роЪро░роЩрпНроХро│рпН. роЗроирпНрод роЕроорпИрокрпНрокрпБроХро│рпН роЙро│рпНро│рпВро░рпН роороЯрпНроЯрпБроорпЗ, роорпЗро▓рпБроорпН роорпВро▓роХрпН роХрпЛроЯро┐ро▓рпН роЪрпЗро░рпНроХрпНроХрокрпНрокроЯроХрпНроХрпВроЯро╛родрпБ. рокропройрпНрокро╛роЯрпНроЯрпИ роХро┐ро│ро╡рпБроЯро┐ро▓рпН рокро┐ро░роЪрпБро░ро┐роХрпНроХрпБроорпНрокрпЛродрпБ, роЗроирпНрод роЕроорпИрокрпНрокрпБроХро│рпН рокро┐ро░роЪрпБро░ро┐роХрпНроХрокрпНрокроЯро╛родрпБ; рокродро┐ро▓ро╛роХ роЙроЩрпНроХро│рпН роЕроорпИрокрпНрокрпБроХро│рпН рокропройрпНрокро╛роЯрпНроЯрпБ роЕроорпИрокрпНрокрпБроХро│ро┐ро▓рпН роЗро░рпБроирпНродрпБ роПро▒рпНро▒рокрпНрокроЯрпБроорпН. роЗродрпБ роЗроирпНрод рокро╛роЯродрпНродро┐ро▓рпН рокро┐ройрпНройро░рпН роХро╡ро░рокрпНрокроЯрпБроорпН.
    * `requirements.txt` - роЗродрпБ [Pip родрпЗро╡рпИроХро│рпН роХрпЛрокрпНрокрпБ](https://pip.pypa.io/en/stable/user_guide/#requirements-files) роЖроХрпБроорпН, роЗродрпБ роЙроЩрпНроХро│рпН Functions рокропройрпНрокро╛роЯрпНроЯрпИ роЗропроХрпНроХ родрпЗро╡рпИропро╛рой Pip родрпКроХрпБрокрпНрокрпБроХро│рпИ роХрпКрогрпНроЯрпБро│рпНро│родрпБ.

1. Functions рокропройрпНрокро╛роЯрпБ рокропройрпНрокроЯрпБродрпНродрпБроорпН роЪрпЗрооро┐рокрпНрокрпБ роХрогроХрпНроХро┐ро▒рпНроХро╛рой роЕроорпИрокрпНрокрпБ `local.settings.json` роХрпЛрокрпНрокро┐ро▓рпН роЙро│рпНро│родрпБ. роЗродрпБ роХро╛ро▓ро┐ропро╛роХ роЗро░рпБроХрпНроХрпБроорпН, роОройро╡рпЗ роЕроорпИроХрпНроХ ро╡рпЗрогрпНроЯрпБроорпН. Azurite роЙро│рпНро│рпВро░рпН роЪрпЗрооро┐рокрпНрокрпБ роОроорпБро▓рпЗроЯрпНроЯро░рпБроЯройрпН роЗрогрпИроХрпНроХ, роЗроирпНрод роородро┐рокрпНрокрпИ роХрпАро┤рпЗ роЙро│рпНро│ро╡ро╛ро▒рпБ роЕроорпИроХрпНроХро╡рпБроорпН:

    ```json
    "AzureWebJobsStorage": "UseDevelopmentStorage=true",
    ```

1. родрпЗро╡рпИропро╛рой Pip родрпКроХрпБрокрпНрокрпБроХро│рпИ родрпЗро╡рпИроХро│рпН роХрпЛрокрпНрокрпИрокрпН рокропройрпНрокроЯрпБродрпНродро┐ роиро┐ро▒рпБро╡ро╡рпБроорпН:

    ```sh
    pip install -r requirements.txt
    ```

    > ЁЯТБ родрпЗро╡рпИропро╛рой Pip родрпКроХрпБрокрпНрокрпБроХро│рпН роЗроирпНрод роХрпЛрокрпНрокро┐ро▓рпН роЗро░рпБроХрпНроХ ро╡рпЗрогрпНроЯрпБроорпН, роОройро╡рпЗ Functions рокропройрпНрокро╛роЯрпНроЯрпИ роХро┐ро│ро╡рпБроЯро┐ро▓рпН рокро┐ро░роЪрпБро░ро┐роХрпНроХрпБроорпНрокрпЛродрпБ, runtime роЪро░ро┐ропро╛рой родрпКроХрпБрокрпНрокрпБроХро│рпИ роиро┐ро▒рпБро╡рпБро╡родрпИ роЙро▒рпБродро┐рокрпНрокроЯрпБродрпНрод роорпБроЯро┐ропрпБроорпН.

1. роОро▓рпНро▓ро╛роорпН роЪро░ро┐ропро╛роХ ро╡рпЗро▓рпИ роЪрпЖропрпНроХро┐ро▒родрпБ роОройрпНрокродрпИ роЪрпЛродро┐роХрпНроХ, Functions runtime-роР родрпКроЯроЩрпНроХро▓ро╛роорпН. роЗродрпИ роЪрпЖропрпНроп роХрпАро┤рпЗ роЙро│рпНро│ роХроЯрпНроЯро│рпИропрпИ роЗропроХрпНроХро╡рпБроорпН:

    ```sh
    func start
    ```

    runtime родрпКроЯроЩрпНроХрпБроорпН рооро▒рпНро▒рпБроорпН роОроирпНрод ро╡рпЗро▓рпИ роЪрпЖропро▓рпНрокро╛роЯрпБроХро│рпИропрпБроорпН (роЯро┐ро░ро┐роХро░рпНроХро│рпН) роХрогрпНроЯро▒ро┐ропро╡ро┐ро▓рпНро▓рпИ роОройрпНро▒рпБ родрпЖро░ро┐ро╡ро┐роХрпНроХрпБроорпН.

    ```output
    (.venv) тЮЬ  soil-moisture-trigger func start
    Found Python version 3.9.1 (python3).
    
    Azure Functions Core Tools
    Core Tools Version:       3.0.3442 Commit hash: 6bfab24b2743f8421475d996402c398d2fe4a9e0  (64-bit)
    Function Runtime Version: 3.0.15417.0
    
    [2021-05-05T01:24:46.795Z] No job functions found.
    ```

    > тЪая╕П Firewall роЕро▒ро┐ро╡ро┐рокрпНрокрпБ ро╡роирпНродро╛ро▓рпН, `func` рокропройрпНрокро╛роЯрпНроЯро┐ро▒рпНроХрпБ роЙроЩрпНроХро│рпН роирпЖроЯрпНро╡рпКро░рпНроХрпНроХро┐ро▓рпН рокроЯро┐роХрпНроХ рооро▒рпНро▒рпБроорпН роОро┤рпБрод роЕройрпБроородро┐ роЕро│ро┐роХрпНроХ ро╡рпЗрогрпНроЯрпБроорпН.

    > тЪая╕П macOS рокропройрпНрокроЯрпБродрпНродро┐ройро╛ро▓рпН, ро╡рпЖро│ро┐ропрпАроЯрпНроЯро┐ро▓рпН роОроЪрпНроЪро░ро┐роХрпНроХрпИроХро│рпН роЗро░рпБроХрпНроХро▓ро╛роорпН:
    >
    > ```output
    > (.venv) тЮЬ  soil-moisture-trigger func start
    > Found Python version 3.9.1 (python3).
    >
    > Azure Functions Core Tools
    > Core Tools Version:       3.0.3442 Commit hash: 6bfab24b2743f8421475d996402c398d2fe4a9e0  (64-bit)
    > Function Runtime Version: 3.0.15417.0
    >
    > [2021-06-16T08:18:28.315Z] Cannot create directory for shared memory usage: /dev/shm/AzureFunctions
    > [2021-06-16T08:18:28.316Z] System.IO.FileSystem: Access to the path '/dev/shm/AzureFunctions' is denied. Operation not permitted.
    > [2021-06-16T08:18:30.361Z] No job functions found.
    > ```
    >
    > Functions рокропройрпНрокро╛роЯрпБ роЪро░ро┐ропро╛роХ родрпКроЯроЩрпНроХрпБроорпН рооро▒рпНро▒рпБроорпН роЪрпЖропро▓рпНрокроЯрпБроорпН роЪрпЖропро▓рпНрокро╛роЯрпБроХро│рпИ рокроЯрпНроЯро┐ропро▓ро┐роЯрпБроорпН ро╡ро░рпИ роЗродрпИ роирпАроЩрпНроХро│рпН рокрпБро▒роХрпНроХрогро┐роХрпНроХро▓ро╛роорпН.

1. `ctrl+c` роЕро┤рпБродрпНродро┐ Functions рокропройрпНрокро╛роЯрпНроЯрпИ роиро┐ро▒рпБродрпНродро╡рпБроорпН.

1. родро▒рпНрокрпЛродрпИроп роХрпЛрокрпНрокрпБро▒рпИропрпИ VS Code-ро▓рпН родро┐ро▒роХрпНроХро╡рпБроорпН, VS Code-роР родро┐ро▒роирпНродрпБ роЗроирпНрод роХрпЛрокрпНрокрпБро▒рпИропрпИродрпН родро┐ро▒роХрпНроХро╡рпБроорпН роЕро▓рпНро▓родрпБ роХрпАро┤рпЗ роЙро│рпНро│ роХроЯрпНроЯро│рпИропрпИ роЗропроХрпНроХро╡рпБроорпН:

    ```sh
    code .
    ```

VS Code роЙроЩрпНроХро│рпН Functions родро┐роЯрпНроЯродрпНродрпИ роХрогрпНроЯро▒ро┐роирпНродрпБ, роХрпАро┤рпЗ роЙро│рпНро│ роЕро▒ро┐ро╡ро┐рокрпНрокрпИ роХро╛роЯрпНроЯрпБроорпН:

    ```output
    Detected an Azure Functions Project in folder "soil-moisture-trigger" that may have been created outside of
    VS Code. Initialize for optimal use with VS Code?
    ```

![роЕро▒ро┐ро╡ро┐рокрпНрокрпБ](../../../../../translated_images/vscode-azure-functions-init-notification.bd19b49229963edb5311fb3a79445ea469424759d2917ee2f2eb6f92d65d5086.ta.png)

**Yes** роОройрпНрокродрпИ родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН.

1. Python virtual environment VS Code terminal-ро▓рпН роЗропроЩрпНроХрпБроХро┐ро▒родро╛ роОройрпНрокродрпИ роЙро▒рпБродро┐рокрпНрокроЯрпБродрпНродро╡рпБроорпН. родрпЗро╡рпИропро╛ройро╛ро▓рпН роЕродрпИ роиро┐ро▒рпБродрпНродро┐ роорпАрогрпНроЯрпБроорпН родрпКроЯроЩрпНроХро╡рпБроорпН.

## IoT Hub роиро┐роХро┤рпНро╡рпБ роЯро┐ро░ро┐роХро░рпИ роЙро░рпБро╡ро╛роХрпНроХро╡рпБроорпН

Functions app роОройрпНрокродрпБ роЙроЩрпНроХро│рпН serverless code-роХрпНроХрпБ роТро░рпБ shell роЖроХрпБроорпН. IoT Hub роиро┐роХро┤рпНро╡рпБроХро│рпБроХрпНроХрпБ рокродро┐ро▓ро│ро┐роХрпНроХ, роирпАроЩрпНроХро│рпН роЗроирпНрод app-роХрпНроХрпБ роТро░рпБ IoT Hub роЯро┐ро░ро┐роХро░рпИ роЪрпЗро░рпНроХрпНроХро▓ро╛роорпН. роЗроирпНрод роЯро┐ро░ро┐роХро░рпН IoT Hub-роХрпНроХрпБ роЕройрпБрокрпНрокрокрпНрокроЯрпБроорпН роЪрпЖропрпНродро┐роХро│ро┐ройрпН ро╕рпНроЯрпНро░рпАроорпБроЯройрпН роЗрогрпИроХрпНроХро╡рпБроорпН, роЕро╡ро▒рпНро▒рпБроХрпНроХрпБ рокродро┐ро▓ро│ро┐роХрпНроХро╡рпБроорпН ро╡рпЗрогрпНроЯрпБроорпН. роЗроирпНрод роЪрпЖропрпНродро┐роХро│ро┐ройрпН ро╕рпНроЯрпНро░рпАроорпИрокрпН рокрпЖро▒, роЙроЩрпНроХро│рпН роЯро┐ро░ро┐роХро░рпН IoT Hub-роХро│ро┐ройрпН *event hub compatible endpoint*-роХрпНроХрпБ роЗрогрпИроХрпНроХ ро╡рпЗрогрпНроЯрпБроорпН.

IoT Hub роОройрпНрокродрпБ Azure Event Hubs роОройрокрпНрокроЯрпБроорпН рооро▒рпНро▒рпКро░рпБ Azure роЪрпЗро╡рпИропрпИ роЕроЯро┐рокрпНрокроЯрпИропро╛роХроХрпН роХрпКрогрпНроЯродрпБ. Event Hubs роОройрпНрокродрпБ роЪрпЖропрпНродро┐роХро│рпИ роЕройрпБрокрпНрокро╡рпБроорпН, рокрпЖро▒ро╡рпБроорпН роЙродро╡рпБроорпН роТро░рпБ роЪрпЗро╡рпИропро╛роХрпБроорпН, IoT Hub роЗродрпИ IoT роЪро╛родройроЩрпНроХро│рпБроХрпНроХро╛рой роЕроорпНроЪроЩрпНроХро│рпИроЪрпН роЪрпЗро░рпНроХрпНроХ ро╡ро┐ро░ро┐ро╡ро╛роХрпНроХрпБроХро┐ро▒родрпБ. IoT Hub-ро▓рпН роЗро░рпБроирпНродрпБ роЪрпЖропрпНродро┐роХро│рпИрокрпН рокроЯро┐роХрпНроХ роирпАроЩрпНроХро│рпН роЗрогрпИроХрпНроХрпБроорпН роорпБро▒рпИ Event Hubs-роРрокрпН рокропройрпНрокроЯрпБродрпНродрпБроорпН роорпБро▒рпИ рокрпЛро▓ро╡рпЗ роЗро░рпБроХрпНроХрпБроорпН.

тЬЕ роЖро░ро╛ропрпНроЪрпНроЪро┐ роЪрпЖропрпНропро╡рпБроорпН: [Azure Event Hubs documentation](https://docs.microsoft.com/azure/event-hubs/event-hubs-about?WT.mc_id=academic-17441-jabenn) роЗро▓рпН Event Hubs рокро▒рпНро▒ро┐роп роорпЗро▓рпЛроЯрпНроЯродрпНродрпИ рокроЯро┐роХрпНроХро╡рпБроорпН. роЕроЯро┐рокрпНрокроЯрпИ роЕроорпНроЪроЩрпНроХро│рпН IoT Hub-роХрпНроХрпБ роОрокрпНрокроЯро┐ роТрокрпНрокро┐роЯрокрпНрокроЯрпБроХро┐ройрпНро▒рой?

IoT роЪро╛родройроорпН IoT Hub-роХрпНроХрпБ роЗрогрпИроХрпНроХ, роЕройрпБроородро┐роХрпНроХрокрпНрокроЯрпНроЯ роЪро╛родройроЩрпНроХро│рпН роороЯрпНроЯрпБроорпЗ роЗрогрпИроХрпНроХ роорпБроЯро┐ропрпБроорпН роОройрпНрокродрпИ роЙро▒рпБродро┐рокрпНрокроЯрпБродрпНродрпБроорпН роТро░рпБ ро░роХроЪро┐роп ро╡ро┐роЪрпИропрпИ рокропройрпНрокроЯрпБродрпНрод ро╡рпЗрогрпНроЯрпБроорпН. роЪрпЖропрпНродро┐роХро│рпИрокрпН рокроЯро┐роХрпНроХ роЗрогрпИроХрпНроХрпБроорпН рокрпЛродрпБ роХрпВроЯ роЗродрпЗ рокрпКро░рпБроирпНродрпБроорпН; роЙроЩрпНроХро│рпН code-роХрпНроХрпБ IoT Hub рокро▒рпНро▒ро┐роп ро╡ро┐ро╡ро░роЩрпНроХро│рпБроЯройрпН роТро░рпБ ро░роХроЪро┐роп ро╡ро┐роЪрпИропрпИ роХрпКрогрпНроЯ роТро░рпБ connection string родрпЗро╡рпИрокрпНрокроЯрпБроорпН.

> ЁЯТБ роирпАроЩрпНроХро│рпН рокрпЖро▒рпБроорпН роЗропро▓рпНрокро╛рой connection string-роХрпНроХрпБ **iothubowner** роЕройрпБроородро┐роХро│рпН роЙро│рпНро│рой, роЗродрпБ роЕродрпИ рокропройрпНрокроЯрпБродрпНродрпБроорпН роОроирпНрод code-роХрпНроХрпБроорпН IoT Hub-ро▓рпН роорпБро┤рпБ роЕройрпБроородро┐роХро│рпИ ро╡ро┤роЩрпНроХрпБроХро┐ро▒родрпБ. роЪро╛родрпНродро┐ропрооро╛рой роХрпБро▒рпИроирпНрод роЕро│ро╡ро┐ро▓ро╛рой роЕройрпБроородро┐роХро│рпБроЯройрпН роЗрогрпИроХрпНроХ ро╡рпЗрогрпНроЯрпБроорпН. роЗродрпБ роЕроЯрпБродрпНрод рокро╛роЯродрпНродро┐ро▓рпН роХро▒рпНро▒рпБроХрпНроХрпКро│рпНро│рокрпНрокроЯрпБроорпН.

роЙроЩрпНроХро│рпН роЯро┐ро░ро┐роХро░рпН роЗрогрпИроХрпНроХрокрпНрокроЯрпНроЯро╡рпБроЯройрпН, IoT Hub-роХрпНроХрпБ роЕройрпБрокрпНрокрокрпНрокроЯрпБроорпН роТро╡рпНро╡рпКро░рпБ роЪрпЖропрпНродро┐роХрпНроХрпБроорпН function роЙро│рпНро│ code роЕро┤рпИроХрпНроХрокрпНрокроЯрпБроорпН, роОроирпНрод роЪро╛родройроорпН роЕройрпБрокрпНрокро┐ропродрпБ роОройрпНро▒ро╛ро▓рпБроорпН. роЯро┐ро░ро┐роХро░рпН роЪрпЖропрпНродро┐ропрпИ роТро░рпБ parameter роЖроХ роЕройрпБрокрпНрокрпБроорпН.

### Task - Event Hub compatible endpoint connection string рокрпЖро▒ро╡рпБроорпН

1. IoT Hub-роХро│ро┐ройрпН Event Hub compatible endpoint-роХрпНроХрпБ connection string рокрпЖро▒, VS Code terminal-ро▓рпН роХрпАро┤рпЗ роЙро│рпНро│ роХроЯрпНроЯро│рпИропрпИ роЗропроХрпНроХро╡рпБроорпН:

    ```sh
    az iot hub connection-string show --default-eventhub \
                                      --output table \
                                      --hub-name <hub_name>
    ```

`<hub_name>` роР роЙроЩрпНроХро│рпН IoT Hub-роХрпНроХрпБ роирпАроЩрпНроХро│рпН рокропройрпНрокроЯрпБродрпНродро┐роп рокрпЖропро░рпБроЯройрпН рооро╛ро▒рпНро▒ро╡рпБроорпН.

1. VS Code-ро▓рпН, `local.settings.json` роХрпЛрокрпНрокрпИ родро┐ро▒роХрпНроХро╡рпБроорпН. `Values` рокро┐ро░ро┐ро╡ро┐ро▓рпН роХрпАро┤рпЗ роЙро│рпНро│ роХрпВроЯрпБродро▓рпН роородро┐рокрпНрокрпИроЪрпН роЪрпЗро░рпНроХрпНроХро╡рпБроорпН:

    ```json
    "IOT_HUB_CONNECTION_STRING": "<connection string>"
    ```

`<connection string>` роР роорпБроирпНродрпИроп рокроЯро┐ропро┐ро▓рпН роЗро░рпБроирпНродрпБ рокрпЖро▒рокрпНрокроЯрпНроЯ роородро┐рокрпНрокрпБроЯройрпН рооро╛ро▒рпНро▒ро╡рпБроорпН. роЗродрпБ роЪрпЖро▓рпНро▓рпБрокроЯро┐ропро╛роХрпБроорпН JSON роЖроХ роЗро░рпБроХрпНроХ, роорпЗро▓рпЗ роЙро│рпНро│ ро╡ро░ро┐роХрпНроХрпБ рокро┐ройрпН роТро░рпБ роХрооро╛ро╡рпИроЪрпН роЪрпЗро░рпНроХрпНроХ ро╡рпЗрогрпНроЯрпБроорпН.

### Task - роиро┐роХро┤рпНро╡рпБ роЯро┐ро░ро┐роХро░рпИ роЙро░рпБро╡ро╛роХрпНроХро╡рпБроорпН

роЗрокрпНрокрпЛродрпБ роирпАроЩрпНроХро│рпН роиро┐роХро┤рпНро╡рпБ роЯро┐ро░ро┐роХро░рпИ роЙро░рпБро╡ро╛роХрпНроХ родропро╛ро░ро╛роХ роЙро│рпНро│рпАро░рпНроХро│рпН.

1. `soil-moisture-trigger` роХрпЛрокрпНрокроХродрпНродро┐ро▒рпНроХрпБро│рпН роЗро░рпБроирпНродрпБ VS Code terminal-ро▓рпН роХрпАро┤рпЗ роЙро│рпНро│ роХроЯрпНроЯро│рпИропрпИ роЗропроХрпНроХро╡рпБроорпН:

    ```sh
    func new --name iot-hub-trigger --template "Azure Event Hub trigger"
    ```

роЗродрпБ `iot-hub-trigger` роОройрокрпНрокроЯрпБроорпН рокрпБродро┐роп Function-роР роЙро░рпБро╡ро╛роХрпНроХрпБроХро┐ро▒родрпБ. роЯро┐ро░ро┐роХро░рпН IoT Hub-ро▓рпН Event Hub compatible endpoint-роХрпНроХрпБ роЗрогрпИроХрпНроХрокрпНрокроЯрпБроорпН, роОройро╡рпЗ роирпАроЩрпНроХро│рпН Event Hub роЯро┐ро░ро┐роХро░рпИрокрпН рокропройрпНрокроЯрпБродрпНродро▓ро╛роорпН. роХрпБро▒ро┐рокрпНрокро╛роХ IoT Hub роЯро┐ро░ро┐роХро░рпН роЗро▓рпНро▓рпИ.

роЗродрпБ `soil-moisture-trigger` роХрпЛрокрпНрокроХродрпНродро┐ро▒рпНроХрпБро│рпН `iot-hub-trigger` роОройрокрпНрокроЯрпБроорпН роТро░рпБ роХрпЛрокрпНрокроХродрпНродрпИ роЙро░рпБро╡ро╛роХрпНроХрпБроорпН, роЗродрпБ роЗроирпНрод function-роР роХрпКрогрпНроЯро┐ро░рпБроХрпНроХрпБроорпН. роЗроирпНрод роХрпЛрокрпНрокроХродрпНродро┐ро▓рпН роХрпАро┤рпЗ роЙро│рпНро│ роХрпЛрокрпНрокрпБроХро│рпН роЗро░рпБроХрпНроХрпБроорпН:

* `__init__.py` - роЗродрпБ роЯро┐ро░ро┐роХро░рпИ роХрпКрогрпНроЯ Python code роХрпЛрокрпНрокро╛роХрпБроорпН, Python module роЖроХ роЗроирпНрод роХрпЛрокрпНрокроХродрпНродрпИ рооро╛ро▒рпНро▒ Python роХрпЛрокрпНрокрпБ рокрпЖропро░рпН рооро░рокрпИ рокропройрпНрокроЯрпБродрпНродрпБроХро┐ро▒родрпБ.

    роЗроирпНрод роХрпЛрокрпНрокро┐ро▓рпН роХрпАро┤рпЗ роЙро│рпНро│ code роЗро░рпБроХрпНроХрпБроорпН:

    ```python
    import logging

    import azure.functions as func


    def main(event: func.EventHubEvent):
        logging.info('Python EventHub trigger processed an event: %s',
                    event.get_body().decode('utf-8'))
    ```

    роЯро┐ро░ро┐роХро░ро┐ройрпН роорпИропроорпН `main` function роЖроХрпБроорпН. IoT Hub-ро▓рпН роЗро░рпБроирпНродрпБ роиро┐роХро┤рпНро╡рпБроХро│рпБроЯройрпН роЗроирпНрод function роЕро┤рпИроХрпНроХрокрпНрокроЯрпБроорпН. роЗроирпНрод function-роХрпНроХрпБ `event` роОройрокрпНрокроЯрпБроорпН роТро░рпБ parameter роЙро│рпНро│родрпБ, роЗродрпБ `EventHubEvent` роЖроХрпБроорпН. IoT Hub-роХрпНроХрпБ роТро╡рпНро╡рпКро░рпБ роЪрпЖропрпНродро┐ропрпБроорпН роЕройрпБрокрпНрокрокрпНрокроЯрпБроорпН рокрпЛродрпБ, роЗроирпНрод function `event` роОройрпБроорпН parameter-роЖроХ роЕроирпНрод роЪрпЖропрпНродро┐ропрпИ роЕройрпБрокрпНрокрпБроорпН, рооро▒рпНро▒рпБроорпН роорпБроирпНродрпИроп рокро╛роЯродрпНродро┐ро▓рпН роирпАроЩрпНроХро│рпН рокро╛ро░рпНродрпНрод annotations рокрпЛройрпНро▒ рокрогрпНрокрпБроХро│рпИ роЕройрпБрокрпНрокрпБроорпН.

    роЗроирпНрод function-ройрпН роорпИропроорпН роиро┐роХро┤рпНро╡рпИ рокродро┐ро╡рпБ роЪрпЖропрпНроХро┐ро▒родрпБ.

* `function.json` - роЗродрпБ роЯро┐ро░ро┐роХро░рпБроХрпНроХро╛рой configuration-роР роХрпКрогрпНроЯрпБро│рпНро│родрпБ. роорпБроХрпНроХро┐роп configuration `bindings` роОройрокрпНрокроЯрпБроорпН рокро┐ро░ро┐ро╡ро┐ро▓рпН роЙро│рпНро│родрпБ. Azure Functions рооро▒рпНро▒рпБроорпН рокро┐ро▒ Azure роЪрпЗро╡рпИроХро│рпБроХрпНроХрпБ роЗроЯрпИропро┐ро▓ро╛рой роЗрогрпИрокрпНрокрпБроХрпНроХрпБ binding роОройрокрпНрокроЯрпБроорпН. роЗроирпНрод function-роХрпНроХрпБ Event Hub-роХрпНроХрпБ роТро░рпБ input binding роЙро│рпНро│родрпБ - роЗродрпБ Event Hub-роХрпНроХрпБ роЗрогрпИроХрпНроХро┐ро▒родрпБ рооро▒рпНро▒рпБроорпН родро░ро╡рпБроХро│рпИрокрпН рокрпЖро▒рпБроХро┐ро▒родрпБ.

    > ЁЯТБ роирпАроЩрпНроХро│рпН output bindings-роР роХрпВроЯ ро╡рпИродрпНродро┐ро░рпБроХрпНроХро▓ро╛роорпН, роОройро╡рпЗ function-ройрпН output рооро▒рпНро▒рпКро░рпБ роЪрпЗро╡рпИроХрпНроХрпБ роЕройрпБрокрпНрокрокрпНрокроЯрпБроорпН. роЙродро╛ро░рогрооро╛роХ, роирпАроЩрпНроХро│рпН роТро░рпБ database-роХрпНроХрпБ output binding-роР роЪрпЗро░рпНродрпНродрпБ, IoT Hub роиро┐роХро┤рпНро╡рпИ function-ро▓рпН роЗро░рпБроирпНродрпБ родро┐ро░рпБрокрпНрокро┐ роЕройрпБрокрпНрокро▓ро╛роорпН, роЗродрпБ database-ро▓рпН родро╛ройро╛роХ роЪрпЗро░рпНроХрпНроХрокрпНрокроЯрпБроорпН.

    `bindings` рокро┐ро░ро┐ро╡ро┐ро▓рпН binding-роХрпНроХро╛рой configuration роЕроЯроЩрпНроХрпБроорпН. роорпБроХрпНроХро┐ропрооро╛рой роородро┐рокрпНрокрпБроХро│рпН:

  * `"type": "eventHubTrigger"` - роЗродрпБ function-роХрпНроХрпБ Event Hub-ро▓рпН роЗро░рпБроирпНродрпБ роиро┐роХро┤рпНро╡рпБроХро│рпИ роХрпЗроЯрпНроХ ро╡рпЗрогрпНроЯрпБроорпН роОройрпНрокродрпИроЪрпН роЪрпКро▓рпНроХро┐ро▒родрпБ
  * `"name": "events"` - роЗродрпБ Event Hub роиро┐роХро┤рпНро╡рпБроХро│рпБроХрпНроХрпБ рокропройрпНрокроЯрпБродрпНрод ро╡рпЗрогрпНроЯро┐роп parameter рокрпЖропро░рпН. Python code-ро▓рпН роЙро│рпНро│ `main` function-ро▓рпН роЙро│рпНро│ parameter рокрпЖропро░рпБроЯройрпН роЗродрпБ рокрпКро░рпБроирпНродрпБроХро┐ро▒родрпБ.
  * `"direction": "in"` - роЗродрпБ роТро░рпБ input binding, Event Hub-ро▓рпН роЗро░рпБроирпНродрпБ родро░ро╡рпБ function-роХрпНроХрпБ ро╡ро░рпБроХро┐ро▒родрпБ
  * `"connection": ""` - роЗродрпБ connection string-роР рокроЯро┐роХрпНроХ settings-ро▓рпН роЙро│рпНро│ рокрпЖропро░рпИ ро╡ро░рпИропро▒рпБроХрпНроХро┐ро▒родрпБ. роЙро│рпНро│рпВро░рпН роорпБро▒рпИропро┐ро▓рпН роЗропроХрпНроХрпБроорпНрокрпЛродрпБ, роЗродрпБ `local.settings.json` роХрпЛрокрпНрокро┐ро▓рпН роЗро░рпБроирпНродрпБ роЗроирпНрод settings-роР рокроЯро┐роХрпНроХрпБроорпН.

    > ЁЯТБ connection string `function.json` роХрпЛрокрпНрокро┐ро▓рпН роЪрпЗрооро┐роХрпНроХ роорпБроЯро┐ропро╛родрпБ, роЗродрпБ settings-ро▓рпН роЗро░рпБроирпНродрпБ рокроЯро┐роХрпНроХ ро╡рпЗрогрпНроЯрпБроорпН. роЗродрпБ роЙроЩрпНроХро│рпН connection string-роР родро╡ро▒рпБродро▓ро╛роХ ро╡рпЖро│ро┐рокрпНрокроЯрпБродрпНродрпБро╡родрпИродрпН родроЯрпБроХрпНроХро┐ро▒родрпБ.

1. [Azure Functions template-ро▓рпН роЙро│рпНро│ рокро┐ро┤рпИ](https://github.com/Azure/azure-functions-templates/issues/1250) роХро╛ро░рогрооро╛роХ, `function.json`-ро▓рпН `cardinality` рокрпБро▓родрпНродро┐ро▒рпНроХрпБ родро╡ро▒ро╛рой роородро┐рокрпНрокрпБ роЙро│рпНро│родрпБ. роЗроирпНрод рокрпБро▓родрпНродрпИ `many`-роЗро▓рпН роЗро░рпБроирпНродрпБ `one`-роХрпНроХрпБ рооро╛ро▒рпНро▒ро╡рпБроорпН:

    ```json
    "cardinality": "one",
    ```

1. `function.json` роХрпЛрокрпНрокро┐ро▓рпН `"connection"`-ройрпН роородро┐рокрпНрокрпИ `local.settings.json` роХрпЛрокрпНрокро┐ро▓рпН роирпАроЩрпНроХро│рпН роЪрпЗро░рпНродрпНрод рокрпБродро┐роп роородро┐рокрпНрокрпИроЪрпН роЪрпБроЯрпНроЯро┐роХрпНроХро╛роЯрпНроЯрпБроорпН ро╡роХрпИропро┐ро▓рпН рокрпБродрпБрокрпНрокро┐роХрпНроХро╡рпБроорпН:

    ```json
    "connection": "IOT_HUB_CONNECTION_STRING",
    ```

    > ЁЯТБ роиро┐ройрпИро╡ро┐ро▓рпН роХрпКро│рпНро│ро╡рпБроорпН - роЗродрпБ settings-роР роЪрпБроЯрпНроЯро┐роХрпНроХро╛роЯрпНроЯ ро╡рпЗрогрпНроЯрпБроорпН, connection string-роР роЙро│рпНро│роЯроХрпНроХроХрпНроХрпВроЯро╛родрпБ.

1. Connection string `eventHubName` роородро┐рокрпНрокрпИ роХрпКрогрпНроЯрпБро│рпНро│родрпБ, роОройро╡рпЗ `function.json` роХрпЛрокрпНрокро┐ро▓рпН роЗродро▒рпНроХро╛рой роородро┐рокрпНрокрпБ роХро╛ро▓ро┐ропро╛роХ роЗро░рпБроХрпНроХ ро╡рпЗрогрпНроЯрпБроорпН. роЗроирпНрод роородро┐рокрпНрокрпИ роХро╛ро▓ро┐ропро╛роХ рооро╛ро▒рпНро▒ро╡рпБроорпН:

    ```json
    "eventHubName": "",
    ```

### Task - роиро┐роХро┤рпНро╡рпБ роЯро┐ро░ро┐роХро░рпИ роЗропроХрпНроХро╡рпБроорпН

1. IoT Hub роиро┐роХро┤рпНро╡рпБ рооро╛ройро┐роЯрпНроЯро░рпИ роЗропроХрпНроХро╡ро┐ро▓рпНро▓рпИ роОройрпНрокродрпИ роЙро▒рпБродро┐рокрпНрокроЯрпБродрпНродро╡рпБроорпН. Functions app рооро▒рпНро▒рпБроорпН роиро┐роХро┤рпНро╡рпБ рооро╛ройро┐роЯрпНроЯро░рпН роТро░рпЗ роирпЗро░родрпНродро┐ро▓рпН роЗропроЩрпНроХро┐ройро╛ро▓рпН, Functions app роЗрогрпИроХрпНроХ роорпБроЯро┐ропро╛родрпБ рооро▒рпНро▒рпБроорпН роиро┐роХро┤рпНро╡рпБроХро│рпИрокрпН рокропройрпНрокроЯрпБродрпНрод роорпБроЯро┐ропро╛родрпБ.

    > ЁЯТБ рокро▓ app-роХро│рпН IoT Hub endpoint-роХро│рпБроХрпНроХрпБ *consumer groups* рокропройрпНрокроЯрпБродрпНродро┐ роЗрогрпИроХрпНроХ роорпБроЯро┐ропрпБроорпН. роЗро╡рпИ роЕроЯрпБродрпНрод рокро╛роЯродрпНродро┐ро▓рпН роХро▒рпНро▒рпБроХрпНроХрпКро│рпНро│рокрпНрокроЯрпБроорпН.

1. Functions app-роР роЗропроХрпНроХ, VS Code terminal-ро▓рпН роХрпАро┤рпЗ роЙро│рпНро│ роХроЯрпНроЯро│рпИропрпИ роЗропроХрпНроХро╡рпБроорпН:

    ```sh
    func start
    ```

    Functions app родрпКроЯроЩрпНроХрпБроорпН, рооро▒рпНро▒рпБроорпН `iot-hub-trigger` function-роР роХрогрпНроЯро▒ро┐ропрпБроорпН. роЗродрпБ роХроЯроирпНрод роТро░рпБ роиро╛ро│ро┐ро▓рпН IoT Hub-роХрпНроХрпБ роПро▒рпНроХройро╡рпЗ роЕройрпБрокрпНрокрокрпНрокроЯрпНроЯ роОроирпНрод роиро┐роХро┤рпНро╡рпБроХро│рпИропрпБроорпН роЪрпЖропро▓рпНрокроЯрпБродрпНродрпБроорпН.

@@CODE_BLOCK-25@@
    роТро╡рпНро╡рпКро░рпБ function роЕро┤рпИрокрпНрокрпБроорпН `Executing 'Functions.iot-hub-trigger'`/`Executed 'Functions.iot-hub-trigger'` роОройрпБроорпН output-ро▓рпН роЪрпБро▒рпНро▒ро┐ роЗро░рпБроХрпНроХрпБроорпН, роОройро╡рпЗ роТро╡рпНро╡рпКро░рпБ function роЕро┤рпИрокрпНрокро┐ро▓рпБроорпН роОродрпНродройрпИ роЪрпЖропрпНродро┐роХро│рпН роЪрпЖропро▓рпНрокроЯрпБродрпНродрокрпНрокроЯрпНроЯрой роОройрпНрокродрпИ роирпАроЩрпНроХро│рпН роХро╛рогро▓ро╛роорпН.

1. роЙроЩрпНроХро│рпН IoT роЪро╛родройроорпН роЗропроЩрпНроХрпБроХро┐ро▒родро╛ роОройрпНрокродрпИ роЙро▒рпБродро┐рокрпНрокроЯрпБродрпНродро╡рпБроорпН. Functions app-ро▓рпН рокрпБродро┐роп роорогрпН роИро░рокрпНрокродроорпН роЪрпЖропрпНродро┐роХро│рпИ роирпАроЩрпНроХро│рпН роХро╛рогро▓ро╛роорпН.

1. Functions app-роР роиро┐ро▒рпБродрпНродро┐ роорпАрогрпНроЯрпБроорпН родрпКроЯроЩрпНроХро╡рпБроорпН. роЗродрпБ роорпБроирпНродрпИроп роЪрпЖропрпНродро┐роХро│рпИ роорпАрогрпНроЯрпБроорпН роЪрпЖропро▓рпНрокроЯрпБродрпНродро╛родрпБ, рокрпБродро┐роп роЪрпЖропрпНродро┐роХро│рпИ роороЯрпНроЯрпБроорпЗ роЪрпЖропро▓рпНрокроЯрпБродрпНродрпБроорпН.

> ЁЯТБ VS Code роЙроЩрпНроХро│рпН Functions-роР debugging-роР роЖродро░ро┐роХрпНроХро┐ро▒родрпБ. роТро╡рпНро╡рпКро░рпБ code ро╡ро░ро┐ропро┐ройрпН родрпКроЯроХрпНроХродрпНродро┐ро▓рпН click роЪрпЖропрпНродрпБ роЕро▓рпНро▓родрпБ code ро╡ро░ро┐ропро┐ро▓рпН cursor ро╡рпИродрпНродрпБ *Run -> Toggle breakpoint* родрпЗро░рпНроирпНродрпЖроЯрпБродрпНродрпБ роЕро▓рпНро▓родрпБ `F9` роЕро┤рпБродрпНродро┐ break points роЕроорпИроХрпНроХро▓ро╛роорпН. Debugger-роР родрпКроЯроЩрпНроХ *Run -> Start debugging* родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН, `F5` роЕро┤рпБродрпНродро╡рпБроорпН, роЕро▓рпНро▓родрпБ *Run and debug* pane-роРродрпН родрпЗро░рпНроирпНродрпЖроЯрпБродрпНродрпБ **Start debugging** рокрпКродрпНродро╛ройрпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН. роЗродройро╛ро▓рпН роЪрпЖропро▓рпНрокроЯрпБродрпНродрокрпНрокроЯрпБроорпН роиро┐роХро┤рпНро╡рпБроХро│ро┐ройрпН ро╡ро┐ро╡ро░роЩрпНроХро│рпИ роирпАроЩрпНроХро│рпН роХро╛рогро▓ро╛роорпН.

#### Troubleshooting

* роирпАроЩрпНроХро│рпН роХрпАро┤рпЗ роЙро│рпНро│ рокро┐ро┤рпИропрпИрокрпН рокрпЖро▒ро┐ройро╛ро▓рпН:

    ```output
    The listener for function 'Functions.iot-hub-trigger' was unable to start. Microsoft.WindowsAzure.Storage: Connection refused. System.Net.Http: Connection refused. System.Private.CoreLib: Connection refused.
    ```

    Azurite роЗропроЩрпНроХрпБроХро┐ро▒родро╛, рооро▒рпНро▒рпБроорпН `local.settings.json` роХрпЛрокрпНрокро┐ро▓рпН `AzureWebJobsStorage`-роР `UseDevelopmentStorage=true` роОрой роЕроорпИродрпНродрпБро│рпНро│рпАро░рпНроХро│ро╛ роОройрпНрокродрпИроЪрпН роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН.

* роирпАроЩрпНроХро│рпН роХрпАро┤рпЗ роЙро│рпНро│ рокро┐ро┤рпИропрпИрокрпН рокрпЖро▒ро┐ройро╛ро▓рпН:

    ```output
    System.Private.CoreLib: Exception while executing function: Functions.iot-hub-trigger. System.Private.CoreLib: Result: Failure Exception: AttributeError: 'list' object has no attribute 'get_body'
    ```

    `function.json` роХрпЛрокрпНрокро┐ро▓рпН `cardinality`-роР `one` роОрой роЕроорпИродрпНродрпБро│рпНро│рпАро░рпНроХро│ро╛ роОройрпНрокродрпИроЪрпН роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН.

* роирпАроЩрпНроХро│рпН роХрпАро┤рпЗ роЙро│рпНро│ рокро┐ро┤рпИропрпИрокрпН рокрпЖро▒ро┐ройро╛ро▓рпН:

    ```output
    Azure.Messaging.EventHubs: The path to an Event Hub may be specified as part of the connection string or as a separate value, but not both.  Please verify that your connection string does not have the `EntityPath` token if you are passing an explicit Event Hub name. (Parameter 'connectionString').
    ```

    `function.json` роХрпЛрокрпНрокро┐ро▓рпН `eventHubName`-роР роХро╛ро▓ро┐ропро╛роХ роЕроорпИродрпНродрпБро│рпНро│рпАро░рпНроХро│ро╛ роОройрпНрокродрпИроЪрпН роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН.

## Serverless code-ро▓рпН роЗро░рпБроирпНродрпБ роирпЗро░роЯро┐ роорпБро▒рпИ роХрпЛро░ро┐роХрпНроХрпИроХро│рпИ роЕройрпБрокрпНрокро╡рпБроорпН

роЗрокрпНрокрпЛродрпБ роЙроЩрпНроХро│рпН Functions app Event Hub compatible endpoint-роРрокрпН рокропройрпНрокроЯрпБродрпНродро┐ IoT Hub-ро▓рпН роЗро░рпБроирпНродрпБ роЪрпЖропрпНродро┐роХро│рпИ роХрпЗроЯрпНроХро┐ро▒родрпБ. роирпАроЩрпНроХро│рпН IoT роЪро╛родройроЩрпНроХро│рпБроХрпНроХрпБ роХроЯрпНроЯро│рпИроХро│рпИ роЕройрпБрокрпНрок ро╡рпЗрогрпНроЯрпБроорпН. роЗродрпБ IoT Hub-роХрпНроХрпБ *Registry Manager* ро╡ро┤ро┐ропро╛роХ роТро░рпБ ро╡рпЗро▒рпБрокроЯрпНроЯ роЗрогрпИрокрпНрокрпИрокрпН рокропройрпНрокроЯрпБродрпНродро┐ роЪрпЖропрпНропрокрпНрокроЯрпБроХро┐ро▒родрпБ. Registry Manager роОройрпНрокродрпБ IoT Hub-роХрпНроХрпБ роОроирпНрод роЪро╛родройроЩрпНроХро│рпН рокродро┐ро╡рпБ роЪрпЖропрпНропрокрпНрокроЯрпНроЯрпБро│рпНро│рой роОройрпНрокродрпИрокрпН рокро╛ро░рпНроХрпНроХро╡рпБроорпН, cloud-роЗро▓рпН роЗро░рпБроирпНродрпБ роЪро╛родройроЩрпНроХро│рпБроХрпНроХрпБ роЪрпЖропрпНродро┐роХро│рпИ роЕройрпБрокрпНрокро╡рпБроорпН, роирпЗро░роЯро┐ роорпБро▒рпИ роХрпЛро░ро┐роХрпНроХрпИроХро│рпИ роЕройрпБрокрпНрокро╡рпБроорпН роЕро▓рпНро▓родрпБ device twin-роР рокрпБродрпБрокрпНрокро┐роХрпНроХро╡рпБроорпН роЙродро╡рпБроорпН роТро░рпБ роХро░рпБро╡ро┐ропро╛роХрпБроорпН. роЗродрпИ IoT Hub-ро▓рпН IoT роЪро╛родройроЩрпНроХро│рпИ рокродро┐ро╡рпБ роЪрпЖропрпНроп, рокрпБродрпБрокрпНрокро┐роХрпНроХ роЕро▓рпНро▓родрпБ роирпАроХрпНроХро╡рпБроорпН рокропройрпНрокроЯрпБродрпНродро▓ро╛роорпН.

Registry Manager-роХрпНроХрпБ роЗрогрпИроХрпНроХ, connection string родрпЗро╡рпИрокрпНрокроЯрпБроорпН.

### Task - Registry Manager connection string рокрпЖро▒ро╡рпБроорпН

1. Connection string рокрпЖро▒, роХрпАро┤рпЗ роЙро│рпНро│ роХроЯрпНроЯро│рпИропрпИ роЗропроХрпНроХро╡рпБроорпН:

    ```sh
    az iot hub connection-string show --policy-name service \
                                      --output table \
                                      --hub-name <hub_name>
    ```

    `<hub_name>` роР роЙроЩрпНроХро│рпН IoT Hub-роХрпНроХрпБ роирпАроЩрпНроХро│рпН рокропройрпНрокроЯрпБродрпНродро┐роп рокрпЖропро░рпБроЯройрпН рооро╛ро▒рпНро▒ро╡рпБроорпН.

    Connection string *ServiceConnect* роХрпКро│рпНроХрпИроХрпНроХро╛ройродрпБ `--policy-name service` parameter-роРрокрпН рокропройрпНрокроЯрпБродрпНродро┐ роХрпЛро░рокрпНрокроЯрпБроХро┐ро▒родрпБ. Connection string-роР роирпАроЩрпНроХро│рпН роХрпЛро░рпБроорпНрокрпЛродрпБ, роЕроирпНрод connection string роОроирпНрод роЕройрпБроородро┐роХро│рпИ ро╡ро┤роЩрпНроХрпБроорпН роОройрпНрокродрпИ роирпАроЩрпНроХро│рпН роХрпБро▒ро┐рокрпНрокро┐роЯро▓ро╛роорпН. ServiceConnect роХрпКро│рпНроХрпИ роЙроЩрпНроХро│рпН code-роХрпНроХрпБ IoT роЪро╛родройроЩрпНроХро│рпБроХрпНроХрпБ роЗрогрпИроХрпНроХро╡рпБроорпН, роЪрпЖропрпНродро┐роХро│рпИ роЕройрпБрокрпНрокро╡рпБроорпН роЕройрпБроородро┐роХрпНроХро┐ро▒родрпБ.

    тЬЕ роЖро░ро╛ропрпНроЪрпНроЪро┐ роЪрпЖропрпНропро╡рпБроорпН: [IoT Hub permissions documentation](https://docs.microsoft.com/azure/iot-hub/iot-hub-devguide-security#iot-hub-permissions?WT.mc_id=academic-17441-jabenn) роЗро▓рпН рокро▓рпНро╡рпЗро▒рпБ роХрпКро│рпНроХрпИроХро│рпИрокрпН рокро▒рпНро▒ро┐ рокроЯро┐роХрпНроХро╡рпБроорпН.

1. VS Code-ро▓рпН, `local.settings.json` роХрпЛрокрпНрокрпИ родро┐ро▒роХрпНроХро╡рпБроорпН. `Values` рокро┐ро░ро┐ро╡ро┐ро▓рпН роХрпАро┤рпЗ роЙро│рпНро│ роХрпВроЯрпБродро▓рпН роородро┐рокрпНрокрпИроЪрпН роЪрпЗро░рпНроХрпНроХро╡рпБроорпН:

    ```json
    "REGISTRY_MANAGER_CONNECTION_STRING": "<connection string>"
    ```

    `<connection string>` роР роорпБроирпНродрпИроп рокроЯро┐ропро┐ро▓рпН роЗро░рпБроирпНродрпБ рокрпЖро▒рокрпНрокроЯрпНроЯ роородро┐рокрпНрокрпБроЯройрпН рооро╛ро▒рпНро▒ро╡рпБроорпН. роЗродрпБ роЪрпЖро▓рпНро▓рпБрокроЯро┐ропро╛роХрпБроорпН JSON роЖроХ роЗро░рпБроХрпНроХ, роорпЗро▓рпЗ роЙро│рпНро│ ро╡ро░ро┐роХрпНроХрпБ рокро┐ройрпН роТро░рпБ роХрооро╛ро╡рпИроЪрпН роЪрпЗро░рпНроХрпНроХ ро╡рпЗрогрпНроЯрпБроорпН.

### Task - роЪро╛родройродрпНродро┐ро▒рпНроХрпБ роирпЗро░роЯро┐ роорпБро▒рпИ роХрпЛро░ро┐роХрпНроХрпИропрпИ роЕройрпБрокрпНрокро╡рпБроорпН

1. Registry Manager-роХрпНроХрпБ SDK роТро░рпБ Pip package ро╡ро┤ро┐ропро╛роХ роХро┐роЯрпИроХрпНроХро┐ро▒родрпБ. `requirements.txt` роХрпЛрокрпНрокро┐ро▓рпН роХрпАро┤рпЗ роЙро│рпНро│ ро╡ро░ро┐ропрпИроЪрпН роЪрпЗро░рпНродрпНродрпБ роЗроирпНрод package-роХрпНроХрпБ dependency-роРроЪрпН роЪрпЗро░рпНроХрпНроХро╡рпБроорпН:

    ```sh
    azure-iot-hub
    ```

1. VS Code terminal-ро▓рпН virtual environment роЪрпЖропро▓рпНрокроЯрпБродрпНродрокрпНрокроЯрпНроЯрпБро│рпНро│родро╛ роОройрпНрокродрпИ роЙро▒рпБродро┐рокрпНрокроЯрпБродрпНродро┐, Pip packages-роР роиро┐ро▒рпБро╡ роХрпАро┤рпЗ роЙро│рпНро│ роХроЯрпНроЯро│рпИропрпИ роЗропроХрпНроХро╡рпБроорпН:

    ```sh
    pip install -r requirements.txt
    ```

1. `__init__.py` роХрпЛрокрпНрокро┐ро▓рпН роХрпАро┤рпЗ роЙро│рпНро│ imports-роРроЪрпН роЪрпЗро░рпНроХрпНроХро╡рпБроорпН:

    ```python
    import json
    import os
    from azure.iot.hub import IoTHubRegistryManager
    from azure.iot.hub.models import CloudToDeviceMethod
    ```

    роЗродрпБ роЪро┐ро▓ system libraries-роР, Registry Manager-роР рооро▒рпНро▒рпБроорпН роирпЗро░роЯро┐ роорпБро▒рпИ роХрпЛро░ро┐роХрпНроХрпИроХро│рпИ роЕройрпБрокрпНрок libraries-роР import роЪрпЖропрпНроХро┐ро▒родрпБ.

1. `main` method-роЗройрпН роЙро│рпНро│рпЗ роЙро│рпНро│ code-роР роирпАроХрпНроХро╡рпБроорпН, роЖройро╛ро▓рпН method-роР ро╡рпИродрпНродро┐ро░рпБроХрпНроХро╡рпБроорпН.

1. `main` method-роЗро▓рпН роХрпАро┤рпЗ роЙро│рпНро│ code-роРроЪрпН роЪрпЗро░рпНроХрпНроХро╡рпБроорпН:

    ```python
    body = json.loads(event.get_body().decode('utf-8'))
    device_id = event.iothub_metadata['connection-device-id']

    logging.info(f'Received message: {body} from {device_id}')
    ```

    роЗроирпНрод code IoT роЪро╛родройроорпН роЕройрпБрокрпНрокро┐роп JSON роЪрпЖропрпНродро┐ропрпИ event body-роЗро▓рпН роЗро░рпБроирпНродрпБ роОроЯрпБроХрпНроХро┐ро▒родрпБ.

    роЗродрпБ annotations-ро▓рпН роЗро░рпБроирпНродрпБ роЪро╛родрой ID-роР рокрпЖро▒рпБроХро┐ро▒родрпБ. Event body-роЗро▓рпН роЪро╛родройроорпН роЕройрпБрокрпНрокро┐роп родроХро╡ро▓рпНроХро│рпН роЙро│рпНро│рой, `iothub_metadata` dictionary IoT Hub-ро▓рпН роЕроорпИроХрпНроХрокрпНрокроЯрпНроЯ рокрогрпНрокрпБроХро│рпИ роХрпКрогрпНроЯрпБро│рпНро│родрпБ, роЙродро╛ро░рогрооро╛роХ роЕройрпБрокрпНрокро┐роп роЪро╛родрой ID рооро▒рпНро▒рпБроорпН роЪрпЖропрпНродро┐ роЕройрпБрокрпНрокрокрпНрокроЯрпНроЯ роирпЗро░роорпН.

    роЗроирпНрод родроХро╡ро▓рпН рокродро┐ро╡рпБ роЪрпЖропрпНропрокрпНрокроЯрпБроХро┐ро▒родрпБ. Functions app-роР роЙро│рпНро│рпВро░рпН роорпБро▒рпИропро┐ро▓рпН роЗропроХрпНроХрпБроорпНрокрпЛродрпБ роЗроирпНрод рокродро┐ро╡рпБ terminal-ро▓рпН роХро╛рогрокрпНрокроЯрпБроорпН.

1. роЗродро▒рпНроХрпБ роХрпАро┤рпЗ, роХрпАро┤рпЗ роЙро│рпНро│ code-роРроЪрпН роЪрпЗро░рпНроХрпНроХро╡рпБроорпН:

    ```python
    soil_moisture = body['soil_moisture']

    if soil_moisture > 450:
        direct_method = CloudToDeviceMethod(method_name='relay_on', payload='{}')
    else:
        direct_method = CloudToDeviceMethod(method_name='relay_off', payload='{}')
    ```

    роЗроирпНрод code роЪрпЖропрпНродро┐ропро┐ро▓рпН роЗро░рпБроирпНродрпБ роорогрпН роИро░рокрпНрокродродрпНродрпИ рокрпЖро▒рпБроХро┐ро▒родрпБ. роЕродройрпН роородро┐рокрпНрокрпИроЪрпН роЪро░ро┐рокро╛ро░рпНродрпНродрпБ, `relay_on` роЕро▓рпНро▓родрпБ `relay_off` роирпЗро░роЯро┐ роорпБро▒рпИ роХрпЛро░ро┐роХрпНроХрпИроХрпНроХро╛рой роЙродро╡ро┐роХрпНроХро░рпБро╡ро┐ропрпИ роЙро░рпБро╡ро╛роХрпНроХрпБроХро┐ро▒родрпБ. Method request-роХрпНроХрпБ payload родрпЗро╡рпИропро┐ро▓рпНро▓рпИ, роОройро╡рпЗ роХро╛ро▓ро┐ропро╛рой JSON роЖро╡рогроорпН роЕройрпБрокрпНрокрокрпНрокроЯрпБроХро┐ро▒родрпБ.

1. роЗродро▒рпНроХрпБ роХрпАро┤рпЗ, роХрпАро┤рпЗ роЙро│рпНро│ code-роРроЪрпН роЪрпЗро░рпНроХрпНроХро╡рпБроорпН:

    ```python
    logging.info(f'Sending direct method request for {direct_method.method_name} for device {device_id}')

    registry_manager_connection_string = os.environ['REGISTRY_MANAGER_CONNECTION_STRING']
    registry_manager = IoTHubRegistryManager(registry_manager_connection_string)
    ```

    роЗроирпНрод code `local.settings.json` роХрпЛрокрпНрокро┐ро▓рпН роЗро░рпБроирпНродрпБ `REGISTRY_MANAGER_CONNECTION_STRING`-роР роПро▒рпНро▒рпБроХро┐ро▒родрпБ. роЗроирпНрод роХрпЛрокрпНрокро┐ро▓рпН роЙро│рпНро│ роородро┐рокрпНрокрпБроХро│рпН роЪрпВро┤ро▓рпН рооро╛ро▒ро┐роХро│рпН (environment variables) роЖроХ роХро┐роЯрпИроХрпНроХро┐ройрпНро▒рой, рооро▒рпНро▒рпБроорпН `os.environ` function-роРрокрпН рокропройрпНрокроЯрпБродрпНродро┐ рокроЯро┐роХрпНроХро▓ро╛роорпН, роЗродрпБ роЕройрпИродрпНродрпБ роЪрпВро┤ро▓рпН рооро╛ро▒ро┐роХро│ро┐ройрпН dictionary-роР родро┐ро░рпБрокрпНрокрпБроХро┐ро▒родрпБ.

    > ЁЯТБ роЗроирпНрод code cloud-роЗро▓рпН deploy роЪрпЖропрпНропрокрпНрокроЯрпБроорпН рокрпЛродрпБ, `local.settings.json` роХрпЛрокрпНрокро┐ро▓рпН роЙро│рпНро│ роородро┐рокрпНрокрпБроХро│рпН *Application Settings* роЖроХ роЕроорпИроХрпНроХрокрпНрокроЯрпБроорпН, рооро▒рпНро▒рпБроорпН роЗро╡рпИ роЪрпВро┤ро▓рпН рооро╛ро▒ро┐роХро│ро┐ро▓ро┐ро░рпБроирпНродрпБ рокроЯро┐роХрпНроХрокрпНрокроЯрпБроорпН.

    роЗроирпНрод code connection string-роРрокрпН рокропройрпНрокроЯрпБродрпНродро┐ Registry Manager роЙродро╡ро┐роХрпНроХро░рпБро╡ро┐ропро┐ройрпН instance-роР роЙро░рпБро╡ро╛роХрпНроХрпБроХро┐ро▒родрпБ.

1. роЗродро▒рпНроХрпБ роХрпАро┤рпЗ, роХрпАро┤рпЗ роЙро│рпНро│ code-роРроЪрпН роЪрпЗро░рпНроХрпНроХро╡рпБроорпН:

    ```python
    registry_manager.invoke_device_method(device_id, direct_method)

    logging.info('Direct method request sent!')
    ```

    роЗроирпНрод code Registry Manager-роР IoT роЪро╛родройроорпН роЕройрпБрокрпНрокро┐роп родроХро╡ро▓рпБроХрпНроХрпБ роирпЗро░роЯро┐ роорпБро▒рпИ роХрпЛро░ро┐роХрпНроХрпИропрпИ роЕройрпБрокрпНрокроЪрпН роЪрпКро▓рпНроХро┐ро▒родрпБ.
> ЁЯТБ роирпАроЩрпНроХро│рпН роорпБроирпНродрпИроп рокро╛роЯроЩрпНроХро│ро┐ро▓рпН MQTT рокропройрпНрокроЯрпБродрпНродро┐ роЙро░рпБро╡ро╛роХрпНроХро┐роп роЪрпЖропро▓ро┐ропро┐ройрпН рокродро┐рокрпНрокрпБроХро│ро┐ро▓рпН, ро░ро┐ро▓рпЗ роХроЯрпНроЯрпБрокрпНрокро╛роЯрпНроЯрпБ роХроЯрпНроЯро│рпИроХро│рпН роЕройрпИродрпНродрпБ роЪро╛родройроЩрпНроХро│рпБроХрпНроХрпБроорпН роЕройрпБрокрпНрокрокрпНрокроЯрпНроЯрой. роХрпБро▒ро┐ропрпАроЯрпБ роирпАроЩрпНроХро│рпН роТро░рпБ роЪро╛родройродрпНродрпИ роороЯрпНроЯрпБроорпЗ ро╡рпИродрпНродро┐ро░рпБрокрпНрокрпАро░рпНроХро│рпН роОройрпНро▒рпБ роХро░рпБродро┐ропродрпБ. роЗроирпНрод рокродро┐рокрпНрокрпБ роТро░рпБ роЪро╛родройродрпНродро┐ро▒рпНроХрпБ роороЯрпНроЯрпБроорпЗ роорпБро▒рпИ роХрпЛро░ро┐роХрпНроХрпИропрпИ роЕройрпБрокрпНрокрпБроХро┐ро▒родрпБ, роОройро╡рпЗ роирпАроЩрпНроХро│рпН рокро▓ роорогрпН роИро░рокрпНрокродроорпН роЪрпЖройрпНроЪро╛ро░рпНроХро│рпН рооро▒рпНро▒рпБроорпН ро░ро┐ро▓рпЗ роЕроорпИрокрпНрокрпБроХро│рпИ ро╡рпИродрпНродро┐ро░рпБроирпНродро╛ро▓рпН, роЪро░ро┐ропро╛рой роирпЗро░роЯро┐ роорпБро▒рпИ роХрпЛро░ро┐роХрпНроХрпИропрпИ роЪро░ро┐ропро╛рой роЪро╛родройродрпНродро┐ро▒рпНроХрпБ роЕройрпБрокрпНрок роЗродрпБ ро╡рпЗро▓рпИ роЪрпЖропрпНропрпБроорпН.

1. Functions роЪрпЖропро▓ро┐ропрпИ роЗропроХрпНроХро╡рпБроорпН, роЙроЩрпНроХро│рпН IoT роЪро╛родройроорпН родро░ро╡рпБроХро│рпИ роЕройрпБрокрпНрокрпБроХро┐ро▒родро╛ роОройрпНрокродрпИ роЙро▒рпБродро┐рокрпНрокроЯрпБродрпНродро╡рпБроорпН. роЪрпЖропрпНродро┐роХро│рпН роЪрпЖропро▓ро╛роХрпНроХрокрпНрокроЯрпБро╡родрпИропрпБроорпН роирпЗро░роЯро┐ роорпБро▒рпИ роХрпЛро░ро┐роХрпНроХрпИроХро│рпН роЕройрпБрокрпНрокрокрпНрокроЯрпБро╡родрпИропрпБроорпН роирпАроЩрпНроХро│рпН роХро╛рогро▓ро╛роорпН. роорогрпН роИро░рокрпНрокродроорпН роЪрпЖройрпНроЪро╛ро░рпИ роорогрпНрогро┐ро▓рпН роЙро│рпНро│рпЗ рооро▒рпНро▒рпБроорпН ро╡рпЖро│ро┐ропрпЗ роироХро░рпНродрпНродро┐ роородро┐рокрпНрокрпБроХро│рпН рооро╛ро▒рпБро╡родрпИропрпБроорпН ро░ро┐ро▓рпЗ роЖройрпН рооро▒рпНро▒рпБроорпН роЖроГрокрпН роЖроХрпБро╡родрпИропрпБроорпН роХро╛рогро▓ро╛роорпН.

> ЁЯТБ роЗроирпНрод роХрпБро▒ро┐ропрпАроЯрпНроЯрпИ [code/functions](../../../../../2-farm/lessons/5-migrate-application-to-the-cloud/code/functions) роХрпЛрокрпНрокрпБро▒рпИропро┐ро▓рпН роХро╛рогро▓ро╛роорпН.

## роЙроЩрпНроХро│рпН роЪро░рпНро╡ро░рпНро▓рпЖро╕рпН роХрпБро▒ро┐ропрпАроЯрпНроЯрпИ роорпЗроХродрпНродро┐ро▓рпН рокро┐ро░роЪрпБро░ро┐роХрпНроХро╡рпБроорпН

роЙроЩрпНроХро│рпН роХрпБро▒ро┐ропрпАроЯрпБ родро▒рпНрокрпЛродрпБ роЙро│рпНро│роЯроХрооро╛роХ ро╡рпЗро▓рпИ роЪрпЖропрпНроХро┐ро▒родрпБ, роОройро╡рпЗ роЕроЯрпБродрпНрод рокроЯро┐ Functions App роР роорпЗроХродрпНродро┐ро▓рпН рокро┐ро░роЪрпБро░ро┐рокрпНрокродрпБ.

### рокрогро┐роХро│рпН - роорпЗроХ ро╡ро│роЩрпНроХро│рпИ роЙро░рпБро╡ро╛роХрпНроХро╡рпБроорпН

Functions роЪрпЖропро▓ро┐ропрпИ Azure роЗро▓рпН роЙро│рпНро│ Functions App ро╡ро│родрпНродро┐ро▓рпН рокро┐ро░роЪрпБро░ро┐роХрпНроХ ро╡рпЗрогрпНроЯрпБроорпН, роЗродрпБ роЙроЩрпНроХро│рпН IoT Hub роХрпНроХро╛роХ роирпАроЩрпНроХро│рпН роЙро░рпБро╡ро╛роХрпНроХро┐роп Resource Group роЗро▓рпН роЗро░рпБроХрпНроХрпБроорпН. роорпЗро▓рпБроорпН, роирпАроЩрпНроХро│рпН роЙро│рпНро│роЯроХрооро╛роХ роЗропроХрпНроХрпБроорпН роОроорпБро▓рпЗроЯрпНроЯроЯрпН роТройрпНро▒рпИ рооро╛ро▒рпНро▒ Azure роЗро▓рпН роТро░рпБ Storage Account роЙро░рпБро╡ро╛роХрпНроХ ро╡рпЗрогрпНроЯрпБроорпН.

1. роТро░рпБ Storage Account роЙро░рпБро╡ро╛роХрпНроХ роХрпАро┤рпЗ роЙро│рпНро│ роХроЯрпНроЯро│рпИропрпИ роЗропроХрпНроХро╡рпБроорпН:

    ```sh
    az storage account create --resource-group soil-moisture-sensor \
                              --sku Standard_LRS \
                              --name <storage_name> 
    ```

    `<storage_name>` роР роЙроЩрпНроХро│рпН Storage Account роХрпНроХро╛рой рокрпЖропро░рпБроЯройрпН рооро╛ро▒рпНро▒ро╡рпБроорпН. роЗродрпБ URL роЗро▓рпН рокропройрпНрокроЯрпБродрпНродрокрпНрокроЯрпБроорпН рокрпЖропро░ро┐ройрпН роТро░рпБ рокроХрпБродро┐ропро╛роХ роЗро░рпБрокрпНрокродро╛ро▓рпН роЙро▓роХро│ро╛ро╡ро┐роп роЕро│ро╡ро┐ро▓рпН родройро┐родрпНродрпБро╡рооро╛ройродро╛роХ роЗро░рпБроХрпНроХ ро╡рпЗрогрпНроЯрпБроорпН. роЗроирпНрод рокрпЖропро░рпБроХрпНроХрпБ роЪро┐ро▒ро┐роп роОро┤рпБродрпНродрпБроХрпНроХро│рпН рооро▒рпНро▒рпБроорпН роОрогрпНроХро│рпИ роороЯрпНроЯрпБроорпЗ рокропройрпНрокроЯрпБродрпНродро▓ро╛роорпН, ро╡рпЗро▒рпБ роОро┤рпБродрпНродрпБроХрпНроХро│рпН роЗро▓рпНро▓рпИ, роорпЗро▓рпБроорпН роЗродрпБ 24 роОро┤рпБродрпНродрпБроХро│рпБроХрпНроХрпБ роороЯрпНроЯрпБроорпЗ ро╡ро░рпИропро▒рпБроХрпНроХрокрпНрокроЯрпНроЯрпБро│рпНро│родрпБ. `sms` рокрпЛройрпНро▒ роТройрпНро▒рпИ рокропройрпНрокроЯрпБродрпНродро┐, роЕродройрпН роЗро▒рпБродро┐ропро┐ро▓рпН роЪро┐ро▓ роЪрпАро░ро▒рпНро▒ ро╡ро╛ро░рпНродрпНродрпИроХро│рпН роЕро▓рпНро▓родрпБ роЙроЩрпНроХро│рпН рокрпЖропро░рпИроЪрпН роЪрпЗро░рпНроХрпНроХро╡рпБроорпН.

    `--sku Standard_LRS` ро╡ро┐ро▓рпИ роиро┐ро▓рпИропрпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро┐ро▒родрпБ, роХрпБро▒рпИроирпНрод роЪрпЖро▓ро╡рпБроЯрпИроп рокрпКродрпБро╡ро╛рой роХрогроХрпНроХрпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро┐ро▒родрпБ. роЪрпЗрооро┐рокрпНрокроХродрпНродро┐ро▒рпНроХрпБ роЗро▓ро╡роЪ роиро┐ро▓рпИ роЗро▓рпНро▓рпИ, роорпЗро▓рпБроорпН роирпАроЩрпНроХро│рпН рокропройрпНрокроЯрпБродрпНродрпБро╡родро▒рпНроХрпЗ роЪрпЖро▓рпБродрпНрод ро╡рпЗрогрпНроЯрпБроорпН. роЪрпЖро▓ро╡рпБроХро│рпН рооро┐роХро╡рпБроорпН роХрпБро▒рпИро╡ро╛роХ роЙро│рпНро│рой, рооро┐роХ роЕродро┐роХ роЪрпЖро▓ро╡рпБроЯрпИроп роЪрпЗрооро┐рокрпНрокроХродрпНродро┐ро▒рпНроХрпБроорпН роТро░рпБ рооро╛родродрпНродро┐ро▒рпНроХрпБ роТро░рпБ роЬро┐роХро╛рокрпИроЯрпН роЪрпЗрооро┐рокрпНрокродро▒рпНроХрпБ US$0.05 роХрпНроХрпБроорпН роХрпБро▒рпИро╡ро╛роХ роЙро│рпНро│родрпБ.

    тЬЕ ро╡ро┐ро▓рпИ рокро▒рпНро▒ро┐роп родроХро╡ро▓рпНроХро│рпИ [Azure Storage Account ро╡ро┐ро▓рпИ рокроХрпНроХроорпН](https://azure.microsoft.com/pricing/details/storage/?WT.mc_id=academic-17441-jabenn) роЗро▓рпН рокроЯро┐роХрпНроХро╡рпБроорпН.

1. Functions App роЙро░рпБро╡ро╛роХрпНроХ роХрпАро┤рпЗ роЙро│рпНро│ роХроЯрпНроЯро│рпИропрпИ роЗропроХрпНроХро╡рпБроорпН:

    ```sh
    az functionapp create --resource-group soil-moisture-sensor \
                          --runtime python \
                          --functions-version 3 \
                          --os-type Linux \
                          --consumption-plan-location <location> \
                          --storage-account <storage_name> \
                          --name <functions_app_name>
    ```

    `<location>` роР роорпБроирпНродрпИроп рокро╛роЯродрпНродро┐ро▓рпН Resource Group роЙро░рпБро╡ро╛роХрпНроХро┐роп роЗроЯродрпНродрпБроЯройрпН рооро╛ро▒рпНро▒ро╡рпБроорпН.

    `<storage_name>` роР роирпАроЩрпНроХро│рпН роорпБроирпНродрпИроп рокроЯро┐ропро┐ро▓рпН роЙро░рпБро╡ро╛роХрпНроХро┐роп Storage Account рокрпЖропро░рпБроЯройрпН рооро╛ро▒рпНро▒ро╡рпБроорпН.

    `<functions_app_name>` роР роЙроЩрпНроХро│рпН Functions App роХрпНроХро╛рой родройро┐родрпНродрпБро╡рооро╛рой рокрпЖропро░рпБроЯройрпН рооро╛ро▒рпНро▒ро╡рпБроорпН. роЗродрпБ URL роЗро▓рпН рокропройрпНрокроЯрпБродрпНродрокрпНрокроЯрпБроорпН рокрпЖропро░ро┐ройрпН роТро░рпБ рокроХрпБродро┐ропро╛роХ роЗро░рпБрокрпНрокродро╛ро▓рпН роЙро▓роХро│ро╛ро╡ро┐роп роЕро│ро╡ро┐ро▓рпН родройро┐родрпНродрпБро╡рооро╛ройродро╛роХ роЗро░рпБроХрпНроХ ро╡рпЗрогрпНроЯрпБроорпН. `soil-moisture-sensor-` рокрпЛройрпНро▒ роТройрпНро▒рпИ рокропройрпНрокроЯрпБродрпНродро┐, роЕродройрпН роЗро▒рпБродро┐ропро┐ро▓рпН роЪро┐ро▓ роЪрпАро░ро▒рпНро▒ ро╡ро╛ро░рпНродрпНродрпИроХро│рпН роЕро▓рпНро▓родрпБ роЙроЩрпНроХро│рпН рокрпЖропро░рпИроЪрпН роЪрпЗро░рпНроХрпНроХро╡рпБроорпН.

    `--functions-version 3` ро╡ро┐ро░рпБрокрпНрокроорпН Azure Functions роЗройрпН рокродро┐рокрпНрокрпИ роЕроорпИроХрпНроХро┐ро▒родрпБ. рокродро┐рокрпНрокрпБ 3 роЪроорпАрокродрпНродро┐роп рокродро┐рокрпНрокрпБ.

    `--os-type Linux` Functions runtime роР Linux роР OS роЖроХ рокропройрпНрокроЯрпБродрпНродроЪрпН роЪрпКро▓рпНро▓рпБроХро┐ро▒родрпБ. Functions роР Linux роЕро▓рпНро▓родрпБ Windows роЗро▓рпН ро╣рпЛро╕рпНроЯрпН роЪрпЖропрпНропро▓ро╛роорпН, рокропройрпНрокроЯрпБродрпНродрокрпНрокроЯрпБроорпН роиро┐ро░ро▓ро╛роХрпНроХ роорпКро┤ро┐ропрпИрокрпН рокрпКро▒рпБродрпНродрпБ. Python роЪрпЖропро▓ро┐роХро│рпН Linux роЗро▓рпН роороЯрпНроЯрпБроорпЗ роЖродро░ро┐роХрпНроХрокрпНрокроЯрпБроХро┐ройрпНро▒рой.

### рокрогро┐роХро│рпН - роЙроЩрпНроХро│рпН роЪрпЖропро▓ро┐ роЕроорпИрокрпНрокрпБроХро│рпИрокрпН рокродро┐ро╡рпЗро▒рпНро▒ро╡рпБроорпН

роирпАроЩрпНроХро│рпН роЙроЩрпНроХро│рпН Functions App роР роЙро░рпБро╡ро╛роХрпНроХро┐роп рокрпЛродрпБ, IoT Hub роХрпНроХро╛рой роЗрогрпИрокрпНрокрпБ strings роХрпНроХро╛рой `local.settings.json` роХрпЛрокрпНрокро┐ро▓рпН роЪро┐ро▓ роЕроорпИрокрпНрокрпБроХро│рпИ роЪрпЗрооро┐родрпНродрпАро░рпНроХро│рпН. роЗро╡рпИ роЙроЩрпНроХро│рпН Functions App роЗро▓рпН Application Settings роЖроХ Azure роЗро▓рпН роОро┤рпБродрокрпНрокроЯ ро╡рпЗрогрпНроЯрпБроорпН, роЙроЩрпНроХро│рпН роХрпБро▒ро┐ропрпАроЯрпНроЯро╛ро▓рпН рокропройрпНрокроЯрпБродрпНродрокрпНрокроЯрпБро╡родро▒рпНроХро╛роХ.

> ЁЯОУ `local.settings.json` роХрпЛрокрпНрокрпБ роЙро│рпНро│роЯроХ роорпЗроорпНрокро╛роЯрпНроЯрпБ роЕроорпИрокрпНрокрпБроХро│рпБроХрпНроХро╛роХ роороЯрпНроЯрпБроорпЗ, роорпЗро▓рпБроорпН роЗро╡рпИ GitHub рокрпЛройрпНро▒ роорпВро▓ роХрпБро▒ро┐ропрпАроЯрпБ роХроЯрпНроЯрпБрокрпНрокро╛роЯрпНроЯро┐ро▓рпН роЪро░ро┐рокро╛ро░рпНроХрпНроХрокрпНрокроЯроХрпНроХрпВроЯро╛родрпБ. роорпЗроХродрпНродро┐ро▓рпН рокро┐ро░роЪрпБро░ро┐роХрпНроХрокрпНрокроЯрпНроЯ рокрпЛродрпБ, Application Settings рокропройрпНрокроЯрпБродрпНродрокрпНрокроЯрпБроХро┐ройрпНро▒рой. Application Settings роОройрпНрокродрпБ роорпЗроХродрпНродро┐ро▓рпН ро╣рпЛро╕рпНроЯрпН роЪрпЖропрпНропрокрпНрокроЯрпНроЯ key/value роЬрпЛроЯро┐роХро│рпН роЖроХрпБроорпН, роорпЗро▓рпБроорпН роЙроЩрпНроХро│рпН роХрпБро▒ро┐ропрпАроЯрпНроЯро┐ро▓рпН роЕро▓рпНро▓родрпБ runtime роорпВро▓роорпН IoT Hub роХрпНроХрпБ роЙроЩрпНроХро│рпН роХрпБро▒ро┐ропрпАроЯрпНроЯрпИ роЗрогрпИроХрпНроХрпБроорпН рокрпЛродрпБ роЪрпВро┤ро▓рпН рооро╛ро▒ро┐роХро│рпН роорпВро▓роорпН ро╡ро╛роЪро┐роХрпНроХрокрпНрокроЯрпБроХро┐ройрпНро▒рой.

1. Functions App Application Settings роЗро▓рпН `IOT_HUB_CONNECTION_STRING` роЕроорпИрокрпНрокрпИ роЕроорпИроХрпНроХ роХрпАро┤рпЗ роЙро│рпНро│ роХроЯрпНроЯро│рпИропрпИ роЗропроХрпНроХро╡рпБроорпН:

    ```sh
    az functionapp config appsettings set --resource-group soil-moisture-sensor \
                                          --name <functions_app_name> \
                                          --settings "IOT_HUB_CONNECTION_STRING=<connection string>"
    ```

    `<functions_app_name>` роР роЙроЩрпНроХро│рпН Functions App роХрпНроХро╛рой рокрпЖропро░рпБроЯройрпН рооро╛ро▒рпНро▒ро╡рпБроорпН.

    `<connection string>` роР роЙроЩрпНроХро│рпН `local.settings.json` роХрпЛрокрпНрокро┐ро▓рпН роЙро│рпНро│ `IOT_HUB_CONNECTION_STRING` роЗройрпН роородро┐рокрпНрокрпБроЯройрпН рооро╛ро▒рпНро▒ро╡рпБроорпН.

1. роорпЗро▓рпЗ роЙро│рпНро│ рокроЯро┐ропрпИ роорпАрогрпНроЯрпБроорпН роЪрпЖропрпНропро╡рпБроорпН, роЖройро╛ро▓рпН `REGISTRY_MANAGER_CONNECTION_STRING` роЗройрпН роородро┐рокрпНрокрпИ `local.settings.json` роХрпЛрокрпНрокро┐ро▓рпН роЙро│рпНро│ родрпКроЯро░рпНрокрпБроЯрпИроп роородро┐рокрпНрокрпБроЯройрпН роЕроорпИроХрпНроХро╡рпБроорпН.

роЗроирпНрод роХроЯрпНроЯро│рпИроХро│рпИ роирпАроЩрпНроХро│рпН роЗропроХрпНроХрпБроорпНрокрпЛродрпБ, Functions App роХрпНроХро╛рой Application Settings роЗройрпН рокроЯрпНроЯро┐ропро▓рпИропрпБроорпН роЕро╡рпИ ро╡рпЖро│ро┐ропро┐роЯрпБроорпН. роЙроЩрпНроХро│рпН роородро┐рокрпНрокрпБроХро│рпН роЪро░ро┐ропро╛роХ роЕроорпИроХрпНроХрокрпНрокроЯрпНроЯрпБро│рпНро│родро╛ роОройрпНрокродрпИ роЪро░ро┐рокро╛ро░рпНроХрпНроХ роЗродрпИрокрпН рокропройрпНрокроЯрпБродрпНродро▓ро╛роорпН.

> ЁЯТБ роирпАроЩрпНроХро│рпН `AzureWebJobsStorage` роХрпНроХро╛рой роородро┐рокрпНрокрпИ роПро▒рпНроХройро╡рпЗ роЕроорпИродрпНродрпБро│рпНро│рпАро░рпНроХро│рпН роОройрпНрокродрпИ роХро╛рогро▓ро╛роорпН. роЙроЩрпНроХро│рпН `local.settings.json` роХрпЛрокрпНрокро┐ро▓рпН, роЗродрпБ роЙро│рпНро│роЯроХ роЪрпЗрооро┐рокрпНрокрпБ роОроорпБро▓рпЗроЯрпНроЯро░рпИрокрпН рокропройрпНрокроЯрпБродрпНрод роТро░рпБ роородро┐рокрпНрокро╛роХ роЕроорпИроХрпНроХрокрпНрокроЯрпНроЯродрпБ. роирпАроЩрпНроХро│рпН Functions App роР роЙро░рпБро╡ро╛роХрпНроХро┐роп рокрпЛродрпБ, роирпАроЩрпНроХро│рпН роЪрпЗрооро┐рокрпНрокроХ роХрогроХрпНроХрпИ роТро░рпБ роЕро│ро╡рпБро░рпБро╡ро╛роХ ро╡ро┤роЩрпНроХрпБроХро┐ро▒рпАро░рпНроХро│рпН, роорпЗро▓рпБроорпН роЗродрпБ роЗроирпНрод роЕроорпИрокрпНрокро┐ро▓рпН родро╛ройро╛роХро╡рпЗ роЕроорпИроХрпНроХрокрпНрокроЯрпБроХро┐ро▒родрпБ.

### рокрогро┐роХро│рпН - роЙроЩрпНроХро│рпН Functions App роР роорпЗроХродрпНродро┐ро▓рпН рокро┐ро░роЪрпБро░ро┐роХрпНроХро╡рпБроорпН

роЗрокрпНрокрпЛродрпБ Functions App родропро╛ро░ро╛роХ роЙро│рпНро│родрпБ, роЙроЩрпНроХро│рпН роХрпБро▒ро┐ропрпАроЯрпБ рокро┐ро░роЪрпБро░ро┐роХрпНроХрокрпНрокроЯро▓ро╛роорпН.

1. VS Code роЯрпЖро░рпНрооро┐ройро▓ро┐ро▓рпН роЗро░рпБроирпНродрпБ роХрпАро┤рпЗ роЙро│рпНро│ роХроЯрпНроЯро│рпИропрпИ роЗропроХрпНроХро┐ роЙроЩрпНроХро│рпН Functions App роР рокро┐ро░роЪрпБро░ро┐роХрпНроХро╡рпБроорпН:

    ```sh
    func azure functionapp publish <functions_app_name>
    ```

    `<functions_app_name>` роР роЙроЩрпНроХро│рпН Functions App роХрпНроХро╛рой рокрпЖропро░рпБроЯройрпН рооро╛ро▒рпНро▒ро╡рпБроорпН.

роХрпБро▒ро┐ропрпАроЯрпБ родрпКроХрпБрокрпНрокро╛роХро┐ Functions App роХрпНроХрпБ роЕройрпБрокрпНрокрокрпНрокроЯрпБроорпН, роЕроЩрпНроХрпБ роЕродрпБ рокро┐ро░роЪрпБро░ро┐роХрпНроХрокрпНрокроЯрпНроЯрпБ родрпКроЯроЩрпНроХрокрпНрокроЯрпБроорпН. роиро┐ро▒рпИроп роХро╛ройрпНроЪрпЛро▓рпН ро╡рпЖро│ро┐ропрпАроЯрпБ роЗро░рпБроХрпНроХрпБроорпН, рокро┐ро░роЪрпБро░родрпНродро┐ройрпН роЙро▒рпБродро┐рокрпНрокро╛роЯрпНроЯрпБроЯройрпН роорпБроЯро┐ро╡роЯрпИропрпБроорпН рооро▒рпНро▒рпБроорпН рокро┐ро░роЪрпБро░ро┐роХрпНроХрокрпНрокроЯрпНроЯ Functions роЗройрпН рокроЯрпНроЯро┐ропро▓рпБроЯройрпН роорпБроЯро┐ро╡роЯрпИропрпБроорпН. роЗроирпНрод ро╡ро┤роХрпНроХро┐ро▓рпН рокроЯрпНроЯро┐ропро▓ро┐ро▓рпН trigger роороЯрпНроЯрпБроорпЗ роЗро░рпБроХрпНроХрпБроорпН.

```output
Deployment successful.
Remote build succeeded!
Syncing triggers...
Functions in soil-moisture-sensor:
    iot-hub-trigger - [eventHubTrigger]
```

роЙроЩрпНроХро│рпН IoT роЪро╛родройроорпН роЗропроЩрпНроХрпБроХро┐ро▒родро╛ роОройрпНрокродрпИ роЙро▒рпБродро┐рокрпНрокроЯрпБродрпНродро╡рпБроорпН. роорогрпН роИро░рокрпНрокродродрпНродрпИ рооро╛ро▒рпНро▒ро╡рпБроорпН, роорогрпН роИро░рокрпНрокродроорпН роЪрпЖройрпНроЪро╛ро░рпИ роорогрпНрогро┐ро▓рпН роЙро│рпНро│рпЗ роЕро▓рпНро▓родрпБ ро╡рпЖро│ро┐ропрпЗ роироХро░рпНродрпНродро╡рпБроорпН. роорогрпН роИро░рокрпНрокродроорпН рооро╛ро▒рпБроорпНрокрпЛродрпБ ро░ро┐ро▓рпЗ роЖройрпН рооро▒рпНро▒рпБроорпН роЖроГрокрпН роЖроХрпБроорпН роОройрпНрокродрпИ роирпАроЩрпНроХро│рпН роХро╛рогро▓ро╛роорпН.

---

## ЁЯЪА роЪро╡ро╛ро▓рпН

роорпБроирпНродрпИроп рокро╛роЯродрпНродро┐ро▓рпН, роирпАроЩрпНроХро│рпН ро░ро┐ро▓рпЗ роирпЗро░родрпНродрпИ роиро┐ро░рпНро╡роХро┐роХрпНроХ MQTT роЪрпЖропрпНродро┐роХро│ро┐ро▓ро┐ро░рпБроирпНродрпБ ро░ро┐ро▓рпЗ роЖройрпН роЗро░рпБроХрпНроХрпБроорпН рокрпЛродрпБ рооро▒рпНро▒рпБроорпН роЕродрпБ роЖроГрокрпН роЖрой рокро┐ро▒роХрпБ роХрпБро▒рпБроХро┐роп роирпЗро░родрпНродро┐ро▒рпНроХрпБ ро╡ро┐ро▓роХрпБро╡родройрпН роорпВро▓роорпН роиро┐ро░рпНро╡роХро┐родрпНродрпАро░рпНроХро│рпН. роирпАроЩрпНроХро│рпН роЗроЩрпНроХрпБ роЗроирпНрод роорпБро▒рпИропрпИрокрпН рокропройрпНрокроЯрпБродрпНрод роорпБроЯро┐ропро╛родрпБ - роЙроЩрпНроХро│рпН IoT Hub trigger роР роирпАроЩрпНроХро│рпН ро╡ро┐ро▓роХрпНроХ роорпБроЯро┐ропро╛родрпБ.

Functions App роЗро▓рпН роЗродрпИ роирпАроЩрпНроХро│рпН роОрокрпНрокроЯро┐ роХрпИропро╛ро│ро▓ро╛роорпН роОройрпНро▒рпБ роЪро┐роирпНродро┐роХрпНроХро╡рпБроорпН.

## рокро╛роЯродрпНродро┐ро▒рпНроХрпБрокрпН рокро┐роирпНродрпИроп ро╡ро┐ройро╛роЯро┐ ро╡ро┐ройро╛

[рокро╛роЯродрпНродро┐ро▒рпНроХрпБрокрпН рокро┐роирпНродрпИроп ро╡ро┐ройро╛роЯро┐ ро╡ро┐ройро╛](https://black-meadow-040d15503.1.azurestaticapps.net/quiz/18)

## роородро┐рокрпНрокрпАроЯрпБ & роЪрпБропрокроЯро┐рокрпНрокрпБ

* [Wikipedia роЗро▓рпН Serverless Computing рокроХрпНроХроорпН](https://wikipedia.org/wiki/Serverless_computing) роЗро▓рпН Serverless Computing рокро▒рпНро▒ро┐ рокроЯро┐роХрпНроХро╡рпБроорпН.
* Azure роЗро▓рпН Serverless роР рокропройрпНрокроЯрпБродрпНродрпБро╡родрпБ рооро▒рпНро▒рпБроорпН роорпЗро▓рпБроорпН роЪро┐ро▓ роЙродро╛ро░рогроЩрпНроХро│рпН рокро▒рпНро▒ро┐роп [Go serverless for your IoT needs Azure blog post](https://azure.microsoft.com/blog/go-serverless-for-your-iot-needs/?WT.mc_id=academic-17441-jabenn) роР рокроЯро┐роХрпНроХро╡рпБроорпН.
* Azure Functions рокро▒рпНро▒ро┐ роорпЗро▓рпБроорпН роЕро▒ро┐роп [Azure Functions YouTube channel](https://www.youtube.com/c/AzureFunctions) роР рокро╛ро░рпНро╡рпИропро┐роЯро╡рпБроорпН.

## рокрогро┐роХрпНроХроЯрпНроЯро│рпИ

[роХрпИропрпЗроЯрпБ ро░ро┐ро▓рпЗ роХроЯрпНроЯрпБрокрпНрокро╛роЯрпНроЯрпИроЪрпН роЪрпЗро░рпНроХрпНроХро╡рпБроорпН](assignment.md)

---

**роХрпБро▒ро┐рокрпНрокрпБ**:  
роЗроирпНрод роЖро╡рогроорпН [Co-op Translator](https://github.com/Azure/co-op-translator) роОройрпНро▒ AI роорпКро┤ро┐рокрпЖропро░рпНрокрпНрокрпБ роЪрпЗро╡рпИропрпИрокрпН рокропройрпНрокроЯрпБродрпНродро┐ роорпКро┤ро┐рокрпЖропро░рпНроХрпНроХрокрпНрокроЯрпНроЯрпБро│рпНро│родрпБ. роиро╛роЩрпНроХро│рпН родрпБро▓рпНро▓ро┐ропродрпНродро┐ро▒рпНроХро╛роХ роорпБропро▒рпНроЪро┐роХрпНроХро┐ройрпНро▒рпЛроорпН, роЖройро╛ро▓рпН родро╛ройро┐ропроЩрпНроХро┐ роорпКро┤ро┐рокрпЖропро░рпНрокрпНрокрпБроХро│ро┐ро▓рпН рокро┐ро┤рпИроХро│рпН роЕро▓рпНро▓родрпБ родро╡ро▒ро╛рой родроХро╡ро▓рпНроХро│рпН роЗро░рпБроХрпНроХроХрпНроХрпВроЯрпБроорпН роОройрпНрокродрпИ родропро╡рпБроЪрпЖропрпНродрпБ роХро╡ройродрпНродро┐ро▓рпН роХрпКро│рпНро│рпБроЩрпНроХро│рпН. роЕродройрпН родро╛ропрпНроорпКро┤ро┐ропро┐ро▓рпН роЙро│рпНро│ роорпВро▓ роЖро╡рогроорпН роЕродро┐роХро╛ро░рокрпНрокрпВро░рпНро╡ роЖродро╛ро░рооро╛роХ роХро░рпБродрокрпНрокроЯ ро╡рпЗрогрпНроЯрпБроорпН. роорпБроХрпНроХро┐ропрооро╛рой родроХро╡ро▓рпНроХро│рпБроХрпНроХрпБ, родрпКро┤ро┐ро▓рпНроорпБро▒рпИ рооройро┐род роорпКро┤ро┐рокрпЖропро░рпНрокрпНрокрпБ рокро░ро┐роирпНродрпБро░рпИроХрпНроХрокрпНрокроЯрпБроХро┐ро▒родрпБ. роЗроирпНрод роорпКро┤ро┐рокрпЖропро░рпНрокрпНрокрпИрокрпН рокропройрпНрокроЯрпБродрпНродрпБро╡родро╛ро▓рпН роПро▒рпНрокроЯрпБроорпН роОроирпНрод родро╡ро▒ро╛рой рокрпБро░ро┐родро▓рпНроХро│рпН роЕро▓рпНро▓родрпБ родро╡ро▒ро╛рой ро╡ро┐ро│роХрпНроХроЩрпНроХро│рпБроХрпНроХрпБ роиро╛роЩрпНроХро│рпН рокрпКро▒рпБрокрпНрокро▓рпНро▓.