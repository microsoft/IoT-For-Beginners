<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "3ac42e284a7222c0e83d2d43231a364f",
  "translation_date": "2025-08-28T11:24:50+00:00",
  "source_file": "2-farm/lessons/4-migrate-your-plant-to-the-cloud/single-board-computer-connect-hub.md",
  "language_code": "bg"
}
-->
# –°–≤—ä—Ä–∂–µ—Ç–µ –≤–∞—à–µ—Ç–æ IoT —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ —Å –æ–±–ª–∞–∫–∞ - –í–∏—Ä—Ç—É–∞–ª–µ–Ω IoT —Ö–∞—Ä–¥—É–µ—Ä –∏ Raspberry Pi

–í —Ç–∞–∑–∏ —á–∞—Å—Ç –æ—Ç —É—Ä–æ–∫–∞ —â–µ —Å–≤—ä—Ä–∂–µ—Ç–µ –≤–∞—à–µ—Ç–æ –≤–∏—Ä—Ç—É–∞–ª–Ω–æ IoT —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∏–ª–∏ Raspberry Pi –∫—ä–º –≤–∞—à–∏—è IoT Hub, –∑–∞ –¥–∞ –∏–∑–ø—Ä–∞—â–∞—Ç–µ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—è –∏ –¥–∞ –ø–æ–ª—É—á–∞–≤–∞—Ç–µ –∫–æ–º–∞–Ω–¥–∏.

## –°–≤—ä—Ä–∂–µ—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ—Ç–æ —Å–∏ –∫—ä–º IoT Hub

–°–ª–µ–¥–≤–∞—â–∞—Ç–∞ —Å—Ç—ä–ø–∫–∞ –µ –¥–∞ —Å–≤—ä—Ä–∂–µ—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ—Ç–æ —Å–∏ –∫—ä–º IoT Hub.

### –ó–∞–¥–∞—á–∞ - —Å–≤—ä—Ä–∑–≤–∞–Ω–µ –∫—ä–º IoT Hub

1. –û—Ç–≤–æ—Ä–µ—Ç–µ –ø–∞–ø–∫–∞—Ç–∞ `soil-moisture-sensor` –≤ VS Code. –£–≤–µ—Ä–µ—Ç–µ —Å–µ, —á–µ –≤–∏—Ä—Ç—É–∞–ª–Ω–∞—Ç–∞ —Å—Ä–µ–¥–∞ —Ä–∞–±–æ—Ç–∏ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞, –∞–∫–æ –∏–∑–ø–æ–ª–∑–≤–∞—Ç–µ –≤–∏—Ä—Ç—É–∞–ª–Ω–æ IoT —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ.

1. –ò–Ω—Å—Ç–∞–ª–∏—Ä–∞–π—Ç–µ –Ω—è–∫–æ–∏ –¥–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∏ Pip –ø–∞–∫–µ—Ç–∏:

    ```sh
    pip3 install azure-iot-device
    ```

    `azure-iot-device` –µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∑–∞ –∫–æ–º—É–Ω–∏–∫–∞—Ü–∏—è —Å –≤–∞—à–∏—è IoT Hub.

1. –î–æ–±–∞–≤–µ—Ç–µ —Å–ª–µ–¥–Ω–∏—Ç–µ –∏–º–ø–æ—Ä—Ç–∏ –≤ –Ω–∞—á–∞–ª–æ—Ç–æ –Ω–∞ —Ñ–∞–π–ª–∞ `app.py`, –ø–æ–¥ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞—â–∏—Ç–µ –∏–º–ø–æ—Ä—Ç–∏:

    ```python
    from azure.iot.device import IoTHubDeviceClient, Message, MethodResponse
    ```

    –¢–æ–∑–∏ –∫–æ–¥ –∏–º–ø–æ—Ä—Ç–∏—Ä–∞ SDK –∑–∞ –∫–æ–º—É–Ω–∏–∫–∞—Ü–∏—è —Å –≤–∞—à–∏—è IoT Hub.

1. –ü—Ä–µ–º–∞—Ö–Ω–µ—Ç–µ —Ä–µ–¥–∞ `import paho.mqtt.client as mqtt`, —Ç—ä–π –∫–∞—Ç–æ —Ç–∞–∑–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –≤–µ—á–µ –Ω–µ –µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞. –ü—Ä–µ–º–∞—Ö–Ω–µ—Ç–µ —Ü–µ–ª–∏—è MQTT –∫–æ–¥, –≤–∫–ª—é—á–∏—Ç–µ–ª–Ω–æ –∏–º–µ–Ω–∞—Ç–∞ –Ω–∞ —Ç–µ–º–∏—Ç–µ, —Ü–µ–ª–∏—è –∫–æ–¥, –∫–æ–π—Ç–æ –∏–∑–ø–æ–ª–∑–≤–∞ `mqtt_client`, –∏ `handle_command`. –ó–∞–ø–∞–∑–µ—Ç–µ —Ü–∏–∫—ä–ª–∞ `while True:`, –ø—Ä–æ—Å—Ç–æ –∏–∑—Ç—Ä–∏–π—Ç–µ —Ä–µ–¥–∞ `mqtt_client.publish` –æ—Ç —Ç–æ–∑–∏ —Ü–∏–∫—ä–ª.

1. –î–æ–±–∞–≤–µ—Ç–µ —Å–ª–µ–¥–Ω–∏—è –∫–æ–¥ –ø–æ–¥ –∏–∑—è–≤–ª–µ–Ω–∏—è—Ç–∞ –∑–∞ –∏–º–ø–æ—Ä—Ç–∏—Ä–∞–Ω–µ:

    ```python
    connection_string = "<connection string>"
    ```

    –ó–∞–º–µ–Ω–µ—Ç–µ `<connection string>` —Å—ä—Å —Å—Ç—Ä–∏–Ω–≥–∞ –∑–∞ –≤—Ä—ä–∑–∫–∞, –∫–æ–π—Ç–æ –∏–∑–≤–ª—è–∫–æ—Ö—Ç–µ –∑–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ—Ç–æ –ø–æ-—Ä–∞–Ω–æ –≤ —Ç–æ–∑–∏ —É—Ä–æ–∫.

    > üíÅ –¢–æ–≤–∞ –Ω–µ –µ –Ω–∞–π-–¥–æ–±—Ä–∞—Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫–∞. –°—Ç—Ä–∏–Ω–≥–æ–≤–µ—Ç–µ –∑–∞ –≤—Ä—ä–∑–∫–∞ –Ω–∏–∫–æ–≥–∞ –Ω–µ —Ç—Ä—è–±–≤–∞ –¥–∞ —Å–µ —Å—ä—Ö—Ä–∞–Ω—è–≤–∞—Ç –≤ –∏–∑—Ö–æ–¥–Ω–∏—è –∫–æ–¥, —Ç—ä–π –∫–∞—Ç–æ –º–æ–≥–∞—Ç –¥–∞ –±—ä–¥–∞—Ç –∫–∞—á–µ–Ω–∏ –≤ —Å–∏—Å—Ç–µ–º–∞ –∑–∞ –∫–æ–Ω—Ç—Ä–æ–ª –Ω–∞ –≤–µ—Ä—Å–∏–∏—Ç–µ –∏ –Ω–∞–º–µ—Ä–µ–Ω–∏ –æ—Ç –≤—Å–µ–∫–∏. –ü—Ä–∞–≤–∏–º —Ç–æ–≤–∞ —Ç—É–∫ –∑–∞—Ä–∞–¥–∏ –ø—Ä–æ—Å—Ç–æ—Ç–∞—Ç–∞. –ò–¥–µ–∞–ª–Ω–æ –±–∏ –±–∏–ª–æ –¥–∞ –∏–∑–ø–æ–ª–∑–≤–∞—Ç–µ –Ω–µ—â–æ –∫–∞—Ç–æ –ø—Ä–æ–º–µ–Ω–ª–∏–≤–∞ –Ω–∞ —Å—Ä–µ–¥–∞—Ç–∞ –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∫–∞—Ç–æ [`python-dotenv`](https://pypi.org/project/python-dotenv/). –©–µ –Ω–∞—É—á–∏—Ç–µ –ø–æ–≤–µ—á–µ –∑–∞ —Ç–æ–≤–∞ –≤ –ø—Ä–µ–¥—Å—Ç–æ—è—â —É—Ä–æ–∫.

1. –ü–æ–¥ —Ç–æ–∑–∏ –∫–æ–¥ –¥–æ–±–∞–≤–µ—Ç–µ —Å–ª–µ–¥–Ω–æ—Ç–æ, –∑–∞ –¥–∞ —Å—ä–∑–¥–∞–¥–µ—Ç–µ –æ–±–µ–∫—Ç –∑–∞ –∫–ª–∏–µ–Ω—Ç –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ—Ç–æ, –∫–æ–π—Ç–æ –º–æ–∂–µ –¥–∞ –∫–æ–º—É–Ω–∏–∫–∏—Ä–∞ —Å IoT Hub, –∏ –≥–æ —Å–≤—ä—Ä–∂–µ—Ç–µ:

    ```python
    device_client = IoTHubDeviceClient.create_from_connection_string(connection_string)

    print('Connecting')
    device_client.connect()
    print('Connected')
    ```

1. –°—Ç–∞—Ä—Ç–∏—Ä–∞–π—Ç–µ —Ç–æ–∑–∏ –∫–æ–¥. –©–µ –≤–∏–¥–∏—Ç–µ –∫–∞–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ—Ç–æ –≤–∏ —Å–µ —Å–≤—ä—Ä–∑–≤–∞.

    ```output
    pi@raspberrypi:~/soil-moisture-sensor $ python3 app.py 
    Connecting
    Connected
    Soil moisture: 379
    ```

## –ò–∑–ø—Ä–∞—â–∞–Ω–µ –Ω–∞ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—è

–°–µ–≥–∞, –∫–æ–≥–∞—Ç–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ—Ç–æ –≤–∏ –µ —Å–≤—ä—Ä–∑–∞–Ω–æ, –º–æ–∂–µ—Ç–µ –¥–∞ –∏–∑–ø—Ä–∞—â–∞—Ç–µ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—è –∫—ä–º IoT Hub –≤–º–µ—Å—Ç–æ –∫—ä–º MQTT –±—Ä–æ–∫–µ—Ä–∞.

### –ó–∞–¥–∞—á–∞ - –∏–∑–ø—Ä–∞—â–∞–Ω–µ –Ω–∞ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—è

1. –î–æ–±–∞–≤–µ—Ç–µ —Å–ª–µ–¥–Ω–∏—è –∫–æ–¥ –≤—ä—Ç—Ä–µ –≤ —Ü–∏–∫—ä–ª–∞ `while True`, —Ç–æ—á–Ω–æ –ø—Ä–µ–¥–∏ –∫–æ–º–∞–Ω–¥–∞—Ç–∞ –∑–∞ –ø–∞—É–∑–∞:

    ```python
    message = Message(json.dumps({ 'soil_moisture': soil_moisture }))
    device_client.send_message(message)
    ```

    –¢–æ–∑–∏ –∫–æ–¥ —Å—ä–∑–¥–∞–≤–∞ IoT Hub `Message`, —Å—ä–¥—ä—Ä–∂–∞—â –ø–æ–∫–∞–∑–∞–Ω–∏—è—Ç–∞ –∑–∞ –≤–ª–∞–∂–Ω–æ—Å—Ç –Ω–∞ –ø–æ—á–≤–∞—Ç–∞ –∫–∞—Ç–æ JSON –Ω–∏–∑, —Å–ª–µ–¥ –∫–æ–µ—Ç–æ –≥–æ –∏–∑–ø—Ä–∞—â–∞ –∫—ä–º IoT Hub –∫–∞—Ç–æ —Å—ä–æ–±—â–µ–Ω–∏–µ –æ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∫—ä–º –æ–±–ª–∞–∫.

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ –∫–æ–º–∞–Ω–¥–∏

–í–∞—à–µ—Ç–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ —Ç—Ä—è–±–≤–∞ –¥–∞ –æ–±—Ä–∞–±–æ—Ç–≤–∞ –∫–æ–º–∞–Ω–¥–∞ –æ—Ç —Å—ä—Ä–≤—ä—Ä–Ω–∏—è –∫–æ–¥ –∑–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Ä–µ–ª–µ—Ç–æ. –¢–æ–≤–∞ —Å–µ –∏–∑–ø—Ä–∞—â–∞ –∫–∞—Ç–æ –∑–∞—è–≤–∫–∞ –∑–∞ –¥–∏—Ä–µ–∫—Ç–µ–Ω –º–µ—Ç–æ–¥.

## –ó–∞–¥–∞—á–∞ - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ –∑–∞—è–≤–∫–∞ –∑–∞ –¥–∏—Ä–µ–∫—Ç–µ–Ω –º–µ—Ç–æ–¥

1. –î–æ–±–∞–≤–µ—Ç–µ —Å–ª–µ–¥–Ω–∏—è –∫–æ–¥ –ø—Ä–µ–¥–∏ —Ü–∏–∫—ä–ª–∞ `while True`:

    ```python
    def handle_method_request(request):
        print("Direct method received - ", request.name)
    
        if request.name == "relay_on":
            relay.on()
        elif request.name == "relay_off":
            relay.off()    
    ```

    –¢–æ–≤–∞ –¥–µ—Ñ–∏–Ω–∏—Ä–∞ –º–µ—Ç–æ–¥, `handle_method_request`, –∫–æ–π—Ç–æ —â–µ –±—ä–¥–µ –∏–∑–≤–∏–∫–∞–Ω, –∫–æ–≥–∞—Ç–æ –¥–∏—Ä–µ–∫—Ç–µ–Ω –º–µ—Ç–æ–¥ –±—ä–¥–µ –∏–∑–≤–∏–∫–∞–Ω –æ—Ç IoT Hub. –í—Å–µ–∫–∏ –¥–∏—Ä–µ–∫—Ç–µ–Ω –º–µ—Ç–æ–¥ –∏–º–∞ –∏–º–µ, –∏ —Ç–æ–∑–∏ –∫–æ–¥ –æ—á–∞–∫–≤–∞ –º–µ—Ç–æ–¥, –Ω–∞—Ä–µ—á–µ–Ω `relay_on`, –∑–∞ –¥–∞ –≤–∫–ª—é—á–∏ —Ä–µ–ª–µ—Ç–æ, –∏ `relay_off`, –∑–∞ –¥–∞ –≥–æ –∏–∑–∫–ª—é—á–∏.

    > üíÅ –¢–æ–≤–∞ –º–æ–∂–µ –¥–∞ –±—ä–¥–µ —Ä–µ–∞–ª–∏–∑–∏—Ä–∞–Ω–æ –∏ –≤ –µ–¥–∏–Ω –¥–∏—Ä–µ–∫—Ç–µ–Ω –º–µ—Ç–æ–¥, –∫–∞—Ç–æ —Å–µ –ø—Ä–µ–¥–∞–¥–µ –∂–µ–ª–∞–Ω–æ—Ç–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ –Ω–∞ —Ä–µ–ª–µ—Ç–æ –≤ –ø–æ–ª–µ–∑–µ–Ω —Ç–æ–≤–∞—Ä, –∫–æ–π—Ç–æ –º–æ–∂–µ –¥–∞ –±—ä–¥–µ –ø—Ä–µ–¥–∞–¥–µ–Ω —Å—ä—Å –∑–∞—è–≤–∫–∞—Ç–∞ –∑–∞ –º–µ—Ç–æ–¥ –∏ –¥–æ—Å—Ç—ä–ø–µ–Ω –æ—Ç –æ–±–µ–∫—Ç–∞ `request`.

1. –î–∏—Ä–µ–∫—Ç–Ω–∏—Ç–µ –º–µ—Ç–æ–¥–∏ –∏–∑–∏—Å–∫–≤–∞—Ç –æ—Ç–≥–æ–≤–æ—Ä, –∑–∞ –¥–∞ –∏–Ω—Ñ–æ—Ä–º–∏—Ä–∞—Ç –∏–∑–≤–∏–∫–≤–∞—â–∏—è –∫–æ–¥, —á–µ —Å–∞ –±–∏–ª–∏ –æ–±—Ä–∞–±–æ—Ç–µ–Ω–∏. –î–æ–±–∞–≤–µ—Ç–µ —Å–ª–µ–¥–Ω–∏—è –∫–æ–¥ –≤ –∫—Ä–∞—è –Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è—Ç–∞ `handle_method_request`, –∑–∞ –¥–∞ —Å—ä–∑–¥–∞–¥–µ—Ç–µ –æ—Ç–≥–æ–≤–æ—Ä –Ω–∞ –∑–∞—è–≤–∫–∞—Ç–∞:

    ```python
    method_response = MethodResponse.create_from_method_request(request, 200)
    device_client.send_method_response(method_response)
    ```

    –¢–æ–∑–∏ –∫–æ–¥ –∏–∑–ø—Ä–∞—â–∞ –æ—Ç–≥–æ–≤–æ—Ä –Ω–∞ –∑–∞—è–≤–∫–∞—Ç–∞ –∑–∞ –¥–∏—Ä–µ–∫—Ç–µ–Ω –º–µ—Ç–æ–¥ —Å HTTP —Å—Ç–∞—Ç—É—Å –∫–æ–¥ 200 –∏ –≥–æ –≤—Ä—ä—â–∞ –∫—ä–º IoT Hub.

1. –î–æ–±–∞–≤–µ—Ç–µ —Å–ª–µ–¥–Ω–∏—è –∫–æ–¥ –ø–æ–¥ –¥–µ—Ñ–∏–Ω–∏—Ü–∏—è—Ç–∞ –Ω–∞ —Ç–∞–∑–∏ —Ñ—É–Ω–∫—Ü–∏—è:

    ```python
    device_client.on_method_request_received = handle_method_request
    ```

    –¢–æ–∑–∏ –∫–æ–¥ –∫–∞–∑–≤–∞ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞ –Ω–∞ IoT Hub –¥–∞ –∏–∑–≤–∏–∫–∞ —Ñ—É–Ω–∫—Ü–∏—è—Ç–∞ `handle_method_request`, –∫–æ–≥–∞—Ç–æ –±—ä–¥–µ –∏–∑–≤–∏–∫–∞–Ω –¥–∏—Ä–µ–∫—Ç–µ–Ω –º–µ—Ç–æ–¥.

> üíÅ –ú–æ–∂–µ—Ç–µ –¥–∞ –Ω–∞–º–µ—Ä–∏—Ç–µ —Ç–æ–∑–∏ –∫–æ–¥ –≤ –ø–∞–ø–∫–∞—Ç–∞ [code/pi](../../../../../2-farm/lessons/4-migrate-your-plant-to-the-cloud/code/pi) –∏–ª–∏ [code/virtual-device](../../../../../2-farm/lessons/4-migrate-your-plant-to-the-cloud/code/virtual-device).

üòÄ –í–∞—à–∞—Ç–∞ –ø—Ä–æ–≥—Ä–∞–º–∞ –∑–∞ —Å–µ–Ω–∑–æ—Ä –∑–∞ –≤–ª–∞–∂–Ω–æ—Å—Ç –Ω–∞ –ø–æ—á–≤–∞—Ç–∞ –µ —Å–≤—ä—Ä–∑–∞–Ω–∞ —Å –≤–∞—à–∏—è IoT Hub!

---

**–û—Ç–∫–∞–∑ –æ—Ç –æ—Ç–≥–æ–≤–æ—Ä–Ω–æ—Å—Ç**:  
–¢–æ–∑–∏ –¥–æ–∫—É–º–µ–Ω—Ç –µ –ø—Ä–µ–≤–µ–¥–µ–Ω —Å –ø–æ–º–æ—â—Ç–∞ –Ω–∞ AI —É—Å–ª—É–≥–∞ –∑–∞ –ø—Ä–µ–≤–æ–¥ [Co-op Translator](https://github.com/Azure/co-op-translator). –í—ä–ø—Ä–µ–∫–∏ —á–µ —Å–µ —Å—Ç—Ä–µ–º–∏–º –∫—ä–º —Ç–æ—á–Ω–æ—Å—Ç, –º–æ–ª—è, –∏–º–∞–π—Ç–µ –ø—Ä–µ–¥–≤–∏–¥, —á–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–∞–Ω–∏—Ç–µ –ø—Ä–µ–≤–æ–¥–∏ –º–æ–∂–µ –¥–∞ —Å—ä–¥—ä—Ä–∂–∞—Ç –≥—Ä–µ—à–∫–∏ –∏–ª–∏ –Ω–µ—Ç–æ—á–Ω–æ—Å—Ç–∏. –û—Ä–∏–≥–∏–Ω–∞–ª–Ω–∏—è—Ç –¥–æ–∫—É–º–µ–Ω—Ç –Ω–∞ –Ω–µ–≥–æ–≤–∏—è —Ä–æ–¥–µ–Ω –µ–∑–∏–∫ —Ç—Ä—è–±–≤–∞ –¥–∞ —Å–µ —Å—á–∏—Ç–∞ –∑–∞ –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç–µ–Ω –∏–∑—Ç–æ—á–Ω–∏–∫. –ó–∞ –∫—Ä–∏—Ç–∏—á–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —Å–µ –ø—Ä–µ–ø–æ—Ä—ä—á–≤–∞ –ø—Ä–æ—Ñ–µ—Å–∏–æ–Ω–∞–ª–µ–Ω —á–æ–≤–µ—à–∫–∏ –ø—Ä–µ–≤–æ–¥. –ù–∏–µ –Ω–µ –Ω–æ—Å–∏–º –æ—Ç–≥–æ–≤–æ—Ä–Ω–æ—Å—Ç –∑–∞ –Ω–µ–¥–æ—Ä–∞–∑—É–º–µ–Ω–∏—è –∏–ª–∏ –ø–æ–≥—Ä–µ—à–Ω–∏ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏, –ø—Ä–æ–∏–∑—Ç–∏—á–∞—â–∏ –æ—Ç –∏–∑–ø–æ–ª–∑–≤–∞–Ω–µ—Ç–æ –Ω–∞ —Ç–æ–∑–∏ –ø—Ä–µ–≤–æ–¥.